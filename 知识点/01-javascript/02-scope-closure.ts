/**
 * ============================================================
 * ğŸ“š ä½œç”¨åŸŸä¸é—­åŒ…
 * ============================================================
 *
 * é¢è¯•è€ƒå¯Ÿé‡ç‚¹ï¼š
 * 1. ä½œç”¨åŸŸçš„ç±»å‹å’Œä½œç”¨åŸŸé“¾
 * 2. é—­åŒ…çš„å®šä¹‰ã€åŸç†ã€åº”ç”¨åœºæ™¯
 * 3. é—­åŒ…ä¸å†…å­˜æ³„æ¼
 * 4. å—çº§ä½œç”¨åŸŸä¸æš‚æ—¶æ€§æ­»åŒº
 */

// ============================================================
// 1. ä½œç”¨åŸŸæ¦‚å¿µ
// ============================================================

/**
 * ğŸ“– ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸï¼Ÿ
 *
 * ä½œç”¨åŸŸæ˜¯å˜é‡å’Œå‡½æ•°çš„å¯è®¿é—®èŒƒå›´ï¼Œå†³å®šäº†ä»£ç ä¸­å˜é‡çš„å¯è§æ€§ã€‚
 *
 * JavaScript é‡‡ç”¨ã€è¯æ³•ä½œç”¨åŸŸã€‘ï¼ˆé™æ€ä½œç”¨åŸŸï¼‰ï¼š
 * - ä½œç”¨åŸŸåœ¨ä»£ç ç¼–å†™æ—¶å°±ç¡®å®šäº†ï¼Œè€Œéè¿è¡Œæ—¶
 * - å‡½æ•°çš„ä½œç”¨åŸŸå–å†³äºå‡½æ•°å®šä¹‰çš„ä½ç½®ï¼Œè€Œéè°ƒç”¨çš„ä½ç½®
 *
 * ğŸ“Š ä½œç”¨åŸŸç±»å‹ï¼š
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚ å…¨å±€ä½œç”¨åŸŸ       â”‚ æœ€å¤–å±‚ï¼Œåœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è®¿é—®                  â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ å‡½æ•°ä½œç”¨åŸŸ       â”‚ å‡½æ•°å†…éƒ¨ï¼Œvar å£°æ˜çš„å˜é‡                      â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ å—çº§ä½œç”¨åŸŸ       â”‚ {} å†…éƒ¨ï¼Œlet/const å£°æ˜çš„å˜é‡ï¼ˆES6ï¼‰          â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */

// è¯æ³•ä½œç”¨åŸŸç¤ºä¾‹
const globalVar = 'global';

function outer() {
  const outerVar = 'outer';

  function inner() {
    const innerVar = 'inner';
    console.log(globalVar); // 'global' - å¯ä»¥è®¿é—®å…¨å±€ä½œç”¨åŸŸ
    console.log(outerVar); // 'outer' - å¯ä»¥è®¿é—®å¤–å±‚å‡½æ•°ä½œç”¨åŸŸ
    console.log(innerVar); // 'inner' - å¯ä»¥è®¿é—®è‡ªèº«ä½œç”¨åŸŸ
  }

  inner();
}

// è¯æ³•ä½œç”¨åŸŸ vs åŠ¨æ€ä½œç”¨åŸŸ
const value = 1;

function foo() {
  console.log(value);
}

function bar() {
  const value = 2;
  foo(); // è¾“å‡º 1ï¼Œä¸æ˜¯ 2ï¼
  // å› ä¸º foo å®šä¹‰åœ¨å…¨å±€ï¼Œæ‰€ä»¥ value å–å…¨å±€çš„ 1
  // å¦‚æœæ˜¯åŠ¨æ€ä½œç”¨åŸŸï¼Œä¼šè¾“å‡º 2
}

bar();

// ============================================================
// 2. ä½œç”¨åŸŸé“¾
// ============================================================

/**
 * ğŸ“– ä½œç”¨åŸŸé“¾
 *
 * å½“è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼ŒJavaScript ä¼šä»å½“å‰ä½œç”¨åŸŸå¼€å§‹æŸ¥æ‰¾ï¼Œ
 * å¦‚æœæ‰¾ä¸åˆ°å°±å‘ä¸Šä¸€çº§ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œç›´åˆ°å…¨å±€ä½œç”¨åŸŸã€‚
 * è¿™ä¸ªæŸ¥æ‰¾é“¾è·¯å°±æ˜¯ã€ä½œç”¨åŸŸé“¾ã€‘ã€‚
 *
 * ğŸ“Š ä½œç”¨åŸŸé“¾ç¤ºæ„å›¾ï¼š
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                     å…¨å±€ä½œç”¨åŸŸ                               â”‚
 * â”‚  globalVar = 'global'                                       â”‚
 * â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
 * â”‚  â”‚                outer å‡½æ•°ä½œç”¨åŸŸ                       â”‚   â”‚
 * â”‚  â”‚  outerVar = 'outer'                                  â”‚   â”‚
 * â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
 * â”‚  â”‚  â”‚              inner å‡½æ•°ä½œç”¨åŸŸ                 â”‚    â”‚   â”‚
 * â”‚  â”‚  â”‚  innerVar = 'inner'                         â”‚    â”‚   â”‚
 * â”‚  â”‚  â”‚                                             â”‚    â”‚   â”‚
 * â”‚  â”‚  â”‚  è®¿é—® outerVar â†’ å‘ä¸ŠæŸ¥æ‰¾ â†’ æ‰¾åˆ°              â”‚    â”‚   â”‚
 * â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
 * â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * æŸ¥æ‰¾æ–¹å‘ï¼šinner â†’ outer â†’ å…¨å±€
 */

// ============================================================
// 3. var / let / const åŒºåˆ«
// ============================================================

/**
 * ğŸ“Š ä¸‰ç§å£°æ˜æ–¹å¼å¯¹æ¯”
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚   ç‰¹æ€§       â”‚    var     â”‚    let     â”‚       const          â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ ä½œç”¨åŸŸ       â”‚ å‡½æ•°ä½œç”¨åŸŸ  â”‚ å—çº§ä½œç”¨åŸŸ  â”‚ å—çº§ä½œç”¨åŸŸ            â”‚
 * â”‚ å˜é‡æå‡     â”‚ æ˜¯ï¼ˆåˆå§‹åŒ–ï¼‰â”‚ æ˜¯ï¼ˆæœªåˆå§‹åŒ–ï¼‰â”‚ æ˜¯ï¼ˆæœªåˆå§‹åŒ–ï¼‰        â”‚
 * â”‚ æš‚æ—¶æ€§æ­»åŒº   â”‚ æ—          â”‚ æœ‰          â”‚ æœ‰                   â”‚
 * â”‚ é‡å¤å£°æ˜     â”‚ å…è®¸       â”‚ ä¸å…è®¸      â”‚ ä¸å…è®¸               â”‚
 * â”‚ é‡æ–°èµ‹å€¼     â”‚ å…è®¸       â”‚ å…è®¸        â”‚ ä¸å…è®¸ï¼ˆåŸºæœ¬ç±»å‹ï¼‰    â”‚
 * â”‚ å…¨å±€å±æ€§     â”‚ æ˜¯         â”‚ å¦          â”‚ å¦                   â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */

// 3.1 å˜é‡æå‡
console.log(varVariable); // undefinedï¼ˆå·²æå‡ï¼Œä½†æœªèµ‹å€¼ï¼‰
// console.log(letVariable); // ReferenceError: Cannot access before initialization
var varVariable = 'var';
let letVariable = 'let';

// 3.2 æš‚æ—¶æ€§æ­»åŒºï¼ˆTDZ - Temporal Dead Zoneï¼‰
{
  // ä»å—å¼€å§‹åˆ° let å£°æ˜ä¹‹é—´ï¼Œå°±æ˜¯æš‚æ—¶æ€§æ­»åŒº
  // console.log(tdzVar); // ReferenceError
  let tdzVar = 'tdz';
  console.log(tdzVar); // 'tdz'
}

/**
 * ğŸ’¡ è¿½é—®ï¼šä¸ºä»€ä¹ˆæœ‰æš‚æ—¶æ€§æ­»åŒºï¼Ÿ
 *
 * ç­”ï¼šTDZ æ˜¯ä¸ºäº†è®©å¼€å‘è€…æ›´å®¹æ˜“å‘ç°é”™è¯¯ã€‚
 * - var çš„å˜é‡æå‡å®¹æ˜“å¯¼è‡´éš¾ä»¥å‘ç°çš„ bug
 * - TDZ è®©åœ¨å£°æ˜å‰ä½¿ç”¨å˜é‡ç›´æ¥æŠ¥é”™ï¼Œè€Œéå¾—åˆ° undefined
 */

// 3.3 å—çº§ä½œç”¨åŸŸ
for (var i = 0; i < 3; i++) {
  // var æ˜¯å‡½æ•°ä½œç”¨åŸŸï¼Œå¾ªç¯ç»“æŸå i ä»ç„¶å­˜åœ¨
}
console.log(i); // 3

for (let j = 0; j < 3; j++) {
  // let æ˜¯å—çº§ä½œç”¨åŸŸï¼Œå¾ªç¯ç»“æŸå j ä¸å­˜åœ¨
}
// console.log(j); // ReferenceError

// 3.4 const çš„"ä¸å¯å˜"
const obj = { name: 'Tom' };
obj.name = 'Jerry'; // å¯ä»¥ï¼const åªæ˜¯å¼•ç”¨ä¸å¯å˜ï¼Œå¯¹è±¡å†…å®¹å¯å˜
// obj = {}; // Error! ä¸èƒ½é‡æ–°èµ‹å€¼

// ============================================================
// 4. é—­åŒ…
// ============================================================

/**
 * ğŸ“– ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ
 *
 * é—­åŒ… = å‡½æ•° + å‡½æ•°èƒ½å¤Ÿè®¿é—®çš„å¤–éƒ¨å˜é‡
 *
 * æ›´å‡†ç¡®çš„å®šä¹‰ï¼š
 * å½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®å…¶æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸï¼Œ
 * å³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œï¼Œè¿™æ—¶å°±äº§ç”Ÿäº†é—­åŒ…ã€‚
 *
 * å…³é”®ç‚¹ï¼š
 * 1. å‡½æ•°åµŒå¥—
 * 2. å†…éƒ¨å‡½æ•°å¼•ç”¨äº†å¤–éƒ¨å‡½æ•°çš„å˜é‡
 * 3. å†…éƒ¨å‡½æ•°è¢«è¿”å›æˆ–ä¼ é€’åˆ°å¤–éƒ¨æ‰§è¡Œ
 */

// æœ€ç®€å•çš„é—­åŒ…
function createCounter() {
  let count = 0; // è‡ªç”±å˜é‡ï¼Œè¢«å†…éƒ¨å‡½æ•°å¼•ç”¨
  return function () {
    return ++count;
  };
}

const counter = createCounter();
console.log(counter()); // 1
console.log(counter()); // 2
console.log(counter()); // 3

/**
 * ğŸ“Š é—­åŒ…å†…å­˜æ¨¡å‹ï¼š
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                         å † Heap                             â”‚
 * â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
 * â”‚  â”‚ createCounter çš„é—­åŒ…                                   â”‚ â”‚
 * â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
 * â”‚  â”‚  â”‚ count = 3                                       â”‚  â”‚ â”‚
 * â”‚  â”‚  â”‚ function() { return ++count }                   â”‚  â”‚ â”‚
 * â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
 * â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * counter å˜é‡å¼•ç”¨äº†è¿™ä¸ªé—­åŒ…ï¼Œæ‰€ä»¥ count ä¸ä¼šè¢«å›æ”¶
 */

// ============================================================
// 5. é—­åŒ…çš„åº”ç”¨åœºæ™¯
// ============================================================

// 5.1 æ•°æ®ç§æœ‰åŒ– / æ¨¡å—åŒ–
function createModule() {
  // ç§æœ‰å˜é‡
  let privateData = 'secret';

  return {
    // å…¬å¼€æ–¹æ³•
    getData() {
      return privateData;
    },
    setData(value: string) {
      privateData = value;
    },
  };
}

const module = createModule();
console.log(module.getData()); // 'secret'
// console.log(module.privateData); // undefinedï¼Œæ— æ³•ç›´æ¥è®¿é—®

// 5.2 å‡½æ•°å·¥å‚
function createMultiplier(multiplier: number) {
  return function (num: number) {
    return num * multiplier;
  };
}

const double = createMultiplier(2);
const triple = createMultiplier(3);
console.log(double(5)); // 10
console.log(triple(5)); // 15

// 5.3 ç¼“å­˜ï¼ˆè®°å¿†åŒ–ï¼‰
function memoize<T extends (...args: any[]) => any>(fn: T): T {
  const cache = new Map();
  return function (...args: Parameters<T>): ReturnType<T> {
    const key = JSON.stringify(args);
    if (cache.has(key)) {
      return cache.get(key);
    }
    const result = fn(...args);
    cache.set(key, result);
    return result;
  } as T;
}

// 5.4 é˜²æŠ–/èŠ‚æµï¼ˆè¯¦è§æ‰‹å†™ä»£ç ç« èŠ‚ï¼‰
function debounce<T extends (...args: any[]) => any>(fn: T, delay: number) {
  let timer: ReturnType<typeof setTimeout> | null = null;
  return function (this: any, ...args: Parameters<T>) {
    if (timer) clearTimeout(timer);
    timer = setTimeout(() => {
      fn.apply(this, args);
    }, delay);
  };
}

// 5.5 React Hooksï¼ˆåˆ©ç”¨é—­åŒ…ä¿å­˜çŠ¶æ€ï¼‰
/**
 * useState ç®€åŒ–åŸç†ï¼š
 *
 * let state;
 * function useState(initialValue) {
 *   state = state ?? initialValue;
 *   function setState(newValue) {
 *     state = newValue;
 *     render(); // è§¦å‘é‡æ–°æ¸²æŸ“
 *   }
 *   return [state, setState];
 * }
 */

// ============================================================
// 6. ç»å…¸é—­åŒ…é—®é¢˜
// ============================================================

// 6.1 å¾ªç¯ä¸­çš„é—­åŒ…é—®é¢˜
// é—®é¢˜ä»£ç 
for (var i = 0; i < 3; i++) {
  setTimeout(function () {
    console.log(i); // è¾“å‡º 3, 3, 3
  }, 100);
}
// åŸå› ï¼švar æ˜¯å‡½æ•°ä½œç”¨åŸŸï¼Œå¾ªç¯ç»“æŸæ—¶ i = 3ï¼Œæ‰€æœ‰å›è°ƒå…±äº«åŒä¸€ä¸ª i

// è§£å†³æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ letï¼ˆå—çº§ä½œç”¨åŸŸï¼‰
for (let i = 0; i < 3; i++) {
  setTimeout(function () {
    console.log(i); // è¾“å‡º 0, 1, 2
  }, 100);
}

// è§£å†³æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ IIFE åˆ›å»ºæ–°ä½œç”¨åŸŸ
for (var i = 0; i < 3; i++) {
  (function (j) {
    setTimeout(function () {
      console.log(j); // è¾“å‡º 0, 1, 2
    }, 100);
  })(i);
}

// è§£å†³æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ setTimeout ç¬¬ä¸‰ä¸ªå‚æ•°
for (var i = 0; i < 3; i++) {
  setTimeout(
    function (j) {
      console.log(j); // è¾“å‡º 0, 1, 2
    },
    100,
    i
  );
}

// ============================================================
// 7. é—­åŒ…ä¸å†…å­˜
// ============================================================

/**
 * ğŸ“– é—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„æ¼å—ï¼Ÿ
 *
 * é—­åŒ…æœ¬èº«ä¸ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œä½†ä¸å½“ä½¿ç”¨å¯èƒ½ä¼šï¼š
 * 1. ä¸éœ€è¦çš„é—­åŒ…æ²¡æœ‰è¢«é‡Šæ”¾
 * 2. é—­åŒ…å¼•ç”¨äº† DOM å…ƒç´ 
 * 3. å¾ªç¯å¼•ç”¨
 *
 * è§£å†³æ–¹æ¡ˆï¼š
 * - åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¼•ç”¨ï¼ˆç½®ä¸º nullï¼‰
 * - ä½¿ç”¨ WeakMap/WeakSet å­˜å‚¨å¯¹è±¡å¼•ç”¨
 * - æ³¨æ„äº‹ä»¶ç›‘å¬å™¨çš„ç§»é™¤
 */

// å†…å­˜æ³„æ¼ç¤ºä¾‹
function leakExample() {
  const largeData = new Array(1000000).fill('x');

  return function () {
    // å³ä½¿ä¸ä½¿ç”¨ largeDataï¼Œå®ƒä¹Ÿä¸ä¼šè¢«å›æ”¶
    console.log('leaked');
  };
}

// ä¼˜åŒ–ç‰ˆæœ¬
function optimizedExample() {
  let largeData: string[] | null = new Array(1000000).fill('x');
  const result = processData(largeData);

  // å¤„ç†å®Œåé‡Šæ”¾å¤§æ•°æ®
  largeData = null;

  return function () {
    console.log(result);
  };
}

function processData(data: string[]): number {
  return data.length;
}

// DOM ç›¸å…³çš„å†…å­˜æ³„æ¼
/**
 * // é—®é¢˜ä»£ç 
 * function bindEvent() {
 *   const element = document.getElementById('button');
 *   element.onclick = function() {
 *     console.log(element.id); // é—­åŒ…å¼•ç”¨äº† element
 *   };
 * }
 *
 * // ä¼˜åŒ–ä»£ç 
 * function bindEventOptimized() {
 *   const element = document.getElementById('button');
 *   const id = element.id;
 *   element.onclick = function() {
 *     console.log(id); // åªå¼•ç”¨å¿…è¦çš„æ•°æ®
 *   };
 *   // æˆ–è€…åœ¨ä¸éœ€è¦æ—¶ç§»é™¤å¼•ç”¨
 *   // element = null;
 * }
 */

// ============================================================
// 8. é«˜é¢‘é¢è¯•é¢˜
// ============================================================

/**
 * é¢˜ç›® 1ï¼šä¸‹é¢ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ
 */
function test1() {
  var a = 1;
  function inner() {
    console.log(a);
    var a = 2;
  }
  inner();
}
// test1(); // è¾“å‡º undefinedï¼ˆå˜é‡æå‡ï¼‰

/**
 * é¢˜ç›® 2ï¼šä¸‹é¢ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ
 */
var a = 10;
function test2() {
  console.log(a);
  a = 5;
  console.log(window.a);
  var a;
  console.log(a);
}
// test2();
// è¾“å‡ºï¼šundefined, 10, 5
// è§£æï¼šå‡½æ•°å†…çš„ var a è¢«æå‡ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ª a æ˜¯ undefined
// window.a æ˜¯å…¨å±€çš„ a = 10
// æœ€å a = 5

/**
 * é¢˜ç›® 3ï¼šå®ç°ä¸€ä¸ªåªèƒ½æ‰§è¡Œä¸€æ¬¡çš„å‡½æ•°
 */
function once<T extends (...args: any[]) => any>(fn: T): T {
  let called = false;
  let result: ReturnType<T>;

  return function (this: any, ...args: Parameters<T>): ReturnType<T> {
    if (!called) {
      called = true;
      result = fn.apply(this, args);
    }
    return result;
  } as T;
}

/**
 * é¢˜ç›® 4ï¼šå®ç°å‡½æ•°æŸ¯é‡ŒåŒ–
 */
function curry(fn: Function) {
  return function curried(...args: any[]): any {
    if (args.length >= fn.length) {
      return fn.apply(null, args);
    }
    return function (...moreArgs: any[]) {
      return curried.apply(null, args.concat(moreArgs));
    };
  };
}

// ä½¿ç”¨ç¤ºä¾‹
function add(a: number, b: number, c: number) {
  return a + b + c;
}
const curriedAdd = curry(add);
console.log(curriedAdd(1)(2)(3)); // 6
console.log(curriedAdd(1, 2)(3)); // 6
console.log(curriedAdd(1)(2, 3)); // 6

export { createCounter, createModule, memoize, debounce, once, curry };

