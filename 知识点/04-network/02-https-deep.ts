/**
 * ============================================================
 * 📚 HTTPS 深入
 * ============================================================
 *
 * 面试考察重点：
 * 1. HTTPS 原理
 * 2. TLS 握手过程
 * 3. 证书验证
 * 4. HTTPS 性能优化
 */

// ============================================================
// 1. HTTPS 基础
// ============================================================

/**
 * 📖 什么是 HTTPS？
 *
 * HTTPS = HTTP + TLS/SSL
 *
 * - HTTP 是明文传输，不安全
 * - HTTPS 在 HTTP 和 TCP 之间加入 TLS 层
 * - 提供：加密、完整性、身份验证
 *
 * 📊 协议栈对比
 *
 * HTTP:          HTTPS:
 * ┌─────────┐    ┌─────────┐
 * │  HTTP   │    │  HTTP   │
 * ├─────────┤    ├─────────┤
 * │  TCP    │    │  TLS    │  ← 加密层
 * ├─────────┤    ├─────────┤
 * │  IP     │    │  TCP    │
 * └─────────┘    ├─────────┤
 *                │  IP     │
 *                └─────────┘
 */

/**
 * 📊 HTTPS 解决的问题
 *
 * 1. 窃听（Eavesdropping）
 *    - 问题：中间人可以截获明文数据
 *    - 解决：对称加密保护数据
 *
 * 2. 篡改（Tampering）
 *    - 问题：中间人可以修改数据
 *    - 解决：消息认证码（MAC）验证完整性
 *
 * 3. 冒充（Impersonation）
 *    - 问题：无法确认对方身份
 *    - 解决：数字证书验证服务器身份
 */

// ============================================================
// 2. 加密算法
// ============================================================

/**
 * 📊 对称加密
 *
 * - 加密和解密使用同一个密钥
 * - 速度快，适合大量数据
 * - 问题：如何安全地传输密钥？
 *
 * 常见算法：
 * - AES（推荐）
 * - ChaCha20（移动设备）
 * - DES/3DES（已淘汰）
 */

/**
 * 📊 非对称加密
 *
 * - 公钥加密，私钥解密
 * - 私钥签名，公钥验证
 * - 速度慢，适合小量数据
 * - 解决密钥交换问题
 *
 * 常见算法：
 * - RSA
 * - ECDSA（椭圆曲线）
 * - ECDHE（密钥交换）
 */

/**
 * 📊 混合加密（HTTPS 实际使用）
 *
 * 1. 非对称加密交换密钥
 * 2. 对称加密传输数据
 *
 * ┌─────────────────────────────────────────────────────────────┐
 * │ 客户端                               服务端                  │
 * │                                                             │
 * │          ← 非对称加密交换会话密钥 →                          │
 * │                                                             │
 * │          ← 对称加密传输实际数据 →                            │
 * └─────────────────────────────────────────────────────────────┘
 */

// ============================================================
// 3. TLS 握手（TLS 1.2）
// ============================================================

/**
 * 📊 TLS 1.2 握手过程（RSA 密钥交换）
 *
 * 客户端                                      服务端
 *    │                                           │
 *    │ ──── ClientHello ───────────────────────► │
 *    │      支持的协议版本、加密套件、随机数 A      │
 *    │                                           │
 *    │ ◄─── ServerHello ─────────────────────── │
 *    │      选择的协议版本、加密套件、随机数 B      │
 *    │                                           │
 *    │ ◄─── Certificate ─────────────────────── │
 *    │      服务器证书（含公钥）                   │
 *    │                                           │
 *    │ ◄─── ServerHelloDone ─────────────────── │
 *    │                                           │
 *    │      客户端验证证书                        │
 *    │      生成预主密钥（Pre-Master Secret）     │
 *    │      用服务器公钥加密                      │
 *    │                                           │
 *    │ ──── ClientKeyExchange ─────────────────► │
 *    │      加密的预主密钥                        │
 *    │                                           │
 *    │      双方计算会话密钥：                    │
 *    │      Key = PRF(预主密钥, 随机数A, 随机数B) │
 *    │                                           │
 *    │ ──── ChangeCipherSpec ──────────────────► │
 *    │ ──── Finished ──────────────────────────► │
 *    │                                           │
 *    │ ◄─── ChangeCipherSpec ─────────────────── │
 *    │ ◄─── Finished ─────────────────────────── │
 *    │                                           │
 *    │            开始加密通信                    │
 *
 * RTT：2-RTT
 */

// ============================================================
// 4. TLS 1.3
// ============================================================

/**
 * 📊 TLS 1.3 改进
 *
 * 1. 更快的握手
 *    - 首次连接：1-RTT（减少一次往返）
 *    - 重连：0-RTT（直接发送数据）
 *
 * 2. 更安全
 *    - 移除不安全的加密算法（RSA 密钥交换、SHA-1 等）
 *    - 只支持 AEAD 加密模式
 *    - 握手消息加密
 *
 * 3. 简化的密码套件
 *    - 只有 5 个密码套件
 *    - 强制使用前向保密（PFS）
 */

/**
 * 📊 TLS 1.3 握手过程
 *
 * 客户端                                      服务端
 *    │                                           │
 *    │ ──── ClientHello ───────────────────────► │
 *    │      支持的协议、密钥共享参数               │
 *    │                                           │
 *    │ ◄─── ServerHello ─────────────────────── │
 *    │      选择的协议、密钥共享参数               │
 *    │ ◄─── EncryptedExtensions ───────────────  │
 *    │ ◄─── Certificate ─────────────────────── │
 *    │ ◄─── CertificateVerify ─────────────────  │
 *    │ ◄─── Finished ─────────────────────────── │
 *    │                                           │
 *    │ ──── Finished ──────────────────────────► │
 *    │                                           │
 *    │            开始加密通信                    │
 *
 * RTT：1-RTT（首次）或 0-RTT（重连）
 */

/**
 * 📊 0-RTT 原理
 *
 * 首次连接成功后，服务器发送 Session Ticket。
 * 重连时：
 *
 * 客户端                                      服务端
 *    │                                           │
 *    │ ──── ClientHello + Early Data ──────────► │
 *    │      携带 Session Ticket 和加密的应用数据  │
 *    │                                           │
 *    │            立即处理请求                    │
 *
 * 注意：0-RTT 存在重放攻击风险，只适合幂等请求
 */

// ============================================================
// 5. 证书与 CA
// ============================================================

/**
 * 📊 数字证书内容
 *
 * - 证书持有者信息
 * - 持有者公钥
 * - 颁发机构（CA）
 * - 有效期
 * - 证书序列号
 * - CA 的数字签名
 */

/**
 * 📊 证书链验证
 *
 * ┌─────────────────────┐
 * │ 根证书（Root CA）    │  ← 预装在系统/浏览器中
 * │ 自签名，可信源       │
 * └──────────┬──────────┘
 *            │ 签名
 *            ▼
 * ┌─────────────────────┐
 * │ 中间证书（ICA）      │  ← 由根 CA 签名
 * │                     │
 * └──────────┬──────────┘
 *            │ 签名
 *            ▼
 * ┌─────────────────────┐
 * │ 服务器证书           │  ← 由中间 CA 签名
 * │ example.com         │
 * └─────────────────────┘
 *
 * 验证过程：
 * 1. 用中间 CA 公钥验证服务器证书签名
 * 2. 用根 CA 公钥验证中间证书签名
 * 3. 根 CA 在可信列表中
 */

/**
 * 📊 证书类型
 *
 * DV（Domain Validation）：
 * - 只验证域名所有权
 * - 自动化颁发，便宜/免费
 * - 适合个人网站
 *
 * OV（Organization Validation）：
 * - 验证组织身份
 * - 人工审核
 * - 适合企业网站
 *
 * EV（Extended Validation）：
 * - 严格的身份验证
 * - 浏览器显示公司名（已取消）
 * - 适合金融、政府
 */

// ============================================================
// 6. HTTPS 性能优化
// ============================================================

/**
 * 📊 优化策略
 *
 * 1. 升级到 TLS 1.3
 *    - 更少的 RTT
 *    - 更高效的加密
 *
 * 2. 启用 OCSP Stapling
 *    - 服务器缓存证书状态
 *    - 避免客户端额外请求 CA
 *
 * 3. 会话复用
 *    - Session ID
 *    - Session Ticket
 *    - 减少完整握手
 *
 * 4. 启用 HSTS
 *    - 强制使用 HTTPS
 *    - 避免 HTTP → HTTPS 跳转
 *
 * 5. 证书优化
 *    - 使用 ECDSA 证书（比 RSA 更小更快）
 *    - 减少证书链长度
 *
 * 6. 启用 HTTP/2 或 HTTP/3
 *    - 复用连接，减少握手次数
 */

/**
 * 📊 HSTS（HTTP Strict Transport Security）
 *
 * 响应头：
 * Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
 *
 * 作用：
 * - 告诉浏览器只使用 HTTPS 访问
 * - 防止 SSL 剥离攻击
 * - 避免 HTTP → HTTPS 跳转
 *
 * HSTS Preload：
 * - 将域名加入浏览器内置列表
 * - 首次访问也强制 HTTPS
 */

// ============================================================
// 7. 高频面试题
// ============================================================

/**
 * 题目 1：HTTPS 的加密过程？
 *
 * 1. TCP 三次握手
 * 2. TLS 握手
 *    - 协商协议版本、加密套件
 *    - 验证服务器证书
 *    - 密钥交换，生成会话密钥
 * 3. 使用会话密钥进行对称加密通信
 *
 * 混合加密：
 * - 非对称加密交换密钥
 * - 对称加密传输数据
 */

/**
 * 题目 2：TLS 1.2 和 TLS 1.3 的区别？
 *
 * 握手速度：
 * - TLS 1.2：2-RTT
 * - TLS 1.3：1-RTT，重连 0-RTT
 *
 * 安全性：
 * - TLS 1.3 移除了不安全算法
 * - TLS 1.3 强制前向保密
 * - TLS 1.3 握手消息加密
 *
 * 密码套件：
 * - TLS 1.2：数十种
 * - TLS 1.3：5 种
 */

/**
 * 题目 3：什么是中间人攻击？HTTPS 如何防止？
 *
 * 中间人攻击：
 * - 攻击者在客户端和服务器之间
 * - 分别与双方建立连接
 * - 可以窃听和篡改数据
 *
 * HTTPS 防止方式：
 * - 证书验证：确认服务器身份
 * - 证书链：确保证书来自可信 CA
 * - 证书绑定：防止伪造证书
 *
 * 注意：用户忽略证书警告会被攻击
 */

/**
 * 题目 4：什么是前向保密（Perfect Forward Secrecy）？
 *
 * 定义：即使服务器私钥泄露，也无法解密历史通信。
 *
 * 实现：
 * - 使用临时的密钥交换（ECDHE）
 * - 每次连接生成新的会话密钥
 * - 私钥只用于签名，不参与密钥交换
 *
 * RSA 密钥交换没有前向保密：
 * - 预主密钥用服务器公钥加密
 * - 私钥泄露可以解密所有历史通信
 */

export {};

