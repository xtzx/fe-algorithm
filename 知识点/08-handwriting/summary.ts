/**
 * ============================================================
 * ğŸ“š æ‰‹å†™ä»£ç  - é«˜é¢‘é¢è¯•é¢˜æ±‡æ€»
 * ============================================================
 *
 * æŒ‰ç…§é¢è¯•é¢‘ç‡å’Œéš¾åº¦è¿›è¡Œåˆ†ç±»
 * åŒ…å«å¸¸è§è¿½é—®å’Œæ˜“é”™ç‚¹
 */

// ============================================================
// ğŸ”¥ğŸ”¥ğŸ”¥ é«˜é¢‘å¿…è€ƒé¢˜
// ============================================================

/**
 * 1. æ‰‹å†™ Promise
 *
 * æ ¸å¿ƒè¦ç‚¹ï¼š
 * - ä¸‰ç§çŠ¶æ€ï¼špendingã€fulfilledã€rejected
 * - çŠ¶æ€ä¸å¯é€†
 * - then è¿”å›æ–°çš„ Promise
 * - å›è°ƒå¼‚æ­¥æ‰§è¡Œï¼ˆqueueMicrotaskï¼‰
 *
 * âš ï¸ æ˜“é”™ç‚¹ï¼š
 * - then å¿…é¡»è¿”å›æ–° Promise
 * - å¤„ç† thenable å¯¹è±¡
 * - é˜²æ­¢é‡å¤è°ƒç”¨
 *
 * ğŸ’¡ è¿½é—®ï¼šPromise.all å’Œ allSettled çš„åŒºåˆ«ï¼Ÿ
 * - allï¼šä¸€ä¸ªå¤±è´¥å…¨éƒ¨å¤±è´¥
 * - allSettledï¼šç­‰å¾…å…¨éƒ¨å®Œæˆ
 */

/**
 * 2. æ‰‹å†™é˜²æŠ–å’ŒèŠ‚æµ
 *
 * é˜²æŠ–ï¼ˆDebounceï¼‰ï¼š
 * - å»¶è¿Ÿæ‰§è¡Œï¼ŒæœŸé—´å†è§¦å‘é‡æ–°è®¡æ—¶
 * - åœºæ™¯ï¼šæœç´¢æ¡†ã€resize
 *
 * èŠ‚æµï¼ˆThrottleï¼‰ï¼š
 * - å›ºå®šé—´éš”æ‰§è¡Œä¸€æ¬¡
 * - åœºæ™¯ï¼šæ»šåŠ¨ã€æ‹–æ‹½
 *
 * âš ï¸ æ˜“é”™ç‚¹ï¼š
 * - this å’Œå‚æ•°ä¼ é€’
 * - leading/trailing é€‰é¡¹
 * - cancel æ–¹æ³•
 *
 * ğŸ’¡ è¿½é—®ï¼šå¦‚ä½•å®ç° maxWaitï¼Ÿ
 * - è¶…è¿‡æœ€å¤§ç­‰å¾…æ—¶é—´å¼ºåˆ¶æ‰§è¡Œ
 * - lodash çš„ throttle å°±æ˜¯å¸¦ maxWait çš„ debounce
 */

/**
 * 3. æ‰‹å†™æ·±æ‹·è´
 *
 * è¦ç‚¹ï¼š
 * - å¤„ç†åŸºæœ¬ç±»å‹
 * - å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆWeakMapï¼‰
 * - å¤„ç†ç‰¹æ®Šç±»å‹ï¼ˆDateã€RegExpã€Mapã€Setï¼‰
 * - å¤„ç† Symbol å±æ€§
 *
 * âš ï¸ æ˜“é”™ç‚¹ï¼š
 * - JSON.stringify çš„é—®é¢˜
 * - å¿˜è®°å¤„ç†åŸå‹é“¾
 * - WeakMap vs Map
 *
 * ğŸ’¡ è¿½é—®ï¼šstructuredClone å’Œæ‰‹å†™çš„åŒºåˆ«ï¼Ÿ
 * - åŸç”Ÿ APIï¼Œæ€§èƒ½å¥½
 * - ä¸æ”¯æŒå‡½æ•°
 */

/**
 * 4. æ‰‹å†™ call / apply / bind
 *
 * call/applyï¼š
 * - å°†å‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨
 * - ç”¨ Symbol é¿å…å±æ€§å†²çª
 *
 * bindï¼š
 * - è¿”å›æ–°å‡½æ•°
 * - æ”¯æŒæŸ¯é‡ŒåŒ–
 * - new è°ƒç”¨æ—¶ this æŒ‡å‘æ–°å¯¹è±¡
 *
 * âš ï¸ æ˜“é”™ç‚¹ï¼š
 * - null/undefined å¤„ç†
 * - bind è¿”å›çš„å‡½æ•°å¯ä»¥è¢« new
 *
 * ğŸ’¡ è¿½é—®ï¼šä¸‰è€…çš„åŒºåˆ«ï¼Ÿ
 * - callï¼šç«‹å³æ‰§è¡Œï¼Œå‚æ•°é€ä¸ªä¼ 
 * - applyï¼šç«‹å³æ‰§è¡Œï¼Œå‚æ•°æ•°ç»„ä¼ 
 * - bindï¼šè¿”å›æ–°å‡½æ•°
 */

/**
 * 5. æ‰‹å†™ new æ“ä½œç¬¦
 *
 * æ­¥éª¤ï¼š
 * 1. åˆ›å»ºæ–°å¯¹è±¡
 * 2. é“¾æ¥åŸå‹
 * 3. ç»‘å®š this æ‰§è¡Œæ„é€ å‡½æ•°
 * 4. è¿”å›å¯¹è±¡
 *
 * âš ï¸ æ˜“é”™ç‚¹ï¼š
 * - æ„é€ å‡½æ•°è¿”å›å¯¹è±¡æ—¶ä½¿ç”¨è¯¥å¯¹è±¡
 *
 * ğŸ’¡ è¿½é—®ï¼šnew å’Œ Object.create çš„åŒºåˆ«ï¼Ÿ
 * - newï¼šæ‰§è¡Œæ„é€ å‡½æ•°
 * - Object.createï¼šåªé“¾æ¥åŸå‹ï¼Œä¸æ‰§è¡Œ
 */

// ============================================================
// ğŸ”¥ğŸ”¥ è¿›é˜¶æ‰‹å†™é¢˜
// ============================================================

/**
 * 6. æ‰‹å†™ EventEmitter
 *
 * è¦ç‚¹ï¼š
 * - on/off/emit/once
 * - æ”¯æŒå¤šä¸ªç›‘å¬å™¨
 *
 * âš ï¸ æ˜“é”™ç‚¹ï¼š
 * - once çš„å®ç°ï¼ˆåŒ…è£… + è‡ªåŠ¨ç§»é™¤ï¼‰
 * - åœ¨å›è°ƒä¸­ä¿®æ”¹ç›‘å¬å™¨æ•°ç»„
 *
 * ğŸ’¡ è¿½é—®ï¼šå¦‚ä½•é˜²æ­¢å†…å­˜æ³„æ¼ï¼Ÿ
 * - ç»„ä»¶å¸è½½æ—¶ off
 * - è®¾ç½®æœ€å¤§ç›‘å¬å™¨æ•°é‡è­¦å‘Š
 */

/**
 * 7. æ‰‹å†™ instanceof
 *
 * åŸç†ï¼š
 * - æ²¿ç€åŸå‹é“¾æŸ¥æ‰¾
 * - æ‰¾åˆ° constructor.prototype è¿”å› true
 *
 * âš ï¸ æ˜“é”™ç‚¹ï¼š
 * - åŸºæœ¬ç±»å‹è¿”å› false
 *
 * ğŸ’¡ è¿½é—®ï¼šå’Œ typeof çš„åŒºåˆ«ï¼Ÿ
 * - typeofï¼šè¿”å›ç±»å‹å­—ç¬¦ä¸²
 * - instanceofï¼šæ£€æŸ¥åŸå‹é“¾
 */

/**
 * 8. æ‰‹å†™æŸ¯é‡ŒåŒ–
 *
 * åŸç†ï¼š
 * - å‚æ•°å¤Ÿäº†æ‰§è¡Œ
 * - ä¸å¤Ÿè¿”å›æ–°å‡½æ•°ç»§ç»­æ”¶é›†
 *
 * âš ï¸ æ˜“é”™ç‚¹ï¼š
 * - ä½¿ç”¨ fn.length åˆ¤æ–­å‚æ•°æ•°é‡
 *
 * ğŸ’¡ è¿½é—®ï¼šæŸ¯é‡ŒåŒ–æœ‰ä»€ä¹ˆç”¨ï¼Ÿ
 * - å‚æ•°å¤ç”¨
 * - å»¶è¿Ÿæ‰§è¡Œ
 * - å‡½æ•°ç»„åˆ
 */

/**
 * 9. æ‰‹å†™ Promise å¹¶å‘æ§åˆ¶
 *
 * è¦ç‚¹ï¼š
 * - ç»´æŠ¤æ‰§è¡Œä¸­çš„é˜Ÿåˆ—
 * - è¾¾åˆ°é™åˆ¶æ—¶ç­‰å¾…
 * - å®Œæˆä¸€ä¸ªæ‰§è¡Œä¸‹ä¸€ä¸ª
 *
 * âš ï¸ æ˜“é”™ç‚¹ï¼š
 * - ä¿æŒæ‰§è¡Œé¡ºåº
 * - é”™è¯¯å¤„ç†
 *
 * ğŸ’¡ è¿½é—®ï¼šä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘æ§åˆ¶ï¼Ÿ
 * - é¿å…è¯·æ±‚è¿‡å¤š
 * - é¿å…æœåŠ¡å™¨å‹åŠ›
 */

/**
 * 10. æ‰‹å†™æ•°ç»„æ–¹æ³•ï¼ˆmap/reduce/flatï¼‰
 *
 * mapï¼š
 * - è¿”å›æ–°æ•°ç»„
 * - å›è°ƒå‚æ•°ï¼šitem, index, array
 *
 * reduceï¼š
 * - ç´¯åŠ å™¨
 * - å¯é€‰åˆå§‹å€¼
 *
 * flatï¼š
 * - é€’å½’å±•å¼€
 * - æ”¯æŒæ·±åº¦å‚æ•°
 *
 * âš ï¸ æ˜“é”™ç‚¹ï¼š
 * - reduce æ— åˆå§‹å€¼æ—¶ä½¿ç”¨ç¬¬ä¸€ä¸ªå…ƒç´ 
 * - ç¨€ç–æ•°ç»„å¤„ç†
 */

// ============================================================
// ğŸ“ è®¾è®¡æ¨¡å¼æ‰‹å†™
// ============================================================

/**
 * 11. å•ä¾‹æ¨¡å¼
 *
 * è¦ç‚¹ï¼š
 * - ç§æœ‰æ„é€ å‡½æ•°
 * - é™æ€ getInstance æ–¹æ³•
 *
 * åœºæ™¯ï¼šå…¨å±€çŠ¶æ€ã€é…ç½®ã€æ—¥å¿—
 */

/**
 * 12. å‘å¸ƒè®¢é˜…æ¨¡å¼
 *
 * è¦ç‚¹ï¼š
 * - äº‹ä»¶ä¸­å¿ƒ
 * - å‘å¸ƒè€…å’Œè®¢é˜…è€…è§£è€¦
 *
 * åœºæ™¯ï¼šç»„ä»¶é€šä¿¡ã€äº‹ä»¶æ€»çº¿
 */

/**
 * 13. è§‚å¯Ÿè€…æ¨¡å¼
 *
 * è¦ç‚¹ï¼š
 * - Subject æŒæœ‰ Observer
 * - çŠ¶æ€å˜åŒ–é€šçŸ¥ Observer
 *
 * åœºæ™¯ï¼šVue å“åº”å¼
 */

// ============================================================
// ğŸ¯ èµ„æ·±è¿½é—®æ¸…å•
// ============================================================

/**
 * è¿½é—® 1ï¼šasync/await çš„åŸç†ï¼Ÿ
 *
 * - åŸºäº Generator + è‡ªåŠ¨æ‰§è¡Œå™¨
 * - await ç›¸å½“äº yield + then
 */

const asyncAwaitImpl = `
function asyncToGenerator(generatorFn) {
  return function(...args) {
    const gen = generatorFn.apply(this, args);
    
    return new Promise((resolve, reject) => {
      function step(key, arg) {
        let result;
        try {
          result = gen[key](arg);
        } catch (error) {
          return reject(error);
        }
        
        if (result.done) {
          return resolve(result.value);
        }
        
        Promise.resolve(result.value).then(
          val => step('next', val),
          err => step('throw', err)
        );
      }
      
      step('next');
    });
  };
}
`;

/**
 * è¿½é—® 2ï¼šå¦‚ä½•å®ç° Promise.retryï¼Ÿ
 */

const promiseRetryImpl = `
function retry(fn, retries = 3, delay = 1000) {
  return new Promise((resolve, reject) => {
    const attempt = (remaining) => {
      fn()
        .then(resolve)
        .catch(err => {
          if (remaining <= 0) {
            reject(err);
          } else {
            setTimeout(() => attempt(remaining - 1), delay);
          }
        });
    };
    attempt(retries);
  });
}
`;

/**
 * è¿½é—® 3ï¼šå¦‚ä½•å®ç° LRU ç¼“å­˜ï¼Ÿ
 */

const lruCacheImpl = `
class LRUCache {
  private capacity: number;
  private cache: Map<any, any>;

  constructor(capacity: number) {
    this.capacity = capacity;
    this.cache = new Map();
  }

  get(key: any) {
    if (!this.cache.has(key)) return -1;
    
    const value = this.cache.get(key);
    // ç§»åˆ°æœ€åï¼ˆæœ€è¿‘ä½¿ç”¨ï¼‰
    this.cache.delete(key);
    this.cache.set(key, value);
    return value;
  }

  put(key: any, value: any) {
    if (this.cache.has(key)) {
      this.cache.delete(key);
    } else if (this.cache.size >= this.capacity) {
      // åˆ é™¤æœ€ä¹…æœªä½¿ç”¨ï¼ˆç¬¬ä¸€ä¸ªï¼‰
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }
}
`;

// ============================================================
// ğŸ“‹ é¢è¯•å‡†å¤‡ Checklist
// ============================================================

/**
 * âœ… Promise ç›¸å…³
 *    - [ ] Promise å®Œæ•´å®ç°
 *    - [ ] Promise.all / race / allSettled / any
 *    - [ ] å¹¶å‘æ§åˆ¶
 *    - [ ] é‡è¯•æœºåˆ¶
 *
 * âœ… å‡½æ•°ç›¸å…³
 *    - [ ] call / apply / bind
 *    - [ ] debounce / throttle
 *    - [ ] æŸ¯é‡ŒåŒ–
 *    - [ ] ç»„åˆå‡½æ•°
 *
 * âœ… å¯¹è±¡ç›¸å…³
 *    - [ ] æ·±æ‹·è´
 *    - [ ] new æ“ä½œç¬¦
 *    - [ ] instanceof
 *
 * âœ… æ•°ç»„ç›¸å…³
 *    - [ ] map / reduce / filter
 *    - [ ] flat
 *
 * âœ… è®¾è®¡æ¨¡å¼
 *    - [ ] EventEmitter
 *    - [ ] å•ä¾‹æ¨¡å¼
 *    - [ ] è§‚å¯Ÿè€…æ¨¡å¼
 *    - [ ] ç­–ç•¥æ¨¡å¼
 */

// ============================================================
// ğŸ“š æ‰‹å†™ä»£ç è¯„åˆ†æ ‡å‡†
// ============================================================

/**
 * ğŸ’¯ è¯„åˆ†ç»´åº¦
 *
 * 1. æ­£ç¡®æ€§ï¼ˆ40%ï¼‰
 *    - æ ¸å¿ƒåŠŸèƒ½å®ç°æ­£ç¡®
 *    - è¾¹ç•Œæƒ…å†µå¤„ç†
 *
 * 2. å®Œæ•´æ€§ï¼ˆ30%ï¼‰
 *    - å‚æ•°æ ¡éªŒ
 *    - é”™è¯¯å¤„ç†
 *    - ç±»å‹å¤„ç†
 *
 * 3. ä»£ç è´¨é‡ï¼ˆ20%ï¼‰
 *    - å¯è¯»æ€§
 *    - å‘½åè§„èŒƒ
 *    - ä»£ç ç»“æ„
 *
 * 4. æ‰©å±•æ€è€ƒï¼ˆ10%ï¼‰
 *    - æ€§èƒ½ä¼˜åŒ–
 *    - å®é™…åº”ç”¨åœºæ™¯
 *    - ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”
 */

export {
  asyncAwaitImpl,
  promiseRetryImpl,
  lruCacheImpl,
};

