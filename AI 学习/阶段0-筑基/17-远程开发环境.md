# 🌐 17 - 远程开发环境

> 连接 GPU 服务器、云端训练、远程 Jupyter 全攻略

---

## 目录

1. [为什么需要远程开发](#1-为什么需要远程开发)
2. [SSH 基础](#2-ssh-基础)
3. [VS Code Remote](#3-vs-code-remote)
4. [远程 Jupyter](#4-远程-jupyter)
5. [云端 GPU 平台](#5-云端-gpu-平台)
6. [文件同步](#6-文件同步)
7. [实战：连接 GPU 服务器训练模型](#7-实战连接-gpu-服务器训练模型)
8. [常见问题排查](#8-常见问题排查)

---

## 1. 为什么需要远程开发

### 1.1 本地算力限制

```
AI 训练的算力需求：

任务类型           | 本地笔记本 | 需要的配置
-------------------|-----------|------------------
简单数据分析       | ✅ 可以   | CPU 即可
小型 ML 模型       | ✅ 可以   | CPU / 入门 GPU
图像分类（ResNet） | ⚠️ 勉强   | 8GB+ GPU
目标检测（YOLO）   | ❌ 太慢   | 12GB+ GPU
大模型微调         | ❌ 不行   | 24GB+ GPU / 多卡
LLM 推理           | ❌ 不行   | 24GB+ GPU

解决方案：连接远程 GPU 服务器！
```

### 1.2 远程开发的优势

```
本地开发                    远程开发
┌─────────────────┐        ┌─────────────────┐
│  MacBook Air    │        │  GPU Server     │
│  - M1 芯片      │   SSH  │  - RTX 4090×2   │
│  - 8GB 内存     │ =====> │  - 128GB 内存   │
│  - 256GB SSD    │        │  - 4TB SSD      │
└─────────────────┘        └─────────────────┘

优势：
✅ 使用强大的远程硬件
✅ 本地只需轻薄笔记本
✅ 数据和代码在服务器上
✅ 训练不占用本地资源
✅ 随时随地远程连接
```

---

## 2. SSH 基础

### 2.1 SSH 是什么

```
SSH (Secure Shell) = 加密的远程登录协议

你的电脑 ----SSH 加密隧道----> 远程服务器
           (安全通信)

类比：SSH 就像打一个加密的电话到远程服务器
```

### 2.2 密钥生成与配置

```bash
# 生成 SSH 密钥对
ssh-keygen -t ed25519 -C "your@email.com"
# 或者使用 RSA（兼容性更好）
ssh-keygen -t rsa -b 4096 -C "your@email.com"

# 按提示操作：
# 1. 密钥保存位置（默认 ~/.ssh/id_ed25519）
# 2. 设置密码（可选，增加安全性）

# 生成两个文件：
# ~/.ssh/id_ed25519      私钥（绝对不能泄露！）
# ~/.ssh/id_ed25519.pub  公钥（可以分享）
```

```bash
# 查看公钥内容
cat ~/.ssh/id_ed25519.pub
# ssh-ed25519 AAAAC3NzaC1lZDI1... your@email.com

# 复制公钥到服务器（方法 1：ssh-copy-id）
ssh-copy-id -i ~/.ssh/id_ed25519.pub user@server_ip
# 输入服务器密码后，公钥会被添加到服务器的 ~/.ssh/authorized_keys

# 复制公钥到服务器（方法 2：手动）
# 1. 复制公钥内容
cat ~/.ssh/id_ed25519.pub | pbcopy  # macOS
cat ~/.ssh/id_ed25519.pub | xclip   # Linux

# 2. 在服务器上
mkdir -p ~/.ssh
echo "粘贴公钥内容" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

### 2.3 SSH 连接

```bash
# 基础连接
ssh username@server_ip
# 例如: ssh root@192.168.1.100

# 指定端口（默认 22）
ssh -p 2222 username@server_ip

# 指定密钥
ssh -i ~/.ssh/my_key username@server_ip

# 连接后，你就进入了服务器的终端
```

### 2.4 SSH 配置文件

```bash
# ~/.ssh/config 文件可以简化连接命令

# 创建/编辑配置文件
nano ~/.ssh/config
```

```
# ~/.ssh/config

# GPU 服务器
Host gpu-server
    HostName 192.168.1.100
    User alice
    Port 22
    IdentityFile ~/.ssh/id_ed25519

# 公司跳板机
Host jumpbox
    HostName jump.company.com
    User alice
    Port 22

# 通过跳板机连接内网服务器
Host internal-server
    HostName 10.0.0.50
    User alice
    ProxyJump jumpbox

# AutoDL 服务器
Host autodl
    HostName connect.westb.seetacloud.com
    User root
    Port 38297
    IdentityFile ~/.ssh/id_ed25519
```

```bash
# 配置后，只需输入别名即可连接
ssh gpu-server    # 等同于 ssh alice@192.168.1.100
ssh autodl        # 等同于复杂的 AutoDL 连接命令
```

### 2.5 SSH 端口转发

```bash
# 本地端口转发：访问本地端口 → 转发到远程端口
# 场景：在本地浏览器访问远程服务器上运行的 Jupyter

# 命令格式：ssh -L 本地端口:目标地址:目标端口 跳板机
ssh -L 8888:localhost:8888 gpu-server

# 然后在本地浏览器访问 http://localhost:8888
# 实际访问的是远程服务器的 Jupyter

# 多端口转发
ssh -L 8888:localhost:8888 -L 6006:localhost:6006 gpu-server
# 同时转发 Jupyter(8888) 和 TensorBoard(6006)

# 远程端口转发：让远程服务器访问本地服务
# ssh -R 远程端口:localhost:本地端口 remote

# 动态端口转发（SOCKS 代理）
ssh -D 1080 gpu-server
# 设置浏览器 SOCKS5 代理为 localhost:1080
```

### 2.6 保持连接

```bash
# 防止 SSH 连接断开

# 方法 1：配置 ~/.ssh/config
Host *
    ServerAliveInterval 60
    ServerAliveCountMax 3

# 方法 2：使用 screen/tmux（推荐！）
# 见下文 7.3 节
```

---

## 3. VS Code Remote

### 3.1 安装插件

```
1. 打开 VS Code
2. 安装扩展：Remote - SSH
   - 搜索 "Remote - SSH" 或 "Remote Development"
   - 安装 Microsoft 官方扩展
```

### 3.2 连接远程服务器

```
方法 1：命令面板
1. Ctrl+Shift+P (Mac: Cmd+Shift+P)
2. 输入 "Remote-SSH: Connect to Host"
3. 选择服务器或输入 user@host

方法 2：侧边栏
1. 点击左侧 "Remote Explorer" 图标
2. 选择 "SSH Targets"
3. 点击服务器旁的连接按钮

首次连接：
- VS Code 会在远程服务器安装 VS Code Server
- 需要几分钟，请耐心等待
```

### 3.3 远程 Python 开发配置

```json
// .vscode/settings.json（在远程项目中）
{
    // Python 解释器路径
    "python.defaultInterpreterPath": "/home/user/miniconda3/envs/ml/bin/python",

    // 格式化
    "python.formatting.provider": "black",
    "editor.formatOnSave": true,

    // Linting
    "python.linting.enabled": true,
    "python.linting.pylintEnabled": false,
    "python.linting.flake8Enabled": true,

    // 终端
    "terminal.integrated.defaultProfile.linux": "bash"
}
```

```json
// .vscode/launch.json（调试配置）
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python: 当前文件",
            "type": "debugpy",
            "request": "launch",
            "program": "${file}",
            "console": "integratedTerminal",
            "justMyCode": true
        },
        {
            "name": "Python: 训练脚本",
            "type": "debugpy",
            "request": "launch",
            "program": "train.py",
            "args": ["--epochs", "10", "--batch-size", "32"],
            "console": "integratedTerminal"
        }
    ]
}
```

### 3.4 远程调试

```python
# train.py - 可以设置断点进行调试

import argparse
import torch

def train(args):
    # 在这里设置断点（点击行号左侧）
    model = create_model(args.model_name)

    for epoch in range(args.epochs):
        # 断点：检查每个 epoch 的状态
        loss = train_epoch(model, dataloader)
        print(f"Epoch {epoch}: loss={loss:.4f}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--epochs", type=int, default=10)
    args = parser.parse_args()
    train(args)
```

### 3.5 实用技巧

```bash
# 1. 远程终端快捷键
Ctrl+` (反引号)  # 打开/关闭终端

# 2. 拆分终端
Ctrl+Shift+5     # 垂直拆分

# 3. 文件传输
# 直接拖拽文件到 VS Code 文件管理器即可上传
# 右键文件 -> Download 下载

# 4. 多窗口
# 可以同时打开多个远程 VS Code 窗口
# 连接不同服务器或同一服务器的不同目录

# 5. 扩展同步
# 在远程服务器上安装的扩展会保存在服务器上
# 可以配置扩展在远程自动安装
```

---

## 4. 远程 Jupyter

### 4.1 服务器端启动 Jupyter

```bash
# 1. SSH 连接服务器
ssh gpu-server

# 2. 安装 Jupyter（如果没有）
pip install jupyterlab notebook

# 3. 启动 Jupyter Lab
# 方法 A：无密码（开发环境）
jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --NotebookApp.token=''

# 方法 B：有 token（更安全）
jupyter lab --ip=0.0.0.0 --port=8888 --no-browser
# 启动后会显示带 token 的 URL

# 方法 C：后台运行
nohup jupyter lab --ip=0.0.0.0 --port=8888 --no-browser > jupyter.log 2>&1 &
# 查看 token
cat jupyter.log | grep token
```

### 4.2 SSH 隧道连接

```bash
# 在本地终端执行
ssh -L 8888:localhost:8888 gpu-server

# 保持终端打开
# 然后在本地浏览器访问：http://localhost:8888
```

```bash
# 后台运行 SSH 隧道
ssh -fNL 8888:localhost:8888 gpu-server
# -f: 后台运行
# -N: 不执行远程命令
# -L: 端口转发

# 查看后台 SSH 进程
ps aux | grep ssh

# 关闭后台 SSH
kill <pid>
```

### 4.3 配置 Jupyter

```bash
# 在服务器上生成配置文件
jupyter lab --generate-config
# 生成 ~/.jupyter/jupyter_lab_config.py
```

```python
# ~/.jupyter/jupyter_lab_config.py

c.ServerApp.ip = '0.0.0.0'
c.ServerApp.port = 8888
c.ServerApp.open_browser = False
c.ServerApp.allow_root = True

# 设置密码（更安全）
# 先生成密码哈希
# python -c "from jupyter_server.auth import passwd; print(passwd())"
c.ServerApp.password = 'argon2:$argon2id$v=19$m=10240,t=10,p=8$...'

# 或者设置 token
c.ServerApp.token = 'your-secret-token'

# 允许远程访问
c.ServerApp.allow_remote_access = True
```

### 4.4 VS Code + Jupyter

```
VS Code 可以直接连接远程 Jupyter！

1. 安装扩展：Jupyter
2. Remote-SSH 连接服务器
3. 打开 .ipynb 文件
4. 选择内核（Python 环境）

优势：
- 不需要端口转发
- 直接在 VS Code 中编辑和运行
- 代码补全、调试等功能完整
```

### 4.5 JupyterHub（多用户）

```yaml
# JupyterHub 适合团队使用
# docker-compose.yml 示例

version: '3'
services:
  jupyterhub:
    image: jupyterhub/jupyterhub
    ports:
      - "8000:8000"
    volumes:
      - ./jupyterhub_config.py:/srv/jupyterhub/jupyterhub_config.py
      - /home:/home  # 用户目录
    command: jupyterhub -f /srv/jupyterhub/jupyterhub_config.py
```

---

## 5. 云端 GPU 平台

### 5.1 免费平台

#### Google Colab

```python
# Google Colab：免费 GPU，限时使用

# 优势：
# - 完全免费（有付费升级版）
# - 无需配置环境
# - 预装常用库
# - 支持 GPU（T4）和 TPU

# 使用方法：
# 1. 访问 https://colab.research.google.com
# 2. 新建笔记本
# 3. 运行时 -> 更改运行时类型 -> GPU

# 检查 GPU
import torch
print(torch.cuda.is_available())
print(torch.cuda.get_device_name(0))

# 挂载 Google Drive
from google.colab import drive
drive.mount('/content/drive')

# 限制：
# - 免费版 GPU 时间有限
# - 连接可能中断
# - 不适合长时间训练
```

#### Kaggle Notebooks

```python
# Kaggle：免费 GPU，每周 30 小时

# 优势：
# - 免费 GPU（P100/T4）
# - 内置数据集
# - 适合比赛

# 使用方法：
# 1. 访问 https://www.kaggle.com
# 2. 创建新 Notebook
# 3. 设置 -> Accelerator -> GPU

# 检查 GPU
!nvidia-smi

# 限制：
# - 每周 30 小时 GPU 时间
# - 会话最长 12 小时
```

### 5.2 国内付费平台

#### AutoDL

```bash
# AutoDL：性价比高的国内 GPU 平台
# https://www.autodl.com

# 特点：
# - 按小时计费
# - 多种 GPU 可选（A100, 4090, 3090...）
# - 预装环境（PyTorch, TensorFlow）
# - 支持学术优惠

# 连接步骤：
# 1. 创建实例，选择 GPU 和镜像
# 2. 获取 SSH 连接信息
# 3. 配置 ~/.ssh/config

Host autodl
    HostName connect.westb.seetacloud.com
    User root
    Port 38297  # 你的端口

# 4. 连接
ssh autodl

# 数据传输
# AutoDL 提供网盘功能，可以持久化存储
# /root/autodl-tmp  临时存储（实例重启会清空）
# /root/autodl-nas  网盘（持久化）
```

#### 矩池云

```bash
# 矩池云：https://matpool.com

# 连接类似 AutoDL
# 支持 Jupyter 直连
```

### 5.3 企业级云平台

```bash
# AWS (Amazon Web Services)
# - EC2 GPU 实例（p3, p4, g4）
# - SageMaker（托管 ML 平台）

# GCP (Google Cloud Platform)
# - Compute Engine + GPU
# - Vertex AI（托管 ML）

# Azure
# - Virtual Machines + GPU
# - Azure ML

# 这些平台功能强大但配置复杂，适合企业使用
```

### 5.4 平台对比

| 平台 | 价格 | GPU | 适合场景 |
|------|------|-----|---------|
| **Colab** | 免费 | T4 | 学习、实验 |
| **Kaggle** | 免费 | P100/T4 | 比赛、实验 |
| **AutoDL** | ~1-5元/小时 | 多种 | 训练、开发 |
| **矩池云** | ~1-5元/小时 | 多种 | 训练、开发 |
| **AWS/GCP** | 较贵 | 企业级 | 生产环境 |

---

## 6. 文件同步

### 6.1 scp 命令

```bash
# scp：安全复制（基于 SSH）

# 上传文件到服务器
scp local_file.py gpu-server:/home/user/project/
# scp 本地文件 远程:路径

# 上传目录（-r 递归）
scp -r ./data gpu-server:/home/user/project/

# 下载文件
scp gpu-server:/home/user/model.pt ./
# scp 远程:文件 本地路径

# 下载目录
scp -r gpu-server:/home/user/results ./
```

### 6.2 rsync 命令（推荐）

```bash
# rsync：增量同步，比 scp 更智能

# 基础用法
rsync -avz ./src/ gpu-server:/home/user/project/src/
# -a: 归档模式（保留权限、时间等）
# -v: 详细输出
# -z: 压缩传输

# 同步整个项目
rsync -avz --progress ./project/ gpu-server:/home/user/project/

# 排除某些文件
rsync -avz --exclude='*.pyc' --exclude='__pycache__' \
      --exclude='.git' --exclude='data/' \
      ./project/ gpu-server:/home/user/project/

# 使用 .rsyncignore 文件
rsync -avz --exclude-from='.rsyncignore' ./project/ gpu-server:/home/user/project/

# 删除目标端多余文件（镜像同步）
rsync -avz --delete ./project/ gpu-server:/home/user/project/

# 模拟运行（不实际传输）
rsync -avzn ./project/ gpu-server:/home/user/project/
```

```
# .rsyncignore 文件示例
*.pyc
__pycache__
.git
.venv
venv
*.egg-info
.pytest_cache
.ipynb_checkpoints
data/
models/*.pt
```

### 6.3 VS Code 自动同步

```
方法 1：Remote-SSH（推荐）
- 直接在远程编辑，无需同步
- 实时保存到服务器

方法 2：SFTP 扩展
- 安装 "SFTP" 扩展
- 配置 sftp.json
```

```json
// .vscode/sftp.json
{
    "name": "GPU Server",
    "host": "192.168.1.100",
    "protocol": "sftp",
    "port": 22,
    "username": "user",
    "remotePath": "/home/user/project",
    "privateKeyPath": "~/.ssh/id_ed25519",
    "uploadOnSave": true,
    "ignore": [
        ".vscode",
        ".git",
        "__pycache__",
        "*.pyc",
        "data",
        "models"
    ]
}
```

### 6.4 Git 管理代码（最佳实践）

```bash
# 最佳实践：用 Git 管理代码

# 本地：提交代码
git add .
git commit -m "Update training script"
git push origin main

# 服务器：拉取代码
ssh gpu-server
cd /home/user/project
git pull

# 优势：
# - 版本控制
# - 多机同步
# - 分支管理
# - 代码审查

# 注意：大文件（数据、模型）不要放 Git
# 使用 .gitignore 排除
```

```
# .gitignore
# 数据
data/
*.csv
*.parquet

# 模型
models/
*.pt
*.pth
*.h5
*.onnx

# 缓存
__pycache__/
*.pyc
.ipynb_checkpoints/

# 环境
.venv/
venv/

# 日志
logs/
*.log
```

---

## 7. 实战：连接 GPU 服务器训练模型

### 7.1 完整工作流

```
┌─────────────────────────────────────────────────────────┐
│                    完整工作流程                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. 本地开发          2. 同步代码         3. 远程训练   │
│  ┌─────────┐         ┌─────────┐        ┌─────────┐    │
│  │ VS Code │  ─git─> │  GitHub │  ─git─> │  GPU    │    │
│  │  本地   │         │         │        │  服务器  │    │
│  └─────────┘         └─────────┘        └─────────┘    │
│                                               │         │
│  4. 监控训练         5. 下载结果              │         │
│  ┌─────────┐         ┌─────────┐              │         │
│  │ 浏览器  │ <─────  │ 模型/   │ <────────────┘         │
│  │TensorBoard│        │ 日志    │                       │
│  └─────────┘         └─────────┘                        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 7.2 项目结构

```
ml-project/
├── train.py           # 训练脚本
├── model.py           # 模型定义
├── dataset.py         # 数据加载
├── config.yaml        # 配置文件
├── requirements.txt   # 依赖
├── .gitignore
├── data/              # 数据目录（不上传 Git）
│   └── .gitkeep
├── models/            # 模型保存（不上传 Git）
│   └── .gitkeep
├── logs/              # 日志目录
│   └── .gitkeep
└── notebooks/         # 实验笔记本
    └── experiment.ipynb
```

### 7.3 服务器环境配置

```bash
# 1. SSH 连接服务器
ssh gpu-server

# 2. 检查 GPU
nvidia-smi

# 3. 安装 Miniconda（如果没有）
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh

# 4. 创建虚拟环境
conda create -n ml python=3.10
conda activate ml

# 5. 安装 PyTorch（根据 CUDA 版本选择）
# CUDA 11.8
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
# CUDA 12.1
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# 6. 克隆项目
git clone https://github.com/yourname/ml-project.git
cd ml-project

# 7. 安装依赖
pip install -r requirements.txt
```

### 7.4 使用 tmux/screen 运行长任务

```bash
# tmux：终端复用器，防止 SSH 断开后任务中断

# 安装 tmux
sudo apt install tmux

# 创建新会话
tmux new -s train

# 在 tmux 中运行训练
conda activate ml
python train.py

# 断开会话（保持后台运行）
Ctrl+B, D

# 重新连接会话
tmux attach -t train

# 列出所有会话
tmux ls

# 结束会话
tmux kill-session -t train
```

```bash
# tmux 常用快捷键（先按 Ctrl+B）
# d: 断开会话
# c: 新建窗口
# n/p: 下一个/上一个窗口
# %: 垂直分屏
# ": 水平分屏
# 方向键: 切换窗格
# x: 关闭当前窗格
```

### 7.5 训练脚本示例

```python
# train.py
import torch
import torch.nn as nn
from torch.utils.data import DataLoader
from torch.utils.tensorboard import SummaryWriter
import argparse
from pathlib import Path
from datetime import datetime

def train(args):
    # 设备
    device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    print(f"Using device: {device}")
    if torch.cuda.is_available():
        print(f"GPU: {torch.cuda.get_device_name(0)}")

    # TensorBoard
    log_dir = Path(f"logs/{datetime.now().strftime('%Y%m%d_%H%M%S')}")
    writer = SummaryWriter(log_dir)

    # 模型
    model = create_model(args.model).to(device)

    # 数据
    train_loader = get_dataloader(args.batch_size)

    # 优化器
    optimizer = torch.optim.Adam(model.parameters(), lr=args.lr)
    criterion = nn.CrossEntropyLoss()

    # 训练循环
    for epoch in range(args.epochs):
        model.train()
        total_loss = 0

        for batch_idx, (data, target) in enumerate(train_loader):
            data, target = data.to(device), target.to(device)

            optimizer.zero_grad()
            output = model(data)
            loss = criterion(output, target)
            loss.backward()
            optimizer.step()

            total_loss += loss.item()

            if batch_idx % 100 == 0:
                print(f"Epoch {epoch} [{batch_idx}/{len(train_loader)}] Loss: {loss.item():.4f}")

        avg_loss = total_loss / len(train_loader)
        writer.add_scalar("Loss/train", avg_loss, epoch)
        print(f"Epoch {epoch}: Average Loss = {avg_loss:.4f}")

        # 保存 checkpoint
        if (epoch + 1) % args.save_every == 0:
            save_path = Path(f"models/checkpoint_epoch{epoch+1}.pt")
            save_path.parent.mkdir(exist_ok=True)
            torch.save({
                'epoch': epoch,
                'model_state_dict': model.state_dict(),
                'optimizer_state_dict': optimizer.state_dict(),
                'loss': avg_loss,
            }, save_path)
            print(f"Saved checkpoint: {save_path}")

    writer.close()
    print("Training completed!")

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--model", default="resnet18")
    parser.add_argument("--epochs", type=int, default=10)
    parser.add_argument("--batch-size", type=int, default=32)
    parser.add_argument("--lr", type=float, default=1e-3)
    parser.add_argument("--save-every", type=int, default=5)
    args = parser.parse_args()

    train(args)
```

### 7.6 监控训练

```bash
# 方法 1：TensorBoard（推荐）

# 服务器上启动 TensorBoard
tensorboard --logdir=logs --port=6006 --bind_all

# 本地端口转发
ssh -L 6006:localhost:6006 gpu-server

# 本地浏览器访问
# http://localhost:6006
```

```bash
# 方法 2：查看日志
# 实时查看
tail -f logs/train.log

# 或者用 tmux 分屏
# 一个窗格运行训练，一个窗格查看日志
```

```bash
# 方法 3：nvidia-smi 监控 GPU
# 实时监控
watch -n 1 nvidia-smi

# 或者用 nvitop（更好用）
pip install nvitop
nvitop
```

### 7.7 下载结果

```bash
# 下载模型
scp gpu-server:/home/user/project/models/best_model.pt ./

# 下载日志
rsync -avz gpu-server:/home/user/project/logs/ ./logs/

# 下载 TensorBoard 日志后本地查看
tensorboard --logdir=./logs
```

---

## 8. 常见问题排查

### 8.1 SSH 连接问题

```bash
# 问题：Connection refused
# 原因：SSH 服务未运行或端口错误
# 解决：
ssh -v user@host  # 详细输出，查看错误

# 问题：Permission denied
# 原因：密钥或密码错误
# 解决：
ssh -i ~/.ssh/id_ed25519 user@host  # 指定密钥
ssh-add ~/.ssh/id_ed25519  # 添加到 agent

# 问题：Connection timed out
# 原因：防火墙阻止或 IP 错误
# 解决：检查 IP、端口、防火墙规则

# 问题：SSH 断开
# 原因：网络不稳定或服务器配置
# 解决：配置 ServerAliveInterval（见 2.6 节）
```

### 8.2 VS Code Remote 问题

```bash
# 问题：VS Code Server 安装失败
# 解决：
# 1. 删除远程 ~/.vscode-server 目录
rm -rf ~/.vscode-server
# 2. 重新连接

# 问题：扩展无法安装
# 解决：检查网络，或手动下载 vsix 安装

# 问题：无法选择 Python 解释器
# 解决：
# 1. 确保远程安装了 Python 扩展
# 2. 使用完整路径 /path/to/python
```

### 8.3 Jupyter 问题

```bash
# 问题：无法访问 Jupyter
# 检查：
# 1. Jupyter 是否在运行
ps aux | grep jupyter
# 2. 端口转发是否正确
# 3. 防火墙是否开放端口

# 问题：内核启动失败
# 解决：
# 1. 检查 Python 环境
which python
# 2. 重新安装 ipykernel
pip install ipykernel
python -m ipykernel install --user --name=ml
```

### 8.4 GPU 问题

```bash
# 问题：CUDA out of memory
# 解决：
# 1. 减小 batch size
# 2. 使用梯度累积
# 3. 使用混合精度训练
# 4. 清理 GPU 缓存
torch.cuda.empty_cache()

# 问题：torch.cuda.is_available() = False
# 检查：
# 1. nvidia-smi 是否正常
# 2. PyTorch CUDA 版本是否匹配
python -c "import torch; print(torch.version.cuda)"

# 问题：多卡训练问题
# 检查：CUDA_VISIBLE_DEVICES 设置
export CUDA_VISIBLE_DEVICES=0,1
```

---

## 📚 命令速查表

```bash
# SSH
ssh user@host                  # 连接
ssh -p 2222 user@host         # 指定端口
ssh -L 8888:localhost:8888 h  # 端口转发
ssh-keygen -t ed25519         # 生成密钥
ssh-copy-id user@host         # 复制公钥

# 文件传输
scp file user@host:/path      # 上传
scp user@host:/path file      # 下载
rsync -avz ./src/ host:/dst/  # 同步

# tmux
tmux new -s name              # 新建会话
tmux attach -t name           # 连接会话
Ctrl+B, D                     # 断开会话
tmux ls                       # 列出会话

# 监控
nvidia-smi                    # GPU 状态
watch -n 1 nvidia-smi         # 实时监控
htop                          # CPU/内存
```

---

## ➡️ 下一步

学完本节后，继续学习 [18-综合实战项目.md](./18-综合实战项目.md)

