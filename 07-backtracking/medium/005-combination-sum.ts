/**
 * ğŸ“ é¢˜ç›®ï¼šç»„åˆæ€»å’Œ
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/combination-sum/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ•°ç»„ã€å›æº¯
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ª æ— é‡å¤å…ƒç´  çš„æ•´æ•°æ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•´æ•° targetï¼Œ
 * æ‰¾å‡º candidates ä¸­å¯ä»¥ä½¿æ•°å­—å’Œä¸ºç›®æ ‡æ•° target çš„æ‰€æœ‰ ä¸åŒç»„åˆï¼Œ
 * å¹¶ä»¥åˆ—è¡¨å½¢å¼è¿”å›ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›è¿™äº›ç»„åˆã€‚
 *
 * candidates ä¸­çš„ åŒä¸€ä¸ª æ•°å­—å¯ä»¥ æ— é™åˆ¶é‡å¤è¢«é€‰å–ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šcandidates = [2,3,6,7], target = 7
 * è¾“å‡ºï¼š[[2,2,3],[7]]
 *
 * è¾“å…¥ï¼šcandidates = [2,3,5], target = 8
 * è¾“å‡ºï¼š[[2,2,2,2],[2,3,3],[3,5]]
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// ä¸æ ‡å‡†ç»„åˆçš„åŒºåˆ«ï¼š
// - åŒä¸€ä¸ªå…ƒç´ å¯ä»¥é‡å¤é€‰å–
// - æ‰€ä»¥é€’å½’æ—¶ï¼Œä¸‹ä¸€æ¬¡è¿˜æ˜¯ä» i å¼€å§‹ï¼Œä¸æ˜¯ i+1
//
// å‰ªæä¼˜åŒ–ï¼š
// - å…ˆæ’åº
// - å½“å‰å…ƒç´  > remaining æ—¶ï¼Œåé¢çš„æ›´å¤§ï¼Œç›´æ¥ break

// ============================================================
// è§£æ³•ï¼šå›æº¯ + å‰ªæ
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n Ã— 2^n) | ç©ºé—´å¤æ‚åº¦ï¼šO(target)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * candidates = [2, 3, 6, 7], target = 7
 *
 *                    []
 *          /       |       \       \
 *        [2]      [3]      [6]     [7] âœ“
 *       / | \      |
 *    [2,2][2,3][2,6][3,3]
 *     |     âœ“    âœ—    âœ—
 *  [2,2,2]
 *     |
 *  [2,2,2,2]
 *     âœ— (>7)
 *    ...
 *  [2,2,3] âœ“
 *
 * ç»“æœï¼š[[2,2,3], [7]]
 */
function combinationSum(candidates: number[], target: number): number[][] {
  const result: number[][] = [];
  const path: number[] = [];

  // æ’åºï¼Œä¾¿äºå‰ªæ
  candidates.sort((a, b) => a - b);

  function backtrack(start: number, remaining: number) {
    // æ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆç»„åˆ
    if (remaining === 0) {
      result.push([...path]);
      return;
    }

    for (let i = start; i < candidates.length; i++) {
      // å‰ªæï¼šå½“å‰å…ƒç´ å·²ç»å¤§äºå‰©ä½™ç›®æ ‡
      if (candidates[i] > remaining) {
        break; // æ’åºåï¼Œåé¢çš„æ›´å¤§ï¼Œç›´æ¥é€€å‡º
      }

      path.push(candidates[i]);

      // å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯ä» i å¼€å§‹
      backtrack(i, remaining - candidates[i]);

      path.pop();
    }
  }

  backtrack(0, target);
  return result;
}

// ============================================================
// æ— å‰ªæç‰ˆæœ¬ï¼ˆå¯¹æ¯”ï¼‰
// ============================================================
function combinationSum_noPrune(candidates: number[], target: number): number[][] {
  const result: number[][] = [];
  const path: number[] = [];

  function backtrack(start: number, remaining: number) {
    if (remaining < 0) return; // è¶…è¿‡äº†ï¼Œè¿”å›
    if (remaining === 0) {
      result.push([...path]);
      return;
    }

    for (let i = start; i < candidates.length; i++) {
      path.push(candidates[i]);
      backtrack(i, remaining - candidates[i]);
      path.pop();
    }
  }

  backtrack(0, target);
  return result;
}

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. å¯é‡å¤ä½¿ç”¨ï¼š
 *    - backtrack(i, ...) ä¸æ˜¯ backtrack(i+1, ...)
 *
 * 2. å‰ªæä¼˜åŒ–ï¼š
 *    - éœ€è¦å…ˆæ’åº
 *    - ç”¨ break ä¸æ˜¯ continue
 *
 * 3. ç»ˆæ­¢æ¡ä»¶ï¼š
 *    - remaining === 0 æ”¶é›†ç»“æœ
 *    - remaining < 0 è¿”å›ï¼ˆæ— å‰ªæç‰ˆæœ¬éœ€è¦ï¼‰
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - ç»„åˆæ€»å’Œ II â†’ æ¯ä¸ªå…ƒç´ åªèƒ½ç”¨ä¸€æ¬¡ï¼Œæœ‰é‡å¤å…ƒç´ 
 * - ç»„åˆæ€»å’Œ III â†’ ä» 1-9 ä¸­é€‰ k ä¸ªæ•°
 * - é›¶é’±å…‘æ¢ â†’ è¿”å›æœ€å°‘ç¡¬å¸æ•°ï¼ˆDPï¼‰
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. è´­ç‰©å‡‘å•ï¼šæ‰¾å‡ºå“ªäº›å•†å“ç»„åˆåˆšå¥½æ»¡è¶³æ»¡å‡é‡‘é¢
 * 2. æ—¶é—´åˆ†é…ï¼šä»»åŠ¡æ—¶é—´ç»„åˆæ»¡è¶³æ€»æ—¶é•¿è¦æ±‚
 */

export { combinationSum, combinationSum_noPrune };
export default combinationSum;

