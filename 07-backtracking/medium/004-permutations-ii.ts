/**
 * ğŸ“ é¢˜ç›®ï¼šå…¨æ’åˆ— II
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/permutations-ii/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ•°ç»„ã€å›æº¯
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™å®šä¸€ä¸ªå¯åŒ…å«é‡å¤æ•°å­—çš„åºåˆ— numsï¼ŒæŒ‰ä»»æ„é¡ºåº è¿”å›æ‰€æœ‰ä¸é‡å¤çš„å…¨æ’åˆ—ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šnums = [1,1,2]
 * è¾“å‡ºï¼š[[1,1,2],[1,2,1],[2,1,1]]
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// ä¸"å…¨æ’åˆ—"çš„åŒºåˆ«ï¼šæœ‰é‡å¤å…ƒç´ 
//
// å»é‡ç­–ç•¥ï¼š
// 1. å…ˆæ’åºï¼Œè®©ç›¸åŒå…ƒç´ ç›¸é‚»
// 2. åŒä¸€å±‚ä¸­ï¼Œè·³è¿‡é‡å¤å…ƒç´ 
//
// å…³é”®åˆ¤æ–­ï¼š
// if (i > 0 && nums[i] === nums[i-1] && !used[i-1]) continue;
//
// ä¸ºä»€ä¹ˆæ˜¯ !used[i-1]ï¼Ÿ
// - used[i-1] = trueï¼šå‰ä¸€ä¸ªå…ƒç´ åœ¨å½“å‰è·¯å¾„ä¸­ï¼ˆä¸åŒå±‚ï¼‰
// - used[i-1] = falseï¼šå‰ä¸€ä¸ªå…ƒç´ ä¸åœ¨å½“å‰è·¯å¾„ä¸­ï¼ˆåŒä¸€å±‚ï¼‰

// ============================================================
// è§£æ³•ï¼šå›æº¯ + å»é‡
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n Ã— n!) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * nums = [1, 1, 2]ï¼ˆæ’åºåï¼‰
 *
 *                        []
 *             /          |          \
 *           [1]        [1]â†è·³è¿‡      [2]
 *          /   \                    /
 *       [1,1]  [1,2]             [2,1]
 *         |      |                 |
 *      [1,1,2] [1,2,1]          [2,1,1]
 *
 * ç»“æœï¼š[[1,1,2], [1,2,1], [2,1,1]]
 *
 * ğŸ”„ å»é‡æ¡ä»¶è¯¦è§£ï¼š
 *
 * ç¬¬ä¸€å±‚é€‰ç¬¬ä¸€ä¸ª 1ï¼šused = [T, F, F]
 *   â†’ ç¬¬äºŒå±‚å¯ä»¥é€‰ç¬¬äºŒä¸ª 1ï¼šused = [T, T, F]
 *
 * ç¬¬ä¸€å±‚é€‰ç¬¬äºŒä¸ª 1ï¼š
 *   â†’ nums[1] === nums[0] && !used[0]
 *   â†’ å‰ä¸€ä¸ªç›¸åŒå…ƒç´ æ²¡è¢«ä½¿ç”¨ï¼Œè¯´æ˜æ˜¯åŒä¸€å±‚
 *   â†’ è·³è¿‡ï¼
 */
function permuteUnique(nums: number[]): number[][] {
  const result: number[][] = [];
  const path: number[] = [];
  const used: boolean[] = new Array(nums.length).fill(false);

  // 1. å…ˆæ’åº
  nums.sort((a, b) => a - b);

  function backtrack() {
    if (path.length === nums.length) {
      result.push([...path]);
      return;
    }

    for (let i = 0; i < nums.length; i++) {
      // è·³è¿‡å·²ä½¿ç”¨çš„å…ƒç´ 
      if (used[i]) continue;

      // 2. å»é‡ï¼šåŒä¸€å±‚ä¸­è·³è¿‡é‡å¤å…ƒç´ 
      if (i > 0 && nums[i] === nums[i - 1] && !used[i - 1]) {
        continue;
      }

      path.push(nums[i]);
      used[i] = true;

      backtrack();

      path.pop();
      used[i] = false;
    }
  }

  backtrack();
  return result;
}

// ============================================================
// ğŸ”‘ å»é‡æ¡ä»¶çš„æ·±å…¥ç†è§£
// ============================================================

/**
 * ä¸ºä»€ä¹ˆæ˜¯ !used[i-1] è€Œä¸æ˜¯ used[i-1]ï¼Ÿ
 *
 * å‡è®¾æœ‰ä¸¤ä¸ªç›¸åŒå…ƒç´  A å’Œ A'
 *
 * ã€ç­–ç•¥ 1ã€‘!used[i-1]ï¼ˆæ ‘å±‚å»é‡ï¼‰
 * - åªå…è®¸ A åœ¨ A' å‰é¢è¢«é€‰
 * - ä¸å…è®¸ A' åœ¨ A å‰é¢è¢«é€‰
 * - å»æ‰çš„æ˜¯åŒä¸€å±‚çš„é‡å¤
 *
 * ã€ç­–ç•¥ 2ã€‘used[i-1]ï¼ˆæ ‘æå»é‡ï¼‰
 * - åªå…è®¸ A åœ¨ A' è¢«é€‰ä¹‹åæ‰èƒ½é€‰
 * - å»æ‰çš„æ˜¯ä¸åŒå±‚çš„é‡å¤
 *
 * ä¸¤ç§éƒ½èƒ½å»é‡ï¼Œä½†ç­–ç•¥ 1 æ•ˆç‡æ›´é«˜ï¼
 *
 * ä¾‹å¦‚ [1, 1, 1]ï¼š
 * ç­–ç•¥ 1ï¼šåªä¿ç•™ç¬¬ä¸€ä¸ª 1 å¼€å¤´çš„åˆ†æ”¯
 * ç­–ç•¥ 2ï¼šæ¯ä¸ªåˆ†æ”¯éƒ½ä¼šèµ°å®Œå†å‰ªæ
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. å¿…é¡»å…ˆæ’åº
 *
 * 2. å»é‡æ¡ä»¶çš„ç»„åˆï¼š
 *    - i > 0ï¼ˆæœ‰å‰ä¸€ä¸ªå…ƒç´ ï¼‰
 *    - nums[i] === nums[i-1]ï¼ˆå½“å‰å’Œå‰ä¸€ä¸ªç›¸åŒï¼‰
 *    - !used[i-1]ï¼ˆå‰ä¸€ä¸ªæ²¡è¢«ä½¿ç”¨ï¼‰
 *
 * 3. ä¸å­é›†å»é‡çš„åŒºåˆ«ï¼š
 *    - å­é›†ï¼ši > start && nums[i] === nums[i-1]
 *    - æ’åˆ—ï¼ši > 0 && nums[i] === nums[i-1] && !used[i-1]
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - å…¨æ’åˆ— â†’ æ— é‡å¤å…ƒç´ 
 * - å­é›† II â†’ æœ‰é‡å¤å…ƒç´ çš„å­é›†
 * - ç»„åˆæ€»å’Œ II â†’ æœ‰é‡å¤å…ƒç´ çš„ç»„åˆ
 */

export { permuteUnique };
export default permuteUnique;

