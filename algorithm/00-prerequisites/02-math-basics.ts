/**
 * ============================================================
 * ğŸ“š åŸºç¡€æ•°å­¦ - ç®—æ³•ä¸­å¸¸ç”¨çš„æ•°å­¦çŸ¥è¯†
 * ============================================================
 *
 * ç®—æ³•ä¸­éœ€è¦çš„æ•°å­¦çŸ¥è¯†ä¸å¤šï¼Œä½†æŸäº›ç‚¹å¾ˆé‡è¦ã€‚
 * æœ¬æ–‡ä»¶è¦†ç›–ï¼š
 * 1. å¯¹æ•°ä¸æŒ‡æ•°
 * 2. æ’åˆ—ç»„åˆ
 * 3. ç­‰å·®ç­‰æ¯”æ•°åˆ—
 * 4. å–æ¨¡è¿ç®—
 * 5. ä½è¿ç®—ï¼ˆé‡ç‚¹ï¼‰
 * 6. æœ€å¤§å…¬çº¦æ•°
 */

// ============================================================
// 1. å¯¹æ•°ä¸æŒ‡æ•°
// ============================================================

/**
 * ã€å¯¹æ•°çš„æ€§è´¨ã€‘
 *
 * log_a(b) = c  âŸº  a^c = b
 *
 * å¸¸ç”¨å¯¹æ•°ï¼š
 * - logâ‚‚nï¼šäºŒåˆ†ç›¸å…³ï¼Œæ ‘çš„é«˜åº¦
 * - logâ‚â‚€nï¼šä½æ•°è®¡ç®—
 *
 * ã€é‡è¦æ€§è´¨ã€‘
 *
 * log(a Ã— b) = log(a) + log(b)
 * log(a / b) = log(a) - log(b)
 * log(a^n) = n Ã— log(a)
 * log_a(b) = log_c(b) / log_c(a)  // æ¢åº•å…¬å¼
 *
 * ã€åœ¨ç®—æ³•ä¸­çš„åº”ç”¨ã€‘
 *
 * 1. äºŒåˆ†æŸ¥æ‰¾ï¼šæ¯æ¬¡æŠ˜åŠï¼Œlogâ‚‚n æ¬¡
 * 2. å®Œå…¨äºŒå‰æ ‘é«˜åº¦ï¼šlogâ‚‚n
 * 3. å½’å¹¶æ’åºå±‚æ•°ï¼šlogâ‚‚n
 * 4. æ•°å­—ä½æ•°ï¼šlogâ‚â‚€n + 1
 */

// è®¡ç®—æ•°å­—çš„ä½æ•°
function getDigitCount(n: number): number {
  if (n === 0) return 1;
  return Math.floor(Math.log10(Math.abs(n))) + 1;
}

// è®¡ç®— logâ‚‚nï¼ˆå‘ä¸‹å–æ•´ï¼‰
function log2Floor(n: number): number {
  return Math.floor(Math.log2(n));
}

// ============================================================
// 2. æ’åˆ—ç»„åˆ
// ============================================================

/**
 * ã€æ’åˆ— P(n, k)ã€‘
 *
 * ä» n ä¸ªå…ƒç´ ä¸­é€‰ k ä¸ªï¼Œæœ‰é¡ºåº
 * P(n, k) = n! / (n-k)! = n Ã— (n-1) Ã— ... Ã— (n-k+1)
 *
 * ç‰¹ä¾‹ï¼šå…¨æ’åˆ— P(n, n) = n!
 *
 * ã€ç»„åˆ C(n, k)ã€‘
 *
 * ä» n ä¸ªå…ƒç´ ä¸­é€‰ k ä¸ªï¼Œæ— é¡ºåº
 * C(n, k) = n! / (k! Ã— (n-k)!)
 * C(n, k) = C(n, n-k)  // å¯¹ç§°æ€§
 *
 * ã€åœ¨ç®—æ³•ä¸­çš„åº”ç”¨ã€‘
 *
 * 1. å›æº¯ç®—æ³•å¤æ‚åº¦åˆ†æ
 * 2. åŠ¨æ€è§„åˆ’çŠ¶æ€æ•°
 * 3. æ¦‚ç‡è®¡ç®—
 */

// é˜¶ä¹˜
function factorial(n: number): number {
  if (n <= 1) return 1;
  let result = 1;
  for (let i = 2; i <= n; i++) {
    result *= i;
  }
  return result;
}

// æ’åˆ— P(n, k)
function permutation(n: number, k: number): number {
  let result = 1;
  for (let i = n; i > n - k; i--) {
    result *= i;
  }
  return result;
}

// ç»„åˆ C(n, k) - ä¼˜åŒ–ç‰ˆæœ¬ï¼Œé¿å…æº¢å‡º
function combination(n: number, k: number): number {
  if (k > n - k) k = n - k; // åˆ©ç”¨å¯¹ç§°æ€§
  let result = 1;
  for (let i = 0; i < k; i++) {
    result = (result * (n - i)) / (i + 1);
  }
  return Math.round(result);
}

/**
 * ã€æ¨è¾‰ä¸‰è§’ä¸ç»„åˆæ•°ã€‘
 *
 *        1
 *       1 1
 *      1 2 1
 *     1 3 3 1
 *    1 4 6 4 1
 *
 * ç¬¬ n è¡Œç¬¬ k ä¸ªæ•° = C(n, k)
 * é€’æ¨å…¬å¼ï¼šC(n, k) = C(n-1, k-1) + C(n-1, k)
 */

// ============================================================
// 3. ç­‰å·®ç­‰æ¯”æ•°åˆ—
// ============================================================

/**
 * ã€ç­‰å·®æ•°åˆ—ã€‘
 *
 * a, a+d, a+2d, ..., a+(n-1)d
 *
 * æ±‚å’Œï¼šS = n(aâ‚ + aâ‚™) / 2 = n(2a + (n-1)d) / 2
 *
 * å¸¸è§ï¼š1 + 2 + 3 + ... + n = n(n+1)/2 â†’ O(nÂ²)
 *
 * ã€ç­‰æ¯”æ•°åˆ—ã€‘
 *
 * a, ar, arÂ², ..., arâ¿â»Â¹
 *
 * æ±‚å’Œï¼šS = a(1 - râ¿) / (1 - r)  (r â‰  1)
 *
 * å¸¸è§ï¼š1 + 2 + 4 + ... + 2â¿ = 2â¿âºÂ¹ - 1 â†’ O(2^n)
 *
 * ã€åœ¨å¤æ‚åº¦åˆ†æä¸­çš„åº”ç”¨ã€‘
 *
 * åˆ†æåµŒå¥—å¾ªç¯æ—¶ç»å¸¸ç”¨åˆ°ç­‰å·®æ•°åˆ—æ±‚å’Œ
 */

// ç­‰å·®æ•°åˆ—æ±‚å’Œ
function arithmeticSum(first: number, last: number, n: number): number {
  return (n * (first + last)) / 2;
}

// 1 åˆ° n çš„å’Œ
function sumToN(n: number): number {
  return (n * (n + 1)) / 2;
}

// ============================================================
// 4. å–æ¨¡è¿ç®—
// ============================================================

/**
 * ã€ä¸ºä»€ä¹ˆéœ€è¦å–æ¨¡ã€‘
 *
 * å¾ˆå¤šé¢˜ç›®è¦æ±‚ç­”æ¡ˆå¯¹ 10^9 + 7 å–æ¨¡ï¼ŒåŸå› ï¼š
 * 1. ç»“æœå¯èƒ½éå¸¸å¤§ï¼Œè¶…å‡ºæ•´æ•°èŒƒå›´
 * 2. 10^9 + 7 æ˜¯è´¨æ•°ï¼Œæœ‰å¾ˆå¥½çš„æ•°å­¦æ€§è´¨
 *
 * ã€å–æ¨¡è¿ç®—è§„åˆ™ã€‘
 *
 * (a + b) % m = ((a % m) + (b % m)) % m
 * (a - b) % m = ((a % m) - (b % m) + m) % m  // æ³¨æ„åŠ  m é˜²æ­¢è´Ÿæ•°
 * (a Ã— b) % m = ((a % m) Ã— (b % m)) % m
 * (a / b) % m = (a Ã— bâ»Â¹) % m  // éœ€è¦ç”¨é€†å…ƒ
 *
 * ã€JavaScript æ³¨æ„äº‹é¡¹ã€‘
 *
 * JavaScript çš„ % å¯¹è´Ÿæ•°çš„å¤„ç†å’Œæ•°å­¦å®šä¹‰ä¸åŒï¼š
 * -7 % 3 = -1ï¼ˆJavaScriptï¼‰
 * -7 mod 3 = 2ï¼ˆæ•°å­¦ï¼‰
 */

const MOD = 1e9 + 7;

// å®‰å…¨çš„åŠ æ³•å–æ¨¡
function addMod(a: number, b: number): number {
  return ((a % MOD) + (b % MOD)) % MOD;
}

// å®‰å…¨çš„å‡æ³•å–æ¨¡
function subMod(a: number, b: number): number {
  return (((a % MOD) - (b % MOD)) % MOD + MOD) % MOD;
}

// å®‰å…¨çš„ä¹˜æ³•å–æ¨¡
function mulMod(a: number, b: number): number {
  return ((a % MOD) * (b % MOD)) % MOD;
}

// å¿«é€Ÿå¹‚ï¼ˆç”¨äºè®¡ç®— a^n % mï¼‰
function powerMod(base: number, exp: number, mod: number = MOD): number {
  let result = 1;
  base = base % mod;
  while (exp > 0) {
    if (exp % 2 === 1) {
      result = (result * base) % mod;
    }
    exp = Math.floor(exp / 2);
    base = (base * base) % mod;
  }
  return result;
}

// ============================================================
// 5. ä½è¿ç®—ï¼ˆé‡ç‚¹ï¼‰
// ============================================================

/**
 * ã€åŸºæœ¬ä½è¿ç®—ã€‘
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚ è¿ç®—ç¬¦  â”‚ è¯´æ˜                                           â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ &      â”‚ æŒ‰ä½ä¸ï¼šä¸¤ä¸ªéƒ½æ˜¯1æ‰æ˜¯1                           â”‚
 * â”‚ |      â”‚ æŒ‰ä½æˆ–ï¼šæœ‰ä¸€ä¸ªæ˜¯1å°±æ˜¯1                           â”‚
 * â”‚ ^      â”‚ æŒ‰ä½å¼‚æˆ–ï¼šä¸åŒä¸º1ï¼Œç›¸åŒä¸º0                       â”‚
 * â”‚ ~      â”‚ æŒ‰ä½å–å                                        â”‚
 * â”‚ <<     â”‚ å·¦ç§»ï¼šç›¸å½“äºä¹˜ä»¥ 2^n                             â”‚
 * â”‚ >>     â”‚ å³ç§»ï¼šç›¸å½“äºé™¤ä»¥ 2^nï¼ˆæœ‰ç¬¦å·ï¼‰                   â”‚
 * â”‚ >>>    â”‚ æ— ç¬¦å·å³ç§»                                      â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * ã€å¸¸ç”¨æŠ€å·§ã€‘
 */

// 1. åˆ¤æ–­å¥‡å¶
function isOdd(n: number): boolean {
  return (n & 1) === 1;
}

// 2. ä¹˜ä»¥/é™¤ä»¥ 2
function multiplyBy2(n: number): number {
  return n << 1;
}

function divideBy2(n: number): number {
  return n >> 1;
}

// 3. è·å–æœ€ä½ä½çš„ 1ï¼ˆlowbitï¼‰
function lowbit(n: number): number {
  return n & -n;
}

// 4. å»æ‰æœ€ä½ä½çš„ 1
function removeLowestBit(n: number): number {
  return n & (n - 1);
}

// 5. åˆ¤æ–­æ˜¯å¦æ˜¯ 2 çš„å¹‚
function isPowerOfTwo(n: number): boolean {
  return n > 0 && (n & (n - 1)) === 0;
}

// 6. ç»Ÿè®¡äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°
function countBits(n: number): number {
  let count = 0;
  while (n > 0) {
    n = n & (n - 1); // æ¯æ¬¡å»æ‰æœ€ä½ä½çš„ 1
    count++;
  }
  return count;
}

// 7. äº¤æ¢ä¸¤ä¸ªæ•°ï¼ˆä¸ç”¨ä¸´æ—¶å˜é‡ï¼‰
function swapXor(a: number, b: number): [number, number] {
  a = a ^ b;
  b = a ^ b;
  a = a ^ b;
  return [a, b];
}

/**
 * ã€å¼‚æˆ–çš„æ€§è´¨ã€‘
 *
 * a ^ 0 = a
 * a ^ a = 0
 * a ^ b ^ b = aï¼ˆç”¨äºæ‰¾å•ç‹¬çš„æ•°ï¼‰
 * a ^ b = b ^ aï¼ˆäº¤æ¢å¾‹ï¼‰
 * (a ^ b) ^ c = a ^ (b ^ c)ï¼ˆç»“åˆå¾‹ï¼‰
 *
 * ã€åœ¨ç®—æ³•ä¸­çš„åº”ç”¨ã€‘
 *
 * 1. æ‰¾åªå‡ºç°ä¸€æ¬¡çš„æ•°
 * 2. ä¸ç”¨é¢å¤–ç©ºé—´äº¤æ¢ä¸¤æ•°
 * 3. çŠ¶æ€å‹ç¼©ï¼ˆå­é›†æšä¸¾ï¼‰
 */

// æ‰¾åªå‡ºç°ä¸€æ¬¡çš„æ•°ï¼ˆå…¶ä»–éƒ½å‡ºç°ä¸¤æ¬¡ï¼‰
function singleNumber(nums: number[]): number {
  let result = 0;
  for (const num of nums) {
    result ^= num;
  }
  return result;
}

/**
 * ã€çŠ¶æ€å‹ç¼©ã€‘
 *
 * ç”¨ä¸€ä¸ªæ•´æ•°çš„äºŒè¿›åˆ¶ä½è¡¨ç¤ºçŠ¶æ€
 *
 * ä¾‹ï¼šç”¨ n ä½äºŒè¿›åˆ¶è¡¨ç¤º n ä¸ªå…ƒç´ çš„é€‰å–æƒ…å†µ
 * 0101 è¡¨ç¤ºé€‰äº†ç¬¬ 0 ä½å’Œç¬¬ 2 ä½
 */

// æšä¸¾æ‰€æœ‰å­é›†
function enumerateSubsets(n: number): number[][] {
  const result: number[][] = [];
  for (let mask = 0; mask < (1 << n); mask++) {
    const subset: number[] = [];
    for (let i = 0; i < n; i++) {
      if ((mask >> i) & 1) {
        subset.push(i);
      }
    }
    result.push(subset);
  }
  return result;
}

// ============================================================
// 6. æœ€å¤§å…¬çº¦æ•°ï¼ˆGCDï¼‰
// ============================================================

/**
 * ã€æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼ˆè¾—è½¬ç›¸é™¤æ³•ï¼‰ã€‘
 *
 * gcd(a, b) = gcd(b, a % b)
 * gcd(a, 0) = a
 *
 * æ—¶é—´å¤æ‚åº¦ï¼šO(log(min(a, b)))
 *
 * ã€æœ€å°å…¬å€æ•°ã€‘
 *
 * lcm(a, b) = a Ã— b / gcd(a, b)
 */

// æœ€å¤§å…¬çº¦æ•°
function gcd(a: number, b: number): number {
  while (b !== 0) {
    const temp = b;
    b = a % b;
    a = temp;
  }
  return a;
}

// æœ€å°å…¬å€æ•°
function lcm(a: number, b: number): number {
  return (a / gcd(a, b)) * b;
}

// é€’å½’ç‰ˆ GCD
function gcdRecursive(a: number, b: number): number {
  return b === 0 ? a : gcdRecursive(b, a % b);
}

// ============================================================
// 7. é€ŸæŸ¥è¡¨
// ============================================================

/**
 * ã€å¸¸ç”¨æ•°å­¦å…¬å¼é€ŸæŸ¥ã€‘
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚ ç±»åˆ«        â”‚ å…¬å¼                                         â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ ç­‰å·®æ±‚å’Œ    â”‚ n(n+1)/2                                     â”‚
 * â”‚ ç­‰æ¯”æ±‚å’Œ    â”‚ a(1-r^n)/(1-r)                               â”‚
 * â”‚ ç»„åˆæ•°      â”‚ C(n,k) = n!/((n-k)!k!)                       â”‚
 * â”‚ å…¨æ’åˆ—      â”‚ n!                                          â”‚
 * â”‚ äºŒå‰æ ‘é«˜åº¦  â”‚ logâ‚‚n                                        â”‚
 * â”‚ æ•°å­—ä½æ•°    â”‚ logâ‚â‚€n + 1                                   â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * ã€ä½è¿ç®—é€ŸæŸ¥ã€‘
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚ æ“ä½œ                â”‚ ä»£ç                                  â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ åˆ¤æ–­å¥‡å¶            â”‚ n & 1                               â”‚
 * â”‚ ä¹˜ä»¥ 2              â”‚ n << 1                              â”‚
 * â”‚ é™¤ä»¥ 2              â”‚ n >> 1                              â”‚
 * â”‚ å»æ‰æœ€ä½ä½çš„ 1      â”‚ n & (n - 1)                         â”‚
 * â”‚ è·å–æœ€ä½ä½çš„ 1      â”‚ n & -n                              â”‚
 * â”‚ åˆ¤æ–­ 2 çš„å¹‚         â”‚ n > 0 && (n & (n-1)) === 0          â”‚
 * â”‚ ç¬¬ i ä½ç½® 1        â”‚ n | (1 << i)                        â”‚
 * â”‚ ç¬¬ i ä½ç½® 0        â”‚ n & ~(1 << i)                       â”‚
 * â”‚ æ£€æŸ¥ç¬¬ i ä½        â”‚ (n >> i) & 1                        â”‚
 * â”‚ ç¿»è½¬ç¬¬ i ä½        â”‚ n ^ (1 << i)                        â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */

export {
  getDigitCount,
  log2Floor,
  factorial,
  permutation,
  combination,
  arithmeticSum,
  sumToN,
  addMod,
  subMod,
  mulMod,
  powerMod,
  isOdd,
  multiplyBy2,
  divideBy2,
  lowbit,
  removeLowestBit,
  isPowerOfTwo,
  countBits,
  swapXor,
  singleNumber,
  enumerateSubsets,
  gcd,
  lcm,
  gcdRecursive,
};

