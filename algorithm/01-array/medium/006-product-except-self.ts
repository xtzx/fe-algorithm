/**
 * ğŸ“ é¢˜ç›®ï¼šé™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/product-of-array-except-self/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ•°ç»„ã€å‰ç¼€å’Œ
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œè¿”å›æ•°ç»„ answerï¼Œå…¶ä¸­ answer[i] ç­‰äº nums ä¸­
 * é™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯ã€‚
 *
 * è¦æ±‚ï¼šä¸èƒ½ä½¿ç”¨é™¤æ³•ï¼Œä¸”åœ¨ O(n) æ—¶é—´å¤æ‚åº¦å†…å®Œæˆã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šnums = [1,2,3,4]
 * è¾“å‡ºï¼š[24,12,8,6]
 * è§£é‡Šï¼š
 * - answer[0] = 2*3*4 = 24
 * - answer[1] = 1*3*4 = 12
 * - answer[2] = 1*2*4 = 8
 * - answer[3] = 1*2*3 = 6
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// å…³é”®çº¦æŸï¼šã€Œä¸èƒ½ç”¨é™¤æ³•ã€ã€ŒO(n) æ—¶é—´ã€
//
// 1. å¦‚æœèƒ½ç”¨é™¤æ³•ï¼šæ€»ä¹˜ç§¯ / nums[i]ï¼ˆä½†è¦å¤„ç† 0 çš„æƒ…å†µï¼‰
//
// 2. å‰ç¼€ç§¯æ€è·¯ï¼š
//    answer[i] = nums[i] å·¦è¾¹æ‰€æœ‰æ•°çš„ä¹˜ç§¯ Ã— nums[i] å³è¾¹æ‰€æœ‰æ•°çš„ä¹˜ç§¯
//             = leftProduct[i] Ã— rightProduct[i]
//
// 3. ç©ºé—´ä¼˜åŒ–ï¼š
//    - å…ˆç”¨ answer å­˜å‚¨å·¦è¾¹ä¹˜ç§¯
//    - å†ä»å³å¾€å·¦éå†ï¼Œä¹˜ä¸Šå³è¾¹ä¹˜ç§¯
//
// ğŸ“Š å‰ç¼€ç§¯å›¾è§£ï¼š
//
//    nums = [1, 2, 3, 4]
//
//    å·¦è¾¹ä¹˜ç§¯ (ä¸åŒ…å«è‡ªå·±)ï¼š
//    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
//    â”‚  i=0: å·¦è¾¹æ²¡æœ‰å…ƒç´ , left[0] = 1           â”‚
//    â”‚  i=1: å·¦è¾¹æ˜¯ [1], left[1] = 1             â”‚
//    â”‚  i=2: å·¦è¾¹æ˜¯ [1,2], left[2] = 1*2 = 2     â”‚
//    â”‚  i=3: å·¦è¾¹æ˜¯ [1,2,3], left[3] = 1*2*3 = 6 â”‚
//    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//    left = [1, 1, 2, 6]
//
//    å³è¾¹ä¹˜ç§¯ (ä¸åŒ…å«è‡ªå·±)ï¼š
//    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
//    â”‚  i=3: å³è¾¹æ²¡æœ‰å…ƒç´ , right[3] = 1           â”‚
//    â”‚  i=2: å³è¾¹æ˜¯ [4], right[2] = 4             â”‚
//    â”‚  i=1: å³è¾¹æ˜¯ [3,4], right[1] = 3*4 = 12    â”‚
//    â”‚  i=0: å³è¾¹æ˜¯ [2,3,4], right[0] = 2*3*4 = 24â”‚
//    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//    right = [24, 12, 4, 1]
//
//    answer[i] = left[i] Ã— right[i]
//    answer = [1Ã—24, 1Ã—12, 2Ã—4, 6Ã—1] = [24, 12, 8, 6]

// ============================================================
// è§£æ³•ä¸€ï¼šå·¦å³ä¹˜ç§¯æ•°ç»„
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)

function productExceptSelf_v1(nums: number[]): number[] {
  const n = nums.length;

  // å·¦è¾¹ä¹˜ç§¯ï¼šleft[i] = nums[0] Ã— nums[1] Ã— ... Ã— nums[i-1]
  const left: number[] = new Array(n);
  left[0] = 1;
  for (let i = 1; i < n; i++) {
    left[i] = left[i - 1] * nums[i - 1];
  }

  // å³è¾¹ä¹˜ç§¯ï¼šright[i] = nums[i+1] Ã— nums[i+2] Ã— ... Ã— nums[n-1]
  const right: number[] = new Array(n);
  right[n - 1] = 1;
  for (let i = n - 2; i >= 0; i--) {
    right[i] = right[i + 1] * nums[i + 1];
  }

  // ç»“æœ
  const answer: number[] = new Array(n);
  for (let i = 0; i < n; i++) {
    answer[i] = left[i] * right[i];
  }

  return answer;
}

// ============================================================
// è§£æ³•äºŒï¼šç©ºé—´ä¼˜åŒ–ï¼ˆæ¨èï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼ˆä¸è®¡è¾“å‡ºæ•°ç»„ï¼‰
// âœ… æ¨èï¼šç”¨ answer æ•°ç»„å­˜å‚¨å·¦è¾¹ä¹˜ç§¯ï¼Œå†ç”¨ä¸€ä¸ªå˜é‡ç´¯ç§¯å³è¾¹ä¹˜ç§¯

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * nums = [1, 2, 3, 4]
 *
 * === ç¬¬ä¸€éï¼šä»å·¦å¾€å³ï¼Œè®¡ç®—å·¦è¾¹ä¹˜ç§¯ ===
 * answer[0] = 1
 * answer[1] = 1 Ã— 1 = 1
 * answer[2] = 1 Ã— 2 = 2
 * answer[3] = 2 Ã— 3 = 6
 *
 * answer = [1, 1, 2, 6] (å­˜å‚¨çš„æ˜¯å·¦è¾¹ä¹˜ç§¯)
 *
 * === ç¬¬äºŒéï¼šä»å³å¾€å·¦ï¼Œä¹˜ä¸Šå³è¾¹ä¹˜ç§¯ ===
 * right = 1
 * i=3: answer[3] = 6 Ã— 1 = 6,  right = 1 Ã— 4 = 4
 * i=2: answer[2] = 2 Ã— 4 = 8,  right = 4 Ã— 3 = 12
 * i=1: answer[1] = 1 Ã— 12 = 12, right = 12 Ã— 2 = 24
 * i=0: answer[0] = 1 Ã— 24 = 24, right = 24 Ã— 1 = 24
 *
 * answer = [24, 12, 8, 6]
 */
function productExceptSelf_v2(nums: number[]): number[] {
  const n = nums.length;
  const answer: number[] = new Array(n);

  // ç¬¬ä¸€éï¼šä»å·¦å¾€å³ï¼Œanswer[i] å­˜å‚¨ nums[0..i-1] çš„ä¹˜ç§¯
  answer[0] = 1;
  for (let i = 1; i < n; i++) {
    answer[i] = answer[i - 1] * nums[i - 1];
  }

  // ç¬¬äºŒéï¼šä»å³å¾€å·¦ï¼Œä¹˜ä¸Šå³è¾¹çš„ä¹˜ç§¯
  let right = 1;
  for (let i = n - 1; i >= 0; i--) {
    answer[i] = answer[i] * right;
    right = right * nums[i];
  }

  return answer;
}

// ============================================================
// è§£æ³•ä¸‰ï¼šä½¿ç”¨é™¤æ³•ï¼ˆå¦‚æœé¢˜ç›®å…è®¸ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)
// âš ï¸ æœ¬é¢˜ä¸å…è®¸ä½¿ç”¨é™¤æ³•ï¼Œè¿™é‡Œä»…ä½œå¯¹æ¯”

function productExceptSelf_v3(nums: number[]): number[] {
  const n = nums.length;
  let totalProduct = 1;
  let zeroCount = 0;

  // è®¡ç®—æ€»ä¹˜ç§¯å’Œ 0 çš„ä¸ªæ•°
  for (const num of nums) {
    if (num === 0) {
      zeroCount++;
    } else {
      totalProduct *= num;
    }
  }

  const answer: number[] = new Array(n);

  // æ ¹æ® 0 çš„ä¸ªæ•°å¤„ç†
  if (zeroCount > 1) {
    // æœ‰å¤šä¸ª 0ï¼Œæ‰€æœ‰ç»“æœéƒ½æ˜¯ 0
    answer.fill(0);
  } else if (zeroCount === 1) {
    // åªæœ‰ä¸€ä¸ª 0ï¼Œåªæœ‰ 0 çš„ä½ç½®ç»“æœé 0
    for (let i = 0; i < n; i++) {
      answer[i] = nums[i] === 0 ? totalProduct : 0;
    }
  } else {
    // æ²¡æœ‰ 0ï¼Œç›´æ¥é™¤
    for (let i = 0; i < n; i++) {
      answer[i] = totalProduct / nums[i];
    }
  }

  return answer;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•           | æ—¶é—´  | ç©ºé—´  | ç‰¹ç‚¹                     |
 * |---------------|-------|-------|-------------------------|
 * | å·¦å³ä¹˜ç§¯æ•°ç»„   | O(n)  | O(n)  | æ€è·¯æ¸…æ™°                 |
 * | ç©ºé—´ä¼˜åŒ–       | O(n)  | O(1)  | æ¨èï¼Œé¢è¯•å¸¸é—®           |
 * | é™¤æ³•          | O(n)  | O(1)  | ç®€å•ä½†æœ¬é¢˜ä¸å…è®¸          |
 *
 * ä¸ºä»€ä¹ˆä¸èƒ½ç”¨é™¤æ³•ï¼Ÿ
 * - å¯èƒ½æœ‰ 0ï¼Œé™¤ä»¥ 0 ä¼šå‡ºé”™
 * - é¢˜ç›®æ˜ç¡®è¦æ±‚ä¸ä½¿ç”¨é™¤æ³•
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. è¾¹ç•Œåˆå§‹åŒ–ï¼š
 *    - left[0] = 1ï¼ˆå·¦è¾¹æ²¡æœ‰å…ƒç´ ï¼Œä¹˜ç§¯ä¸º1ï¼‰
 *    - right[n-1] = 1ï¼ˆå³è¾¹æ²¡æœ‰å…ƒç´ ï¼Œä¹˜ç§¯ä¸º1ï¼‰
 *
 * 2. ç©ºé—´ä¼˜åŒ–æ—¶çš„é¡ºåºï¼š
 *    - ç¬¬ä¸€éï¼šä»å·¦å¾€å³ï¼Œå­˜å‚¨å·¦è¾¹ä¹˜ç§¯
 *    - ç¬¬äºŒéï¼šä»å³å¾€å·¦ï¼Œä¹˜ä¸Šå³è¾¹ä¹˜ç§¯
 *    - ä¸èƒ½åè¿‡æ¥ï¼
 *
 * 3. 0 çš„å¤„ç†ï¼š
 *    - å¦‚æœæœ‰ 0ï¼Œå‰ç¼€ç§¯ä¼šå˜æˆ 0
 *    - ä½†æœ¬é¢˜çš„å‰ç¼€ç§¯ä¸åŒ…å«è‡ªå·±ï¼Œæ‰€ä»¥æ²¡é—®é¢˜
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - å‰ç¼€å’Œ â†’ æ±‚åŒºé—´å’Œ
 * - å‰ç¼€ç§¯ â†’ æ±‚åŒºé—´ç§¯
 * - æ¥é›¨æ°´ â†’ å·¦å³æœ€å¤§å€¼é¢„å¤„ç†ï¼ˆç±»ä¼¼æ€æƒ³ï¼‰
 *
 * å…±åŒæ¨¡å¼ï¼šã€Œå·¦è¾¹ + å³è¾¹ã€åˆ†åˆ«é¢„å¤„ç†
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. æƒé‡è®¡ç®—ï¼šè®¡ç®—æ¯ä¸ªé€‰é¡¹çš„ç›¸å¯¹æƒé‡ï¼ˆå…¶ä»–é€‰é¡¹æƒé‡çš„ä¹˜ç§¯ï¼‰
 * 2. æ¦‚ç‡è®¡ç®—ï¼šè®¡ç®—æ¯ä¸ªäº‹ä»¶ä¸å‘ç”Ÿæ—¶å…¶ä»–äº‹ä»¶çš„è”åˆæ¦‚ç‡
 * 3. å›¾è¡¨ç¼©æ”¾ï¼šè®¡ç®—æ¯ä¸ªæ•°æ®ç‚¹ç›¸å¯¹äºå…¶ä»–ç‚¹çš„ç¼©æ”¾å› å­
 */

// å¯¼å‡ºä¸»è§£æ³•
export { productExceptSelf_v1, productExceptSelf_v2, productExceptSelf_v3 };
export default productExceptSelf_v2;

