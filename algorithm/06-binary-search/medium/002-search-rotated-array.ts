/**
 * ğŸ“ é¢˜ç›®ï¼šæœç´¢æ—‹è½¬æ’åºæ•°ç»„
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/search-in-rotated-sorted-array/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ•°ç»„ã€äºŒåˆ†æŸ¥æ‰¾
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * æ•´æ•°æ•°ç»„ nums æŒ‰å‡åºæ’åˆ—ï¼Œæ•°ç»„ä¸­çš„å€¼ äº’ä¸ç›¸åŒã€‚
 *
 * åœ¨ä¼ é€’ç»™å‡½æ•°ä¹‹å‰ï¼Œnums åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªä¸‹æ ‡ kï¼ˆ0 <= k < nums.lengthï¼‰ä¸Šè¿›è¡Œäº† æ—‹è½¬ï¼Œ
 * ä½¿æ•°ç»„å˜ä¸º [nums[k], nums[k+1], ..., nums[n-1], nums[0], nums[1], ..., nums[k-1]]
 *
 * ç»™ä½  æ—‹è½¬å çš„æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° targetï¼Œå¦‚æœ nums ä¸­å­˜åœ¨è¿™ä¸ªç›®æ ‡å€¼ targetï¼Œ
 * åˆ™è¿”å›å®ƒçš„ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚
 *
 * ä½ å¿…é¡»è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šnums = [4,5,6,7,0,1,2], target = 0
 * è¾“å‡ºï¼š4
 *
 * è¾“å…¥ï¼šnums = [4,5,6,7,0,1,2], target = 3
 * è¾“å‡ºï¼š-1
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// æ—‹è½¬æ•°ç»„çš„ç‰¹ç‚¹ï¼š
// - åˆ†æˆä¸¤æ®µï¼Œæ¯æ®µéƒ½æ˜¯æœ‰åºçš„
// - å·¦æ®µçš„æœ€å°å€¼ > å³æ®µçš„æœ€å¤§å€¼
//
// å…³é”®ï¼šåˆ¤æ–­ mid åœ¨å·¦æ®µè¿˜æ˜¯å³æ®µ
// - nums[mid] >= nums[left] â†’ mid åœ¨å·¦æ®µ
// - nums[mid] < nums[left] â†’ mid åœ¨å³æ®µ
//
// ç„¶ååˆ¤æ–­ target åœ¨æœ‰åºçš„é‚£åŠè¾¹è¿˜æ˜¯æ— åºçš„é‚£åŠè¾¹

// ============================================================
// è§£æ³•ï¼šäºŒåˆ†æŸ¥æ‰¾
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(log n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * nums = [4, 5, 6, 7, 0, 1, 2], target = 0
 *         0  1  2  3  4  5  6
 *
 * åˆå§‹: left=0, right=6
 *
 * Step 1: mid = 3, nums[mid] = 7
 *         nums[0]=4 <= nums[3]=7 â†’ å·¦åŠè¾¹[4,5,6,7]æœ‰åº
 *         target=0 ä¸åœ¨ [4,7] ä¹‹é—´
 *         left = 4
 *
 * Step 2: mid = 5, nums[mid] = 1
 *         nums[4]=0 <= nums[5]=1 â†’ å·¦åŠè¾¹[0,1]æœ‰åº
 *         target=0 åœ¨ [0,1] ä¹‹é—´
 *         right = 5
 *
 * Step 3: mid = 4, nums[mid] = 0
 *         nums[4]=0 == target=0
 *         æ‰¾åˆ°ï¼è¿”å› 4
 *
 * ğŸ”„ å…³é”®åˆ¤æ–­ (Mermaid):
 * ```mermaid
 * flowchart TD
 *     A[è®¡ç®— mid] --> B{nums left <= nums mid?}
 *     B -->|Yes| C[å·¦åŠè¾¹æœ‰åº]
 *     B -->|No| D[å³åŠè¾¹æœ‰åº]
 *     C --> E{target åœ¨å·¦åŠè¾¹?}
 *     E -->|Yes| F[right = mid - 1]
 *     E -->|No| G[left = mid + 1]
 *     D --> H{target åœ¨å³åŠè¾¹?}
 *     H -->|Yes| I[left = mid + 1]
 *     H -->|No| J[right = mid - 1]
 * ```
 */
function search(nums: number[], target: number): number {
  let left = 0;
  let right = nums.length - 1;

  while (left <= right) {
    const mid = left + ((right - left) >> 1);

    if (nums[mid] === target) {
      return mid;
    }

    // åˆ¤æ–­å“ªåŠè¾¹æ˜¯æœ‰åºçš„
    if (nums[left] <= nums[mid]) {
      // å·¦åŠè¾¹ [left, mid] æ˜¯æœ‰åºçš„
      if (nums[left] <= target && target < nums[mid]) {
        // target åœ¨æœ‰åºçš„å·¦åŠè¾¹
        right = mid - 1;
      } else {
        // target åœ¨å³åŠè¾¹
        left = mid + 1;
      }
    } else {
      // å³åŠè¾¹ [mid, right] æ˜¯æœ‰åºçš„
      if (nums[mid] < target && target <= nums[right]) {
        // target åœ¨æœ‰åºçš„å³åŠè¾¹
        left = mid + 1;
      } else {
        // target åœ¨å·¦åŠè¾¹
        right = mid - 1;
      }
    }
  }

  return -1;
}

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. åˆ¤æ–­æœ‰åºåŠè¾¹ï¼š
 *    - nums[left] <= nums[mid]ï¼ˆæ³¨æ„ç­‰å·ï¼ï¼‰
 *    - ä¸æ˜¯ nums[left] < nums[mid]
 *    - å½“ left == mid æ—¶ï¼Œå·¦åŠè¾¹åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿæ˜¯æœ‰åºçš„
 *
 * 2. target èŒƒå›´åˆ¤æ–­ï¼š
 *    - å·¦åŠè¾¹ï¼šnums[left] <= target < nums[mid]
 *    - å³åŠè¾¹ï¼šnums[mid] < target <= nums[right]
 *    - æ³¨æ„è¾¹ç•Œçš„ç­‰å·ä½ç½®
 *
 * 3. æ•°ç»„æ— é‡å¤ï¼š
 *    - å¦‚æœæœ‰é‡å¤ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - æœç´¢æ—‹è½¬æ’åºæ•°ç»„ II â†’ æœ‰é‡å¤å…ƒç´ 
 * - å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ â†’ æ‰¾æ—‹è½¬ç‚¹
 * - å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II â†’ æœ‰é‡å¤
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. å¾ªç¯åˆ—è¡¨æŸ¥æ‰¾ï¼šåœ¨å¾ªç¯ç¼“å†²åŒºä¸­æŸ¥æ‰¾
 * 2. è½®æ’­å›¾å®šä½ï¼šåœ¨å¾ªç¯è½®æ’­ä¸­æ‰¾ç‰¹å®šé¡¹
 */

export { search };
export default search;

