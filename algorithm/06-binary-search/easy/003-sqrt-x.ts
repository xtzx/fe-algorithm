/**
 * 📝 题目：x 的平方根
 * 🔗 链接：https://leetcode.cn/problems/sqrtx/
 * 🏷️ 难度：Easy
 * 🏷️ 标签：数学、二分查找
 *
 * 📋 题目描述：
 * 给你一个非负整数 x，计算并返回 x 的 算术平方根。
 *
 * 由于返回类型是整数，结果只保留 整数部分，小数部分将被 舍去。
 *
 * 注意：不允许使用任何内置指数函数和算符，例如 pow(x, 0.5) 或 x ** 0.5。
 *
 * 示例：
 * 输入：x = 4
 * 输出：2
 *
 * 输入：x = 8
 * 输出：2
 * 解释：8 的算术平方根是 2.82842...，由于返回类型是整数，小数部分将被舍去。
 */

// ============================================================
// 💡 思路分析：这道题的解法是怎么想出来的？
// ============================================================
//
// 本质：找最大的 k，使得 k² <= x
//
// 这是一个典型的"答案二分"问题：
// - 搜索空间：[0, x]
// - 判断条件：k² <= x
// - 找满足条件的最大值

// ============================================================
// 解法一：二分查找
// ============================================================
// ⏱️ 时间复杂度：O(log x) | 空间复杂度：O(1)

/**
 * 📊 执行过程图解：
 *
 * x = 8，找最大的 k 使得 k² <= 8
 *
 * 搜索空间: [0, 8]
 *
 * Step 1: mid = 4
 *         4² = 16 > 8
 *         right = 3
 *
 * Step 2: mid = 1
 *         1² = 1 <= 8
 *         left = 2
 *
 * Step 3: mid = 2
 *         2² = 4 <= 8
 *         left = 3
 *
 * Step 4: mid = 3
 *         3² = 9 > 8
 *         right = 2
 *
 * left > right，循环结束
 * 返回 right = 2
 */
function mySqrt(x: number): number {
  if (x < 2) return x;

  let left = 1;
  let right = Math.floor(x / 2); // 优化：sqrt(x) <= x/2 (x >= 2)

  while (left <= right) {
    const mid = left + ((right - left) >> 1);
    const square = mid * mid;

    if (square === x) {
      return mid;
    } else if (square < x) {
      left = mid + 1;
    } else {
      right = mid - 1;
    }
  }

  // 返回最大的 k 使得 k² <= x
  return right;
}

// ============================================================
// 解法二：左边界二分思路
// ============================================================
// ⏱️ 时间复杂度：O(log x) | 空间复杂度：O(1)

/**
 * 找第一个 k² > x 的 k，然后返回 k - 1
 */
function mySqrt_v2(x: number): number {
  let left = 0;
  let right = x + 1; // 开区间

  while (left < right) {
    const mid = left + ((right - left) >> 1);

    if (mid > x / mid) {
      // 用除法避免溢出
      right = mid;
    } else {
      left = mid + 1;
    }
  }

  return left - 1;
}

// ============================================================
// 解法三：牛顿迭代法
// ============================================================
// ⏱️ 时间复杂度：O(log x) | 空间复杂度：O(1)

/**
 * 牛顿迭代法：
 * 求 f(k) = k² - x = 0 的根
 * 迭代公式：k = (k + x/k) / 2
 */
function mySqrt_v3(x: number): number {
  if (x < 2) return x;

  let k = x;
  while (k > x / k) {
    k = Math.floor((k + x / k) / 2);
  }

  return k;
}

// ============================================================
// 🔄 解法对比
// ============================================================
/**
 * | 解法       | 时间     | 空间  | 特点                     |
 * |-----------|----------|-------|-------------------------|
 * | 二分查找   | O(log x) | O(1)  | 推荐，最通用              |
 * | 牛顿迭代   | O(log x) | O(1)  | 收敛更快，但需要数学背景   |
 */

// ============================================================
// ⚠️ 易错点
// ============================================================
/**
 * 1. 溢出问题：
 *    - mid * mid 可能溢出
 *    - 可以用 mid > x / mid 代替
 *
 * 2. 边界情况：
 *    - x = 0 或 x = 1 时直接返回 x
 *
 * 3. 返回值：
 *    - 找的是最大的 k² <= x，所以返回 right
 *    - 不是返回 left
 */

// ============================================================
// 🔗 举一反三：相似题目
// ============================================================
/**
 * - 有效的完全平方数 → 判断 x 是否是完全平方数
 * - Pow(x, n) → 快速幂
 */

// ============================================================
// 🏢 前端业务场景
// ============================================================
/**
 * 1. 动画计算：计算贝塞尔曲线、距离等
 * 2. 布局计算：正方形区域的边长
 */

export { mySqrt, mySqrt_v2, mySqrt_v3 };
export default mySqrt;

