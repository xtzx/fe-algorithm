/**
 * ğŸ“ é¢˜ç›®ï¼šç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/first-bad-version/
 * ğŸ·ï¸ éš¾åº¦ï¼šEasy
 * ğŸ·ï¸ æ ‡ç­¾ï¼šäºŒåˆ†æŸ¥æ‰¾ã€äº¤äº’
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ä½ æ˜¯äº§å“ç»ç†ï¼Œç›®å‰æ­£åœ¨å¸¦é¢†ä¸€ä¸ªå›¢é˜Ÿå¼€å‘æ–°çš„äº§å“ã€‚
 * ä¸å¹¸çš„æ˜¯ï¼Œä½ çš„äº§å“çš„æœ€æ–°ç‰ˆæœ¬æ²¡æœ‰é€šè¿‡è´¨é‡æ£€æµ‹ã€‚
 * ç”±äºæ¯ä¸ªç‰ˆæœ¬éƒ½æ˜¯åŸºäºä¹‹å‰çš„ç‰ˆæœ¬å¼€å‘çš„ï¼Œæ‰€ä»¥é”™è¯¯çš„ç‰ˆæœ¬ä¹‹åçš„æ‰€æœ‰ç‰ˆæœ¬éƒ½æ˜¯é”™çš„ã€‚
 *
 * å‡è®¾ä½ æœ‰ n ä¸ªç‰ˆæœ¬ [1, 2, ..., n]ï¼Œä½ æƒ³æ‰¾å‡ºå¯¼è‡´ä¹‹åæ‰€æœ‰ç‰ˆæœ¬å‡ºé”™çš„ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚
 *
 * ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ bool isBadVersion(version) æ¥å£æ¥åˆ¤æ–­ç‰ˆæœ¬å· version æ˜¯å¦åœ¨å•å…ƒæµ‹è¯•ä¸­å‡ºé”™ã€‚
 * å®ç°ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚ä½ åº”è¯¥å°½é‡å‡å°‘å¯¹è°ƒç”¨ API çš„æ¬¡æ•°ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šn = 5, bad = 4
 * è¾“å‡ºï¼š4
 * è§£é‡Šï¼š
 * è°ƒç”¨ isBadVersion(3) -> false
 * è°ƒç”¨ isBadVersion(5) -> true
 * è°ƒç”¨ isBadVersion(4) -> true
 * æ‰€ä»¥ï¼Œ4 æ˜¯ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚
 */

// API å£°æ˜ï¼ˆç”±ç³»ç»Ÿæä¾›ï¼‰
declare function isBadVersion(version: number): boolean;

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// å…¸å‹çš„å·¦è¾¹ç•ŒäºŒåˆ†ï¼
//
// ç‰ˆæœ¬åºåˆ—: [good, good, good, bad, bad, bad]
//                          â†‘
//                     ç¬¬ä¸€ä¸ª bad
//
// æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³ isBadVersion(mid) == true çš„ä½ç½®

// ============================================================
// è§£æ³•ï¼šå·¦è¾¹ç•ŒäºŒåˆ†
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(log n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * n = 5, bad = 4
 *
 * ç‰ˆæœ¬: [1, 2, 3, 4, 5]
 * çŠ¶æ€: [G, G, G, B, B]
 *
 * åˆå§‹: left=1, right=5
 *
 * Step 1: mid = 3
 *         isBadVersion(3) = false
 *         left = 4
 *
 * Step 2: mid = 4
 *         isBadVersion(4) = true
 *         right = 4
 *
 * left == right == 4ï¼Œè¿”å› 4
 */
function solution(isBadVersion: (version: number) => boolean) {
  return function (n: number): number {
    let left = 1;
    let right = n;

    while (left < right) {
      const mid = left + ((right - left) >> 1);

      if (isBadVersion(mid)) {
        // mid æ˜¯åç‰ˆæœ¬ï¼Œç­”æ¡ˆå¯èƒ½æ˜¯ mid æˆ–æ›´æ—©
        right = mid;
      } else {
        // mid æ˜¯å¥½ç‰ˆæœ¬ï¼Œç­”æ¡ˆåœ¨å³è¾¹
        left = mid + 1;
      }
    }

    return left; // left == rightï¼Œå°±æ˜¯ç¬¬ä¸€ä¸ªåç‰ˆæœ¬
  };
}

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. ç‰ˆæœ¬å·ä» 1 å¼€å§‹ï¼š
 *    - left = 1ï¼Œä¸æ˜¯ 0
 *
 * 2. å¾ªç¯æ¡ä»¶ï¼š
 *    - left < rightï¼Œæ‰¾å·¦è¾¹ç•Œçš„æ ‡å‡†å†™æ³•
 *
 * 3. mid è®¡ç®—ï¼š
 *    - ç”¨ left + (right - left) / 2 é˜²æ­¢æº¢å‡º
 *
 * 4. API è°ƒç”¨æ¬¡æ•°ï¼š
 *    - äºŒåˆ†æŸ¥æ‰¾ä¿è¯è°ƒç”¨æ¬¡æ•°æ˜¯ O(log n)
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - æœç´¢æ’å…¥ä½ç½® â†’ æ‰¾ç¬¬ä¸€ä¸ª >= target
 * - å¯»æ‰¾å³°å€¼ â†’ å±€éƒ¨äºŒåˆ†
 * - å±±è„‰æ•°ç»„ä¸­æŸ¥æ‰¾ç›®æ ‡å€¼ â†’ å…ˆæ‰¾å³°å€¼å†äºŒåˆ†
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. Git bisectï¼šæŸ¥æ‰¾å¼•å…¥ bug çš„æäº¤
 *    - å®é™…ä¸Šå°±æ˜¯è¿™é“é¢˜ï¼
 *
 * 2. ç‰ˆæœ¬å›é€€ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªæœ‰é—®é¢˜çš„éƒ¨ç½²ç‰ˆæœ¬
 *
 * 3. æ€§èƒ½æµ‹è¯•ï¼šæ‰¾åˆ°å¯¼è‡´æ€§èƒ½ä¸‹é™çš„ä»£ç å˜æ›´
 */

// ============================================================
// ğŸ“– å…³äº Git bisect
// ============================================================
/**
 * Git bisect å‘½ä»¤å°±æ˜¯ç”¨äºŒåˆ†æŸ¥æ‰¾å®šä½å¼•å…¥ bug çš„æäº¤ï¼š
 *
 * git bisect start
 * git bisect bad                  # å½“å‰ç‰ˆæœ¬æœ‰ bug
 * git bisect good <commit-hash>   # è¿™ä¸ªç‰ˆæœ¬æ²¡æœ‰ bug
 *
 * Git ä¼šè‡ªåŠ¨ checkout åˆ°ä¸­é—´çš„æäº¤ï¼Œä½ æµ‹è¯•åå‘Šè¯‰ Gitï¼š
 * git bisect good  # æˆ– git bisect bad
 *
 * é‡å¤ç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœ‰ bug çš„æäº¤ï¼
 *
 * è¿™æ¯”çº¿æ€§æŸ¥æ‰¾å¿«å¾—å¤šï¼š
 * - 1000 ä¸ªæäº¤åªéœ€è¦çº¦ 10 æ¬¡æµ‹è¯•
 */

export { solution };
export default solution;

