/**
 * ğŸ“ é¢˜ç›®ï¼šLRU ç¼“å­˜
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/lru-cache/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium (å®é™…éš¾åº¦å Hard)
 * ğŸ·ï¸ æ ‡ç­¾ï¼šè®¾è®¡ã€å“ˆå¸Œè¡¨ã€é“¾è¡¨ã€åŒå‘é“¾è¡¨
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³ LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜ çº¦æŸçš„æ•°æ®ç»“æ„ã€‚
 *
 * å®ç° LRUCache ç±»ï¼š
 * - LRUCache(int capacity) ä»¥æ­£æ•´æ•°ä½œä¸ºå®¹é‡ capacity åˆå§‹åŒ– LRU ç¼“å­˜
 * - int get(int key) å¦‚æœå…³é”®å­— key å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› -1
 * - void put(int key, int value) å¦‚æœå…³é”®å­— key å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ valueï¼›
 *   å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„ key-valueã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡ capacityï¼Œ
 *   åˆ™åº”è¯¥é€å‡ºæœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚
 *
 * å‡½æ•° get å’Œ put å¿…é¡»ä»¥ O(1) çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼š
 * ["LRUCache", "put", "put", "get", "put", "get", "put", "get", "get", "get"]
 * [[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]]
 * è¾“å‡ºï¼š
 * [null, null, null, 1, null, -1, null, -1, 3, 4]
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// LRU ç¼“å­˜éœ€è¦æ»¡è¶³ï¼š
// 1. O(1) æ—¶é—´è·å– key å¯¹åº”çš„ value â†’ å“ˆå¸Œè¡¨
// 2. O(1) æ—¶é—´æ›´æ–°è®¿é—®é¡ºåº â†’ åŒå‘é“¾è¡¨
// 3. O(1) æ—¶é—´æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„å…ƒç´  â†’ é“¾è¡¨å°¾éƒ¨
//
// æ•°æ®ç»“æ„é€‰æ‹©ï¼š
// - å“ˆå¸Œè¡¨ï¼ˆMapï¼‰ï¼škey â†’ é“¾è¡¨èŠ‚ç‚¹
// - åŒå‘é“¾è¡¨ï¼šç»´æŠ¤è®¿é—®é¡ºåºï¼Œæœ€è¿‘è®¿é—®çš„åœ¨å¤´éƒ¨ï¼Œæœ€ä¹…æœªä½¿ç”¨çš„åœ¨å°¾éƒ¨
//
// ğŸ“Š ç»“æ„å›¾è§£ï¼š
//
//   HashMap:
//   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
//   â”‚ key â”‚   Node      â”‚
//   â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
//   â”‚  1  â”‚ â†’ Node(1,1) â”‚
//   â”‚  2  â”‚ â†’ Node(2,2) â”‚
//   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//
//   åŒå‘é“¾è¡¨ï¼ˆå¤´éƒ¨æœ€æ–°ï¼Œå°¾éƒ¨æœ€æ—§ï¼‰ï¼š
//   head â‡„ Node(1,1) â‡„ Node(2,2) â‡„ tail
//          (æœ€æ–°)        (æœ€æ—§)

// ============================================================
// åŒå‘é“¾è¡¨èŠ‚ç‚¹
// ============================================================
class DLinkedNode {
  key: number;
  value: number;
  prev: DLinkedNode | null = null;
  next: DLinkedNode | null = null;

  constructor(key: number = 0, value: number = 0) {
    this.key = key;
    this.value = value;
  }
}

// ============================================================
// LRU ç¼“å­˜å®ç°
// ============================================================
// â±ï¸ get/put æ—¶é—´å¤æ‚åº¦ï¼šO(1) | ç©ºé—´å¤æ‚åº¦ï¼šO(capacity)

/**
 * ğŸ“Š æ“ä½œå›¾è§£ï¼š
 *
 * ã€get æ“ä½œã€‘
 *
 *   1. åœ¨ HashMap ä¸­æ‰¾åˆ°èŠ‚ç‚¹
 *   2. å°†èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨ï¼ˆæ ‡è®°ä¸ºæœ€è¿‘ä½¿ç”¨ï¼‰
 *   3. è¿”å›å€¼
 *
 * ã€put æ“ä½œ - æ›´æ–°å·²æœ‰ keyã€‘
 *
 *   1. åœ¨ HashMap ä¸­æ‰¾åˆ°èŠ‚ç‚¹
 *   2. æ›´æ–°å€¼
 *   3. å°†èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨
 *
 * ã€put æ“ä½œ - æ’å…¥æ–° keyã€‘
 *
 *   1. åˆ›å»ºæ–°èŠ‚ç‚¹
 *   2. åŠ å…¥ HashMap
 *   3. åŠ å…¥é“¾è¡¨å¤´éƒ¨
 *   4. å¦‚æœè¶…å‡ºå®¹é‡ï¼š
 *      - ç§»é™¤é“¾è¡¨å°¾éƒ¨èŠ‚ç‚¹
 *      - ä» HashMap ä¸­åˆ é™¤
 *
 * ğŸ”„ æµç¨‹å›¾ (Mermaid):
 * ```mermaid
 * flowchart TD
 *     subgraph GET
 *         G1[get key] --> G2{key å­˜åœ¨?}
 *         G2 -->|Yes| G3[ç§»åŠ¨åˆ°å¤´éƒ¨]
 *         G3 --> G4[è¿”å› value]
 *         G2 -->|No| G5[è¿”å› -1]
 *     end
 *
 *     subgraph PUT
 *         P1[put key,value] --> P2{key å­˜åœ¨?}
 *         P2 -->|Yes| P3[æ›´æ–° value, ç§»åŠ¨åˆ°å¤´éƒ¨]
 *         P2 -->|No| P4[åˆ›å»ºæ–°èŠ‚ç‚¹, åŠ åˆ°å¤´éƒ¨]
 *         P4 --> P5{è¶…å‡ºå®¹é‡?}
 *         P5 -->|Yes| P6[åˆ é™¤å°¾éƒ¨èŠ‚ç‚¹]
 *         P5 -->|No| P7[å®Œæˆ]
 *         P6 --> P7
 *     end
 * ```
 */
class LRUCache {
  private capacity: number;
  private cache: Map<number, DLinkedNode>;
  private head: DLinkedNode; // è™šæ‹Ÿå¤´èŠ‚ç‚¹
  private tail: DLinkedNode; // è™šæ‹Ÿå°¾èŠ‚ç‚¹

  constructor(capacity: number) {
    this.capacity = capacity;
    this.cache = new Map();

    // åˆ›å»ºè™šæ‹Ÿå¤´å°¾èŠ‚ç‚¹
    this.head = new DLinkedNode();
    this.tail = new DLinkedNode();
    this.head.next = this.tail;
    this.tail.prev = this.head;
  }

  get(key: number): number {
    const node = this.cache.get(key);
    if (!node) {
      return -1;
    }

    // ç§»åˆ°å¤´éƒ¨ï¼ˆæ ‡è®°ä¸ºæœ€è¿‘ä½¿ç”¨ï¼‰
    this.moveToHead(node);
    return node.value;
  }

  put(key: number, value: number): void {
    const node = this.cache.get(key);

    if (node) {
      // key å·²å­˜åœ¨ï¼Œæ›´æ–°å€¼å¹¶ç§»åˆ°å¤´éƒ¨
      node.value = value;
      this.moveToHead(node);
    } else {
      // key ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°èŠ‚ç‚¹
      const newNode = new DLinkedNode(key, value);
      this.cache.set(key, newNode);
      this.addToHead(newNode);

      // æ£€æŸ¥å®¹é‡
      if (this.cache.size > this.capacity) {
        // ç§»é™¤æœ€ä¹…æœªä½¿ç”¨çš„ï¼ˆå°¾éƒ¨èŠ‚ç‚¹ï¼‰
        const removed = this.removeTail();
        this.cache.delete(removed.key);
      }
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ç§æœ‰æ–¹æ³•ï¼šåŒå‘é“¾è¡¨æ“ä½œ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  // å°†èŠ‚ç‚¹æ·»åŠ åˆ°å¤´éƒ¨
  private addToHead(node: DLinkedNode): void {
    node.prev = this.head;
    node.next = this.head.next;
    this.head.next!.prev = node;
    this.head.next = node;
  }

  // ç§»é™¤èŠ‚ç‚¹
  private removeNode(node: DLinkedNode): void {
    node.prev!.next = node.next;
    node.next!.prev = node.prev;
  }

  // å°†èŠ‚ç‚¹ç§»åˆ°å¤´éƒ¨
  private moveToHead(node: DLinkedNode): void {
    this.removeNode(node);
    this.addToHead(node);
  }

  // ç§»é™¤å°¾éƒ¨èŠ‚ç‚¹å¹¶è¿”å›
  private removeTail(): DLinkedNode {
    const node = this.tail.prev!;
    this.removeNode(node);
    return node;
  }
}

// ============================================================
// ä½¿ç”¨ JavaScript Map çš„ç®€åŒ–ç‰ˆæœ¬
// ============================================================
// ğŸ“ åˆ©ç”¨ Map çš„æ’å…¥é¡ºåºç‰¹æ€§

/**
 * JavaScript çš„ Map ä¿æŒæ’å…¥é¡ºåº
 * - æœ€æ—©æ’å…¥çš„ key å¯ä»¥é€šè¿‡ map.keys().next().value è·å–
 * - åˆ é™¤å¹¶é‡æ–°æ’å…¥å¯ä»¥å°† key ç§»åˆ°æœ«å°¾
 *
 * ä½†è¿™ä¸ªæ–¹æ³•åœ¨å¤§é‡æ“ä½œæ—¶æ€§èƒ½ä¸å¦‚åŒå‘é“¾è¡¨ç‰ˆæœ¬
 */
class LRUCacheSimple {
  private capacity: number;
  private cache: Map<number, number>;

  constructor(capacity: number) {
    this.capacity = capacity;
    this.cache = new Map();
  }

  get(key: number): number {
    if (!this.cache.has(key)) {
      return -1;
    }

    // ç§»åˆ°æœ«å°¾ï¼ˆåˆ é™¤å¹¶é‡æ–°æ’å…¥ï¼‰
    const value = this.cache.get(key)!;
    this.cache.delete(key);
    this.cache.set(key, value);

    return value;
  }

  put(key: number, value: number): void {
    // å¦‚æœå·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤
    if (this.cache.has(key)) {
      this.cache.delete(key);
    }

    // æ’å…¥
    this.cache.set(key, value);

    // æ£€æŸ¥å®¹é‡
    if (this.cache.size > this.capacity) {
      // åˆ é™¤æœ€æ—©æ’å…¥çš„ï¼ˆç¬¬ä¸€ä¸ªï¼‰
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
  }
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•         | get   | put   | ç‰¹ç‚¹                    |
 * |-------------|-------|-------|------------------------|
 * | åŒå‘é“¾è¡¨+Map | O(1)  | O(1)  | æ¨èï¼Œæ ‡å‡†å®ç°           |
 * | Map ç‰¹æ€§    | O(1)* | O(1)* | ç®€æ´ä½†ä¾èµ– Map å®ç°      |
 *
 * * Map.delete + Map.set çš„ç»„åˆåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¸æ˜¯ O(1)
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. è™šæ‹Ÿå¤´å°¾èŠ‚ç‚¹ï¼š
 *    - ç®€åŒ–è¾¹ç•Œå¤„ç†
 *    - é¿å…å¤„ç†ç©ºé“¾è¡¨
 *
 * 2. åˆ é™¤æ—¶è¦æ›´æ–° HashMapï¼š
 *    - ä¸ä»…è¦ä»é“¾è¡¨åˆ é™¤
 *    - è¿˜è¦ä» HashMap ä¸­åˆ é™¤
 *
 * 3. èŠ‚ç‚¹ä¸­å­˜å‚¨ keyï¼š
 *    - åˆ é™¤å°¾éƒ¨èŠ‚ç‚¹æ—¶éœ€è¦ key æ¥æ›´æ–° HashMap
 *
 * 4. get ä¹Ÿè¦æ›´æ–°é¡ºåºï¼š
 *    - get ä¹Ÿç®—"ä½¿ç”¨"ï¼Œè¦ç§»åˆ°å¤´éƒ¨
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - LFU ç¼“å­˜ï¼ˆæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼‰â†’ éœ€è¦é¢å¤–çš„é¢‘ç‡ä¿¡æ¯
 * - è®¾è®¡ Twitter â†’ ç±»ä¼¼çš„æ•°æ®ç»“æ„è®¾è®¡
 * - å®ç° Trie â†’ è®¾è®¡ç±»é¢˜ç›®
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. å›¾ç‰‡ç¼“å­˜ï¼šç¼“å­˜æœ€è¿‘è®¿é—®çš„å›¾ç‰‡
 * 2. API è¯·æ±‚ç¼“å­˜ï¼šç¼“å­˜æœ€è¿‘çš„ API å“åº”
 * 3. è·¯ç”±ç¼“å­˜ï¼šKeep-Alive ç»„ä»¶ç¼“å­˜
 * 4. çŠ¶æ€ç®¡ç†ï¼šç¼“å­˜è®¡ç®—ç»“æœï¼ˆç±»ä¼¼ React memoï¼‰
 * 5. Service Workerï¼šç¼“å­˜ç­–ç•¥å®ç°
 */

// ============================================================
// æ‰©å±•ï¼šReact ä¸­çš„ LRU åº”ç”¨
// ============================================================
/**
 * // React Keep-Alive åœºæ™¯çš„ç®€åŒ–å®ç°
 * const componentCache = new LRUCache(10);
 *
 * function cacheComponent(key, component) {
 *   componentCache.put(key, component);
 * }
 *
 * function getCachedComponent(key) {
 *   return componentCache.get(key);
 * }
 */

export { DLinkedNode, LRUCache, LRUCacheSimple };
export default LRUCache;

