/**
 * ğŸ“ é¢˜ç›®ï¼šç›¸äº¤é“¾è¡¨
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/intersection-of-two-linked-lists/
 * ğŸ·ï¸ éš¾åº¦ï¼šEasy
 * ğŸ·ï¸ æ ‡ç­¾ï¼šå“ˆå¸Œè¡¨ã€é“¾è¡¨ã€åŒæŒ‡é’ˆ
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸¤ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ headA å’Œ headBï¼Œ
 * è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚
 * å¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸å­˜åœ¨ç›¸äº¤èŠ‚ç‚¹ï¼Œè¿”å› nullã€‚
 *
 * æ³¨æ„ï¼šé“¾è¡¨åœ¨è¿”å›ç»“æœåå¿…é¡»ä¿æŒå…¶åŸå§‹ç»“æ„ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šlistA = [4,1,8,4,5], listB = [5,6,1,8,4,5]
 * è¾“å‡ºï¼šIntersected at '8'
 *
 * è¾“å…¥ï¼šlistA = [1,9,1,2,4], listB = [3,2,4]
 * è¾“å‡ºï¼šIntersected at '2'
 */

// é“¾è¡¨èŠ‚ç‚¹å®šä¹‰
class ListNode {
  val: number;
  next: ListNode | null;
  constructor(val?: number, next?: ListNode | null) {
    this.val = val === undefined ? 0 : val;
    this.next = next === undefined ? null : next;
  }
}

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æ
// ============================================================
//
// å…³é”®ï¼šä¸¤ä¸ªé“¾è¡¨é•¿åº¦å¯èƒ½ä¸åŒ
//
// æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨
// - éå†é“¾è¡¨ Aï¼ŒæŠŠèŠ‚ç‚¹å­˜å…¥ Set
// - éå†é“¾è¡¨ Bï¼Œç¬¬ä¸€ä¸ªåœ¨ Set ä¸­çš„èŠ‚ç‚¹å°±æ˜¯äº¤ç‚¹
//
// æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆï¼ˆæµªæ¼«ç›¸é‡ï¼‰
// - æŒ‡é’ˆ A èµ°å®Œé“¾è¡¨ A åèµ°é“¾è¡¨ B
// - æŒ‡é’ˆ B èµ°å®Œé“¾è¡¨ B åèµ°é“¾è¡¨ A
// - å¦‚æœç›¸äº¤ï¼Œå®ƒä»¬ä¼šåœ¨äº¤ç‚¹ç›¸é‡
// - å¦‚æœä¸ç›¸äº¤ï¼Œå®ƒä»¬ä¼šåŒæ—¶åˆ°è¾¾ null

// ============================================================
// è§£æ³•ä¸€ï¼šåŒæŒ‡é’ˆï¼ˆæ¨èï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(m + n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)

/**
 * ğŸ“Š åŒæŒ‡é’ˆæ€è·¯å›¾è§£ï¼š
 *
 * é“¾è¡¨ A:  4 -> 1 â”€â”
 *                  â”œ-> 8 -> 4 -> 5 -> null
 * é“¾è¡¨ B:  5 -> 6 -> 1 â”€â”˜
 *
 * è®¾ï¼š
 * - a = é“¾è¡¨ A ç‹¬æœ‰éƒ¨åˆ†é•¿åº¦ = 2
 * - b = é“¾è¡¨ B ç‹¬æœ‰éƒ¨åˆ†é•¿åº¦ = 3
 * - c = å…¬å…±éƒ¨åˆ†é•¿åº¦ = 3
 *
 * æŒ‡é’ˆ A çš„è·¯å¾„ï¼ša + c + b = 2 + 3 + 3 = 8
 * æŒ‡é’ˆ B çš„è·¯å¾„ï¼šb + c + a = 3 + 3 + 2 = 8
 *
 * ä¸¤ä¸ªæŒ‡é’ˆèµ°çš„è·ç¦»ç›¸åŒï¼Œæ‰€ä»¥ä¼šåœ¨äº¤ç‚¹ç›¸é‡ï¼
 *
 *          4 -> 1 -> 8 -> 4 -> 5 -> 5 -> 6 -> 1 -> 8
 *                                              â†‘
 *                                          ç›¸é‡ç‚¹
 *
 *          5 -> 6 -> 1 -> 8 -> 4 -> 5 -> 4 -> 1 -> 8
 *                                              â†‘
 *                                          ç›¸é‡ç‚¹
 */
function getIntersectionNode_v1(
  headA: ListNode | null,
  headB: ListNode | null
): ListNode | null {
  if (!headA || !headB) return null;

  let pA: ListNode | null = headA;
  let pB: ListNode | null = headB;

  // ä¸¤ä¸ªæŒ‡é’ˆä¼šåŒæ—¶åˆ°è¾¾äº¤ç‚¹æˆ–åŒæ—¶åˆ°è¾¾ null
  while (pA !== pB) {
    // A èµ°å®Œèµ° Bï¼ŒB èµ°å®Œèµ° A
    pA = pA === null ? headB : pA.next;
    pB = pB === null ? headA : pB.next;
  }

  return pA; // äº¤ç‚¹æˆ– null
}

// ============================================================
// è§£æ³•äºŒï¼šå“ˆå¸Œè¡¨
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(m + n) | ç©ºé—´å¤æ‚åº¦ï¼šO(m)

function getIntersectionNode_v2(
  headA: ListNode | null,
  headB: ListNode | null
): ListNode | null {
  if (!headA || !headB) return null;

  const visited = new Set<ListNode>();

  // éå†é“¾è¡¨ Aï¼Œå­˜å…¥æ‰€æœ‰èŠ‚ç‚¹
  let curr: ListNode | null = headA;
  while (curr) {
    visited.add(curr);
    curr = curr.next;
  }

  // éå†é“¾è¡¨ Bï¼Œæ‰¾ç¬¬ä¸€ä¸ªåœ¨ Set ä¸­çš„èŠ‚ç‚¹
  curr = headB;
  while (curr) {
    if (visited.has(curr)) {
      return curr;
    }
    curr = curr.next;
  }

  return null;
}

// ============================================================
// è§£æ³•ä¸‰ï¼šå…ˆè®¡ç®—é•¿åº¦å·®
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(m + n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)
// ğŸ“ è®©é•¿é“¾è¡¨å…ˆèµ°å·®å€¼æ­¥ï¼Œç„¶åä¸€èµ·èµ°

function getIntersectionNode_v3(
  headA: ListNode | null,
  headB: ListNode | null
): ListNode | null {
  if (!headA || !headB) return null;

  // è®¡ç®—é“¾è¡¨é•¿åº¦
  const getLength = (head: ListNode | null): number => {
    let length = 0;
    while (head) {
      length++;
      head = head.next;
    }
    return length;
  };

  const lenA = getLength(headA);
  const lenB = getLength(headB);

  // è®©é•¿é“¾è¡¨å…ˆèµ°å·®å€¼æ­¥
  let pA: ListNode | null = headA;
  let pB: ListNode | null = headB;

  if (lenA > lenB) {
    for (let i = 0; i < lenA - lenB; i++) {
      pA = pA!.next;
    }
  } else {
    for (let i = 0; i < lenB - lenA; i++) {
      pB = pB!.next;
    }
  }

  // ä¸€èµ·èµ°ï¼Œæ‰¾äº¤ç‚¹
  while (pA !== pB) {
    pA = pA!.next;
    pB = pB!.next;
  }

  return pA;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•       | æ—¶é—´     | ç©ºé—´  | ç‰¹ç‚¹                     |
 * |-----------|---------|-------|-------------------------|
 * | åŒæŒ‡é’ˆ    | O(m+n)  | O(1)  | æ¨èï¼Œä»£ç ä¼˜é›…            |
 * | å“ˆå¸Œè¡¨    | O(m+n)  | O(m)  | ç®€å•ç›´è§‚                 |
 * | é•¿åº¦å·®    | O(m+n)  | O(1)  | éœ€è¦ä¸¤æ¬¡éå†              |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. æ¯”è¾ƒçš„æ˜¯èŠ‚ç‚¹å¼•ç”¨ï¼Œä¸æ˜¯å€¼ï¼š
 *    - ä¸¤ä¸ªå€¼ç›¸åŒçš„èŠ‚ç‚¹ä¸ä¸€å®šæ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹
 *    - pA === pB æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€
 *
 * 2. ç©ºé“¾è¡¨å¤„ç†ï¼š
 *    - å…ˆæ£€æŸ¥ headA å’Œ headB æ˜¯å¦ä¸º null
 *
 * 3. åŒæŒ‡é’ˆçš„å¾ªç¯æ¡ä»¶ï¼š
 *    - while (pA !== pB) åŒ…æ‹¬éƒ½ä¸º null çš„æƒ…å†µ
 *    - æ‰€ä»¥ä¸éœ€è¦é¢å¤–åˆ¤æ–­æ˜¯å¦ç›¸äº¤
 *
 * 4. ä¿æŒåŸå§‹ç»“æ„ï¼š
 *    - ä¸èƒ½ä¿®æ”¹é“¾è¡¨ç»“æ„
 */

// ============================================================
// ğŸ“Š ä¸ºä»€ä¹ˆåŒæŒ‡é’ˆä¸€å®šä¼šç›¸é‡ï¼Ÿ
// ============================================================
/**
 * æ•°å­¦è¯æ˜ï¼š
 *
 * è®¾é“¾è¡¨ A é•¿åº¦ä¸º aï¼Œé“¾è¡¨ B é•¿åº¦ä¸º bï¼Œå…¬å…±éƒ¨åˆ†é•¿åº¦ä¸º c
 *
 * å¦‚æœç›¸äº¤ï¼š
 * - æŒ‡é’ˆ A èµ°ï¼š(a - c) + c + (b - c) = a + b - c
 * - æŒ‡é’ˆ B èµ°ï¼š(b - c) + c + (a - c) = a + b - c
 * - ä¸¤è€…ç›¸ç­‰ï¼Œåœ¨èµ°å®Œéå…¬å…±éƒ¨åˆ†åç›¸é‡äºäº¤ç‚¹
 *
 * å¦‚æœä¸ç›¸äº¤ï¼ˆc = 0ï¼‰ï¼š
 * - æŒ‡é’ˆ A èµ°ï¼ša + b
 * - æŒ‡é’ˆ B èµ°ï¼šb + a
 * - ä¸¤è€…ç›¸ç­‰ï¼ŒåŒæ—¶åˆ°è¾¾ null
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - ç¯å½¢é“¾è¡¨ II â†’ æ‰¾ç¯å…¥å£ï¼ˆç±»ä¼¼çš„åŒæŒ‡é’ˆè¿½åŠé—®é¢˜ï¼‰
 * - é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ â†’ å¿«æ…¢æŒ‡é’ˆ
 * - åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ â†’ åŒæŒ‡é’ˆ
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. ä¾èµ–åˆ†æï¼šæ‰¾ä¸¤ä¸ªæ¨¡å—çš„å…¬å…±ä¾èµ–
 * 2. DOM æ ‘ï¼šæ‰¾ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ
 * 3. ç‰ˆæœ¬æ§åˆ¶ï¼šæ‰¾ä¸¤ä¸ªåˆ†æ”¯çš„åˆ†å‰ç‚¹
 * 4. æ•°æ®åˆå¹¶ï¼šæ‰¾ä¸¤ä¸ªæ•°æ®æµçš„äº¤æ±‡ç‚¹
 */

export {
  ListNode,
  getIntersectionNode_v1,
  getIntersectionNode_v2,
  getIntersectionNode_v3,
};
export default getIntersectionNode_v1;

