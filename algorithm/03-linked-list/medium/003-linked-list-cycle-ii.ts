/**
 * ğŸ“ é¢˜ç›®ï¼šç¯å½¢é“¾è¡¨ II
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/linked-list-cycle-ii/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šå“ˆå¸Œè¡¨ã€é“¾è¡¨ã€åŒæŒ‡é’ˆ
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™å®šä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ headï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚
 * å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› nullã€‚
 *
 * è¿›é˜¶ï¼šä½ æ˜¯å¦å¯ä»¥ä½¿ç”¨ O(1) ç©ºé—´è§£å†³æ­¤é¢˜ï¼Ÿ
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1
 * è¾“å‡ºï¼šè¿”å›ç´¢å¼•ä¸º 1 çš„é“¾è¡¨èŠ‚ç‚¹
 *
 *   3 -> 2 -> 0 -> -4
 *        â†‘         â†“
 *        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *        ç¯çš„å…¥å£æ˜¯ 2
 */

class ListNode {
  val: number;
  next: ListNode | null;
  constructor(val?: number, next?: ListNode | null) {
    this.val = val === undefined ? 0 : val;
    this.next = next === undefined ? null : next;
  }
}

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// æ¯”"æ£€æµ‹ç¯"æ›´éš¾ä¸€æ­¥ï¼šæ‰¾åˆ°ç¯çš„å…¥å£
//
// 1. å“ˆå¸Œè¡¨æ³•ï¼š
//    - éå†é“¾è¡¨ï¼Œè®°å½•è®¿é—®è¿‡çš„èŠ‚ç‚¹
//    - ç¬¬ä¸€ä¸ªé‡å¤è®¿é—®çš„å°±æ˜¯å…¥å£
//    - æ—¶é—´ O(n)ï¼Œç©ºé—´ O(n)
//
// 2. å¿«æ…¢æŒ‡é’ˆ + æ•°å­¦æ¨å¯¼ï¼ˆæ¨èï¼‰ï¼š
//    - ç¬¬ä¸€é˜¶æ®µï¼šå¿«æ…¢æŒ‡é’ˆæ‰¾ç›¸é‡ç‚¹
//    - ç¬¬äºŒé˜¶æ®µï¼šä» head å’Œç›¸é‡ç‚¹åŒæ—¶å‡ºå‘ï¼Œç›¸é‡å¤„å³ä¸ºå…¥å£
//    - æ—¶é—´ O(n)ï¼Œç©ºé—´ O(1)
//
// ğŸ“Š æ•°å­¦è¯æ˜ï¼š
//
//    è®¾ï¼š
//    - a = ä» head åˆ°ç¯å…¥å£çš„è·ç¦»
//    - b = ä»ç¯å…¥å£åˆ°ç›¸é‡ç‚¹çš„è·ç¦»
//    - c = ç¯çš„é•¿åº¦
//
//    ç›¸é‡æ—¶ï¼š
//    - slow èµ°äº†: a + b
//    - fast èµ°äº†: a + b + n*cï¼ˆfast æ¯” slow å¤šèµ°äº† n åœˆï¼‰
//
//    å› ä¸º fast é€Ÿåº¦æ˜¯ slow çš„ 2 å€ï¼š
//    2(a + b) = a + b + n*c
//    a + b = n*c
//    a = n*c - b = (n-1)*c + (c-b)
//
//    è¿™æ„å‘³ç€ï¼š
//    ä» head èµ° a æ­¥ = ä»ç›¸é‡ç‚¹èµ° (n-1)*c + (c-b) æ­¥
//    éƒ½ä¼šåˆ°è¾¾ç¯å…¥å£ï¼

// ============================================================
// è§£æ³•ä¸€ï¼šå¿«æ…¢æŒ‡é’ˆï¼ˆæ¨èï¼ŒO(1) ç©ºé—´ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 *        a       b
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
 *   â”‚        â”‚     â”‚
 *   3 -> 2 -> 0 -> -4
 *        â†‘         â†“
 *        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *             c-b
 *
 * ç¬¬ä¸€é˜¶æ®µï¼šæ‰¾ç›¸é‡ç‚¹
 *
 *   slow: 3 -> 2 -> 0 -> -4 -> 2
 *   fast: 3 -> 0 -> 2 -> -4 -> 0 -> 2
 *
 *   ç›¸é‡åœ¨èŠ‚ç‚¹ 2ï¼Ÿä¸å¯¹ï¼Œè®©æˆ‘é‡æ–°ç”»ï¼š
 *
 *   å‡è®¾ç¯å…¥å£æ˜¯ 2ï¼Œä» 2 å¼€å§‹ï¼š2 -> 0 -> -4 -> 2ï¼ˆç¯é•¿åº¦ 3ï¼‰
 *
 *   slow: 3(0) -> 2(1) -> 0(2) -> -4(3) -> 2(4)
 *   fast: 3(0) -> 0(2) -> 2(4)
 *
 *   åœ¨ 2 ç›¸é‡ï¼(æ­¥æ•° 4)
 *
 * ç¬¬äºŒé˜¶æ®µï¼šæ‰¾å…¥å£
 *
 *   ptr1 ä» head å‡ºå‘: 3 -> 2
 *   ptr2 ä»ç›¸é‡ç‚¹å‡ºå‘: 2 -> 0 -> -4 -> 2
 *
 *   å®é™…ä¸Šè¿™ä¸ªä¾‹å­ a=1, b=0ï¼Œç›´æ¥ç›¸é‡åœ¨å…¥å£
 *
 * ğŸ”„ æµç¨‹å›¾ (Mermaid):
 * ```mermaid
 * flowchart TD
 *     A[slow=head, fast=head] --> B{fast && fast.next?}
 *     B -->|Yes| C[slow++, fast+2]
 *     C --> D{slow == fast?}
 *     D -->|Yes| E[è¿›å…¥ç¬¬äºŒé˜¶æ®µ]
 *     D -->|No| B
 *     B -->|No| F[æ— ç¯ï¼Œè¿”å› null]
 *     E --> G[ptr=head]
 *     G --> H{ptr != slow?}
 *     H -->|Yes| I[ptr++, slow++]
 *     I --> H
 *     H -->|No| J[è¿”å› ptr ç¯å…¥å£]
 * ```
 */
function detectCycle_v1(head: ListNode | null): ListNode | null {
  if (!head || !head.next) return null;

  let slow: ListNode | null = head;
  let fast: ListNode | null = head;

  // ç¬¬ä¸€é˜¶æ®µï¼šæ‰¾ç›¸é‡ç‚¹
  while (fast && fast.next) {
    slow = slow!.next;
    fast = fast.next.next;

    if (slow === fast) {
      // ç¬¬äºŒé˜¶æ®µï¼šæ‰¾å…¥å£
      let ptr = head;
      while (ptr !== slow) {
        ptr = ptr!.next;
        slow = slow!.next;
      }
      return ptr;
    }
  }

  return null; // æ— ç¯
}

// ============================================================
// è§£æ³•äºŒï¼šå“ˆå¸Œè¡¨
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)
function detectCycle_v2(head: ListNode | null): ListNode | null {
  const visited = new Set<ListNode>();

  let curr = head;
  while (curr) {
    if (visited.has(curr)) {
      return curr; // ç¬¬ä¸€ä¸ªé‡å¤è®¿é—®çš„å°±æ˜¯å…¥å£
    }
    visited.add(curr);
    curr = curr.next;
  }

  return null;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•       | æ—¶é—´  | ç©ºé—´  | ç‰¹ç‚¹                     |
 * |-----------|-------|-------|-------------------------|
 * | å¿«æ…¢æŒ‡é’ˆ   | O(n)  | O(1)  | æ¨èï¼Œæ»¡è¶³è¿›é˜¶è¦æ±‚        |
 * | å“ˆå¸Œè¡¨    | O(n)  | O(n)  | ç®€å•ç›´è§‚                 |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µçš„åŒºåˆ†ï¼š
 *    - ç¬¬ä¸€é˜¶æ®µï¼šå¿«æ…¢æŒ‡é’ˆæ‰¾ç›¸é‡ç‚¹
 *    - ç¬¬äºŒé˜¶æ®µï¼šhead å’Œç›¸é‡ç‚¹åŒé€Ÿå‰è¿›
 *
 * 2. ç¬¬äºŒé˜¶æ®µçš„å¾ªç¯æ¡ä»¶ï¼š
 *    - while (ptr !== slow)
 *    - å¯èƒ½ç¬¬ä¸€æ­¥å°±ç›¸é‡ï¼ˆa=0 çš„æƒ…å†µï¼‰
 *
 * 3. æ•°å­¦æ¨å¯¼çš„ç†è§£ï¼š
 *    - å…³é”®ç­‰å¼ï¼ša = (n-1)*c + (c-b)
 *    - ç›´è§‚ç†è§£ï¼šhead åˆ°å…¥å£çš„è·ç¦» = ç›¸é‡ç‚¹åˆ°å…¥å£çš„è·ç¦»ï¼ˆå¯èƒ½ç»•å‡ åœˆï¼‰
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - ç¯å½¢é“¾è¡¨ï¼ˆåªåˆ¤æ–­æœ‰æ— ç¯ï¼‰â†’ å¿«æ…¢æŒ‡é’ˆ
 * - å¯»æ‰¾é‡å¤æ•° â†’ æŠŠæ•°ç»„å½“æˆé“¾è¡¨ï¼Œç”¨å¿«æ…¢æŒ‡é’ˆ
 * - å¿«ä¹æ•° â†’ å¿«æ…¢æŒ‡é’ˆæ£€æµ‹å¾ªç¯
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. å¾ªç¯ä¾èµ–æ£€æµ‹ï¼šæ‰¾åˆ°å¾ªç¯ä¾èµ–çš„èµ·ç‚¹
 * 2. çŠ¶æ€æœºè°ƒè¯•ï¼šæ‰¾åˆ°æ­»å¾ªç¯çš„å…¥å£çŠ¶æ€
 * 3. å†…å­˜æ³„æ¼æ£€æµ‹ï¼šæ‰¾åˆ°å¾ªç¯å¼•ç”¨çš„èµ·ç‚¹
 */

export { ListNode, detectCycle_v1, detectCycle_v2 };
export default detectCycle_v1;

