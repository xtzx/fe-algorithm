/**
 * ğŸ“ é¢˜ç›®ï¼šå¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/copy-list-with-random-pointer/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šå“ˆå¸Œè¡¨ã€é“¾è¡¨
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆ randomï¼Œ
 * è¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚
 *
 * æ„é€ è¿™ä¸ªé“¾è¡¨çš„ æ·±æ‹·è´ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šhead = [[7,null],[13,0],[11,4],[10,2],[1,0]]
 * è¾“å‡ºï¼š[[7,null],[13,0],[11,4],[10,2],[1,0]]
 */

// å¸¦éšæœºæŒ‡é’ˆçš„èŠ‚ç‚¹å®šä¹‰
class NodeWithRandom {
  val: number;
  next: NodeWithRandom | null;
  random: NodeWithRandom | null;

  constructor(val?: number, next?: NodeWithRandom, random?: NodeWithRandom) {
    this.val = val === undefined ? 0 : val;
    this.next = next === undefined ? null : next;
    this.random = random === undefined ? null : random;
  }
}

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// éš¾ç‚¹ï¼šrandom æŒ‡é’ˆå¯èƒ½æŒ‡å‘ä»»æ„èŠ‚ç‚¹
//       å¤åˆ¶æ—¶æ–°èŠ‚ç‚¹çš„ random åº”è¯¥æŒ‡å‘å¯¹åº”çš„æ–°èŠ‚ç‚¹
//
// 1. å“ˆå¸Œè¡¨æ³•ï¼š
//    - ç”¨ Map å»ºç«‹ åŸèŠ‚ç‚¹ -> æ–°èŠ‚ç‚¹ çš„æ˜ å°„
//    - ç¬¬ä¸€éï¼šåˆ›å»ºæ‰€æœ‰æ–°èŠ‚ç‚¹ï¼Œå»ºç«‹æ˜ å°„
//    - ç¬¬äºŒéï¼šè®¾ç½® next å’Œ random æŒ‡é’ˆ
//
// 2. åŸåœ°å¤åˆ¶æ³•ï¼ˆO(1) ç©ºé—´ï¼‰ï¼š
//    - åœ¨åŸèŠ‚ç‚¹åé¢æ’å…¥æ–°èŠ‚ç‚¹ï¼šA -> A' -> B -> B' -> ...
//    - è®¾ç½® randomï¼šA'.random = A.random.next
//    - åˆ†ç¦»å‡ºæ–°é“¾è¡¨

// ============================================================
// è§£æ³•ä¸€ï¼šå“ˆå¸Œè¡¨ï¼ˆæ¨èï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * åŸé“¾è¡¨:
 *   7 -> 13 -> 11 -> 10 -> 1
 *   â†“     â†“     â†“     â†“    â†“
 *  null   7    1     11    7
 *
 * Step 1: åˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œå»ºç«‹æ˜ å°„
 *
 *   map = {
 *     åŸ7 -> æ–°7,
 *     åŸ13 -> æ–°13,
 *     åŸ11 -> æ–°11,
 *     åŸ10 -> æ–°10,
 *     åŸ1 -> æ–°1
 *   }
 *
 * Step 2: è®¾ç½® next å’Œ random
 *
 *   æ–°7.next = map.get(åŸ7.next) = æ–°13
 *   æ–°7.random = map.get(åŸ7.random) = null
 *   ...
 */
function copyRandomList_v1(
  head: NodeWithRandom | null
): NodeWithRandom | null {
  if (!head) return null;

  // å»ºç«‹ åŸèŠ‚ç‚¹ -> æ–°èŠ‚ç‚¹ çš„æ˜ å°„
  const map = new Map<NodeWithRandom, NodeWithRandom>();

  // ç¬¬ä¸€éï¼šåˆ›å»ºæ‰€æœ‰æ–°èŠ‚ç‚¹
  let curr: NodeWithRandom | null = head;
  while (curr) {
    map.set(curr, new NodeWithRandom(curr.val));
    curr = curr.next;
  }

  // ç¬¬äºŒéï¼šè®¾ç½® next å’Œ random
  curr = head;
  while (curr) {
    const newNode = map.get(curr)!;
    newNode.next = curr.next ? map.get(curr.next)! : null;
    newNode.random = curr.random ? map.get(curr.random)! : null;
    curr = curr.next;
  }

  return map.get(head)!;
}

// ============================================================
// è§£æ³•äºŒï¼šåŸåœ°å¤åˆ¶ï¼ˆO(1) ç©ºé—´ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)

/**
 * ğŸ“Š åŸåœ°å¤åˆ¶å›¾è§£ï¼š
 *
 * Step 1: åœ¨æ¯ä¸ªèŠ‚ç‚¹åæ’å…¥å¤åˆ¶èŠ‚ç‚¹
 *
 *   åŸ: A -> B -> C
 *   å: A -> A' -> B -> B' -> C -> C'
 *
 * Step 2: è®¾ç½® random æŒ‡é’ˆ
 *
 *   A'.random = A.random.next (å³ A.random çš„å¤åˆ¶èŠ‚ç‚¹)
 *
 * Step 3: åˆ†ç¦»å‡ºæ–°é“¾è¡¨
 *
 *   åŸ: A -> B -> C
 *   æ–°: A' -> B' -> C'
 */
function copyRandomList_v2(
  head: NodeWithRandom | null
): NodeWithRandom | null {
  if (!head) return null;

  // Step 1: åœ¨æ¯ä¸ªèŠ‚ç‚¹åæ’å…¥å¤åˆ¶èŠ‚ç‚¹
  let curr: NodeWithRandom | null = head;
  while (curr) {
    const newNode = new NodeWithRandom(curr.val);
    newNode.next = curr.next;
    curr.next = newNode;
    curr = newNode.next;
  }

  // Step 2: è®¾ç½® random æŒ‡é’ˆ
  curr = head;
  while (curr) {
    if (curr.random) {
      curr.next!.random = curr.random.next;
    }
    curr = curr.next!.next;
  }

  // Step 3: åˆ†ç¦»æ–°é“¾è¡¨
  const newHead = head.next;
  curr = head;
  while (curr) {
    const newNode = curr.next!;
    curr.next = newNode.next;
    newNode.next = newNode.next ? newNode.next.next : null;
    curr = curr.next;
  }

  return newHead;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•       | æ—¶é—´  | ç©ºé—´  | ç‰¹ç‚¹                     |
 * |-----------|-------|-------|-------------------------|
 * | å“ˆå¸Œè¡¨    | O(n)  | O(n)  | æ¨èï¼Œä»£ç æ¸…æ™°            |
 * | åŸåœ°å¤åˆ¶   | O(n)  | O(1)  | ç©ºé—´æœ€ä¼˜ï¼Œä½†ä»£ç å¤æ‚       |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. random å¯èƒ½ä¸º nullï¼š
 *    - è®¾ç½® random æ—¶è¦åˆ¤æ–­
 *
 * 2. å“ˆå¸Œè¡¨æ³•ä¸­çš„ä¸¤ééå†ï¼š
 *    - ç¬¬ä¸€éåªåˆ›å»ºèŠ‚ç‚¹ï¼Œä¸è®¾ç½®æŒ‡é’ˆ
 *    - ç¬¬äºŒéè®¾ç½®æ‰€æœ‰æŒ‡é’ˆ
 *
 * 3. åŸåœ°å¤åˆ¶æ³•ä¸­çš„åˆ†ç¦»ï¼š
 *    - è¦æ¢å¤åŸé“¾è¡¨çš„ç»“æ„
 *    - åŒæ—¶æ„å»ºæ–°é“¾è¡¨
 *
 * 4. æ·±æ‹·è´çš„å®šä¹‰ï¼š
 *    - æ–°é“¾è¡¨å’ŒåŸé“¾è¡¨å®Œå…¨ç‹¬ç«‹
 *    - ä¿®æ”¹æ–°é“¾è¡¨ä¸å½±å“åŸé“¾è¡¨
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - å…‹éš†å›¾ â†’ ç±»ä¼¼çš„æ·±æ‹·è´é—®é¢˜
 * - äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ– â†’ å¤æ‚ç»“æ„çš„å¤åˆ¶
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. æ·±æ‹·è´ï¼šå¤æ‚å¯¹è±¡çš„æ·±æ‹·è´
 * 2. çŠ¶æ€ç®¡ç†ï¼šRedux ä¸­çš„ä¸å¯å˜æ›´æ–°
 * 3. å†å²è®°å½•ï¼šä¿å­˜å’Œæ¢å¤å¤æ‚çŠ¶æ€
 * 4. è™šæ‹Ÿ DOMï¼šèŠ‚ç‚¹çš„å…‹éš†
 */

export { NodeWithRandom, copyRandomList_v1, copyRandomList_v2 };
export default copyRandomList_v1;

