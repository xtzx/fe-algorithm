/**
 * ğŸ“ é¢˜ç›®ï¼šäºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/flatten-binary-tree-to-linked-list/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ ˆã€æ ‘ã€æ·±åº¦ä¼˜å…ˆæœç´¢ã€é“¾è¡¨ã€äºŒå‰æ ‘
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ äºŒå‰æ ‘çš„æ ¹ç»“ç‚¹ rootï¼Œè¯·ä½ å°†å®ƒå±•å¼€ä¸ºä¸€ä¸ªå•é“¾è¡¨ï¼š
 * - å±•å¼€åçš„å•é“¾è¡¨åº”è¯¥åŒæ ·ä½¿ç”¨ TreeNodeï¼Œå…¶ä¸­ right å­æŒ‡é’ˆæŒ‡å‘é“¾è¡¨ä¸­ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œ
 *   è€Œå·¦å­æŒ‡é’ˆå§‹ç»ˆä¸º nullã€‚
 * - å±•å¼€åçš„å•é“¾è¡¨åº”è¯¥ä¸äºŒå‰æ ‘ å…ˆåºéå† é¡ºåºç›¸åŒã€‚
 *
 * ç¤ºä¾‹ï¼š
 *       1              1
 *      / \              \
 *     2   5    =>        2
 *    / \   \              \
 *   3   4   6              3
 *                          \
 *                           4
 *                            \
 *                             5
 *                              \
 *                               6
 *
 * è¾“å…¥ï¼šroot = [1,2,5,3,4,null,6]
 * è¾“å‡ºï¼š[1,null,2,null,3,null,4,null,5,null,6]
 */

class TreeNode {
  val: number;
  left: TreeNode | null;
  right: TreeNode | null;
  constructor(val?: number, left?: TreeNode | null, right?: TreeNode | null) {
    this.val = val === undefined ? 0 : val;
    this.left = left === undefined ? null : left;
    this.right = right === undefined ? null : right;
  }
}

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// å±•å¼€é¡ºåºæ˜¯å‰åºéå†ï¼šæ ¹ â†’ å·¦ â†’ å³
//
// æ–¹æ³•ä¸€ï¼šå‰åºéå† + å­˜å‚¨èŠ‚ç‚¹
// æ–¹æ³•äºŒï¼šé€’å½’ï¼Œååºä½ç½®å¤„ç†ï¼ˆæ¨èï¼‰
// æ–¹æ³•ä¸‰ï¼šå¯»æ‰¾å‰é©±èŠ‚ç‚¹

// ============================================================
// è§£æ³•ä¸€ï¼šé€’å½’ï¼ˆååºä½ç½®å¤„ç†ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(h)

/**
 * ğŸ“Š é€’å½’æ€è·¯å›¾è§£ï¼š
 *
 * åˆ†è§£é—®é¢˜ï¼š
 * 1. å…ˆæŠŠå·¦å­æ ‘å±•å¼€æˆé“¾è¡¨
 * 2. å†æŠŠå³å­æ ‘å±•å¼€æˆé“¾è¡¨
 * 3. æŠŠå·¦é“¾è¡¨æ¥åˆ°æ ¹çš„å³è¾¹ï¼Œå†æŠŠå³é“¾è¡¨æ¥åˆ°å·¦é“¾è¡¨åé¢
 *
 *       1
 *      / \
 *     2   5
 *    / \   \
 *   3   4   6
 *
 * Step 1: å±•å¼€å·¦å­æ ‘ â†’ 2 â†’ 3 â†’ 4
 * Step 2: å±•å¼€å³å­æ ‘ â†’ 5 â†’ 6
 * Step 3: 1 â†’ å·¦é“¾è¡¨(2â†’3â†’4) â†’ å³é“¾è¡¨(5â†’6)
 *
 * ç»“æœ: 1 â†’ 2 â†’ 3 â†’ 4 â†’ 5 â†’ 6
 */
function flatten_v1(root: TreeNode | null): void {
  if (!root) return;

  // å…ˆé€’å½’å±•å¼€å·¦å³å­æ ‘
  flatten_v1(root.left);
  flatten_v1(root.right);

  // ååºä½ç½®å¤„ç†

  // ä¿å­˜å·¦å³å­æ ‘
  const left = root.left;
  const right = root.right;

  // å°†å·¦å­æ ‘æ¥åˆ°å³è¾¹
  root.left = null;
  root.right = left;

  // æ‰¾åˆ°å·¦é“¾è¡¨çš„æœ«å°¾ï¼Œæ¥ä¸ŠåŸæ¥çš„å³å­æ ‘
  let curr = root;
  while (curr.right) {
    curr = curr.right;
  }
  curr.right = right;
}

// ============================================================
// è§£æ³•äºŒï¼šå‰åºéå† + æ•°ç»„
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)
function flatten_v2(root: TreeNode | null): void {
  if (!root) return;

  const list: TreeNode[] = [];

  // å‰åºéå†ï¼Œæ”¶é›†æ‰€æœ‰èŠ‚ç‚¹
  function preorder(node: TreeNode | null) {
    if (!node) return;
    list.push(node);
    preorder(node.left);
    preorder(node.right);
  }

  preorder(root);

  // æŒ‰é¡ºåºè¿æ¥
  for (let i = 0; i < list.length - 1; i++) {
    list[i].left = null;
    list[i].right = list[i + 1];
  }
}

// ============================================================
// è§£æ³•ä¸‰ï¼šå¯»æ‰¾å‰é©±èŠ‚ç‚¹ï¼ˆO(1) ç©ºé—´ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)

/**
 * ğŸ“Š å¯»æ‰¾å‰é©±èŠ‚ç‚¹å›¾è§£ï¼š
 *
 * å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæœ‰å·¦å­æ ‘ï¼š
 * - æ‰¾åˆ°å·¦å­æ ‘çš„æœ€å³èŠ‚ç‚¹ï¼ˆå‰åºéå†ä¸­çš„å‰é©±ï¼‰
 * - æŠŠå³å­æ ‘æ¥åˆ°å‰é©±çš„å³è¾¹
 * - æŠŠå·¦å­æ ‘ç§»åˆ°å³è¾¹
 *
 *       1
 *      / \
 *     2   5
 *    / \
 *   3   4
 *
 * å¤„ç† 1ï¼š
 *   å·¦å­æ ‘æœ€å³èŠ‚ç‚¹æ˜¯ 4
 *   æŠŠ 5 æ¥åˆ° 4 çš„å³è¾¹
 *   æŠŠ 2 ç§»åˆ° 1 çš„å³è¾¹
 *
 *   1
 *    \
 *     2
 *    / \
 *   3   4
 *        \
 *         5
 *
 * ç»§ç»­å¤„ç† 2, 3, ...
 */
function flatten_v3(root: TreeNode | null): void {
  let curr = root;

  while (curr) {
    if (curr.left) {
      // æ‰¾å·¦å­æ ‘çš„æœ€å³èŠ‚ç‚¹
      let predecessor = curr.left;
      while (predecessor.right) {
        predecessor = predecessor.right;
      }

      // æŠŠå³å­æ ‘æ¥åˆ°å‰é©±çš„å³è¾¹
      predecessor.right = curr.right;

      // æŠŠå·¦å­æ ‘ç§»åˆ°å³è¾¹
      curr.right = curr.left;
      curr.left = null;
    }

    // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    curr = curr.right;
  }
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•         | æ—¶é—´  | ç©ºé—´  | ç‰¹ç‚¹                     |
 * |-------------|-------|-------|-------------------------|
 * | é€’å½’ååº     | O(n)  | O(h)  | æ€è·¯æ¸…æ™°                 |
 * | å‰åº+æ•°ç»„    | O(n)  | O(n)  | ç®€å•ç›´è§‚                 |
 * | å‰é©±èŠ‚ç‚¹     | O(n)  | O(1)  | ç©ºé—´æœ€ä¼˜                 |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. åŸåœ°ä¿®æ”¹ï¼š
 *    - å‡½æ•°è¿”å› voidï¼Œéœ€è¦åŸåœ°ä¿®æ”¹æ ‘
 *
 * 2. ä¿å­˜å³å­æ ‘ï¼š
 *    - ä¿®æ”¹ root.right å‰è¦å…ˆä¿å­˜
 *
 * 3. å·¦å­æ ‘ç½®ç©ºï¼š
 *    - root.left = null ä¸èƒ½å¿˜
 *
 * 4. æ‰¾é“¾è¡¨æœ«å°¾ï¼š
 *    - è¦éå†åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - æœ‰åºé“¾è¡¨è½¬æ¢äºŒå‰æœç´¢æ ‘ â†’ é€†å‘æ“ä½œ
 * - äºŒå‰æœç´¢æ ‘è½¬æ¢ä¸ºæ’åºçš„åŒå‘é“¾è¡¨ â†’ ä¸­åºéå†
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. æ ‘å½¢èœå•æ‰å¹³åŒ–ï¼šæŠŠåµŒå¥—èœå•è½¬ä¸ºåˆ—è¡¨
 * 2. æ•°æ®å¯¼å‡ºï¼šæŠŠæ ‘å½¢æ•°æ®å±•å¼€ä¸ºè¡¨æ ¼æ•°æ®
 */

export { TreeNode, flatten_v1, flatten_v2, flatten_v3 };
export default flatten_v1;

