/**
 * ğŸ“ é¢˜ç›®ï¼šäºŒå‰æ ‘çš„ç›´å¾„
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/diameter-of-binary-tree/
 * ğŸ·ï¸ éš¾åº¦ï¼šEasy
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ ‘ã€æ·±åº¦ä¼˜å…ˆæœç´¢ã€äºŒå‰æ ‘
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œä½ éœ€è¦è®¡ç®—å®ƒçš„ç›´å¾„é•¿åº¦ã€‚
 * ä¸€æ£µäºŒå‰æ ‘çš„ç›´å¾„é•¿åº¦æ˜¯ä»»æ„ä¸¤ä¸ªç»“ç‚¹è·¯å¾„é•¿åº¦ä¸­çš„æœ€å¤§å€¼ã€‚
 * è¿™æ¡è·¯å¾„å¯èƒ½ç©¿è¿‡ä¹Ÿå¯èƒ½ä¸ç©¿è¿‡æ ¹ç»“ç‚¹ã€‚
 *
 * æ³¨æ„ï¼šä¸¤ç»“ç‚¹ä¹‹é—´çš„è·¯å¾„é•¿åº¦æ˜¯ä»¥å®ƒä»¬ä¹‹é—´è¾¹çš„æ•°ç›®è¡¨ç¤ºã€‚
 *
 * ç¤ºä¾‹ï¼š
 *        1
 *       / \
 *      2   3
 *     / \
 *    4   5
 *
 * è¿”å› 3ï¼Œå®ƒçš„é•¿åº¦æ˜¯è·¯å¾„ [4,2,1,3] æˆ–è€… [5,2,1,3]ã€‚
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æ
// ============================================================
//
// è¿™é“é¢˜æ˜¯"æœ€å¤§è·¯å¾„å’Œ"çš„ç®€åŒ–ç‰ˆ
//
// æ ¸å¿ƒæ€è·¯ï¼š
// 1. ç›´å¾„ = ç»è¿‡æŸä¸ªèŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„
// 2. ç»è¿‡èŠ‚ç‚¹ x çš„æœ€é•¿è·¯å¾„ = x çš„å·¦å­æ ‘æ·±åº¦ + x çš„å³å­æ ‘æ·±åº¦
// 3. éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œå–æœ€å¤§å€¼
//
// è¿™æ˜¯ååºéå†çš„å…¸å‹åº”ç”¨ï¼š
// - éœ€è¦å…ˆçŸ¥é“å·¦å³å­æ ‘çš„æ·±åº¦
// - ç„¶ååœ¨å½“å‰èŠ‚ç‚¹è®¡ç®—ç›´å¾„

// ============================================================
// èŠ‚ç‚¹å®šä¹‰
// ============================================================

class TreeNode {
  val: number;
  left: TreeNode | null;
  right: TreeNode | null;
  constructor(val: number = 0, left?: TreeNode | null, right?: TreeNode | null) {
    this.val = val;
    this.left = left === undefined ? null : left;
    this.right = right === undefined ? null : right;
  }
}

// ============================================================
// è§£æ³•ä¸€ï¼šååºéå†ï¼ˆæ¨èï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(h)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 *        1
 *       / \
 *      2   3
 *     / \
 *    4   5
 *
 * ååºéå†è¿‡ç¨‹ï¼š
 *
 * èŠ‚ç‚¹ 4: å·¦æ·±åº¦=0, å³æ·±åº¦=0, ç›´å¾„=0, è¿”å›æ·±åº¦=1
 * èŠ‚ç‚¹ 5: å·¦æ·±åº¦=0, å³æ·±åº¦=0, ç›´å¾„=0, è¿”å›æ·±åº¦=1
 * èŠ‚ç‚¹ 2: å·¦æ·±åº¦=1, å³æ·±åº¦=1, ç›´å¾„=2, è¿”å›æ·±åº¦=2
 * èŠ‚ç‚¹ 3: å·¦æ·±åº¦=0, å³æ·±åº¦=0, ç›´å¾„=0, è¿”å›æ·±åº¦=1
 * èŠ‚ç‚¹ 1: å·¦æ·±åº¦=2, å³æ·±åº¦=1, ç›´å¾„=3, è¿”å›æ·±åº¦=3
 *
 * æœ€å¤§ç›´å¾„ = 3
 *
 * ğŸ”„ æµç¨‹å›¾ (Mermaid):
 * ```mermaid
 * flowchart TD
 *     A[é€’å½’å‡½æ•°depth] --> B{èŠ‚ç‚¹ä¸ºç©º?}
 *     B -->|Yes| C[è¿”å›0]
 *     B -->|No| D[é€’å½’è®¡ç®—å·¦å­æ ‘æ·±åº¦]
 *     D --> E[é€’å½’è®¡ç®—å³å­æ ‘æ·±åº¦]
 *     E --> F[æ›´æ–°æœ€å¤§ç›´å¾„: left + right]
 *     F --> G[è¿”å› max left, right + 1]
 * ```
 */
function diameterOfBinaryTree_v1(root: TreeNode | null): number {
  let maxDiameter = 0;

  function depth(node: TreeNode | null): number {
    if (!node) return 0;

    // ååºä½ç½®ï¼šå…ˆé€’å½’è®¡ç®—å·¦å³å­æ ‘æ·±åº¦
    const leftDepth = depth(node.left);
    const rightDepth = depth(node.right);

    // åœ¨å½“å‰èŠ‚ç‚¹è®¡ç®—ç›´å¾„å¹¶æ›´æ–°æœ€å¤§å€¼
    maxDiameter = Math.max(maxDiameter, leftDepth + rightDepth);

    // è¿”å›å½“å‰èŠ‚ç‚¹çš„æ·±åº¦
    return Math.max(leftDepth, rightDepth) + 1;
  }

  depth(root);
  return maxDiameter;
}

// ============================================================
// è§£æ³•äºŒï¼šè¿”å›å¯¹è±¡ï¼ˆæ›´æ¸…æ™°ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(h)

interface Result {
  depth: number;    // å½“å‰å­æ ‘çš„æ·±åº¦
  diameter: number; // ä»¥å½“å‰å­æ ‘ä¸ºæ ¹çš„æœ€å¤§ç›´å¾„
}

function diameterOfBinaryTree_v2(root: TreeNode | null): number {
  function dfs(node: TreeNode | null): Result {
    if (!node) {
      return { depth: 0, diameter: 0 };
    }

    const left = dfs(node.left);
    const right = dfs(node.right);

    // ç»è¿‡å½“å‰èŠ‚ç‚¹çš„ç›´å¾„
    const currentDiameter = left.depth + right.depth;

    // æœ€å¤§ç›´å¾„å¯èƒ½æ˜¯ï¼šå·¦å­æ ‘çš„ã€å³å­æ ‘çš„ã€æˆ–ç»è¿‡å½“å‰èŠ‚ç‚¹çš„
    const maxDiameter = Math.max(
      left.diameter,
      right.diameter,
      currentDiameter
    );

    return {
      depth: Math.max(left.depth, right.depth) + 1,
      diameter: maxDiameter,
    };
  }

  return dfs(root).diameter;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•        | æ—¶é—´  | ç©ºé—´  | ç‰¹ç‚¹                        |
 * |------------|-------|-------|----------------------------|
 * | å…¨å±€å˜é‡   | O(n)  | O(h)  | ä»£ç ç®€æ´                    |
 * | è¿”å›å¯¹è±¡   | O(n)  | O(h)  | æ— å‰¯ä½œç”¨ï¼Œæ›´æ¸…æ™°            |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. ç›´å¾„ vs æ·±åº¦ï¼š
 *    - ç›´å¾„æ˜¯è¾¹çš„æ•°é‡
 *    - æ·±åº¦æ˜¯èŠ‚ç‚¹åˆ°å¶å­çš„æœ€é•¿è·¯å¾„
 *    - ç›´å¾„ = å·¦æ·±åº¦ + å³æ·±åº¦ï¼ˆä¸æ˜¯ + 1ï¼‰
 *
 * 2. æœ€å¤§ç›´å¾„å¯èƒ½ä¸ç»è¿‡æ ¹ï¼š
 *    - ä¸èƒ½åªè®¡ç®—æ ¹çš„å·¦æ·±åº¦+å³æ·±åº¦
 *    - éœ€è¦éå†æ¯ä¸ªèŠ‚ç‚¹
 *
 * 3. ä½¿ç”¨å…¨å±€å˜é‡è¦æ³¨æ„åˆå§‹åŒ–ï¼š
 *    - æ¯æ¬¡è°ƒç”¨å‡½æ•°å‰è¦é‡ç½®
 *    - æˆ–è€…ç”¨é—­åŒ…å°è£…
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ â†’ æœ¬é¢˜çš„å­é—®é¢˜
 * - äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ â†’ ç±»ä¼¼æ€è·¯ï¼Œä½†è€ƒè™‘èŠ‚ç‚¹å€¼
 * - å¹³è¡¡äºŒå‰æ ‘ â†’ ä¹Ÿæ˜¯ååºéå†æ±‚æ·±åº¦
 *
 * å…±åŒæ¨¡å¼ï¼šååºä½ç½®è®¡ç®—ï¼Œè¿”å›å€¼å’Œæ›´æ–°å€¼ä¸åŒ
 */

// ============================================================
// ğŸ“Š ä¸æœ€å¤§è·¯å¾„å’Œçš„å¯¹æ¯”
// ============================================================
/**
 * ç›´å¾„é—®é¢˜ï¼š
 * - åªè®¡ç®—è¾¹çš„æ•°é‡
 * - ç›´å¾„ = left + right
 *
 * æœ€å¤§è·¯å¾„å’Œï¼š
 * - è®¡ç®—èŠ‚ç‚¹å€¼çš„å’Œ
 * - è·¯å¾„å’Œ = left + node.val + right
 * - è¿˜è¦è€ƒè™‘è´Ÿæ•°ï¼ˆå¯ä»¥ä¸é€‰æŸè¾¹ï¼‰
 *
 * ä¸¤é“é¢˜çš„ç»“æ„ä¸€æ ·ï¼Œéƒ½æ˜¯"ååºä½ç½®æ›´æ–°å…¨å±€æœ€å¤§å€¼"
 */

export { diameterOfBinaryTree_v1, diameterOfBinaryTree_v2, TreeNode };
export default diameterOfBinaryTree_v1;

