/**
 * ğŸ“ é¢˜ç›®ï¼šäºŒå‰æ ‘çš„å‰åºéå†
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/binary-tree-preorder-traversal/
 * ğŸ·ï¸ éš¾åº¦ï¼šEasy
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ ˆã€æ ‘ã€æ·±åº¦ä¼˜å…ˆæœç´¢ã€äºŒå‰æ ‘
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ rootï¼Œè¿”å›å®ƒèŠ‚ç‚¹å€¼çš„ å‰åº éå†ã€‚
 *
 * è¿›é˜¶ï¼šé€’å½’ç®—æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥é€šè¿‡è¿­ä»£ç®—æ³•å®Œæˆå—ï¼Ÿ
 *
 * ç¤ºä¾‹ï¼š
 *     1
 *      \
 *       2
 *      /
 *     3
 *
 * è¾“å…¥ï¼šroot = [1,null,2,3]
 * è¾“å‡ºï¼š[1,2,3]
 */

class TreeNode {
  val: number;
  left: TreeNode | null;
  right: TreeNode | null;
  constructor(val?: number, left?: TreeNode | null, right?: TreeNode | null) {
    this.val = val === undefined ? 0 : val;
    this.left = left === undefined ? null : left;
    this.right = right === undefined ? null : right;
  }
}

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// å‰åºéå†é¡ºåºï¼šæ ¹ â†’ å·¦ â†’ å³
//
// 1. é€’å½’ï¼šæŒ‰ç…§ æ ¹-å·¦-å³ çš„é¡ºåºé€’å½’
// 2. è¿­ä»£ï¼šç”¨æ ˆæ¨¡æ‹Ÿé€’å½’è¿‡ç¨‹

// ============================================================
// è§£æ³•ä¸€ï¼šé€’å½’
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(h)

/**
 * ğŸ“Š å‰åºéå†å›¾è§£ï¼š
 *
 *        1
 *       / \
 *      2   3
 *     / \
 *    4   5
 *
 *  è®¿é—®é¡ºåº: 1 â†’ 2 â†’ 4 â†’ 5 â†’ 3
 *  ç»“æœ: [1, 2, 4, 5, 3]
 */
function preorderTraversal_v1(root: TreeNode | null): number[] {
  const result: number[] = [];

  function traverse(node: TreeNode | null) {
    if (!node) return;

    result.push(node.val); // æ ¹ï¼ˆå‰åºä½ç½®ï¼‰
    traverse(node.left); // å·¦
    traverse(node.right); // å³
  }

  traverse(root);
  return result;
}

// ============================================================
// è§£æ³•äºŒï¼šè¿­ä»£ï¼ˆæ ˆï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(h)

/**
 * ğŸ“Š è¿­ä»£è¿‡ç¨‹å›¾è§£ï¼š
 *
 *        1
 *       / \
 *      2   3
 *
 *  åˆå§‹: stack = [1]
 *
 *  å¼¹å‡º 1ï¼Œè®¿é—®        result = [1]
 *  å³3ã€å·¦2 å…¥æ ˆ       stack = [3, 2]
 *
 *  å¼¹å‡º 2ï¼Œè®¿é—®        result = [1, 2]
 *  æ— å³æ— å·¦            stack = [3]
 *
 *  å¼¹å‡º 3ï¼Œè®¿é—®        result = [1, 2, 3]
 *  æ ˆç©ºï¼Œç»“æŸ
 */
function preorderTraversal_v2(root: TreeNode | null): number[] {
  if (!root) return [];

  const result: number[] = [];
  const stack: TreeNode[] = [root];

  while (stack.length > 0) {
    const node = stack.pop()!;
    result.push(node.val);

    // å…ˆå³åå·¦å…¥æ ˆï¼Œå‡ºæ ˆæ—¶å°±æ˜¯å…ˆå·¦åå³
    if (node.right) stack.push(node.right);
    if (node.left) stack.push(node.left);
  }

  return result;
}

// ============================================================
// è§£æ³•ä¸‰ï¼šMorris éå†ï¼ˆO(1) ç©ºé—´ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)
// ğŸ“ åˆ©ç”¨å¶å­èŠ‚ç‚¹çš„ç©ºæŒ‡é’ˆï¼Œä¸éœ€è¦é¢å¤–æ ˆç©ºé—´
function preorderTraversal_v3(root: TreeNode | null): number[] {
  const result: number[] = [];
  let curr = root;

  while (curr) {
    if (!curr.left) {
      // æ²¡æœ‰å·¦å­æ ‘ï¼Œè®¿é—®å½“å‰èŠ‚ç‚¹ï¼Œè½¬å‘å³å­æ ‘
      result.push(curr.val);
      curr = curr.right;
    } else {
      // æ‰¾å·¦å­æ ‘çš„æœ€å³èŠ‚ç‚¹ï¼ˆå‰é©±èŠ‚ç‚¹ï¼‰
      let predecessor = curr.left;
      while (predecessor.right && predecessor.right !== curr) {
        predecessor = predecessor.right;
      }

      if (!predecessor.right) {
        // ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œå»ºç«‹çº¿ç´¢ï¼Œè®¿é—®å½“å‰èŠ‚ç‚¹
        result.push(curr.val);
        predecessor.right = curr;
        curr = curr.left;
      } else {
        // ç¬¬äºŒæ¬¡è®¿é—®ï¼Œæ¢å¤æ ‘ç»“æ„
        predecessor.right = null;
        curr = curr.right;
      }
    }
  }

  return result;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•     | æ—¶é—´  | ç©ºé—´  | ç‰¹ç‚¹                     |
 * |---------|-------|-------|-------------------------|
 * | é€’å½’    | O(n)  | O(h)  | æœ€ç®€æ´                   |
 * | æ ˆè¿­ä»£  | O(n)  | O(h)  | å¸¸è€ƒçš„è¿­ä»£ç‰ˆæœ¬            |
 * | Morris  | O(n)  | O(1)  | ç©ºé—´æœ€ä¼˜ï¼Œä½†æ”¹å˜æ ‘ç»“æ„    |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. è¿­ä»£æ—¶å…¥æ ˆé¡ºåºï¼š
 *    - å…ˆå³åå·¦å…¥æ ˆ
 *    - è¿™æ ·å‡ºæ ˆæ—¶æ‰æ˜¯å…ˆå·¦åå³
 *
 * 2. ç©ºèŠ‚ç‚¹æ£€æŸ¥ï¼š
 *    - å…¥æ ˆå‰è¦æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º
 *
 * 3. Morris éå†ï¼š
 *    - ä¼šä¸´æ—¶ä¿®æ”¹æ ‘çš„ç»“æ„
 *    - éœ€è¦æ¢å¤
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - ä¸­åºéå† â†’ å·¦-æ ¹-å³
 * - ååºéå† â†’ å·¦-å³-æ ¹
 * - N å‰æ ‘çš„å‰åºéå† â†’ å¤šä¸ªå­èŠ‚ç‚¹
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. DOM éå†ï¼šæ·±åº¦ä¼˜å…ˆéå† DOM æ ‘
 * 2. ç»„ä»¶æ¸²æŸ“ï¼šReact ç»„ä»¶æ ‘çš„æ¸²æŸ“é¡ºåº
 * 3. AST å¤„ç†ï¼šä»£ç åˆ†æå·¥å…·éå† AST
 */

export {
  TreeNode,
  preorderTraversal_v1,
  preorderTraversal_v2,
  preorderTraversal_v3,
};
export default preorderTraversal_v1;

