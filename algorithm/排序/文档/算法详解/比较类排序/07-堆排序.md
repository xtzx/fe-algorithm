# å †æ’åº (Heap Sort)

## ğŸ“Œ æ ¸å¿ƒæ€æƒ³

åˆ©ç”¨**å †**è¿™ç§æ•°æ®ç»“æ„çš„æ€§è´¨è¿›è¡Œæ’åºï¼š

1. **å»ºå †**ï¼šå°†æ— åºæ•°ç»„æ„å»ºæˆæœ€å¤§å †
2. **æ’åº**ï¼šåå¤å°†å †é¡¶ï¼ˆæœ€å¤§å€¼ï¼‰ä¸æœ«å°¾äº¤æ¢ï¼Œç„¶åå †åŒ–è°ƒæ•´

> å…³é”®æ´å¯Ÿï¼šå †çš„æ ¹èŠ‚ç‚¹å§‹ç»ˆæ˜¯æœ€å€¼ï¼›æ¯æ¬¡å–å‡ºæ ¹èŠ‚ç‚¹åï¼Œåªéœ€ O(log n) å°±èƒ½æ¢å¤å †æ€§è´¨ã€‚

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

### âœ… æ¨èä½¿ç”¨

| åœºæ™¯ | åŸå›  |
|------|------|
| å†…å­˜å—é™ | O(1) é¢å¤–ç©ºé—´ |
| æœ€åæƒ…å†µæ•æ„Ÿ | ä¿è¯ O(n log n)ï¼Œä¸ä¼šé€€åŒ– |
| TopK é—®é¢˜ | ç»´æŠ¤å¤§å°ä¸º K çš„å † |
| ä¼˜å…ˆé˜Ÿåˆ—å®ç° | å †å¤©ç„¶æ”¯æŒ |

### âŒ ä¸æ¨èä½¿ç”¨

| åœºæ™¯ | åŸå›  |
|------|------|
| éœ€è¦ç¨³å®šæ’åº | å †æ’åºä¸ç¨³å®š |
| è¿½æ±‚æœ€å¿«å¹³å‡é€Ÿåº¦ | å¿«æ’çš„å¹³å‡æ€§èƒ½æ›´ä¼˜ |
| è¿‘ä¹æœ‰åºæ•°æ® | æ’å…¥æ’åºæˆ– TimSort æ›´å¿« |

---

## ğŸ“Š å¤æ‚åº¦åˆ†æ

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| **æœ€å¥½æ—¶é—´** | O(n log n) | æ— è®ºæ•°æ®åˆ†å¸ƒå¦‚ä½• |
| **å¹³å‡æ—¶é—´** | O(n log n) | ç¨³å®šçš„æ€§èƒ½ |
| **æœ€åæ—¶é—´** | O(n log n) | â­ ä¿è¯ä¸é€€åŒ– |
| **ç©ºé—´å¤æ‚åº¦** | O(1) | åŸåœ°æ’åº |
| **ç¨³å®šæ€§** | âŒ ä¸ç¨³å®š | äº¤æ¢æ‰“ä¹±ç›¸å¯¹é¡ºåº |
| **åŸåœ°æ€§** | âœ… åŸåœ° | æ— éœ€é¢å¤–æ•°ç»„ |

---

## ğŸŒ³ å †çš„åŸºæœ¬æ¦‚å¿µ

### æ•°ç»„å­˜å‚¨äºŒå‰å †

```
              0
           /     \
          1       2
         / \     / \
        3   4   5   6

æ•°ç»„ç´¢å¼•ï¼š[0, 1, 2, 3, 4, 5, 6]

å…³ç³»å…¬å¼ï¼ˆ0-indexedï¼‰ï¼š
- çˆ¶èŠ‚ç‚¹ï¼šparent(i) = (i - 1) >> 1
- å·¦å­èŠ‚ç‚¹ï¼šleft(i) = 2 * i + 1
- å³å­èŠ‚ç‚¹ï¼šright(i) = 2 * i + 2
```

### æœ€å¤§å †æ€§è´¨

```
å¯¹äºä»»æ„èŠ‚ç‚¹ iï¼šarr[i] >= arr[left(i)] ä¸” arr[i] >= arr[right(i)]
```

---

## ğŸ”„ å †åŒ–è¿‡ç¨‹ï¼ˆMermaidï¼‰

```mermaid
graph TD
    subgraph "åˆå§‹æ•°ç»„ [4, 10, 3, 5, 1]"
        A["4<br/>(0)"]
        A --> B["10<br/>(1)"]
        A --> C["3<br/>(2)"]
        B --> D["5<br/>(3)"]
        B --> E["1<br/>(4)"]
    end
```

```mermaid
graph TD
    subgraph "è‡ªåº•å‘ä¸Šå»ºå †"
        direction TB

        Step1["æ­¥éª¤1: heapify(1)<br/>10 > 5,1 âœ“ æ— éœ€è°ƒæ•´"]
        Step2["æ­¥éª¤2: heapify(0)<br/>4 < 10, äº¤æ¢"]
        Step3["ç»“æœ: [10, 5, 3, 4, 1]"]

        Step1 --> Step2
        Step2 --> Step3
    end
```

```mermaid
graph TD
    subgraph "æœ€å¤§å † [10, 5, 3, 4, 1]"
        A["10<br/>(0)"]
        A --> B["5<br/>(1)"]
        A --> C["3<br/>(2)"]
        B --> D["4<br/>(3)"]
        B --> E["1<br/>(4)"]
    end

    style A fill:#90EE90
```

### æ’åºè¿‡ç¨‹

```mermaid
graph LR
    A["[10,5,3,4,1]"] -->|"swap(0,4)"| B["[1,5,3,4,|10]"]
    B -->|"heapify(0)"| C["[5,4,3,1,|10]"]
    C -->|"swap(0,3)"| D["[1,4,3,|5,10]"]
    D -->|"heapify(0)"| E["[4,1,3,|5,10]"]
    E -->|"ç»§ç»­..."| F["[1,3,4,5,10]"]

    style F fill:#90EE90
```

---

## ğŸ’» æ ¸å¿ƒå®ç°

### ä¸¤ç§å»ºå †æ–¹å¼

#### 1. è‡ªåº•å‘ä¸Šå»ºå †ï¼ˆæ¨è O(n)ï¼‰

```typescript
function buildHeapBottomUp<T>(arr: T[], cmp: Comparator<T>): void {
  const n = arr.length;
  // ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œè‡ªåº•å‘ä¸Š
  for (let i = (n >> 1) - 1; i >= 0; i--) {
    heapifyDown(arr, n, i, cmp);
  }
}
```

> **ä¸ºä»€ä¹ˆæ˜¯ O(n)**ï¼šå¶å­èŠ‚ç‚¹ï¼ˆå ä¸€åŠï¼‰æ— éœ€æ“ä½œï¼›è¶Šé è¿‘æ ¹ï¼ŒèŠ‚ç‚¹è¶Šå°‘ä½†ä¸‹æ²‰è·ç¦»è¶Šé•¿ã€‚æ•°å­¦è¯æ˜æ€»æ“ä½œæ•°æ˜¯ O(n)ã€‚

#### 2. è‡ªé¡¶å‘ä¸‹å»ºå †ï¼ˆO(n log n)ï¼‰

```typescript
function buildHeapTopDown<T>(arr: T[], cmp: Comparator<T>): void {
  const n = arr.length;
  // æ¨¡æ‹Ÿé€ä¸ªæ’å…¥
  for (let i = 1; i < n; i++) {
    heapifyUp(arr, i, cmp);
  }
}
```

### å®Œæ•´å †æ’åº

```typescript
function heapSort<T>(arr: readonly T[], cmp: Comparator<T>): T[] {
  const result = [...arr];
  const n = result.length;

  if (n <= 1) return result;

  // 1. å»ºæœ€å¤§å †ï¼ˆO(n)ï¼‰
  for (let i = (n >> 1) - 1; i >= 0; i--) {
    heapifyDown(result, n, i, cmp);
  }

  // 2. æ’åºï¼šäº¤æ¢å †é¡¶ä¸æœ«å°¾ï¼Œç¼©å°å †èŒƒå›´ï¼Œé‡æ–°å †åŒ–
  for (let i = n - 1; i > 0; i--) {
    [result[0], result[i]] = [result[i], result[0]];
    heapifyDown(result, i, 0, cmp);  // å †å¤§å°å˜ä¸º i
  }

  return result;
}

function heapifyDown<T>(
  arr: T[],
  heapSize: number,
  i: number,
  cmp: Comparator<T>
): void {
  while (true) {
    let largest = i;
    const left = 2 * i + 1;
    const right = 2 * i + 2;

    if (left < heapSize && cmp(arr[left], arr[largest]) > 0) {
      largest = left;
    }
    if (right < heapSize && cmp(arr[right], arr[largest]) > 0) {
      largest = right;
    }

    if (largest === i) break;

    [arr[i], arr[largest]] = [arr[largest], arr[i]];
    i = largest;
  }
}
```

---

## âš ï¸ ä¸ºä»€ä¹ˆå †æ’åºä¸ç¨³å®šï¼Ÿ

```typescript
// ç¤ºä¾‹ï¼šç›¸ç­‰å…ƒç´ é¡ºåºè¢«æ‰“ä¹±
const items = [
  { value: 3, id: 1 },
  { value: 3, id: 2 },
  { value: 1, id: 3 },
];

// å»ºå †æ—¶ï¼Œ(3,id=1) å’Œ (3,id=2) å¯èƒ½å› ä¸ºä¸å…¶ä»–å…ƒç´ äº¤æ¢è€Œé¡ºåºæ”¹å˜
// æ’åºæ—¶ï¼Œå †é¡¶ä¸æœ«å°¾äº¤æ¢ä¹Ÿä¼šæ‰“ä¹±é¡ºåº

// ç»“æœå¯èƒ½æ˜¯ï¼š
// [{ value: 1, id: 3 }, { value: 3, id: 2 }, { value: 3, id: 1 }]
// åŸæœ¬ id=1 åœ¨ id=2 å‰é¢ï¼Œç°åœ¨åäº† â†’ ä¸ç¨³å®š
```

---

## ğŸ”§ å˜ç§ä¸ä¼˜åŒ–

### 1. å‡åºæ’åºç”¨æœ€å¤§å † vs æœ€å°å †

```typescript
// âœ… å‡åºæ’åºï¼šç”¨æœ€å¤§å †
// æ¯æ¬¡å–å‡ºæœ€å¤§å€¼æ”¾åˆ°æœ«å°¾

// âŒ å‡åºæ’åºç”¨æœ€å°å †ï¼šéœ€è¦é¢å¤–æ•°ç»„å­˜å‚¨å–å‡ºçš„å…ƒç´ 
```

### 2. å¤šè·¯å †ï¼ˆd-ary heapï¼‰

```typescript
// d å‰å †ï¼šæ¯ä¸ªèŠ‚ç‚¹æœ‰ d ä¸ªå­èŠ‚ç‚¹
// ä¼˜åŠ¿ï¼šå‡å°‘æ ‘é«˜åº¦ log_d(n)
// åŠ£åŠ¿ï¼šæ¯æ¬¡ heapify éœ€è¦æ¯”è¾ƒ d ä¸ªå­èŠ‚ç‚¹

// é€‚ç”¨åœºæ™¯ï¼šå †æ“ä½œé¢‘ç¹æ—¶ï¼ˆå¦‚ Dijkstra ç®—æ³•ï¼‰
```

### 3. åˆ©ç”¨å †åš TopK

```typescript
function topK<T>(arr: readonly T[], k: number, cmp: Comparator<T>): T[] {
  if (k <= 0) return [];
  if (k >= arr.length) return heapSort(arr, cmp);

  // ç»´æŠ¤å¤§å°ä¸º k çš„æœ€å°å †ï¼ˆæ‰¾æœ€å¤§çš„ k ä¸ªï¼‰
  const heap = arr.slice(0, k);
  buildMinHeap(heap, cmp);

  for (let i = k; i < arr.length; i++) {
    if (cmp(arr[i], heap[0]) > 0) {
      heap[0] = arr[i];
      heapifyDown(heap, k, 0, reverseCmp(cmp));
    }
  }

  return heap;
}
```

---

## ğŸŒ å‰ç«¯ä¸šåŠ¡åœºæ™¯

### 1. ä¼˜å…ˆçº§é˜Ÿåˆ—

```typescript
class PriorityQueue<T> {
  private heap: T[] = [];

  constructor(private cmp: Comparator<T>) {}

  push(item: T): void {
    this.heap.push(item);
    this.heapifyUp(this.heap.length - 1);
  }

  pop(): T | undefined {
    if (this.heap.length === 0) return undefined;
    const top = this.heap[0];
    const last = this.heap.pop()!;
    if (this.heap.length > 0) {
      this.heap[0] = last;
      this.heapifyDown(0);
    }
    return top;
  }

  peek(): T | undefined {
    return this.heap[0];
  }

  // ... heapifyUp, heapifyDown å®ç°
}

// ä½¿ç”¨ï¼šä»»åŠ¡è°ƒåº¦
const taskQueue = new PriorityQueue<Task>((a, b) => b.priority - a.priority);
taskQueue.push({ name: 'low', priority: 1 });
taskQueue.push({ name: 'high', priority: 10 });
console.log(taskQueue.pop()); // { name: 'high', priority: 10 }
```

### 2. å®æ—¶çƒ­æ¦œ

```typescript
// ç»´æŠ¤çƒ­åº¦æœ€é«˜çš„ 10 æ¡å†…å®¹
class HotRanking {
  private minHeap: Article[] = [];
  private readonly capacity = 10;

  add(article: Article): void {
    if (this.minHeap.length < this.capacity) {
      this.minHeap.push(article);
      // heapifyUp...
    } else if (article.heat > this.minHeap[0].heat) {
      this.minHeap[0] = article;
      // heapifyDown...
    }
  }

  getTopN(): Article[] {
    return [...this.minHeap].sort((a, b) => b.heat - a.heat);
  }
}
```

---

## ğŸ†š ä¸å…¶ä»–ç®—æ³•å¯¹æ¯”

| ç®—æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | ç¨³å®šæ€§ | ç‰¹ç‚¹ |
|------|-----------|-----------|--------|------|
| å †æ’åº | O(n log n) | O(1) | âŒ | åŸåœ°ã€ä¿è¯æ€§èƒ½ã€å¸¸æ•°å› å­è¾ƒå¤§ |
| å¿«é€Ÿæ’åº | O(n log n) å¹³å‡ | O(log n) | âŒ | å¹³å‡æ›´å¿«ï¼Œä½†æœ‰æœ€åæƒ…å†µ |
| å½’å¹¶æ’åº | O(n log n) | O(n) | âœ… | ç¨³å®šï¼Œä½†éœ€è¦é¢å¤–ç©ºé—´ |

> **ä¸ºä»€ä¹ˆå¿«æ’æ¯”å †æ’å¸¸æ•°å› å­å°**ï¼šå †æ’çš„ heapify è®¿é—®å†…å­˜ä¸è¿ç»­ï¼ˆçˆ¶å­èŠ‚ç‚¹è·ç¦»è¿œï¼‰ï¼ŒCPU ç¼“å­˜å‘½ä¸­ç‡ä½ã€‚

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

1. **Floyd å»ºå †ç®—æ³•**ï¼šè‡ªåº•å‘ä¸Š O(n) å»ºå †çš„æ•°å­¦è¯æ˜
2. **æ–æ³¢é‚£å¥‘å †**ï¼šæ›´ä¼˜çš„æ‘Šè¿˜å¤æ‚åº¦ï¼Œç”¨äºå›¾ç®—æ³•
3. **äºŒé¡¹å †**ï¼šæ”¯æŒå¿«é€Ÿåˆå¹¶çš„å †ç»“æ„
4. **Introsort**ï¼šå¿«æ’æ·±åº¦è¿‡æ·±æ—¶åˆ‡æ¢åˆ°å †æ’åº

---

## âœ… è‡ªæ£€æ¸…å•

- [ ] èƒ½ç”»å‡ºå †çš„æ•°ç»„è¡¨ç¤ºå’Œçˆ¶å­ç´¢å¼•å…¬å¼
- [ ] èƒ½æ‰‹å†™ heapifyDown å’Œ heapifyUp
- [ ] ç†è§£è‡ªåº•å‘ä¸Šå»ºå †ä¸ºä½•æ˜¯ O(n)
- [ ] èƒ½è§£é‡Šä¸ºä»€ä¹ˆå †æ’åºä¸ç¨³å®š
- [ ] èƒ½å®ç° TopK é—®é¢˜çš„å †è§£æ³•
- [ ] çŸ¥é“å †æ’åºä¸ºä»€ä¹ˆæ¯”å¿«æ’æ…¢ï¼ˆç¼“å­˜ä¸å‹å¥½ï¼‰

