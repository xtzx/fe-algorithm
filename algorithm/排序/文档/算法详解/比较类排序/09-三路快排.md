# ä¸‰è·¯å¿«é€Ÿæ’åº (3-Way Quick Sort)

## ğŸ“Œ æ ¸å¿ƒæ€æƒ³

ç»å…¸å¿«æ’å°†æ•°ç»„åˆ†ä¸ºã€Œå°äº pivotã€å’Œã€Œå¤§äºç­‰äº pivotã€ä¸¤éƒ¨åˆ†ã€‚**ä¸‰è·¯å¿«æ’**åˆ™åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š
- `< pivot`
- `= pivot`
- `> pivot`

> å…³é”®æ´å¯Ÿï¼šå½“æ•°æ®åŒ…å«å¤§é‡é‡å¤å…ƒç´ æ—¶ï¼Œ`= pivot` çš„éƒ¨åˆ†å¯ä»¥ç›´æ¥è·³è¿‡ï¼Œä¸å†å‚ä¸åç»­é€’å½’ã€‚

---

## ğŸš¨ åœºæ™¯è¯†åˆ«ä¿¡å·

| ä¿¡å· | æ¨èç®—æ³• |
|------|---------|
| **æ•°æ®é‡å¤ç‡é«˜**ï¼ˆå¦‚çŠ¶æ€ç ã€ç­‰çº§ã€åˆ†ç±»ï¼‰ | âœ… ä¸‰è·¯å¿«æ’ |
| é‡å¤å°‘çš„éšæœºæ•°æ® | æ ‡å‡†å¿«æ’å³å¯ |
| éœ€è¦ç¨³å®šæ’åº | å½’å¹¶/TimSort |

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

### âœ… æ¨èä½¿ç”¨

| åœºæ™¯ | åŸå›  |
|------|------|
| å¤§é‡é‡å¤å…ƒç´  | ç›¸ç­‰å…ƒç´ ä¸€æ¬¡æ€§å¤„ç†å®Œ |
| æšä¸¾å€¼/åˆ†ç±»æ•°æ®æ’åº | å€¼åŸŸæœ‰é™ï¼Œé‡å¤å¤š |
| å¤šé”®æ’åºçš„è¾…åŠ© | æŒ‰æŸä¸ªå­—æ®µæœ‰å¾ˆå¤šç›¸åŒå€¼ |

### âŒ ä¸æ¨èä½¿ç”¨

| åœºæ™¯ | åŸå›  |
|------|------|
| å‡ ä¹æ— é‡å¤çš„æ•°æ® | é¢å¤–å¼€é”€æ— æ”¶ç›Š |
| éœ€è¦ç¨³å®šæ’åº | ä¸ç¨³å®š |

---

## ğŸ“Š å¤æ‚åº¦åˆ†æ

| æŒ‡æ ‡ | æ ‡å‡†å¿«æ’ | ä¸‰è·¯å¿«æ’ |
|------|---------|---------|
| **æœ€å¥½æ—¶é—´** | O(n log n) | O(n log n) |
| **å¹³å‡æ—¶é—´** | O(n log n) | O(n log n) |
| **æœ€åæ—¶é—´ï¼ˆå…¨ç›¸åŒï¼‰** | O(nÂ²) âš ï¸ | **O(n)** â­ |
| **ç©ºé—´å¤æ‚åº¦** | O(log n) | O(log n) |
| **ç¨³å®šæ€§** | âŒ | âŒ |

---

## ğŸ”„ åˆ†åŒºè¿‡ç¨‹ï¼ˆMermaidï¼‰

### Dijkstra 3-Way Partition

```mermaid
graph TD
    subgraph "åˆå§‹çŠ¶æ€"
        A["[3, 5, 2, 5, 5, 1, 4, 5]<br/>pivot=5<br/>lt=0, i=0, gt=7"]
    end

    subgraph "åˆ†åŒºè¿‡ç¨‹"
        A -->|"3<5: swap(lt,i), lt++, i++"| B["[3, 5, 2, 5, 5, 1, 4, 5]<br/>lt=1, i=1, gt=7"]
        B -->|"5=5: i++"| C["[3, 5, 2, 5, 5, 1, 4, 5]<br/>lt=1, i=2, gt=7"]
        C -->|"2<5: swap(lt,i), lt++, i++"| D["[3, 2, 5, 5, 5, 1, 4, 5]<br/>lt=2, i=3, gt=7"]
        D -->|"5=5: i++"| E["[3, 2, 5, 5, 5, 1, 4, 5]<br/>lt=2, i=4, gt=7"]
        E -->|"5=5: i++"| F["[3, 2, 5, 5, 5, 1, 4, 5]<br/>lt=2, i=5, gt=7"]
        F -->|"1<5: swap(lt,i), lt++, i++"| G["[3, 2, 1, 5, 5, 5, 4, 5]<br/>lt=3, i=6, gt=7"]
        G -->|"4<5: swap(lt,i), lt++, i++"| H["[3, 2, 1, 4, 5, 5, 5, 5]<br/>lt=4, i=7, gt=7"]
        H -->|"i > gt, åœæ­¢"| I["å®Œæˆ"]
    end

    subgraph "æœ€ç»ˆç»“æœ"
        J["[3, 2, 1, 4 | 5, 5, 5, 5]<br/>&lt;5 | =5 | &gt;5"]
    end

    I --> J
    style J fill:#90EE90
```

### åˆ†åŒºåçš„ç»“æ„

```mermaid
graph LR
    A["< pivot"] --> B["= pivot (è·³è¿‡)"]
    B --> C["> pivot"]

    D["é€’å½’å·¦è¾¹"] --> A
    E["é€’å½’å³è¾¹"] --> C

    style B fill:#FFD700
```

---

## ğŸ’» æ ¸å¿ƒå®ç°

### Dijkstra ä¸‰è·¯åˆ†åŒº

```typescript
/**
 * ä¸‰è·¯å¿«é€Ÿæ’åº
 *
 * ä½¿ç”¨ Dijkstra ä¸‰è·¯åˆ†åŒºï¼š
 * - [left, lt): < pivot
 * - [lt, gt]: = pivotï¼ˆè·³è¿‡ï¼‰
 * - (gt, right]: > pivot
 */
export function sort<T>(arr: readonly T[], cmp: Comparator<T>): T[] {
  const result = [...arr];
  threeWayQuickSort(result, 0, result.length - 1, cmp);
  return result;
}

function threeWayQuickSort<T>(
  arr: T[],
  left: number,
  right: number,
  cmp: Comparator<T>
): void {
  if (left >= right) return;

  // éšæœºé€‰æ‹© pivot
  const randomIndex = left + Math.floor(Math.random() * (right - left + 1));
  [arr[randomIndex], arr[left]] = [arr[left], arr[randomIndex]];
  const pivot = arr[left];

  // ä¸‰è·¯åˆ†åŒº
  let lt = left;     // arr[left..lt-1] < pivot
  let gt = right;    // arr[gt+1..right] > pivot
  let i = left + 1;  // arr[lt..i-1] = pivot

  while (i <= gt) {
    const c = cmp(arr[i], pivot);
    if (c < 0) {
      [arr[lt], arr[i]] = [arr[i], arr[lt]];
      lt++;
      i++;
    } else if (c > 0) {
      [arr[i], arr[gt]] = [arr[gt], arr[i]];
      gt--;
      // æ³¨æ„ï¼ši ä¸é€’å¢ï¼Œå› ä¸ºäº¤æ¢æ¥çš„å…ƒç´ è¿˜æœªæ£€æŸ¥
    } else {
      i++;
    }
  }

  // é€’å½’å¤„ç† < pivot å’Œ > pivot çš„éƒ¨åˆ†
  // = pivot çš„éƒ¨åˆ†å·²ç»åœ¨æ­£ç¡®ä½ç½®ï¼Œè·³è¿‡
  threeWayQuickSort(arr, left, lt - 1, cmp);
  threeWayQuickSort(arr, gt + 1, right, cmp);
}
```

---

## âœ… ä¸å˜å¼ä¸æ­£ç¡®æ€§

åœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¸­ï¼Œå§‹ç»ˆä¿æŒä»¥ä¸‹ä¸å˜å¼ï¼š

1. `arr[left..lt-1]` ä¸­æ‰€æœ‰å…ƒç´  `< pivot`
2. `arr[lt..i-1]` ä¸­æ‰€æœ‰å…ƒç´  `= pivot`
3. `arr[gt+1..right]` ä¸­æ‰€æœ‰å…ƒç´  `> pivot`
4. `arr[i..gt]` æ˜¯å°šæœªæ£€æŸ¥çš„åŒºåŸŸ

å½“ `i > gt` æ—¶ï¼Œæœªæ£€æŸ¥åŒºåŸŸä¸ºç©ºï¼Œåˆ†åŒºå®Œæˆã€‚

---

## ğŸ†š ä¸æ ‡å‡†å¿«æ’å¯¹æ¯”

### å…¨ç›¸åŒå…ƒç´ æ—¶çš„è¡¨ç°

```typescript
// å…¨ç›¸åŒå…ƒç´  [5, 5, 5, 5, 5, 5, 5, 5]

// æ ‡å‡†å¿«æ’ï¼šæ¯æ¬¡åªæ’é™¤ 1 ä¸ªå…ƒç´  â†’ O(nÂ²)
// ç¬¬ä¸€æ¬¡ partition åï¼š[5] [5, 5, 5, 5, 5, 5, 5]
// ç¬¬äºŒæ¬¡ partition åï¼š[5] [5] [5, 5, 5, 5, 5, 5]
// ...

// ä¸‰è·¯å¿«æ’ï¼šä¸€æ¬¡ partition å…¨éƒ¨æå®š â†’ O(n)
// ç¬¬ä¸€æ¬¡ partition åï¼š[] [5, 5, 5, 5, 5, 5, 5, 5] []
// å®Œæˆï¼
```

### å°‘é‡é‡å¤æ—¶çš„è¡¨ç°

```typescript
// å°‘é‡é‡å¤ [3, 1, 4, 1, 5, 9, 2, 6]

// ä¸¤ç§æ–¹æ³•æ€§èƒ½æ¥è¿‘
// ä¸‰è·¯å¿«æ’ç¨æœ‰é¢å¤–å¼€é”€ï¼ˆç»´æŠ¤ä¸‰ä¸ªæŒ‡é’ˆï¼‰ï¼Œä½†å½±å“å¾ˆå°
```

---

## ğŸŒ å‰ç«¯ä¸šåŠ¡åœºæ™¯

### 1. çŠ¶æ€ç /æšä¸¾å€¼æ’åº

```typescript
type Status = 'pending' | 'processing' | 'completed' | 'failed';

interface Task {
  id: string;
  status: Status;
  priority: number;
}

// ä»»åŠ¡çŠ¶æ€å­—æ®µé‡å¤ç‡æé«˜
const tasks: Task[] = [
  { id: '1', status: 'pending', priority: 1 },
  { id: '2', status: 'completed', priority: 2 },
  { id: '3', status: 'pending', priority: 3 },
  // ... å¤§é‡ pending/completed é‡å¤
];

// ä¸‰è·¯å¿«æ’é«˜æ•ˆå¤„ç†
const statusOrder: Record<Status, number> = {
  pending: 0,
  processing: 1,
  completed: 2,
  failed: 3,
};

const cmp = (a: Task, b: Task) => statusOrder[a.status] - statusOrder[b.status];
const sorted = threeWaySort(tasks, cmp);
```

### 2. åˆ†æ•°/ç­‰çº§æ’åº

```typescript
// å­¦ç”Ÿæˆç»©ï¼ˆç­‰çº§åˆ¶ï¼Œé‡å¤å¤šï¼‰
interface Student {
  name: string;
  grade: 'A' | 'B' | 'C' | 'D' | 'F';
}

// åªæœ‰ 5 ç§ç­‰çº§ï¼Œå¤§é‡é‡å¤
const gradeOrder = { A: 0, B: 1, C: 2, D: 3, F: 4 };
const cmp = (a: Student, b: Student) => gradeOrder[a.grade] - gradeOrder[b.grade];
```

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

1. **Bentley-McIlroy ä¸‰è·¯åˆ†åŒº**ï¼šå¦ä¸€ç§ä¸‰è·¯åˆ†åŒºå®ç°
2. **Dual-Pivot Quicksort**ï¼šJava 7+ é»˜è®¤æ’åºï¼Œä½¿ç”¨ä¸¤ä¸ª pivot
3. **Pattern-Defeating Quicksort (PDQsort)**ï¼šæ›´ç°ä»£çš„å˜ç§

---

## âœ… è‡ªæ£€æ¸…å•

- [ ] èƒ½æ‰‹å†™ Dijkstra ä¸‰è·¯åˆ†åŒº
- [ ] ç†è§£ä¸‰ä¸ªæŒ‡é’ˆ lt, i, gt çš„å«ä¹‰
- [ ] çŸ¥é“ä¸ºä»€ä¹ˆ `i > gt` æ—¶ä¸é€’å¢ i
- [ ] èƒ½è§£é‡Šä¸ºä»€ä¹ˆå…¨ç›¸åŒå…ƒç´ æ—¶æ˜¯ O(n)
- [ ] çŸ¥é“ä½•æ—¶é€‰æ‹©ä¸‰è·¯å¿«æ’è€Œéæ ‡å‡†å¿«æ’
