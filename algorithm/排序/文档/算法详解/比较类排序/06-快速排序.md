# å¿«é€Ÿæ’åº (Quick Sort)

## ğŸ“Œ æ ¸å¿ƒæ€æƒ³

**åˆ†åŒºå¾æœ**ï¼šé€‰æ‹©ä¸€ä¸ª**åŸºå‡†å…ƒç´ ï¼ˆpivotï¼‰**ï¼Œå°†æ•°ç»„åˆ†ä¸ºã€Œå°äº pivotã€å’Œã€Œå¤§äº pivotã€ä¸¤éƒ¨åˆ†ï¼Œç„¶åé€’å½’æ’åºä¸¤éƒ¨åˆ†ã€‚

> å…³é”®æ´å¯Ÿï¼šæ¯æ¬¡ partition åï¼Œpivot å°±åœ¨æœ€ç»ˆä½ç½®ã€‚å¹³å‡æƒ…å†µä¸‹ï¼Œæ¯æ¬¡åˆ†åŒºå°†é—®é¢˜è§„æ¨¡å‡åŠã€‚

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

### âœ… æ¨èä½¿ç”¨

| åœºæ™¯ | åŸå›  |
|------|------|
| é€šç”¨å†…éƒ¨æ’åº | å¹³å‡æ€§èƒ½æœ€ä¼˜ï¼Œå¸¸æ•°å› å­å° |
| å†…å­˜å—é™ | åŸåœ°æ’åºï¼Œåªéœ€ O(log n) æ ˆç©ºé—´ |
| éšæœºæ•°æ® | éšæœº pivot è¡¨ç°ä¼˜ç§€ |

### âŒ ä¸æ¨èä½¿ç”¨

| åœºæ™¯ | åŸå›  |
|------|------|
| éœ€è¦ç¨³å®šæ’åº | å¿«æ’ä¸ç¨³å®š |
| æ•°æ®å·²æœ‰åº/é€†åº | æœ€åæƒ…å†µ O(nÂ²) |
| å¤§é‡é‡å¤å…ƒç´  | æ ‡å‡†å¿«æ’æ•ˆç‡ä¸‹é™ï¼ˆç”¨ä¸‰è·¯å¿«æ’ï¼‰ |

---

## ğŸ“Š å¤æ‚åº¦åˆ†æ

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| **æœ€å¥½æ—¶é—´** | O(n log n) | æ¯æ¬¡åˆ†åŒºå‡åŒ€ |
| **å¹³å‡æ—¶é—´** | O(n log n) | æœŸæœ›æƒ…å†µ |
| **æœ€åæ—¶é—´** | O(nÂ²) | âš ï¸ æ¯æ¬¡åˆ†åŒºæä¸å‡åŒ€ |
| **ç©ºé—´å¤æ‚åº¦** | O(log n) | é€’å½’æ ˆç©ºé—´ï¼ˆå°¾é€’å½’ä¼˜åŒ–åï¼‰ |
| **ç¨³å®šæ€§** | âŒ ä¸ç¨³å®š | åˆ†åŒºæ—¶å…ƒç´ äº¤æ¢ä¼šæ‰“ä¹±ç›¸å¯¹é¡ºåº |
| **åŸåœ°æ€§** | âœ… åŸåœ° | æ— éœ€é¢å¤–æ•°ç»„ |

---

## ğŸ”„ Partition è¿‡ç¨‹ï¼ˆMermaidï¼‰

```mermaid
graph TD
    subgraph "Lomuto Partition (pivot=43)"
        A["[38, 27, 43, 3, 9, 82, 10]<br/>pivot=43, i=-1"]
        A -->|"38<43, i++, swap"| B["[38, 27, 43, 3, 9, 82, 10]<br/>i=0"]
        B -->|"27<43, i++, swap"| C["[38, 27, 43, 3, 9, 82, 10]<br/>i=1"]
        C -->|"43>=43, skip"| D["[38, 27, 43, 3, 9, 82, 10]<br/>i=1"]
        D -->|"3<43, i++, swap(43,3)"| E["[38, 27, 3, 43, 9, 82, 10]<br/>i=2"]
        E -->|"9<43, i++, swap(43,9)"| F["[38, 27, 3, 9, 43, 82, 10]<br/>i=3"]
        F -->|"82>=43, skip"| G["[38, 27, 3, 9, 43, 82, 10]<br/>i=3"]
        G -->|"10<43, i++, swap(43,10)"| H["[38, 27, 3, 9, 10, 82, 43]<br/>i=4"]
        H -->|"swap pivot"| I["[38, 27, 3, 9, 10, 43, 82]<br/>pivotåœ¨ä½ç½®5"]
    end

    style I fill:#90EE90
```

### Partition åˆ†åŒºç¤ºæ„

```mermaid
graph LR
    subgraph "åˆ†åŒºåçš„ç»“æ„"
        A["< pivot"] --> B["pivot"]
        B --> C["> pivot"]
    end

    D["é€’å½’å·¦è¾¹"] --> A
    E["é€’å½’å³è¾¹"] --> C
```

---

## ğŸ’» æ ¸å¿ƒå®ç°

### 1. åŸºç¡€ç‰ˆæœ¬ï¼ˆLomuto åˆ†åŒºï¼‰

```typescript
function quickSort<T>(arr: T[], cmp: Comparator<T>): T[] {
  const result = [...arr];
  quickSortHelper(result, 0, result.length - 1, cmp);
  return result;
}

function quickSortHelper<T>(
  arr: T[],
  low: number,
  high: number,
  cmp: Comparator<T>
): void {
  if (low >= high) return;

  const pivotIndex = partition(arr, low, high, cmp);
  quickSortHelper(arr, low, pivotIndex - 1, cmp);
  quickSortHelper(arr, pivotIndex + 1, high, cmp);
}

function partition<T>(
  arr: T[],
  low: number,
  high: number,
  cmp: Comparator<T>
): number {
  const pivot = arr[high]; // å–æœ€åä¸€ä¸ªä½œä¸º pivot
  let i = low - 1;

  for (let j = low; j < high; j++) {
    if (cmp(arr[j], pivot) < 0) {
      i++;
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];
  return i + 1;
}
```

---

## âš¡ Pivot é€‰æ‹©ç­–ç•¥

### 1. é¦–/å°¾å…ƒç´ ï¼ˆæœ€ç®€å•ï¼Œä½†æœ‰é£é™©ï¼‰

```typescript
const pivot = arr[high]; // æˆ– arr[low]
// âš ï¸ é£é™©ï¼šæœ‰åºæ•°æ®æ—¶é€€åŒ–ä¸º O(nÂ²)
```

### 2. éšæœºé€‰æ‹©ï¼ˆæ¨èï¼‰

```typescript
function randomPivotPartition<T>(
  arr: T[],
  low: number,
  high: number,
  cmp: Comparator<T>
): number {
  // éšæœºé€‰æ‹© pivotï¼Œä¸æœ«å°¾äº¤æ¢
  const randomIndex = low + Math.floor(Math.random() * (high - low + 1));
  [arr[randomIndex], arr[high]] = [arr[high], arr[randomIndex]];
  return partition(arr, low, high, cmp);
}
```

### 3. ä¸‰æ•°å–ä¸­ï¼ˆMedian-of-Threeï¼‰â­

```typescript
function medianOfThree<T>(
  arr: T[],
  low: number,
  high: number,
  cmp: Comparator<T>
): number {
  const mid = (low + high) >> 1;

  // å°† low, mid, high ä¸‰ä¸ªä½ç½®æ’åº
  if (cmp(arr[low], arr[mid]) > 0) [arr[low], arr[mid]] = [arr[mid], arr[low]];
  if (cmp(arr[low], arr[high]) > 0) [arr[low], arr[high]] = [arr[high], arr[low]];
  if (cmp(arr[mid], arr[high]) > 0) [arr[mid], arr[high]] = [arr[high], arr[mid]];

  // å°†ä¸­å€¼ç§»åˆ° high-1 ä½ç½®
  [arr[mid], arr[high - 1]] = [arr[high - 1], arr[mid]];
  return high - 1;
}
```

> **ä¸‰æ•°å–ä¸­**èƒ½æœ‰æ•ˆé¿å…æœ‰åº/é€†åºæ•°æ®çš„æœ€åæƒ…å†µã€‚

---

## ğŸ”§ å°¾é€’å½’ä¼˜åŒ–

```typescript
function quickSortTailOptimized<T>(
  arr: T[],
  low: number,
  high: number,
  cmp: Comparator<T>
): void {
  while (low < high) {
    const pivotIndex = partition(arr, low, high, cmp);

    // å…ˆé€’å½’è¾ƒå°çš„åˆ†åŒºï¼Œè¾ƒå¤§çš„ç”¨å¾ªç¯å¤„ç†
    if (pivotIndex - low < high - pivotIndex) {
      quickSortTailOptimized(arr, low, pivotIndex - 1, cmp);
      low = pivotIndex + 1; // å°¾é€’å½’ä¼˜åŒ–ï¼šç”¨å¾ªç¯ä»£æ›¿é€’å½’
    } else {
      quickSortTailOptimized(arr, pivotIndex + 1, high, cmp);
      high = pivotIndex - 1;
    }
  }
}
```

> **ä¼˜åŒ–æ•ˆæœ**ï¼šæœ€åæƒ…å†µä¸‹æ ˆæ·±åº¦ä» O(n) é™åˆ° O(log n)ã€‚

---

## âš ï¸ æœ€åæƒ…å†µåˆ†æä¸è§„é¿

### æœ€åæƒ…å†µè§¦å‘æ¡ä»¶

| æ¡ä»¶ | ç¤ºä¾‹ | åæœ |
|------|------|------|
| å·²æ’åº + å–é¦–/å°¾å…ƒç´  | `[1,2,3,4,5]` | O(nÂ²) |
| å®Œå…¨é€†åº + å–é¦–/å°¾å…ƒç´  | `[5,4,3,2,1]` | O(nÂ²) |
| å¤§é‡é‡å¤å…ƒç´  | `[1,1,1,1,1]` | O(nÂ²)ï¼ˆæ ‡å‡†ç‰ˆï¼‰ |

### è§„é¿ç­–ç•¥

```typescript
// ç»„åˆç­–ç•¥ï¼šéšæœº + ä¸‰æ•°å–ä¸­ + å°¾é€’å½’ + å°æ•°ç»„æ’å…¥
function robustQuickSort<T>(arr: T[], cmp: Comparator<T>): T[] {
  const result = [...arr];
  robustHelper(result, 0, result.length - 1, cmp);
  return result;
}

function robustHelper<T>(
  arr: T[],
  low: number,
  high: number,
  cmp: Comparator<T>
): void {
  const INSERTION_THRESHOLD = 16;

  while (low < high) {
    // å°æ•°ç»„ç”¨æ’å…¥æ’åº
    if (high - low < INSERTION_THRESHOLD) {
      insertionSortRange(arr, low, high, cmp);
      return;
    }

    // ä¸‰æ•°å–ä¸­ + åˆ†åŒº
    const pivotIndex = medianOfThreePartition(arr, low, high, cmp);

    // å°¾é€’å½’ä¼˜åŒ–
    if (pivotIndex - low < high - pivotIndex) {
      robustHelper(arr, low, pivotIndex - 1, cmp);
      low = pivotIndex + 1;
    } else {
      robustHelper(arr, pivotIndex + 1, high, cmp);
      high = pivotIndex - 1;
    }
  }
}
```

---

## ğŸ†š Lomuto vs Hoare åˆ†åŒº

| åˆ†åŒºæ–¹å¼ | Lomuto | Hoare |
|----------|--------|-------|
| ç†è§£éš¾åº¦ | ç®€å• | ä¸­ç­‰ |
| äº¤æ¢æ¬¡æ•° | å¤šï¼ˆ3xï¼‰ | å°‘ |
| ç­‰å€¼å…ƒç´ å¤„ç† | ä¸ä½³ | è¾ƒå¥½ |
| ä»£ç é‡ | å°‘ | å¤š |
| å¸¸è§ç”¨é€” | æ•™å­¦ | ç”Ÿäº§ |

### Hoare åˆ†åŒºå®ç°

```typescript
function hoarePartition<T>(
  arr: T[],
  low: number,
  high: number,
  cmp: Comparator<T>
): number {
  const pivot = arr[(low + high) >> 1];
  let i = low - 1;
  let j = high + 1;

  while (true) {
    do { i++; } while (cmp(arr[i], pivot) < 0);
    do { j--; } while (cmp(arr[j], pivot) > 0);

    if (i >= j) return j;
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}
```

---

## ğŸŒ å‰ç«¯ä¸šåŠ¡åœºæ™¯

### 1. å®æ—¶æ•°æ®æ’åº

```typescript
// ä½å»¶è¿Ÿæ’åºï¼ˆå¦‚æ¸¸æˆæ’è¡Œæ¦œï¼‰
function realTimeSort<T>(data: T[], cmp: Comparator<T>): T[] {
  // å¿«æ’åŸåœ°æ’åºï¼Œæ— éœ€é¢å¤–å†…å­˜åˆ†é…
  return quickSortInPlace([...data], cmp);
}
```

### 2. ä¸ Array.sort å¯¹æ¯”

```typescript
// æµè§ˆå™¨ Array.sort é€šå¸¸ä½¿ç”¨ TimSortï¼ˆç¨³å®šï¼‰
// ä½†æŸäº›åœºæ™¯å¿«æ’æ›´å¿«ï¼ˆçº¯æ•°å­—ã€æ— ç¨³å®šæ€§éœ€æ±‚ï¼‰
const numbers = Array.from({ length: 100000 }, () => Math.random());

console.time('Array.sort');
numbers.slice().sort((a, b) => a - b);
console.timeEnd('Array.sort');

console.time('quickSort');
quickSort(numbers, (a, b) => a - b);
console.timeEnd('quickSort');
```

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

1. **ä¸‰è·¯å¿«æ’**ï¼šå¤„ç†å¤§é‡é‡å¤å…ƒç´ ï¼ˆè¯¦è§ 09-ä¸‰è·¯å¿«æ’.mdï¼‰
2. **Introsort**ï¼šå¿«æ’ + å †æ’ + æ’å…¥çš„æ··åˆç®—æ³•ï¼ˆè¯¦è§ 10-Introsort.mdï¼‰
3. **Dual-Pivot Quicksort**ï¼šJava 7+ çš„é»˜è®¤æ’åº
4. **å¿«é€Ÿé€‰æ‹©ï¼ˆQuickSelectï¼‰**ï¼šO(n) æ‰¾ç¬¬ K å¤§ï¼ˆè¯¦è§ 08-å¿«é€Ÿé€‰æ‹©.mdï¼‰

---

## âœ… è‡ªæ£€æ¸…å•

- [ ] èƒ½æ‰‹å†™ Lomuto å’Œ Hoare ä¸¤ç§åˆ†åŒº
- [ ] ç†è§£ pivot é€‰æ‹©å¯¹æ€§èƒ½çš„å½±å“
- [ ] èƒ½å®ç°ä¸‰æ•°å–ä¸­ç­–ç•¥
- [ ] èƒ½è§£é‡Šæœ€åæƒ…å†µä½•æ—¶å‘ç”ŸåŠå¦‚ä½•è§„é¿
- [ ] èƒ½å®ç°å°¾é€’å½’ä¼˜åŒ–
- [ ] çŸ¥é“ä¸ºä»€ä¹ˆå¿«æ’ä¸ç¨³å®š
- [ ] èƒ½è¯´æ˜å¿«æ’ä¸å½’å¹¶çš„ trade-off

