# å½’å¹¶æ’åº (Merge Sort)

## ğŸ“Œ æ ¸å¿ƒæ€æƒ³

**åˆ†è€Œæ²»ä¹‹**ï¼šå°†æ•°ç»„ä¸æ–­äºŒåˆ†ï¼Œç›´åˆ°æ¯ä¸ªå­æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼ˆå¤©ç„¶æœ‰åºï¼‰ï¼Œç„¶åé€å±‚**åˆå¹¶**ä¸¤ä¸ªæœ‰åºæ•°ç»„ã€‚

> å…³é”®æ´å¯Ÿï¼šåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œè€Œåˆ†æ²»çš„å±‚æ•°æ˜¯ O(log n)ï¼Œæ‰€ä»¥æ€»å¤æ‚åº¦æ˜¯ O(n log n)ã€‚

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

### âœ… æ¨èä½¿ç”¨

| åœºæ™¯ | åŸå›  |
|------|------|
| éœ€è¦ç¨³å®šæ’åº | å½’å¹¶æ˜¯ç¨³å®šçš„ O(n log n) ç®—æ³• |
| é“¾è¡¨æ’åº | é“¾è¡¨å½’å¹¶æ— éœ€é¢å¤–ç©ºé—´ï¼Œä¸”åˆå¹¶æ“ä½œé«˜æ•ˆ |
| å¤–éƒ¨æ’åº | å¤§æ–‡ä»¶åˆ†å—æ’åºå†åˆå¹¶ |
| å¹¶è¡Œè®¡ç®— | åˆ†æ²»å¤©ç„¶é€‚åˆå¹¶è¡Œ |

### âŒ ä¸æ¨èä½¿ç”¨

| åœºæ™¯ | åŸå›  |
|------|------|
| å†…å­˜å—é™ | éœ€è¦ O(n) è¾…åŠ©ç©ºé—´ |
| å°è§„æ¨¡æ•°æ® | å¸¸æ•°å› å­å¤§ï¼Œä¸å¦‚æ’å…¥æ’åº |

---

## ğŸ“Š å¤æ‚åº¦åˆ†æ

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| **æœ€å¥½æ—¶é—´** | O(n log n) | æ— è®ºæ•°æ®åˆ†å¸ƒå¦‚ä½• |
| **å¹³å‡æ—¶é—´** | O(n log n) | ç¨³å®šçš„æ€§èƒ½ |
| **æœ€åæ—¶é—´** | O(n log n) | â­ ä¸ä¼šé€€åŒ– |
| **ç©ºé—´å¤æ‚åº¦** | O(n) | éœ€è¦è¾…åŠ©æ•°ç»„ï¼ˆé€’å½’ç‰ˆè¿˜æœ‰æ ˆç©ºé—´ O(log n)ï¼‰ |
| **ç¨³å®šæ€§** | âœ… ç¨³å®š | åˆå¹¶æ—¶ç›¸ç­‰å…ƒç´ ä¿æŒåŸé¡ºåº |
| **åŸåœ°æ€§** | âŒ éåŸåœ° | éœ€è¦é¢å¤–ç©ºé—´ |

---

## ğŸ”„ ç®—æ³•æµç¨‹ï¼ˆMermaidï¼‰

```mermaid
graph TD
    subgraph "åˆ†æ²»è¿‡ç¨‹ (Divide)"
        A["[38, 27, 43, 3, 9, 82, 10]"] --> B["[38, 27, 43, 3]"]
        A --> C["[9, 82, 10]"]
        B --> D["[38, 27]"]
        B --> E["[43, 3]"]
        C --> F["[9, 82]"]
        C --> G["[10]"]
        D --> H["[38]"]
        D --> I["[27]"]
        E --> J["[43]"]
        E --> K["[3]"]
        F --> L["[9]"]
        F --> M["[82]"]
    end

    subgraph "åˆå¹¶è¿‡ç¨‹ (Merge)"
        H --> N["[27, 38]"]
        I --> N
        J --> O["[3, 43]"]
        K --> O
        L --> P["[9, 82]"]
        M --> P
        G --> Q["[10]"]
        N --> R["[3, 27, 38, 43]"]
        O --> R
        P --> S["[9, 10, 82]"]
        Q --> S
        R --> T["[3, 9, 10, 27, 38, 43, 82]"]
        S --> T
    end

    style T fill:#90EE90
```

### åˆå¹¶è¿‡ç¨‹è¯¦è§£

```mermaid
graph LR
    subgraph "åˆå¹¶ [27, 38] å’Œ [3, 43]"
        A["å·¦: [27, 38]<br/>å³: [3, 43]<br/>ç»“æœ: []"]
        A -->|"3 < 27"| B["å·¦: [27, 38]<br/>å³: [43]<br/>ç»“æœ: [3]"]
        B -->|"27 < 43"| C["å·¦: [38]<br/>å³: [43]<br/>ç»“æœ: [3, 27]"]
        C -->|"38 < 43"| D["å·¦: []<br/>å³: [43]<br/>ç»“æœ: [3, 27, 38]"]
        D -->|"å·¦ç©º,å–å³"| E["ç»“æœ: [3, 27, 38, 43]"]
    end
```

---

## ğŸ’» ä¸¤ç§å®ç°æ–¹å¼

### 1. é€’å½’ç‰ˆï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰

```typescript
function mergeSortRecursive<T>(arr: T[], cmp: Comparator<T>): T[] {
  if (arr.length <= 1) return [...arr];

  const mid = arr.length >> 1;
  const left = mergeSortRecursive(arr.slice(0, mid), cmp);
  const right = mergeSortRecursive(arr.slice(mid), cmp);

  return merge(left, right, cmp);
}

function merge<T>(left: T[], right: T[], cmp: Comparator<T>): T[] {
  const result: T[] = [];
  let i = 0, j = 0;

  while (i < left.length && j < right.length) {
    // âš ï¸ <= ä¿è¯ç¨³å®šæ€§ï¼ˆç›¸ç­‰æ—¶å–å·¦è¾¹ï¼‰
    if (cmp(left[i], right[j]) <= 0) {
      result.push(left[i++]);
    } else {
      result.push(right[j++]);
    }
  }

  // åˆå¹¶å‰©ä½™
  return result.concat(left.slice(i), right.slice(j));
}
```

### 2. è¿­ä»£ç‰ˆï¼ˆè‡ªåº•å‘ä¸Šï¼‰

```typescript
function mergeSortIterative<T>(arr: T[], cmp: Comparator<T>): T[] {
  const n = arr.length;
  if (n <= 1) return [...arr];

  const result = [...arr];
  const aux = new Array(n);

  // ä» size=1 å¼€å§‹ï¼Œæ¯æ¬¡ç¿»å€
  for (let size = 1; size < n; size *= 2) {
    // éå†æ‰€æœ‰ç›¸é‚»çš„ size å—
    for (let left = 0; left < n - size; left += 2 * size) {
      const mid = left + size;
      const right = Math.min(left + 2 * size, n);
      mergeInPlace(result, aux, left, mid, right, cmp);
    }
  }

  return result;
}
```

> **è¿­ä»£ç‰ˆä¼˜åŠ¿**ï¼šæ— é€’å½’æ ˆå¼€é”€ï¼Œæ›´é€‚åˆè¶…å¤§æ•°ç»„ï¼›**åŠ£åŠ¿**ï¼šä»£ç ç¨å¤æ‚ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç¨³å®šæ€§ä¿è¯

```typescript
// âœ… æ­£ç¡®ï¼šç›¸ç­‰æ—¶å–å·¦è¾¹å…ƒç´ 
if (cmp(left[i], right[j]) <= 0) {
  result.push(left[i++]);
}

// âŒ é”™è¯¯ï¼šç›¸ç­‰æ—¶å¯èƒ½å–å³è¾¹ï¼Œç ´åç¨³å®šæ€§
if (cmp(left[i], right[j]) < 0) {
  result.push(left[i++]);
}
```

### 2. è¾…åŠ©ç©ºé—´ä¼˜åŒ–

```typescript
// æ–¹æ¡ˆ 1ï¼šä¸€æ¬¡æ€§åˆ†é…ï¼Œé¿å…é‡å¤åˆ›å»º
const aux = new Array(arr.length);

// æ–¹æ¡ˆ 2ï¼šäº¤æ›¿ä½¿ç”¨ä¸¤ä¸ªæ•°ç»„ï¼ˆå‡å°‘æ‹·è´ï¼‰
let src = [...arr];
let dst = new Array(arr.length);
for (let size = 1; size < n; size *= 2) {
  // åˆå¹¶ src â†’ dst
  [src, dst] = [dst, src]; // äº¤æ¢è§’è‰²
}
```

### 3. å°æ•°ç»„ä¼˜åŒ–

```typescript
// å½“å­æ•°ç»„è¶³å¤Ÿå°æ—¶ï¼Œåˆ‡æ¢åˆ°æ’å…¥æ’åº
const INSERTION_THRESHOLD = 16;

function optimizedMergeSort<T>(arr: T[], cmp: Comparator<T>): T[] {
  if (arr.length <= INSERTION_THRESHOLD) {
    return insertionSort(arr, cmp);
  }
  // ... å½’å¹¶é€»è¾‘
}
```

---

## ğŸŒ å‰ç«¯ä¸šåŠ¡åœºæ™¯

### 1. ç¨³å®šæ’åºè¡¨æ ¼æ•°æ®

```typescript
// ç”¨æˆ·å…ˆæŒ‰"éƒ¨é—¨"æ’åºï¼Œå†æŒ‰"å…¥èŒæ—¶é—´"æ’åº
// å¸Œæœ›åŒå…¥èŒæ—¶é—´çš„å‘˜å·¥ä¿æŒä¹‹å‰çš„éƒ¨é—¨é¡ºåº
const employees = [
  { name: 'Alice', dept: 'HR', joinDate: '2023-01' },
  { name: 'Bob', dept: 'Dev', joinDate: '2023-01' },
  { name: 'Carol', dept: 'HR', joinDate: '2023-02' },
];

// ç¬¬ä¸€æ¬¡ï¼šæŒ‰éƒ¨é—¨æ’åº
mergeSort(employees, (a, b) => a.dept.localeCompare(b.dept));

// ç¬¬äºŒæ¬¡ï¼šæŒ‰å…¥èŒæ—¶é—´æ’åºï¼ˆä¿æŒéƒ¨é—¨é¡ºåºï¼‰
mergeSort(employees, (a, b) => a.joinDate.localeCompare(b.joinDate));
```

### 2. åˆå¹¶å¤šä¸ªæœ‰åºæ•°æ®æº

```typescript
// åˆå¹¶å¤šä¸ªåˆ†é¡µ API è¿”å›çš„æœ‰åºç»“æœ
async function mergePagedResults<T>(
  pages: T[][],
  cmp: Comparator<T>
): Promise<T[]> {
  // ä¸¤ä¸¤åˆå¹¶
  while (pages.length > 1) {
    const newPages: T[][] = [];
    for (let i = 0; i < pages.length; i += 2) {
      if (i + 1 < pages.length) {
        newPages.push(merge(pages[i], pages[i + 1], cmp));
      } else {
        newPages.push(pages[i]);
      }
    }
    pages = newPages;
  }
  return pages[0] || [];
}
```

---

## ğŸ†š ä¸å…¶ä»–ç®—æ³•å¯¹æ¯”

| ç®—æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | ç¨³å®šæ€§ | ç‰¹ç‚¹ |
|------|-----------|-----------|--------|------|
| **å½’å¹¶æ’åº** | O(n log n) | O(n) | âœ… ç¨³å®š | æ€§èƒ½ç¨³å®šï¼Œé€‚åˆé“¾è¡¨/å¤–éƒ¨æ’åº |
| å¿«é€Ÿæ’åº | O(n log n) å¹³å‡ | O(log n) | âŒ ä¸ç¨³å®š | åŸåœ°æ’åºï¼Œå¸¸æ•°å› å­å° |
| å †æ’åº | O(n log n) | O(1) | âŒ ä¸ç¨³å®š | åŸåœ°æ’åºï¼Œæ€§èƒ½ç¨³å®š |

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

1. **é“¾è¡¨å½’å¹¶æ’åº**ï¼šç©ºé—´å¤æ‚åº¦å¯è¾¾ O(1)
2. **è‡ªç„¶å½’å¹¶æ’åº**ï¼šåˆ©ç”¨å·²æœ‰çš„æœ‰åº run
3. **TimSort**ï¼šå½’å¹¶ + æ’å…¥çš„å·¥ä¸šçº§å®ç°ï¼ˆPython/Java é»˜è®¤ï¼‰
4. **å¤šè·¯å½’å¹¶**ï¼šå¤–éƒ¨æ’åºçš„æ ¸å¿ƒæŠ€æœ¯

---

## âœ… è‡ªæ£€æ¸…å•

- [ ] èƒ½æ‰‹å†™é€’å½’ç‰ˆå’Œè¿­ä»£ç‰ˆ
- [ ] ç†è§£ç¨³å®šæ€§æ˜¯å¦‚ä½•ä¿è¯çš„ï¼ˆ`<=` vs `<`ï¼‰
- [ ] çŸ¥é“ç©ºé—´å¤æ‚åº¦ä¸ºä½•æ˜¯ O(n)
- [ ] èƒ½è§£é‡Šä¸ºä»€ä¹ˆé€‚åˆå¤–éƒ¨æ’åºå’Œé“¾è¡¨æ’åº
- [ ] èƒ½å®ç°å°æ•°ç»„ä¼˜åŒ–ï¼ˆåˆ‡æ¢åˆ°æ’å…¥æ’åºï¼‰

