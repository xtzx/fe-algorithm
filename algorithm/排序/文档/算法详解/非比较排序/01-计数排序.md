# è®¡æ•°æ’åº (Counting Sort)

## ğŸ“Œ æ ¸å¿ƒæ€æƒ³

**ä¸æ¯”è¾ƒå…ƒç´ å¤§å°**ï¼Œè€Œæ˜¯ç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œç„¶åæ ¹æ®æ¬¡æ•°è¿˜åŸæœ‰åºåºåˆ—ã€‚

> å…³é”®æ´å¯Ÿï¼šå¦‚æœçŸ¥é“æœ‰å¤šå°‘ä¸ªå…ƒç´ æ¯”å½“å‰å…ƒç´ å°ï¼Œå°±çŸ¥é“å®ƒåº”è¯¥åœ¨å“ªä¸ªä½ç½®ã€‚

---

## ğŸš¨ é€‚ç”¨è¾¹ç•Œï¼ˆå¿…é¡»æ»¡è¶³ï¼‰

| æ¡ä»¶ | è¦æ±‚ | åŸå›  |
|------|------|------|
| **æ•°æ®ç±»å‹** | æ•´æ•°ï¼ˆå¯ç¦»æ•£åŒ–ï¼‰ | éœ€è¦ä½œä¸ºæ•°ç»„ç´¢å¼• |
| **å€¼åŸŸèŒƒå›´** | è¾ƒå°ï¼ˆk ä¸è¿œå¤§äº nï¼‰ | ç©ºé—´ O(k)ï¼Œå¤ªå¤§æµªè´¹ |
| **éè´Ÿ** | æœ€å¥½éè´Ÿæˆ–åšåç§» | è´Ÿæ•°éœ€è¦åç§»å¤„ç† |

### âš ï¸ ä»€ä¹ˆæ—¶å€™åˆ«ç”¨

- æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ï¼ˆé™¤éç¦»æ•£åŒ–ï¼‰
- å€¼åŸŸæå¤§ï¼ˆå¦‚ 0~10^9ï¼‰
- åªæœ‰å‡ ä¸ªå…ƒç´ ä½†å€¼åŸŸå¾ˆå¤§

---

## ğŸ¯ åœºæ™¯è¯†åˆ«ä¿¡å·

| ä¿¡å· | æ¨èåº¦ |
|------|-------|
| å°èŒƒå›´æ•´æ•°ï¼ˆå¦‚å¹´é¾„ 0-150ã€åˆ†æ•° 0-100ï¼‰ | â­â­â­â­â­ |
| æšä¸¾å€¼/çŠ¶æ€ç æ’åº | â­â­â­â­ |
| éœ€è¦ç¨³å®šæ’åºçš„æ•´æ•°æ•°æ® | â­â­â­â­ |
| å€¼åŸŸè¿œå¤§äºæ•°æ®é‡ | âŒ ä¸æ¨è |

---

## ğŸ“Š å¤æ‚åº¦åˆ†æ

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| **æ—¶é—´å¤æ‚åº¦** | O(n + k) | n æ˜¯å…ƒç´ æ•°ï¼Œk æ˜¯å€¼åŸŸ |
| **ç©ºé—´å¤æ‚åº¦** | O(n + k) | è®¡æ•°æ•°ç»„ + è¾“å‡ºæ•°ç»„ |
| **ç¨³å®šæ€§** | âœ… ç¨³å®š | ä»åå¾€å‰å›å¡« |

---

## ğŸ”„ ç®—æ³•æµç¨‹ï¼ˆMermaidï¼‰

```mermaid
flowchart TD
    A["è¾“å…¥: [4, 2, 2, 8, 3, 3, 1]"] --> B["1. ç»Ÿè®¡è®¡æ•°"]
    B --> C["count = [0, 1, 2, 2, 1, 0, 0, 0, 1]<br/>ç´¢å¼•0-8å¯¹åº”å€¼0-8"]
    C --> D["2. è®¡ç®—å‰ç¼€å’Œ"]
    D --> E["count = [0, 1, 3, 5, 6, 6, 6, 6, 7]<br/>è¡¨ç¤º â‰¤è¯¥å€¼ çš„å…ƒç´ ä¸ªæ•°"]
    E --> F["3. ä»åå¾€å‰å›å¡«ï¼ˆä¿è¯ç¨³å®šï¼‰"]
    F --> G["è¾“å‡º: [1, 2, 2, 3, 3, 4, 8]"]

    style G fill:#90EE90
```

### å›å¡«è¿‡ç¨‹è¯¦è§£

```mermaid
sequenceDiagram
    participant Input as è¾“å…¥ [4,2,2,8,3,3,1]
    participant Count as å‰ç¼€å’Œ count[]
    participant Output as è¾“å‡ºæ•°ç»„

    Note over Input: ä»åå¾€å‰éå†
    Input->>Count: arr[6]=1, count[1]=1
    Count->>Output: output[0] = 1
    Count-->>Count: count[1]-- â†’ 0

    Input->>Count: arr[5]=3, count[3]=5
    Count->>Output: output[4] = 3
    Count-->>Count: count[3]-- â†’ 4

    Note over Output: ç»§ç»­å¤„ç†å‰©ä½™å…ƒç´ ...
```

---

## ğŸ’» æ ¸å¿ƒå®ç°

```typescript
/**
 * è®¡æ•°æ’åºï¼ˆç¨³å®šç‰ˆï¼‰
 *
 * @param arr å¾…æ’åºæ•°ç»„
 * @param min å€¼åŸŸæœ€å°å€¼
 * @param max å€¼åŸŸæœ€å¤§å€¼
 * @returns æ’åºåçš„æ–°æ•°ç»„
 */
export function countingSort(
  arr: readonly number[],
  min: number,
  max: number
): number[] {
  // è¾“å…¥æ ¡éªŒ
  if (min > max) throw new Error('min > max');

  const n = arr.length;
  if (n === 0) return [];

  const range = max - min + 1;
  const count = new Array(range).fill(0);
  const output = new Array(n);

  // 1. ç»Ÿè®¡è®¡æ•°
  for (const num of arr) {
    if (num < min || num > max) {
      throw new Error(`å€¼ ${num} è¶…å‡ºèŒƒå›´ [${min}, ${max}]`);
    }
    count[num - min]++;
  }

  // 2. è®¡ç®—å‰ç¼€å’Œï¼ˆç´¯ç§¯è®¡æ•°ï¼‰
  for (let i = 1; i < range; i++) {
    count[i] += count[i - 1];
  }

  // 3. ä»åå¾€å‰å›å¡«ï¼ˆä¿è¯ç¨³å®šæ€§ï¼‰
  for (let i = n - 1; i >= 0; i--) {
    const idx = arr[i] - min;
    output[count[idx] - 1] = arr[i];
    count[idx]--;
  }

  return output;
}
```

---

## âœ… ç¨³å®šæ€§ä¿è¯

**ä»åå¾€å‰å›å¡«**æ˜¯ç¨³å®šæ€§çš„å…³é”®ï¼š

```typescript
// âœ… ç¨³å®šï¼šä»åå¾€å‰
for (let i = n - 1; i >= 0; i--) {
  output[--count[arr[i] - min]] = arr[i];
}

// âŒ ä¸ç¨³å®šï¼šä»å‰å¾€å
for (let i = 0; i < n; i++) {
  output[--count[arr[i] - min]] = arr[i];
}
```

åŸç†ï¼šç›¸åŒå€¼çš„å…ƒç´ ï¼Œåå‡ºç°çš„æ”¾åœ¨åé¢çš„ä½ç½®ï¼Œä¿æŒåŸé¡ºåºã€‚

---

## ğŸ”§ å˜ç§ä¸ä¼˜åŒ–

### 1. è‡ªåŠ¨æ£€æµ‹èŒƒå›´

```typescript
export function countingSortAuto(arr: readonly number[]): number[] {
  if (arr.length === 0) return [];

  let min = arr[0], max = arr[0];
  for (const num of arr) {
    if (num < min) min = num;
    if (num > max) max = num;
  }

  return countingSort(arr, min, max);
}
```

### 2. å¯¹è±¡æ’åºï¼ˆæŒ‰æ•´æ•°å­—æ®µï¼‰

```typescript
export function countingSortBy<T>(
  arr: readonly T[],
  keyFn: (item: T) => number,
  min: number,
  max: number
): T[] {
  const n = arr.length;
  if (n === 0) return [];

  const range = max - min + 1;
  const count = new Array(range).fill(0);
  const output = new Array(n);

  // æŒ‰ key è®¡æ•°
  for (const item of arr) {
    count[keyFn(item) - min]++;
  }

  // å‰ç¼€å’Œ
  for (let i = 1; i < range; i++) {
    count[i] += count[i - 1];
  }

  // å›å¡«
  for (let i = n - 1; i >= 0; i--) {
    const idx = keyFn(arr[i]) - min;
    output[count[idx] - 1] = arr[i];
    count[idx]--;
  }

  return output;
}
```

---

## ğŸŒ å‰ç«¯ä¸šåŠ¡åœºæ™¯

### 1. åˆ†æ•°/å¹´é¾„æ’åº

```typescript
interface Student {
  name: string;
  score: number; // 0-100
}

const students: Student[] = [
  { name: 'Alice', score: 85 },
  { name: 'Bob', score: 92 },
  { name: 'Charlie', score: 85 },
];

// æŒ‰åˆ†æ•°æ’åºï¼ˆç¨³å®šï¼ŒåŒåˆ†ä¿æŒåŸé¡ºåºï¼‰
const sorted = countingSortBy(
  students,
  s => s.score,
  0, 100
);
```

### 2. çŠ¶æ€ç æ’åº

```typescript
type Status = 0 | 1 | 2 | 3; // pending, processing, completed, failed

interface Task {
  id: string;
  status: Status;
}

// åªæœ‰ 4 ç§çŠ¶æ€ï¼Œè®¡æ•°æ’åºæœ€ä¼˜
const sorted = countingSortBy(tasks, t => t.status, 0, 3);
```

---

## ğŸ†š ä¸å…¶ä»–æ’åºå¯¹æ¯”

| ç®—æ³• | æ—¶é—´ | ç©ºé—´ | ç¨³å®š | é€‚ç”¨æ¡ä»¶ |
|------|------|------|------|---------|
| **è®¡æ•°æ’åº** | O(n+k) | O(n+k) | âœ… | å°èŒƒå›´æ•´æ•° |
| åŸºæ•°æ’åº | O(dÂ·n) | O(n+k) | âœ… | æ•´æ•°/å®šé•¿å­—ç¬¦ä¸² |
| å½’å¹¶æ’åº | O(n log n) | O(n) | âœ… | é€šç”¨ |
| å¿«é€Ÿæ’åº | O(n log n) | O(log n) | âŒ | é€šç”¨ |

---

## âœ… è‡ªæ£€æ¸…å•

- [ ] ç†è§£è®¡æ•°ã€å‰ç¼€å’Œã€å›å¡«ä¸‰ä¸ªæ­¥éª¤
- [ ] çŸ¥é“ä¸ºä»€ä¹ˆä»åå¾€å‰å›å¡«èƒ½ä¿è¯ç¨³å®šæ€§
- [ ] èƒ½åˆ†ææ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ O(n+k)
- [ ] çŸ¥é“å€¼åŸŸ k è¿‡å¤§æ—¶ä¸é€‚åˆç”¨è®¡æ•°æ’åº
- [ ] èƒ½å®ç°å¯¹è±¡æŒ‰æ•´æ•°å­—æ®µæ’åºçš„ç‰ˆæœ¬

