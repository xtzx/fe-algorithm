# æ¡¶æ’åº (Bucket Sort)

## ğŸ“Œ æ ¸å¿ƒæ€æƒ³

å°†å…ƒç´ **åˆ†æ•£åˆ°å¤šä¸ªæ¡¶**ä¸­ï¼Œæ¯ä¸ªæ¡¶å†…éƒ¨æ’åºï¼Œæœ€åæŒ‰é¡ºåºåˆå¹¶æ‰€æœ‰æ¡¶ã€‚

> å…³é”®æ´å¯Ÿï¼šå¦‚æœæ•°æ®åˆ†å¸ƒå‡åŒ€ï¼Œæ¯ä¸ªæ¡¶çš„å…ƒç´ å¾ˆå°‘ï¼Œæ¡¶å†…æ’åºå¾ˆå¿«ã€‚

---

## ğŸš¨ é€‚ç”¨è¾¹ç•Œï¼ˆå¿…é¡»æ»¡è¶³ï¼‰

| æ¡ä»¶ | è¦æ±‚ | åŸå›  |
|------|------|------|
| **æ•°æ®åˆ†å¸ƒ** | å°½é‡å‡åŒ€ | ä¸å‡åŒ€ä¼šå¯¼è‡´æŸæ¡¶è¿‡å¤§ |
| **å¯æ˜ å°„** | èƒ½æ˜ å°„åˆ°æ¡¶ç´¢å¼• | éœ€è¦ç¡®å®šå…ƒç´ å½’å± |
| **æ¡¶æ•°é‡** | åˆç†ï¼ˆé€šå¸¸ n ä¸ªæ¡¶ï¼‰ | å¤ªå°‘é€€åŒ–ï¼Œå¤ªå¤šæµªè´¹ |

### âš ï¸ ä»€ä¹ˆæ—¶å€™åˆ«ç”¨

- æ•°æ®åˆ†å¸ƒæä¸å‡åŒ€
- æ— æ³•ç¡®å®šåˆç†çš„æ˜ å°„å‡½æ•°
- æ•°æ®é‡å¾ˆå°ï¼ˆç›´æ¥ç”¨æ¯”è¾ƒæ’åºï¼‰

---

## ğŸ¯ åœºæ™¯è¯†åˆ«ä¿¡å·

| ä¿¡å· | æ¨èåº¦ |
|------|-------|
| å‡åŒ€åˆ†å¸ƒçš„æµ®ç‚¹æ•°ï¼ˆå¦‚ 0-1 èŒƒå›´ï¼‰ | â­â­â­â­â­ |
| å¯é¢„çŸ¥åˆ†å¸ƒçš„æ•°æ® | â­â­â­â­ |
| å¤§é‡æ•°æ®éœ€è¦åˆ†å¸ƒå¼æ’åº | â­â­â­â­ |
| åˆ†å¸ƒæœªçŸ¥/æä¸å‡åŒ€ | âŒ ä¸æ¨è |

---

## ğŸ“Š å¤æ‚åº¦åˆ†æ

| æŒ‡æ ‡ | æœ€å¥½æƒ…å†µ | å¹³å‡æƒ…å†µ | æœ€åæƒ…å†µ |
|------|---------|---------|---------|
| **æ—¶é—´** | O(n) | O(n + k + nÂ²/k) | O(nÂ²) |
| **ç©ºé—´** | O(n + k) | O(n + k) | O(n + k) |

> å½“ k â‰ˆ n ä¸”åˆ†å¸ƒå‡åŒ€æ—¶ï¼Œå¹³å‡ O(n)ã€‚

---

## ğŸ”„ ç®—æ³•æµç¨‹ï¼ˆMermaidï¼‰

```mermaid
flowchart TD
    A["è¾“å…¥: [0.78, 0.17, 0.39, 0.26, 0.72, 0.94, 0.21, 0.12, 0.23, 0.68]"]
    A --> B["1. åˆ›å»º n ä¸ªæ¡¶"]
    B --> C["2. åˆ†é…å…ƒç´ åˆ°æ¡¶<br/>æ¡¶ç´¢å¼• = floor(value Ã— n)"]

    subgraph "åˆ†é…åçš„æ¡¶"
        D0["æ¡¶0: [0.17, 0.12]"]
        D1["æ¡¶1: []"]
        D2["æ¡¶2: [0.39, 0.26, 0.21, 0.23]"]
        D3["æ¡¶3: []"]
        D6["æ¡¶6: [0.68]"]
        D7["æ¡¶7: [0.78, 0.72]"]
        D9["æ¡¶9: [0.94]"]
    end

    C --> D0
    C --> D1
    C --> D2
    C --> D6
    C --> D7
    C --> D9

    D0 --> E["3. æ¡¶å†…æ’åº"]
    D2 --> E
    D7 --> E

    E --> F["4. åˆå¹¶æ‰€æœ‰æ¡¶"]
    F --> G["è¾“å‡º: [0.12, 0.17, 0.21, 0.23, 0.26, 0.39, 0.68, 0.72, 0.78, 0.94]"]

    style G fill:#90EE90
```

---

## ğŸ’» æ ¸å¿ƒå®ç°

```typescript
/**
 * æ¡¶æ’åºï¼ˆ0-1 èŒƒå›´çš„æµ®ç‚¹æ•°ï¼‰
 */
export function bucketSort(arr: readonly number[]): number[] {
  const n = arr.length;
  if (n <= 1) return [...arr];

  // åˆ›å»º n ä¸ªæ¡¶
  const buckets: number[][] = Array.from({ length: n }, () => []);

  // åˆ†é…åˆ°æ¡¶
  for (const num of arr) {
    if (num < 0 || num >= 1) {
      throw new Error(`å€¼ ${num} ä¸åœ¨ [0, 1) èŒƒå›´å†…`);
    }
    const bucketIdx = Math.floor(num * n);
    buckets[bucketIdx].push(num);
  }

  // æ¡¶å†…æ’åºï¼ˆä½¿ç”¨æ’å…¥æ’åºï¼Œå› ä¸ºæ¡¶å†…å…ƒç´ å°‘ï¼‰
  for (const bucket of buckets) {
    insertionSort(bucket);
  }

  // åˆå¹¶
  const result: number[] = [];
  for (const bucket of buckets) {
    result.push(...bucket);
  }

  return result;
}

function insertionSort(arr: number[]): void {
  for (let i = 1; i < arr.length; i++) {
    const current = arr[i];
    let j = i - 1;
    while (j >= 0 && arr[j] > current) {
      arr[j + 1] = arr[j];
      j--;
    }
    arr[j + 1] = current;
  }
}
```

---

## ğŸ”§ é€šç”¨ç‰ˆæœ¬ï¼ˆè‡ªå®šä¹‰æ˜ å°„å‡½æ•°ï¼‰

```typescript
/**
 * é€šç”¨æ¡¶æ’åº
 *
 * @param arr å¾…æ’åºæ•°ç»„
 * @param bucketCount æ¡¶æ•°é‡
 * @param getBucketIndex å…ƒç´ åˆ°æ¡¶ç´¢å¼•çš„æ˜ å°„å‡½æ•°
 * @param cmp æ¯”è¾ƒå‡½æ•°
 */
export function bucketSortGeneric<T>(
  arr: readonly T[],
  bucketCount: number,
  getBucketIndex: (item: T) => number,
  cmp: (a: T, b: T) => number
): T[] {
  const n = arr.length;
  if (n <= 1) return [...arr];

  // åˆ›å»ºæ¡¶
  const buckets: T[][] = Array.from({ length: bucketCount }, () => []);

  // åˆ†é…
  for (const item of arr) {
    const idx = getBucketIndex(item);
    if (idx < 0 || idx >= bucketCount) {
      throw new Error(`æ¡¶ç´¢å¼• ${idx} è¶…å‡ºèŒƒå›´ [0, ${bucketCount})`);
    }
    buckets[idx].push(item);
  }

  // æ¡¶å†…æ’åº
  for (const bucket of buckets) {
    bucket.sort(cmp);
  }

  // åˆå¹¶
  const result: T[] = [];
  for (const bucket of buckets) {
    result.push(...bucket);
  }

  return result;
}
```

---

## âœ… ç¨³å®šæ€§ä¿è¯

æ¡¶æ’åºçš„ç¨³å®šæ€§å–å†³äºï¼š
1. **åˆ†é…è¿‡ç¨‹**ï¼šæŒ‰åŸé¡ºåºåˆ†é…æ˜¯ç¨³å®šçš„
2. **æ¡¶å†…æ’åº**ï¼šä½¿ç”¨ç¨³å®šç®—æ³•ï¼ˆå¦‚æ’å…¥æ’åºã€TimSortï¼‰

```typescript
// âœ… ç¨³å®šç‰ˆæœ¬ï¼šæ¡¶å†…ä½¿ç”¨ç¨³å®šæ’åº
for (const bucket of buckets) {
  stableSort(bucket, cmp); // å¦‚ TimSort
}

// âš ï¸ å¯èƒ½ä¸ç¨³å®šï¼šä½¿ç”¨å¿«æ’
for (const bucket of buckets) {
  quickSort(bucket, cmp);
}
```

---

## ğŸŒ å‰ç«¯ä¸šåŠ¡åœºæ™¯

### 1. æŒ‰åˆ†æ•°åŒºé—´åˆ†ç»„

```typescript
interface Student {
  name: string;
  score: number; // 0-100
}

// æŒ‰åˆ†æ•°åˆ†æˆ 10 ä¸ªåŒºé—´ï¼ˆ0-9, 10-19, ...ï¼‰
const bucketCount = 10;
const getBucket = (s: Student) => Math.min(9, Math.floor(s.score / 10));
const cmp = (a: Student, b: Student) => a.score - b.score;

const sorted = bucketSortGeneric(students, bucketCount, getBucket, cmp);
```

### 2. æŒ‰ä»·æ ¼åŒºé—´æ’åº

```typescript
interface Product {
  name: string;
  price: number; // 0-1000
}

const bucketCount = 20; // æ¯ 50 å…ƒä¸€ä¸ªæ¡¶
const getBucket = (p: Product) => Math.min(19, Math.floor(p.price / 50));
const cmp = (a: Product, b: Product) => a.price - b.price;

const sorted = bucketSortGeneric(products, bucketCount, getBucket, cmp);
```

### 3. å‡åŒ€åˆ†å¸ƒçš„å“ˆå¸Œå€¼æ’åº

```typescript
// å“ˆå¸Œå€¼åœ¨ [0, 1) èŒƒå›´å†…å‡åŒ€åˆ†å¸ƒ
const hashes = items.map(item => ({
  item,
  hash: hashFunction(item) / MAX_HASH, // å½’ä¸€åŒ–åˆ° [0, 1)
}));

const sorted = bucketSort(hashes.map(h => h.hash));
```

---

## ğŸ†š ä¸å…¶ä»–éæ¯”è¾ƒæ’åºå¯¹æ¯”

| ç®—æ³• | é€‚ç”¨æ•°æ® | æ—¶é—´ | ç¨³å®š | ç‰¹ç‚¹ |
|------|---------|------|------|------|
| **æ¡¶æ’åº** | å‡åŒ€åˆ†å¸ƒ | O(n)~O(nÂ²) | å¯é€‰ | éœ€è¦å¥½çš„æ˜ å°„å‡½æ•° |
| è®¡æ•°æ’åº | å°èŒƒå›´æ•´æ•° | O(n+k) | âœ… | ç®€å•ç›´æ¥ |
| åŸºæ•°æ’åº | æ•´æ•°/å®šé•¿ä¸² | O(dÂ·n) | âœ… | å¤šè½®ç¨³å®šæ’åº |

---

## âœ… è‡ªæ£€æ¸…å•

- [ ] ç†è§£æ¡¶æ’åºçš„åˆ†é…-æ’åº-åˆå¹¶ä¸‰æ­¥
- [ ] çŸ¥é“åˆ†å¸ƒå‡åŒ€æ—¶èƒ½è¾¾åˆ° O(n)
- [ ] èƒ½è®¾è®¡åˆé€‚çš„æ˜ å°„å‡½æ•°ï¼ˆgetBucketIndexï¼‰
- [ ] ç†è§£ç¨³å®šæ€§å–å†³äºæ¡¶å†…æ’åºç®—æ³•
- [ ] çŸ¥é“æ•°æ®å€¾æ–œæ—¶æ€§èƒ½ä¸‹é™çš„åŸå› 

