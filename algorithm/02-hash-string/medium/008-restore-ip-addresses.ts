/**
 * ğŸ“ é¢˜ç›®ï¼šå¤åŸ IP åœ°å€
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/restore-ip-addresses/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šå­—ç¬¦ä¸²ã€å›æº¯
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * æœ‰æ•ˆ IP åœ°å€ æ­£å¥½ç”±å››ä¸ªæ•´æ•°ï¼ˆæ¯ä¸ªæ•´æ•°ä½äº 0 åˆ° 255 ä¹‹é—´ç»„æˆï¼Œä¸”ä¸èƒ½å«æœ‰å‰å¯¼ 0ï¼‰ï¼Œ
 * æ•´æ•°ä¹‹é—´ç”¨ '.' åˆ†éš”ã€‚
 *
 * ç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­—çš„å­—ç¬¦ä¸² sï¼Œç”¨ä»¥è¡¨ç¤ºä¸€ä¸ª IP åœ°å€ï¼Œ
 * è¿”å›æ‰€æœ‰å¯èƒ½çš„æœ‰æ•ˆ IP åœ°å€ï¼Œè¿™äº›åœ°å€å¯ä»¥é€šè¿‡åœ¨ s ä¸­æ’å…¥ '.' æ¥å½¢æˆã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šs = "25525511135"
 * è¾“å‡ºï¼š["255.255.11.135", "255.255.111.35"]
 *
 * è¾“å…¥ï¼šs = "0000"
 * è¾“å‡ºï¼š["0.0.0.0"]
 *
 * è¾“å…¥ï¼šs = "101023"
 * è¾“å‡ºï¼š["1.0.10.23","1.0.102.3","10.1.0.23","10.10.2.3","101.0.2.3"]
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æ
// ============================================================
//
// è¿™æ˜¯ä¸€é“ç»å…¸çš„å›æº¯é¢˜ï¼š
// - IP åœ°å€ç”± 4 ä¸ªéƒ¨åˆ†ç»„æˆ
// - æ¯ä¸ªéƒ¨åˆ†æ˜¯ 0-255 çš„æ•´æ•°
// - ä¸èƒ½æœ‰å‰å¯¼ 0ï¼ˆé™¤éæ˜¯ 0 æœ¬èº«ï¼‰
//
// å›æº¯æ€è·¯ï¼š
// 1. å°è¯•åˆ‡åˆ† 1-3 ä¸ªå­—ç¬¦ä½œä¸ºä¸€ä¸ªéƒ¨åˆ†
// 2. éªŒè¯è¿™ä¸ªéƒ¨åˆ†æ˜¯å¦æœ‰æ•ˆ
// 3. å¦‚æœæœ‰æ•ˆï¼Œé€’å½’å¤„ç†å‰©ä½™å­—ç¬¦ä¸²
// 4. å½“æ”¶é›†æ»¡ 4 ä¸ªéƒ¨åˆ†ä¸”å­—ç¬¦ä¸²ç”¨å®Œæ—¶ï¼Œå¾—åˆ°ä¸€ä¸ªæœ‰æ•ˆ IP
//
// å‰ªæï¼š
// - å‰©ä½™å­—ç¬¦å¤ªå¤šæˆ–å¤ªå°‘
// - å½“å‰éƒ¨åˆ†æ— æ•ˆ

// ============================================================
// è§£æ³•ä¸€ï¼šå›æº¯ï¼ˆæ¨èï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(3^4 Ã— n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)

/**
 * ğŸ“Š å›æº¯è¿‡ç¨‹å›¾è§£ï¼š
 *
 * s = "25525511135"
 *
 *                    ""
 *        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *        2         25         255
 *    â”Œâ”€â”€â”€â”¼â”€â”€â”€â”   â”Œâ”€â”€â”¼â”€â”€â”    â”Œâ”€â”€â”¼â”€â”€â”
 *    5  55 552  5 52 525   2 25 255
 *    ...
 *
 * æœ€ç»ˆæ‰¾åˆ°ï¼š
 * - 255.255.11.135 âœ“
 * - 255.255.111.35 âœ“
 */
function restoreIpAddresses_v1(s: string): string[] {
  const result: string[] = [];

  // éªŒè¯ä¸€ä¸ªéƒ¨åˆ†æ˜¯å¦æœ‰æ•ˆ
  const isValid = (segment: string): boolean => {
    // é•¿åº¦æ£€æŸ¥
    if (segment.length === 0 || segment.length > 3) return false;

    // å‰å¯¼é›¶æ£€æŸ¥ï¼ˆé•¿åº¦ > 1 æ—¶ä¸èƒ½ä»¥ 0 å¼€å¤´ï¼‰
    if (segment.length > 1 && segment[0] === '0') return false;

    // èŒƒå›´æ£€æŸ¥
    const num = parseInt(segment);
    return num >= 0 && num <= 255;
  };

  // å›æº¯å‡½æ•°
  const backtrack = (start: number, segments: string[]): void => {
    // å¦‚æœå·²ç»æ”¶é›†äº† 4 ä¸ªéƒ¨åˆ†
    if (segments.length === 4) {
      if (start === s.length) {
        // æ­£å¥½ç”¨å®Œæ‰€æœ‰å­—ç¬¦
        result.push(segments.join('.'));
      }
      return;
    }

    // å‰ªæï¼šå‰©ä½™å­—ç¬¦å¤ªå¤šæˆ–å¤ªå°‘
    const remaining = s.length - start;
    const needed = 4 - segments.length;
    if (remaining < needed || remaining > needed * 3) {
      return;
    }

    // å°è¯• 1-3 ä¸ªå­—ç¬¦ä½œä¸ºä¸€ä¸ªéƒ¨åˆ†
    for (let len = 1; len <= 3 && start + len <= s.length; len++) {
      const segment = s.substring(start, start + len);

      if (isValid(segment)) {
        segments.push(segment);
        backtrack(start + len, segments);
        segments.pop();
      }
    }
  };

  backtrack(0, []);
  return result;
}

// ============================================================
// è§£æ³•äºŒï¼šä¸‰é‡å¾ªç¯ï¼ˆæš´åŠ›æšä¸¾ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ³) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)
// ğŸ“ æ€è·¯ç®€å•ï¼Œä½†ä»£ç è¾ƒé•¿

function restoreIpAddresses_v2(s: string): string[] {
  const result: string[] = [];
  const n = s.length;

  // éªŒè¯å‡½æ•°
  const isValid = (str: string): boolean => {
    if (str.length === 0 || str.length > 3) return false;
    if (str.length > 1 && str[0] === '0') return false;
    const num = parseInt(str);
    return num >= 0 && num <= 255;
  };

  // æšä¸¾ä¸‰ä¸ªåˆ†å‰²ç‚¹
  for (let i = 1; i < 4 && i < n; i++) {
    for (let j = i + 1; j < i + 4 && j < n; j++) {
      for (let k = j + 1; k < j + 4 && k < n; k++) {
        const s1 = s.substring(0, i);
        const s2 = s.substring(i, j);
        const s3 = s.substring(j, k);
        const s4 = s.substring(k);

        if (isValid(s1) && isValid(s2) && isValid(s3) && isValid(s4)) {
          result.push(`${s1}.${s2}.${s3}.${s4}`);
        }
      }
    }
  }

  return result;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•      | æ—¶é—´        | ç©ºé—´  | ç‰¹ç‚¹                    |
 * |----------|------------|-------|------------------------|
 * | å›æº¯      | O(3^4 Ã— n) | O(n)  | é€šç”¨æ¨¡æ¿ï¼Œæ˜“äºæ‰©å±•       |
 * | ä¸‰é‡å¾ªç¯  | O(nÂ³)      | O(n)  | ç®€å•ç›´æ¥ï¼Œé€‚åˆæœ¬é¢˜       |
 *
 * æœ¬é¢˜çš„ 4 ä¸ªéƒ¨åˆ†æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ä¸¤ç§æ–¹æ³•å·®åˆ«ä¸å¤§ã€‚
 * ä½†å›æº¯æ–¹æ³•æ›´é€šç”¨ï¼Œå¦‚æœè¦æ±‚åˆ†æˆ n ä¸ªéƒ¨åˆ†ï¼Œå›æº¯æ›´çµæ´»ã€‚
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. å‰å¯¼é›¶ï¼š
 *    - "01", "00", "001" éƒ½æ˜¯æ— æ•ˆçš„
 *    - ä½† "0" å•ç‹¬æ˜¯æœ‰æ•ˆçš„
 *
 * 2. èŒƒå›´ 0-255ï¼š
 *    - "256" æ˜¯æ— æ•ˆçš„
 *
 * 3. å›æº¯ä¸­çš„å‰ªæï¼š
 *    - å‰©ä½™å­—ç¬¦å¤ªå°‘ï¼šæ¯ä¸ªéƒ¨åˆ†è‡³å°‘ 1 ä¸ªå­—ç¬¦
 *    - å‰©ä½™å­—ç¬¦å¤ªå¤šï¼šæ¯ä¸ªéƒ¨åˆ†æœ€å¤š 3 ä¸ªå­—ç¬¦
 *
 * 4. ç»“æŸæ¡ä»¶ï¼š
 *    - å¿…é¡»æ°å¥½ 4 ä¸ªéƒ¨åˆ†
 *    - å¿…é¡»ç”¨å®Œæ‰€æœ‰å­—ç¬¦
 */

// ============================================================
// ğŸ“Š æµç¨‹å›¾ (Mermaid)
// ============================================================
/**
 * ```mermaid
 * flowchart TD
 *     A[å¼€å§‹å›æº¯ start, segments] --> B{segments.length === 4?}
 *     B -->|Yes| C{start === s.length?}
 *     C -->|Yes| D[åŠ å…¥ç»“æœ]
 *     C -->|No| E[è¿”å›]
 *     B -->|No| F{å‰ªææ£€æŸ¥}
 *     F -->|ä¸é€šè¿‡| E
 *     F -->|é€šè¿‡| G[å°è¯• 1-3 ä¸ªå­—ç¬¦]
 *     G --> H{isValid?}
 *     H -->|Yes| I[åŠ å…¥ segment, é€’å½’]
 *     I --> J[ç§»é™¤ segment]
 *     J --> G
 *     H -->|No| G
 * ```
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - åˆ†å‰²å›æ–‡ä¸² â†’ å›æº¯ + å›æ–‡åˆ¤æ–­
 * - ç”µè¯å·ç çš„å­—æ¯ç»„åˆ â†’ å›æº¯
 * - æ‹¬å·ç”Ÿæˆ â†’ å›æº¯
 *
 * å…±åŒæ¨¡å¼ï¼šå›æº¯æ¡†æ¶
 * - è·¯å¾„ï¼šå½“å‰æ”¶é›†çš„ç»“æœ
 * - é€‰æ‹©åˆ—è¡¨ï¼šå½“å‰å¯ä»¥åšçš„é€‰æ‹©
 * - ç»“æŸæ¡ä»¶ï¼šæ”¶é›†å®Œæˆçš„æ¡ä»¶
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. IP åœ°å€éªŒè¯ï¼šè¡¨å•è¾“å…¥éªŒè¯
 * 2. é…ç½®è§£æï¼šè§£æé…ç½®å­—ç¬¦ä¸²
 * 3. è·¯å¾„åˆ†å‰²ï¼šURL è·¯å¾„åˆ†å‰²
 * 4. æ•°æ®æ ¼å¼åŒ–ï¼šå°†æ•°å­—æ ¼å¼åŒ–ä¸ºç‰¹å®šæ ¼å¼ï¼ˆå¦‚ç”µè¯å·ç ï¼‰
 */

export { restoreIpAddresses_v1, restoreIpAddresses_v2 };
export default restoreIpAddresses_v1;

