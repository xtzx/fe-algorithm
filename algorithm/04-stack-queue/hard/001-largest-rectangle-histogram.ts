/**
 * ğŸ“ é¢˜ç›®ï¼šæŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/largest-rectangle-in-histogram/
 * ğŸ·ï¸ éš¾åº¦ï¼šHard
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ ˆã€æ•°ç»„ã€å•è°ƒæ ˆ
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™å®š n ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚
 * æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º 1ã€‚
 * æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šheights = [2,1,5,6,2,3]
 * è¾“å‡ºï¼š10
 * è§£é‡Šï¼šæœ€å¤§çš„çŸ©å½¢ä¸ºå›¾ä¸­çº¢è‰²åŒºåŸŸï¼Œé¢ç§¯ä¸º 10
 *
 *          â”Œâ”€â”€â”€â”
 *      â”Œâ”€â”€â”€â”¤   â”‚
 *      â”‚ 5 â”‚ 6 â”œâ”€â”€â”€â”
 *      â”‚   â”‚   â”‚   â”‚
 * â”Œâ”€â”€â”€â”â”‚   â”‚   â”‚ 2 â”‚ 3
 * â”‚ 2 â”œâ”¤   â”‚   â”œâ”€â”€â”€â”¤
 * â”‚   â”‚â”‚   â”‚   â”‚   â”‚
 * â””â”€â”€â”€â”´â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
 *
 *   æœ€å¤§çŸ©å½¢: 5*2 = 10 (é«˜åº¦5ï¼Œå®½åº¦2)
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// æš´åŠ›æ€è·¯ï¼š
// - å¯¹äºæ¯ä¸ªæŸ±å­ï¼Œä»¥å®ƒçš„é«˜åº¦ä¸ºçŸ©å½¢é«˜åº¦
// - å‘å·¦å³æ‰©å±•ï¼Œç›´åˆ°é‡åˆ°æ›´çŸ®çš„æŸ±å­
// - è®¡ç®—é¢ç§¯ï¼Œå–æœ€å¤§å€¼
// - æ—¶é—´å¤æ‚åº¦ O(nÂ²)
//
// ä¼˜åŒ–ï¼šå•è°ƒæ ˆ
// - å¯¹äºæ¯ä¸ªæŸ±å­ï¼Œéœ€è¦æ‰¾åˆ°ã€Œå·¦è¾¹ç¬¬ä¸€ä¸ªæ›´çŸ®ã€å’Œã€Œå³è¾¹ç¬¬ä¸€ä¸ªæ›´çŸ®ã€
// - è¿™æ­£æ˜¯å•è°ƒæ ˆè¦è§£å†³çš„é—®é¢˜ï¼
// - ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å¢æ ˆ
// - å½“é‡åˆ°æ›´çŸ®çš„æŸ±å­æ—¶ï¼Œæ ˆé¡¶æŸ±å­æ‰¾åˆ°äº†å³è¾¹ç•Œ

// ============================================================
// è§£æ³•ä¸€ï¼šå•è°ƒæ ˆï¼ˆæ¨èï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * heights = [2, 1, 5, 6, 2, 3]
 *            0  1  2  3  4  5
 *
 * æ·»åŠ å“¨å…µ: [0, 2, 1, 5, 6, 2, 3, 0]
 *           0  1  2  3  4  5  6  7
 *
 * éå†è¿‡ç¨‹ï¼ˆå•è°ƒé€’å¢æ ˆï¼‰ï¼š
 *
 * i=0, h=0: æ ˆç©ºï¼Œå…¥æ ˆ                æ ˆ:[0]      area=0
 * i=1, h=2: 2>0ï¼Œå…¥æ ˆ                 æ ˆ:[0,1]    area=0
 * i=2, h=1: 1<2ï¼Œå¼¹1                  æ ˆ:[0]      area=2*1=2
 *           1>0ï¼Œå…¥æ ˆ                 æ ˆ:[0,2]
 * i=3, h=5: 5>1ï¼Œå…¥æ ˆ                 æ ˆ:[0,2,3]  area=2
 * i=4, h=6: 6>5ï¼Œå…¥æ ˆ                 æ ˆ:[0,2,3,4] area=2
 * i=5, h=2: 2<6ï¼Œå¼¹4ï¼Œarea=6*1=6      æ ˆ:[0,2,3]  area=6
 *           2<5ï¼Œå¼¹3ï¼Œarea=5*2=10     æ ˆ:[0,2]    area=10
 *           2>1ï¼Œå…¥æ ˆ                 æ ˆ:[0,2,5]
 * i=6, h=3: 3>2ï¼Œå…¥æ ˆ                 æ ˆ:[0,2,5,6] area=10
 * i=7, h=0: å¼¹6ï¼Œarea=3*1=3           æ ˆ:[0,2,5]  area=10
 *           å¼¹5ï¼Œarea=2*4=8           æ ˆ:[0,2]    area=10
 *           å¼¹2ï¼Œarea=1*6=6           æ ˆ:[0]      area=10
 *
 * æœ€å¤§é¢ç§¯: 10
 *
 * ğŸ”„ é¢ç§¯è®¡ç®—è¯´æ˜ï¼š
 * å½“å¼¹å‡ºç´¢å¼• i æ—¶ï¼š
 * - é«˜åº¦ = heights[i]
 * - å®½åº¦ = å½“å‰ç´¢å¼• - æ ˆé¡¶ç´¢å¼• - 1
 *   ï¼ˆæ ˆé¡¶æ˜¯å·¦è¾¹ç•Œï¼Œå½“å‰æ˜¯å³è¾¹ç•Œï¼‰
 */
function largestRectangleArea(heights: number[]): number {
  // æ·»åŠ å“¨å…µï¼šå·¦è¾¹åŠ 0ï¼Œå³è¾¹åŠ 0
  // å·¦å“¨å…µç¡®ä¿æ ˆä¸ä¼šä¸ºç©º
  // å³å“¨å…µç¡®ä¿æ‰€æœ‰æŸ±å­éƒ½ä¼šè¢«å¤„ç†
  const newHeights = [0, ...heights, 0];
  const stack: number[] = [];
  let maxArea = 0;

  for (let i = 0; i < newHeights.length; i++) {
    // å½“å‰é«˜åº¦æ¯”æ ˆé¡¶å°ï¼Œè¯´æ˜æ ˆé¡¶æŸ±å­æ‰¾åˆ°äº†å³è¾¹ç•Œ
    while (stack.length > 0 && newHeights[stack[stack.length - 1]] > newHeights[i]) {
      const height = newHeights[stack.pop()!];
      const width = i - stack[stack.length - 1] - 1;
      maxArea = Math.max(maxArea, height * width);
    }
    stack.push(i);
  }

  return maxArea;
}

// ============================================================
// è§£æ³•äºŒï¼šä¸ä½¿ç”¨å“¨å…µ
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)
function largestRectangleArea_v2(heights: number[]): number {
  const n = heights.length;
  const stack: number[] = [];
  let maxArea = 0;

  for (let i = 0; i <= n; i++) {
    // i === n æ—¶ç›¸å½“äºé‡åˆ°é«˜åº¦ä¸º 0 çš„æŸ±å­
    const currentHeight = i === n ? 0 : heights[i];

    while (stack.length > 0 && heights[stack[stack.length - 1]] > currentHeight) {
      const height = heights[stack.pop()!];
      // æ ˆä¸ºç©ºè¯´æ˜å·¦è¾¹æ²¡æœ‰æ›´çŸ®çš„ï¼Œå®½åº¦å°±æ˜¯ i
      const width = stack.length === 0 ? i : i - stack[stack.length - 1] - 1;
      maxArea = Math.max(maxArea, height * width);
    }
    stack.push(i);
  }

  return maxArea;
}

// ============================================================
// è§£æ³•ä¸‰ï¼šæš´åŠ›æ³•ï¼ˆè¶…æ—¶ï¼Œä»…ä¾›ç†è§£ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)
function largestRectangleArea_v3(heights: number[]): number {
  const n = heights.length;
  let maxArea = 0;

  for (let i = 0; i < n; i++) {
    let left = i;
    let right = i;

    // å‘å·¦æ‰©å±•
    while (left > 0 && heights[left - 1] >= heights[i]) {
      left--;
    }

    // å‘å³æ‰©å±•
    while (right < n - 1 && heights[right + 1] >= heights[i]) {
      right++;
    }

    const area = heights[i] * (right - left + 1);
    maxArea = Math.max(maxArea, area);
  }

  return maxArea;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•       | æ—¶é—´   | ç©ºé—´  | ç‰¹ç‚¹                     |
 * |-----------|--------|-------|-------------------------|
 * | å•è°ƒæ ˆ    | O(n)   | O(n)  | æ¨èï¼Œæœ€ä¼˜è§£             |
 * | æš´åŠ›      | O(nÂ²)  | O(1)  | ç®€å•ä½†æ…¢                 |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. å“¨å…µçš„ä½œç”¨ï¼š
 *    - å·¦å“¨å…µï¼šé¿å…æ ˆä¸ºç©ºçš„è¾¹ç•Œåˆ¤æ–­
 *    - å³å“¨å…µï¼šç¡®ä¿æ‰€æœ‰æŸ±å­éƒ½è¢«å¼¹å‡ºå¤„ç†
 *
 * 2. å®½åº¦è®¡ç®—ï¼š
 *    - width = right - left - 1
 *    - ä¸åŒ…å«å·¦å³è¾¹ç•Œæœ¬èº«
 *
 * 3. å•è°ƒé€’å¢æ ˆï¼š
 *    - é‡åˆ°æ›´çŸ®çš„æ‰å¼¹å‡º
 *    - è¿™æ ·æ ˆé¡¶å°±æ˜¯å·¦è¾¹ç¬¬ä¸€ä¸ªæ›´çŸ®çš„
 *
 * 4. é¢ç§¯è®¡ç®—æ—¶æœºï¼š
 *    - å¼¹å‡ºæ—¶è®¡ç®—ï¼Œä¸æ˜¯å…¥æ ˆæ—¶
 *    - å¼¹å‡ºæ—¶æ‰çŸ¥é“å³è¾¹ç•Œ
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - æœ€å¤§çŸ©å½¢ â†’ åœ¨ 01 çŸ©é˜µä¸­æ‰¾æœ€å¤§çŸ©å½¢ï¼ˆè½¬åŒ–ä¸ºæŸ±çŠ¶å›¾ï¼‰
 * - æ¥é›¨æ°´ â†’ å•è°ƒæ ˆ/åŒæŒ‡é’ˆ
 * - æ¯æ—¥æ¸©åº¦ â†’ å•è°ƒæ ˆåŸºç¡€
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. æ•°æ®å¯è§†åŒ–ï¼šåœ¨æŸ±çŠ¶å›¾ä¸­æ‰¾æœ€å¤§æœ‰æ•ˆåŒºåŸŸ
 * 2. å¸ƒå±€è®¡ç®—ï¼šåœ¨å˜é«˜çš„å®¹å™¨ä¸­æ‰¾æœ€å¤§çŸ©å½¢åŒºåŸŸ
 * 3. å›¾åƒå¤„ç†ï¼šå¯»æ‰¾æœ€å¤§çŸ©å½¢åŒºåŸŸ
 */

export {
  largestRectangleArea,
  largestRectangleArea_v2,
  largestRectangleArea_v3,
};
export default largestRectangleArea;

