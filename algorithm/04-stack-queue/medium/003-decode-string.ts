/**
 * ğŸ“ é¢˜ç›®ï¼šå­—ç¬¦ä¸²è§£ç 
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/decode-string/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ ˆã€é€’å½’ã€å­—ç¬¦ä¸²
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™å®šä¸€ä¸ªç»è¿‡ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¿”å›å®ƒè§£ç åçš„å­—ç¬¦ä¸²ã€‚
 *
 * ç¼–ç è§„åˆ™ä¸º: k[encoded_string]ï¼Œè¡¨ç¤ºå…¶ä¸­æ–¹æ‹¬å·å†…éƒ¨çš„ encoded_string æ­£å¥½é‡å¤ k æ¬¡ã€‚
 *
 * æ³¨æ„ï¼š
 * - k ä¿è¯ä¸ºæ­£æ•´æ•°
 * - å¯ä»¥è®¤ä¸ºè¾“å…¥å­—ç¬¦ä¸²æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œæ²¡æœ‰é¢å¤–çš„ç©ºæ ¼
 * - åŸå§‹æ•°æ®ä¸åŒ…å«æ•°å­—ï¼Œæ‰€æœ‰æ•°å­—åªè¡¨ç¤ºé‡å¤çš„æ¬¡æ•° k
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šs = "3[a]2[bc]"
 * è¾“å‡ºï¼š"aaabcbc"
 *
 * è¾“å…¥ï¼šs = "3[a2[c]]"
 * è¾“å‡ºï¼š"accaccacc"
 *
 * è¾“å…¥ï¼šs = "2[abc]3[cd]ef"
 * è¾“å‡ºï¼š"abcabccdcdcdef"
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// å…³é”®è§‚å¯Ÿï¼š
// - åµŒå¥—ç»“æ„ 3[a2[c]] â†’ éœ€è¦ä»å†…åˆ°å¤–è§£ç 
// - é‡åˆ° '[' æ—¶éœ€è¦ä¿å­˜å½“å‰çŠ¶æ€
// - é‡åˆ° ']' æ—¶éœ€è¦æ¢å¤ä¹‹å‰çš„çŠ¶æ€
// - è¿™ç§ã€Œä¿å­˜-æ¢å¤ã€çš„æ¨¡å¼æ­£å¥½é€‚åˆæ ˆ
//
// ç”¨ä¸¤ä¸ªæ ˆï¼š
// - numStack: å­˜å‚¨æ•°å­—ï¼ˆé‡å¤æ¬¡æ•°ï¼‰
// - strStack: å­˜å‚¨å­—ç¬¦ä¸²ï¼ˆå½“å‰å·²æ„å»ºçš„å­—ç¬¦ä¸²ï¼‰

// ============================================================
// è§£æ³•ä¸€ï¼šåŒæ ˆ
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * s = "3[a2[c]]"
 *
 * å­—ç¬¦  æ“ä½œ                           numStack  strStack  currentStr  currentNum
 * '3'   currentNum = 3                 []        []        ""          3
 * '['   push, é‡ç½®                     [3]       [""]      ""          0
 * 'a'   currentStr += 'a'              [3]       [""]      "a"         0
 * '2'   currentNum = 2                 [3]       [""]      "a"         2
 * '['   push, é‡ç½®                     [3,2]     ["","a"]  ""          0
 * 'c'   currentStr += 'c'              [3,2]     ["","a"]  "c"         0
 * ']'   pop, ç»„åˆ                      [3]       [""]      "a"+"cc"="acc"  0
 * ']'   pop, ç»„åˆ                      []        []        ""+"accaccacc"  0
 *
 * ç»“æœ: "accaccacc"
 */
function decodeString(s: string): string {
  const numStack: number[] = []; // å­˜å‚¨é‡å¤æ¬¡æ•°
  const strStack: string[] = []; // å­˜å‚¨ä¹‹å‰çš„å­—ç¬¦ä¸²
  let currentStr = ''; // å½“å‰æ­£åœ¨æ„å»ºçš„å­—ç¬¦ä¸²
  let currentNum = 0; // å½“å‰æ•°å­—

  for (const char of s) {
    if (char >= '0' && char <= '9') {
      // æ•°å­—ï¼šæ„å»ºå®Œæ•´æ•°å­—ï¼ˆå¯èƒ½æ˜¯å¤šä½æ•°ï¼‰
      currentNum = currentNum * 10 + parseInt(char, 10);
    } else if (char === '[') {
      // å·¦æ‹¬å·ï¼šä¿å­˜å½“å‰çŠ¶æ€ï¼Œå¼€å§‹æ–°çš„ä¸€å±‚
      numStack.push(currentNum);
      strStack.push(currentStr);
      currentNum = 0;
      currentStr = '';
    } else if (char === ']') {
      // å³æ‹¬å·ï¼šå¼¹å‡ºçŠ¶æ€ï¼Œç»„åˆå­—ç¬¦ä¸²
      const num = numStack.pop()!;
      const prevStr = strStack.pop()!;
      currentStr = prevStr + currentStr.repeat(num);
    } else {
      // å­—æ¯ï¼šè¿½åŠ åˆ°å½“å‰å­—ç¬¦ä¸²
      currentStr += char;
    }
  }

  return currentStr;
}

// ============================================================
// è§£æ³•äºŒï¼šé€’å½’
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)

/**
 * é€’å½’æ€è·¯ï¼š
 * - é‡åˆ° '[' è¿›å…¥é€’å½’
 * - é‡åˆ° ']' è¿”å›ç»“æœ
 * - ç”¨å…¨å±€ç´¢å¼•è¿½è¸ªä½ç½®
 */
function decodeString_v2(s: string): string {
  let index = 0;

  function decode(): string {
    let result = '';
    let num = 0;

    while (index < s.length) {
      const char = s[index];

      if (char >= '0' && char <= '9') {
        num = num * 10 + parseInt(char, 10);
        index++;
      } else if (char === '[') {
        index++; // è·³è¿‡ '['
        const str = decode(); // é€’å½’å¤„ç†æ‹¬å·å†…éƒ¨
        result += str.repeat(num);
        num = 0;
      } else if (char === ']') {
        index++; // è·³è¿‡ ']'
        return result; // è¿”å›å½“å‰å±‚çš„ç»“æœ
      } else {
        result += char;
        index++;
      }
    }

    return result;
  }

  return decode();
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•     | æ—¶é—´  | ç©ºé—´  | ç‰¹ç‚¹                     |
 * |---------|-------|-------|-------------------------|
 * | åŒæ ˆ    | O(n)  | O(n)  | æ¨èï¼Œè¿­ä»£æ€è·¯æ¸…æ™°        |
 * | é€’å½’    | O(n)  | O(n)  | ä»£ç ç®€æ´ï¼Œä½†æœ‰é€’å½’å¼€é”€    |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. å¤šä½æ•°å­—å¤„ç†ï¼š
 *    - "12[a]" ä¸­çš„ 12 æ˜¯ä¸¤ä½æ•°
 *    - currentNum = currentNum * 10 + digit
 *
 * 2. çŠ¶æ€ä¿å­˜æ—¶æœºï¼š
 *    - é‡åˆ° '[' æ—¶ä¿å­˜ï¼Œä¸æ˜¯é‡åˆ°æ•°å­—æ—¶
 *
 * 3. å­—ç¬¦ä¸²æ‹¼æ¥é¡ºåºï¼š
 *    - prevStr + currentStr.repeat(num)
 *    - å‰é¢çš„å­—ç¬¦ä¸² + é‡å¤åçš„å­—ç¬¦ä¸²
 *
 * 4. åµŒå¥—å¤„ç†ï¼š
 *    - å†…å±‚è§£ç å®Œæˆåï¼Œç»“æœä½œä¸ºå¤–å±‚çš„ currentStr çš„ä¸€éƒ¨åˆ†
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - æœ‰æ•ˆçš„æ‹¬å· â†’ æ‹¬å·åŒ¹é…åŸºç¡€
 * - åŸå­çš„æ•°é‡ â†’ ç±»ä¼¼çš„åµŒå¥—ç»“æ„
 * - æ‹¬å·çš„åˆ†æ•° â†’ æ‹¬å·åµŒå¥—è®¡ç®—
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. æ¨¡æ¿å¼•æ“ï¼šè§£æåµŒå¥—æ¨¡æ¿è¯­æ³•
 * 2. é…ç½®è§£æï¼šè§£æåµŒå¥—çš„é…ç½®æ ¼å¼
 * 3. å‹ç¼©æ•°æ®è§£ç ï¼šè§£å‹é‡å¤æ¨¡å¼çš„æ•°æ®
 */

export { decodeString, decodeString_v2 };
export default decodeString;

