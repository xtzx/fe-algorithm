/**
 * ============================================================
 * LeetCode 5. æœ€é•¿å›æ–‡å­ä¸² (Longest Palindromic Substring)
 * ============================================================
 *
 * é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚
 *
 * ç¤ºä¾‹ 1ï¼š
 * è¾“å…¥ï¼šs = "babad"
 * è¾“å‡ºï¼š"bab"
 * è§£é‡Šï¼š"aba" åŒæ ·æ˜¯ç¬¦åˆé¢˜æ„çš„ç­”æ¡ˆã€‚
 *
 * ç¤ºä¾‹ 2ï¼š
 * è¾“å…¥ï¼šs = "cbbd"
 * è¾“å‡ºï¼š"bb"
 *
 * æç¤ºï¼š
 * 1 <= s.length <= 1000
 * s ä»…ç”±æ•°å­—å’Œè‹±æ–‡å­—æ¯ç»„æˆ
 */

// ============================================================
// æ–¹æ³•ä¸€ï¼šä¸­å¿ƒæ‰©å±•æ³•ï¼ˆæ¨èï¼‰
// ============================================================

/**
 * ğŸ“Š æ ¸å¿ƒæ€è·¯ï¼š
 *
 * å›æ–‡ä¸²æ˜¯å¯¹ç§°çš„ï¼Œå¯ä»¥ä»ä¸­å¿ƒå‘ä¸¤è¾¹æ‰©å±•ï¼š
 * - å¥‡æ•°é•¿åº¦å›æ–‡ï¼šä¸­å¿ƒæ˜¯ä¸€ä¸ªå­—ç¬¦
 * - å¶æ•°é•¿åº¦å›æ–‡ï¼šä¸­å¿ƒæ˜¯ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´
 *
 * ğŸ”„ æ‰©å±•è¿‡ç¨‹ (Mermaid):
 *
 * ```mermaid
 * flowchart LR
 *     A[é€‰æ‹©ä¸­å¿ƒ] --> B[å‘ä¸¤è¾¹æ‰©å±•]
 *     B --> C{å·¦å³å­—ç¬¦ç›¸ç­‰?}
 *     C -->|æ˜¯| D[ç»§ç»­æ‰©å±•]
 *     C -->|å¦| E[è®°å½•é•¿åº¦]
 *     D --> B
 * ```
 *
 * æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)
 * ç©ºé—´å¤æ‚åº¦ï¼šO(1)
 */
function longestPalindrome(s: string): string {
  const n = s.length;
  if (n < 2) return s;

  let start = 0;
  let maxLength = 1;

  /**
   * ä»ä¸­å¿ƒå‘ä¸¤è¾¹æ‰©å±•ï¼Œè¿”å›å›æ–‡é•¿åº¦
   */
  function expandAroundCenter(left: number, right: number): number {
    while (left >= 0 && right < n && s[left] === s[right]) {
      left--;
      right++;
    }
    // è¿”å›å›æ–‡é•¿åº¦
    return right - left - 1;
  }

  for (let i = 0; i < n; i++) {
    // å¥‡æ•°é•¿åº¦å›æ–‡ï¼ˆä»¥ i ä¸ºä¸­å¿ƒï¼‰
    const len1 = expandAroundCenter(i, i);
    // å¶æ•°é•¿åº¦å›æ–‡ï¼ˆä»¥ i å’Œ i+1 ä¹‹é—´ä¸ºä¸­å¿ƒï¼‰
    const len2 = expandAroundCenter(i, i + 1);

    const len = Math.max(len1, len2);

    if (len > maxLength) {
      maxLength = len;
      // è®¡ç®—èµ·å§‹ä½ç½®
      start = i - Math.floor((len - 1) / 2);
    }
  }

  return s.substring(start, start + maxLength);
}

// ============================================================
// æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’
// ============================================================

/**
 * ğŸ“Š DP æ€è·¯ï¼š
 *
 * å®šä¹‰ï¼šdp[i][j] = s[i..j] æ˜¯å¦æ˜¯å›æ–‡
 *
 * çŠ¶æ€è½¬ç§»ï¼š
 * - s[i] !== s[j] â†’ dp[i][j] = false
 * - s[i] === s[j] â†’
 *   - j - i < 3ï¼ˆé•¿åº¦ â‰¤ 3ï¼‰â†’ dp[i][j] = true
 *   - å¦åˆ™ â†’ dp[i][j] = dp[i+1][j-1]
 *
 * ğŸ“Š DP è¡¨æ ¼ç¤ºä¾‹ s = "babad":
 *
 *      b  a  b  a  d
 *   b  T  F  T  F  F
 *   a     T  F  T  F
 *   b        T  F  F
 *   a           T  F
 *   d              T
 *
 * æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)
 * ç©ºé—´å¤æ‚åº¦ï¼šO(nÂ²)
 */
function longestPalindromeDP(s: string): string {
  const n = s.length;
  if (n < 2) return s;

  // dp[i][j] = s[i..j] æ˜¯å¦æ˜¯å›æ–‡
  const dp: boolean[][] = Array.from({ length: n }, () =>
    new Array(n).fill(false)
  );

  let start = 0;
  let maxLength = 1;

  // æ‰€æœ‰å•ä¸ªå­—ç¬¦éƒ½æ˜¯å›æ–‡
  for (let i = 0; i < n; i++) {
    dp[i][i] = true;
  }

  // æŒ‰é•¿åº¦éå†ï¼ˆä»çŸ­åˆ°é•¿ï¼‰
  for (let len = 2; len <= n; len++) {
    for (let i = 0; i + len - 1 < n; i++) {
      const j = i + len - 1;

      if (s[i] !== s[j]) {
        dp[i][j] = false;
      } else {
        if (len <= 3) {
          // é•¿åº¦ 2 æˆ– 3ï¼Œåªè¦é¦–å°¾ç›¸åŒå°±æ˜¯å›æ–‡
          dp[i][j] = true;
        } else {
          // çœ‹å†…éƒ¨æ˜¯å¦æ˜¯å›æ–‡
          dp[i][j] = dp[i + 1][j - 1];
        }
      }

      if (dp[i][j] && len > maxLength) {
        maxLength = len;
        start = i;
      }
    }
  }

  return s.substring(start, start + maxLength);
}

// ============================================================
// æ–¹æ³•ä¸‰ï¼šManacher ç®—æ³•ï¼ˆæœ€ä¼˜ï¼Œäº†è§£å³å¯ï¼‰
// ============================================================

/**
 * ğŸ“Š Manacher ç®—æ³•ï¼š
 *
 * æ ¸å¿ƒæ€æƒ³ï¼šåˆ©ç”¨å·²çŸ¥çš„å›æ–‡ä¿¡æ¯ï¼Œå‡å°‘é‡å¤è®¡ç®—
 *
 * é¢„å¤„ç†ï¼šåœ¨æ¯ä¸ªå­—ç¬¦é—´æ’å…¥ç‰¹æ®Šå­—ç¬¦
 * "babad" â†’ "#b#a#b#a#d#"
 *
 * è¿™æ ·æ‰€æœ‰å›æ–‡éƒ½å˜æˆå¥‡æ•°é•¿åº¦
 *
 * æ—¶é—´å¤æ‚åº¦ï¼šO(n)
 * ç©ºé—´å¤æ‚åº¦ï¼šO(n)
 */
function longestPalindromeManacher(s: string): string {
  const n = s.length;
  if (n < 2) return s;

  // é¢„å¤„ç†ï¼šæ’å…¥ #
  const t = '#' + s.split('').join('#') + '#';
  const m = t.length;

  // p[i] = ä»¥ t[i] ä¸ºä¸­å¿ƒçš„å›æ–‡åŠå¾„
  const p: number[] = new Array(m).fill(0);

  let center = 0; // å½“å‰æœ€å³å›æ–‡çš„ä¸­å¿ƒ
  let right = 0; // å½“å‰æœ€å³å›æ–‡çš„å³è¾¹ç•Œ

  let maxLen = 0;
  let maxCenter = 0;

  for (let i = 0; i < m; i++) {
    if (i < right) {
      // åˆ©ç”¨å¯¹ç§°æ€§
      const mirror = 2 * center - i;
      p[i] = Math.min(right - i, p[mirror]);
    }

    // å°è¯•æ‰©å±•
    let left = i - p[i] - 1;
    let rightEnd = i + p[i] + 1;
    while (left >= 0 && rightEnd < m && t[left] === t[rightEnd]) {
      p[i]++;
      left--;
      rightEnd++;
    }

    // æ›´æ–°æœ€å³è¾¹ç•Œ
    if (i + p[i] > right) {
      center = i;
      right = i + p[i];
    }

    // è®°å½•æœ€é•¿å›æ–‡
    if (p[i] > maxLen) {
      maxLen = p[i];
      maxCenter = i;
    }
  }

  // è®¡ç®—åŸå§‹å­—ç¬¦ä¸²ä¸­çš„èµ·å§‹ä½ç½®
  const start = Math.floor((maxCenter - maxLen) / 2);
  return s.substring(start, start + maxLen);
}

// ============================================================
// ğŸ“Š å¤æ‚åº¦å¯¹æ¯”
// ============================================================

/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚      æ–¹æ³•        â”‚ æ—¶é—´å¤æ‚åº¦  â”‚ ç©ºé—´å¤æ‚åº¦  â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ ä¸­å¿ƒæ‰©å±•ï¼ˆæ¨èï¼‰  â”‚   O(nÂ²)    â”‚   O(1)     â”‚
 * â”‚ åŠ¨æ€è§„åˆ’         â”‚   O(nÂ²)    â”‚   O(nÂ²)    â”‚
 * â”‚ Manacher         â”‚   O(n)     â”‚   O(n)     â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * é¢è¯•æ¨èï¼š
 * - é¦–é€‰ä¸­å¿ƒæ‰©å±•æ³•ï¼Œä»£ç ç®€æ´ï¼Œç©ºé—´æœ€ä¼˜
 * - æåŠ DP è§£æ³•ï¼Œå±•ç¤ºå¯¹ DP çš„ç†è§£
 * - äº†è§£ Manacher ç®—æ³•å­˜åœ¨å³å¯
 */

// ============================================================
// ğŸ” å›¾è§£ç¤ºä¾‹
// ============================================================

/**
 * ç¤ºä¾‹ï¼šs = "babad"
 *
 * ä¸­å¿ƒæ‰©å±•è¿‡ç¨‹ï¼š
 *
 * i=0: ä¸­å¿ƒ 'b'
 *      å¥‡æ•°æ‰©å±•ï¼š[b] â†’ é•¿åº¦ 1
 *      å¶æ•°æ‰©å±•ï¼šb|a â†’ ä¸åŒ¹é…
 *
 * i=1: ä¸­å¿ƒ 'a'
 *      å¥‡æ•°æ‰©å±•ï¼š[a] â†’ b[a]b â†’ é•¿åº¦ 3 âœ“
 *      å¶æ•°æ‰©å±•ï¼ša|b â†’ ä¸åŒ¹é…
 *
 * i=2: ä¸­å¿ƒ 'b'
 *      å¥‡æ•°æ‰©å±•ï¼š[b] â†’ a[b]a â†’ é•¿åº¦ 3
 *      å¶æ•°æ‰©å±•ï¼šb|a â†’ ä¸åŒ¹é…
 *
 * i=3: ä¸­å¿ƒ 'a'
 *      å¥‡æ•°æ‰©å±•ï¼š[a] â†’ é•¿åº¦ 1
 *      å¶æ•°æ‰©å±•ï¼ša|d â†’ ä¸åŒ¹é…
 *
 * i=4: ä¸­å¿ƒ 'd'
 *      å¥‡æ•°æ‰©å±•ï¼š[d] â†’ é•¿åº¦ 1
 *
 * æœ€é•¿å›æ–‡ï¼šä» i=1 å¼€å§‹ï¼Œé•¿åº¦ 3ï¼Œå³ "bab"
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================

/**
 * 1. èµ·å§‹ä½ç½®è®¡ç®—
 *    - å¥‡æ•°é•¿åº¦ï¼šstart = i - (len - 1) / 2
 *    - éœ€è¦ Math.floor å¤„ç†
 *
 * 2. å¶æ•°é•¿åº¦å›æ–‡
 *    - ä¸­å¿ƒæ‰©å±•æ—¶è¦åˆ†åˆ«å¤„ç†å¥‡æ•°å’Œå¶æ•°æƒ…å†µ
 *    - expandAroundCenter(i, i) å’Œ expandAroundCenter(i, i+1)
 *
 * 3. DP éå†é¡ºåº
 *    - dp[i][j] ä¾èµ– dp[i+1][j-1]
 *    - å¿…é¡»æŒ‰é•¿åº¦ä»çŸ­åˆ°é•¿éå†
 *    - æˆ–è€… i ä»å¤§åˆ°å°éå†
 *
 * 4. è¾¹ç•Œæƒ…å†µ
 *    - ç©ºå­—ç¬¦ä¸²
 *    - å•å­—ç¬¦
 *    - å…¨ç›¸åŒå­—ç¬¦
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰
// ============================================================

/**
 * æœ€é•¿å›æ–‡å­åºåˆ— (LeetCode 516) - Medium
 * - å­åºåˆ—å¯ä»¥ä¸è¿ç»­
 * - ç”¨ DPï¼šdp[i][j] = s[i..j] çš„æœ€é•¿å›æ–‡å­åºåˆ—é•¿åº¦
 *
 * å›æ–‡å­ä¸²ä¸ªæ•° (LeetCode 647) - Medium
 * - ç»Ÿè®¡æ‰€æœ‰å›æ–‡å­ä¸²çš„ä¸ªæ•°
 * - ç”¨ä¸­å¿ƒæ‰©å±•æ³•ï¼Œç´¯åŠ æ¯ä¸ªä¸­å¿ƒèƒ½æ‰©å±•çš„æ•°é‡
 *
 * åˆ†å‰²å›æ–‡ä¸² (LeetCode 131) - Medium
 * - å›æº¯ + é¢„å¤„ç†å›æ–‡åˆ¤æ–­
 *
 * éªŒè¯å›æ–‡ä¸² (LeetCode 125) - Easy
 * - åŒæŒ‡é’ˆä»ä¸¤ç«¯å‘ä¸­é—´
 */

// ============================================================
// æµ‹è¯•ç”¨ä¾‹
// ============================================================

function test() {
  console.log(longestPalindrome('babad')); // "bab" æˆ– "aba"
  console.log(longestPalindrome('cbbd')); // "bb"
  console.log(longestPalindrome('a')); // "a"
  console.log(longestPalindrome('ac')); // "a" æˆ– "c"

  console.log(longestPalindromeDP('babad')); // "bab"
  console.log(longestPalindromeManacher('babad')); // "bab"
}

// test();

export {
  longestPalindrome,
  longestPalindromeDP,
  longestPalindromeManacher,
};

