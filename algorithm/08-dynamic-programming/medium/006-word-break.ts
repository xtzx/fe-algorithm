/**
 * ğŸ“ é¢˜ç›®ï¼šå•è¯æ‹†åˆ†
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/word-break/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šå­—å…¸æ ‘ã€è®°å¿†åŒ–æœç´¢ã€æ•°ç»„ã€å“ˆå¸Œè¡¨ã€å­—ç¬¦ä¸²ã€åŠ¨æ€è§„åˆ’
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ wordDict ä½œä¸ºå­—å…¸ã€‚
 * å¦‚æœå¯ä»¥åˆ©ç”¨å­—å…¸ä¸­å‡ºç°çš„ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯æ‹¼æ¥å‡º s åˆ™è¿”å› trueã€‚
 *
 * æ³¨æ„ï¼šä¸è¦æ±‚å­—å…¸ä¸­å‡ºç°çš„å•è¯å…¨éƒ¨éƒ½ä½¿ç”¨ï¼Œå¹¶ä¸”å­—å…¸ä¸­çš„å•è¯å¯ä»¥é‡å¤ä½¿ç”¨ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥: s = "leetcode", wordDict = ["leet", "code"]
 * è¾“å‡º: true
 * è§£é‡Š: è¿”å› true å› ä¸º "leetcode" å¯ä»¥ç”± "leet" å’Œ "code" æ‹¼æ¥æˆã€‚
 *
 * è¾“å…¥: s = "applepenapple", wordDict = ["apple", "pen"]
 * è¾“å‡º: true
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// è¿™æ˜¯ä¸€ä¸ª"å­˜åœ¨å‹"DP é—®é¢˜
//
// dp[i] = s[0..i-1] èƒ½å¦è¢«æ‹†åˆ†
//
// çŠ¶æ€è½¬ç§»ï¼š
// dp[i] = true if å­˜åœ¨ j < iï¼Œä½¿å¾— dp[j] === true && s[j..i-1] åœ¨å­—å…¸ä¸­
//
// ç›¸å½“äºï¼šæ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²ç‚¹

// ============================================================
// è§£æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ² Ã— k) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * s = "leetcode", wordDict = ["leet", "code"]
 *
 * dp[0] = trueï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰
 *
 * dp[1]: s[0..0]="l" ä¸åœ¨å­—å…¸ä¸­
 * dp[2]: s[0..1]="le" ä¸åœ¨å­—å…¸ä¸­
 * dp[3]: s[0..2]="lee" ä¸åœ¨å­—å…¸ä¸­
 * dp[4]: dp[0]=true && s[0..3]="leet" åœ¨å­—å…¸ä¸­ â†’ dp[4] = true
 *
 * dp[5]: s[4..4]="c" ä¸åœ¨å­—å…¸ä¸­
 * dp[6]: s[4..5]="co" ä¸åœ¨å­—å…¸ä¸­
 * dp[7]: s[4..6]="cod" ä¸åœ¨å­—å…¸ä¸­
 * dp[8]: dp[4]=true && s[4..7]="code" åœ¨å­—å…¸ä¸­ â†’ dp[8] = true
 *
 * ç­”æ¡ˆï¼šdp[8] = true
 */
function wordBreak(s: string, wordDict: string[]): boolean {
  const n = s.length;
  const wordSet = new Set(wordDict);

  // dp[i] = s[0..i-1] èƒ½å¦è¢«æ‹†åˆ†
  const dp: boolean[] = Array(n + 1).fill(false);
  dp[0] = true; // ç©ºå­—ç¬¦ä¸²

  for (let i = 1; i <= n; i++) {
    for (let j = 0; j < i; j++) {
      // å¦‚æœ s[0..j-1] å¯æ‹†åˆ†ï¼Œä¸” s[j..i-1] åœ¨å­—å…¸ä¸­
      if (dp[j] && wordSet.has(s.slice(j, i))) {
        dp[i] = true;
        break; // æ‰¾åˆ°ä¸€ç§æ‹†åˆ†æ–¹å¼å³å¯
      }
    }
  }

  return dp[n];
}

// ============================================================
// è§£æ³•äºŒï¼šä¼˜åŒ–ï¼ˆåªæ£€æŸ¥å•è¯é•¿åº¦èŒƒå›´å†…ï¼‰
// ============================================================
function wordBreak_optimized(s: string, wordDict: string[]): boolean {
  const n = s.length;
  const wordSet = new Set(wordDict);

  // è·å–å­—å…¸ä¸­å•è¯çš„æœ€å¤§é•¿åº¦
  let maxLen = 0;
  for (const word of wordDict) {
    maxLen = Math.max(maxLen, word.length);
  }

  const dp: boolean[] = Array(n + 1).fill(false);
  dp[0] = true;

  for (let i = 1; i <= n; i++) {
    // åªæ£€æŸ¥ maxLen èŒƒå›´å†…çš„åˆ†å‰²ç‚¹
    for (let j = Math.max(0, i - maxLen); j < i; j++) {
      if (dp[j] && wordSet.has(s.slice(j, i))) {
        dp[i] = true;
        break;
      }
    }
  }

  return dp[n];
}

// ============================================================
// è§£æ³•ä¸‰ï¼šè®°å¿†åŒ–é€’å½’
// ============================================================
function wordBreak_memo(s: string, wordDict: string[]): boolean {
  const wordSet = new Set(wordDict);
  const memo: Map<number, boolean> = new Map();

  function dfs(start: number): boolean {
    if (start === s.length) return true;
    if (memo.has(start)) return memo.get(start)!;

    for (let end = start + 1; end <= s.length; end++) {
      if (wordSet.has(s.slice(start, end)) && dfs(end)) {
        memo.set(start, true);
        return true;
      }
    }

    memo.set(start, false);
    return false;
  }

  return dfs(0);
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•       | æ—¶é—´       | ç©ºé—´  | ç‰¹ç‚¹              |
 * |------------|------------|-------|-------------------|
 * | DP         | O(nÂ² Ã— k)  | O(n)  | æ¨è              |
 * | DPä¼˜åŒ–     | O(n Ã— m Ã— k)| O(n) | m æ˜¯æœ€å¤§å•è¯é•¿åº¦  |
 * | è®°å¿†åŒ–é€’å½’ | O(nÂ² Ã— k)  | O(n)  | å¥½ç†è§£            |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. åˆå§‹å€¼ï¼šdp[0] = trueï¼ˆç©ºå­—ç¬¦ä¸²å¯ä»¥è¢«æ‹†åˆ†ï¼‰
 *
 * 2. å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼š
 *    - s.slice(j, i) æ˜¯ s[j..i-1]
 *    - æ³¨æ„ä¸‹æ ‡
 *
 * 3. æ‰¾åˆ°ä¸€ç§æ‹†åˆ†æ–¹å¼å°± break
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - å•è¯æ‹†åˆ† II â†’ è¿”å›æ‰€æœ‰æ‹†åˆ†æ–¹æ¡ˆ
 * - é›¶é’±å…‘æ¢ â†’ ç±»ä¼¼çš„å®Œå…¨èƒŒåŒ…
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. URL è§£æï¼šåˆ¤æ–­è·¯å¾„æ˜¯å¦æœ‰æ•ˆ
 * 2. åˆ†è¯ï¼šåˆ¤æ–­æ–‡æœ¬èƒ½å¦åˆ†è¯
 */

export { wordBreak, wordBreak_optimized, wordBreak_memo };
export default wordBreak;

