/**
 * ğŸ“ é¢˜ç›®ï¼šæ»‘åŠ¨çª—å£æœ€å¤§å€¼
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/sliding-window-maximum/
 * ğŸ·ï¸ éš¾åº¦ï¼šHard
 * ğŸ·ï¸ æ ‡ç­¾ï¼šé˜Ÿåˆ—ã€æ•°ç»„ã€æ»‘åŠ¨çª—å£ã€å•è°ƒé˜Ÿåˆ—ã€å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º k çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚
 * ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ k ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚
 * è¿”å› æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šnums = [1,3,-1,-3,5,3,6,7], k = 3
 * è¾“å‡ºï¼š[3,3,5,5,6,7]
 *
 * è§£é‡Šï¼š
 * æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼
 * ---------------               -----
 * [1  3  -1] -3  5  3  6  7       3
 *  1 [3  -1  -3] 5  3  6  7       3
 *  1  3 [-1  -3  5] 3  6  7       5
 *  1  3  -1 [-3  5  3] 6  7       5
 *  1  3  -1  -3 [5  3  6] 7       6
 *  1  3  -1  -3  5 [3  6  7]      7
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// æš´åŠ›æ³•ï¼šæ¯ä¸ªçª—å£éå†æ‰¾æœ€å¤§å€¼ â†’ O(nk)
//
// ä¼˜åŒ–æ€è€ƒï¼š
// - çª—å£ç§»åŠ¨æ—¶ï¼Œåªæœ‰ä¸€ä¸ªå…ƒç´ ç¦»å¼€ï¼Œä¸€ä¸ªå…ƒç´ åŠ å…¥
// - èƒ½å¦å¿«é€Ÿç»´æŠ¤æœ€å¤§å€¼ï¼Ÿ
//
// å•è°ƒé˜Ÿåˆ—ï¼š
// - ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡çš„åŒç«¯é˜Ÿåˆ—
// - é˜Ÿé¦–å§‹ç»ˆæ˜¯å½“å‰çª—å£çš„æœ€å¤§å€¼
// - æ–°å…ƒç´ å…¥é˜Ÿå‰ï¼Œç§»é™¤æ‰€æœ‰æ¯”å®ƒå°çš„ï¼ˆå®ƒä»¬ä¸å¯èƒ½æˆä¸ºæœ€å¤§å€¼ï¼‰
// - çª—å£ç§»åŠ¨æ—¶ï¼Œæ£€æŸ¥é˜Ÿé¦–æ˜¯å¦è¿‡æœŸ

// ============================================================
// è§£æ³•ä¸€ï¼šå•è°ƒé˜Ÿåˆ—ï¼ˆæ¨èï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(k)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * nums = [1, 3, -1, -3, 5, 3, 6, 7], k = 3
 *         0  1   2   3  4  5  6  7
 *
 * å•è°ƒé€’å‡é˜Ÿåˆ—ï¼ˆå­˜å‚¨ç´¢å¼•ï¼‰ï¼š
 *
 * i=0, num=1:  é˜Ÿåˆ—ç©ºï¼Œå…¥é˜Ÿ          é˜Ÿåˆ—:[0]      çª—å£æœªæ»¡
 * i=1, num=3:  3>1ï¼Œç§»é™¤0ï¼Œå…¥é˜Ÿ      é˜Ÿåˆ—:[1]      çª—å£æœªæ»¡
 * i=2, num=-1: -1<3ï¼Œå…¥é˜Ÿ            é˜Ÿåˆ—:[1,2]    çª—å£[1,3,-1] max=nums[1]=3
 * i=3, num=-3: -3<-1ï¼Œå…¥é˜Ÿ           é˜Ÿåˆ—:[1,2,3]  çª—å£[3,-1,-3] max=nums[1]=3
 * i=4, num=5:  ç§»é™¤è¿‡æœŸçš„1           é˜Ÿåˆ—:[2,3]
 *              5>-3>-1ï¼Œå…¨éƒ¨ç§»é™¤     é˜Ÿåˆ—:[4]      çª—å£[-1,-3,5] max=nums[4]=5
 * i=5, num=3:  3<5ï¼Œå…¥é˜Ÿ             é˜Ÿåˆ—:[4,5]    çª—å£[-3,5,3] max=nums[4]=5
 * i=6, num=6:  ç§»é™¤è¿‡æœŸçš„ï¼Ÿ4ä¸è¿‡æœŸ
 *              6>3>5ï¼Œå…¨éƒ¨ç§»é™¤       é˜Ÿåˆ—:[6]      çª—å£[5,3,6] max=nums[6]=6
 * i=7, num=7:  7>6ï¼Œç§»é™¤6            é˜Ÿåˆ—:[7]      çª—å£[3,6,7] max=nums[7]=7
 *
 * ç»“æœ: [3, 3, 5, 5, 6, 7]
 *
 * ğŸ”„ æµç¨‹å›¾ (Mermaid):
 * ```mermaid
 * flowchart TD
 *     A[éå†æ•°ç»„] --> B{é˜Ÿé¦–è¿‡æœŸ?}
 *     B -->|Yes| C[ç§»é™¤é˜Ÿé¦–]
 *     C --> B
 *     B -->|No| D{é˜Ÿå°¾ < å½“å‰å…ƒç´ ?}
 *     D -->|Yes| E[ç§»é™¤é˜Ÿå°¾]
 *     E --> D
 *     D -->|No| F[å½“å‰å…ƒç´ å…¥é˜Ÿå°¾]
 *     F --> G{çª—å£å½¢æˆ?}
 *     G -->|Yes| H[è®°å½•é˜Ÿé¦–ä¸ºæœ€å¤§å€¼]
 *     G -->|No| A
 *     H --> A
 * ```
 */
function maxSlidingWindow(nums: number[], k: number): number[] {
  const result: number[] = [];
  const deque: number[] = []; // åŒç«¯é˜Ÿåˆ—ï¼Œå­˜å‚¨ç´¢å¼•ï¼Œä¿æŒå€¼å•è°ƒé€’å‡

  for (let i = 0; i < nums.length; i++) {
    // 1. ç§»é™¤è¿‡æœŸçš„é˜Ÿé¦–ï¼ˆçª—å£å¤–çš„å…ƒç´ ï¼‰
    while (deque.length > 0 && deque[0] <= i - k) {
      deque.shift();
    }

    // 2. ç»´æŠ¤å•è°ƒé€’å‡ï¼šç§»é™¤æ‰€æœ‰æ¯”å½“å‰å…ƒç´ å°çš„
    while (deque.length > 0 && nums[deque[deque.length - 1]] < nums[i]) {
      deque.pop();
    }

    // 3. å½“å‰å…ƒç´ å…¥é˜Ÿ
    deque.push(i);

    // 4. çª—å£å½¢æˆåï¼Œè®°å½•æœ€å¤§å€¼ï¼ˆé˜Ÿé¦–ï¼‰
    if (i >= k - 1) {
      result.push(nums[deque[0]]);
    }
  }

  return result;
}

// ============================================================
// è§£æ³•äºŒï¼šç”¨åŒæŒ‡é’ˆæ¨¡æ‹ŸåŒç«¯é˜Ÿåˆ—ï¼ˆä¼˜åŒ– shift æ€§èƒ½ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(k)
function maxSlidingWindow_v2(nums: number[], k: number): number[] {
  const result: number[] = [];
  const deque: number[] = new Array(nums.length);
  let head = 0;
  let tail = 0;

  for (let i = 0; i < nums.length; i++) {
    // ç§»é™¤è¿‡æœŸçš„é˜Ÿé¦–
    while (head < tail && deque[head] <= i - k) {
      head++;
    }

    // ç»´æŠ¤å•è°ƒé€’å‡
    while (head < tail && nums[deque[tail - 1]] < nums[i]) {
      tail--;
    }

    // å…¥é˜Ÿ
    deque[tail++] = i;

    // è®°å½•æœ€å¤§å€¼
    if (i >= k - 1) {
      result.push(nums[deque[head]]);
    }
  }

  return result;
}

// ============================================================
// è§£æ³•ä¸‰ï¼šæš´åŠ›æ³•ï¼ˆè¶…æ—¶ï¼Œä»…ä¾›ç†è§£ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(nk) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)
function maxSlidingWindow_v3(nums: number[], k: number): number[] {
  const result: number[] = [];

  for (let i = 0; i <= nums.length - k; i++) {
    let max = nums[i];
    for (let j = i + 1; j < i + k; j++) {
      max = Math.max(max, nums[j]);
    }
    result.push(max);
  }

  return result;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•       | æ—¶é—´   | ç©ºé—´  | ç‰¹ç‚¹                     |
 * |-----------|--------|-------|-------------------------|
 * | å•è°ƒé˜Ÿåˆ—   | O(n)   | O(k)  | æ¨èï¼Œæœ€ä¼˜è§£             |
 * | ä¼˜åŒ–shift  | O(n)   | O(k)  | æ€§èƒ½æ›´å¥½                 |
 * | æš´åŠ›      | O(nk)  | O(1)  | ç®€å•ä½†æ…¢                 |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. è¿‡æœŸåˆ¤æ–­ï¼š
 *    - deque[0] <= i - k è¡¨ç¤ºé˜Ÿé¦–è¶…å‡ºçª—å£å·¦è¾¹ç•Œ
 *    - ä¸æ˜¯ < è€Œæ˜¯ <=
 *
 * 2. é˜Ÿåˆ—å­˜å‚¨ç´¢å¼•è€Œä¸æ˜¯å€¼ï¼š
 *    - éœ€è¦åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œæ‰€ä»¥å­˜ç´¢å¼•
 *    - å–å€¼æ—¶ç”¨ nums[deque[0]]
 *
 * 3. ç»´æŠ¤å•è°ƒé€’å‡ï¼š
 *    - ç§»é™¤æ¯”å½“å‰å…ƒç´ å°çš„ï¼ˆä¸æ˜¯å°äºç­‰äºï¼‰
 *    - nums[deque[tail]] < nums[i]
 *
 * 4. JavaScript shift() æ€§èƒ½ï¼š
 *    - shift() æ˜¯ O(n)
 *    - å¤§é‡è°ƒç”¨ä¼šå¯¼è‡´è¶…æ—¶
 *    - å¯ä»¥ç”¨åŒæŒ‡é’ˆæ¨¡æ‹Ÿ
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - æ»‘åŠ¨çª—å£ä¸­ä½æ•° â†’ æ›´å¤æ‚ï¼Œéœ€è¦ä¸¤ä¸ªå †
 * - æœ€å¤§è¿ç»­ 1 çš„ä¸ªæ•° III â†’ æ»‘åŠ¨çª—å£
 * - ç»å¯¹å·®ä¸è¶…è¿‡é™åˆ¶çš„æœ€é•¿è¿ç»­å­æ•°ç»„ â†’ å•è°ƒé˜Ÿåˆ—ç»´æŠ¤æœ€å¤§æœ€å°å€¼
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. å®æ—¶æ•°æ®ç›‘æ§ï¼šæ»‘åŠ¨æ—¶é—´çª—å£å†…çš„æœ€å¤§/æœ€å°å€¼
 * 2. è‚¡ç¥¨å›¾è¡¨ï¼šè®¡ç®— K æ—¥å†…æœ€é«˜ä»·
 * 3. æ€§èƒ½ç›‘æ§ï¼šæ»‘åŠ¨çª—å£å†…çš„æœ€å¤§å»¶è¿Ÿ
 * 4. æ¸¸æˆå¼€å‘ï¼šè®¡ç®—æ»šåŠ¨ä¼¤å®³ç»Ÿè®¡
 */

export {
  maxSlidingWindow,
  maxSlidingWindow_v2,
  maxSlidingWindow_v3,
};
export default maxSlidingWindow;

