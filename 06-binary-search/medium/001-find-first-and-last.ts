/**
 * ğŸ“ é¢˜ç›®ï¼šåœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/find-first-and-last-position-of-element-in-sorted-array/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ•°ç»„ã€äºŒåˆ†æŸ¥æ‰¾
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ªæŒ‰ç…§éé€’å‡é¡ºåºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numsï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetã€‚
 * è¯·ä½ æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚
 *
 * å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ targetï¼Œè¿”å› [-1, -1]ã€‚
 *
 * ä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šnums = [5,7,7,8,8,10], target = 8
 * è¾“å‡ºï¼š[3,4]
 *
 * è¾“å…¥ï¼šnums = [5,7,7,8,8,10], target = 6
 * è¾“å‡ºï¼š[-1,-1]
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// ä¸¤æ¬¡äºŒåˆ†æŸ¥æ‰¾ï¼š
// 1. æ‰¾ç¬¬ä¸€ä¸ª >= target çš„ä½ç½®ï¼ˆå·¦è¾¹ç•Œï¼‰
// 2. æ‰¾ç¬¬ä¸€ä¸ª > target çš„ä½ç½® - 1ï¼ˆå³è¾¹ç•Œï¼‰
//
// æˆ–è€…ï¼š
// 1. æ‰¾ç¬¬ä¸€ä¸ª == target çš„ä½ç½®
// 2. æ‰¾æœ€åä¸€ä¸ª == target çš„ä½ç½®

// ============================================================
// è§£æ³•ï¼šä¸¤æ¬¡è¾¹ç•ŒäºŒåˆ†
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(log n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * nums = [5, 7, 7, 8, 8, 10], target = 8
 *         0  1  2  3  4   5
 *
 * ç¬¬ä¸€æ¬¡äºŒåˆ†ï¼šæ‰¾ç¬¬ä¸€ä¸ª >= 8 çš„ä½ç½®
 *   ç»“æœ: 3
 *
 * ç¬¬äºŒæ¬¡äºŒåˆ†ï¼šæ‰¾ç¬¬ä¸€ä¸ª > 8 çš„ä½ç½®
 *   ç»“æœ: 5
 *   å³è¾¹ç•Œ = 5 - 1 = 4
 *
 * è¿”å› [3, 4]
 */
function searchRange(nums: number[], target: number): number[] {
  const left = findLeft(nums, target);
  const right = findRight(nums, target);

  // æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°
  if (left > right) {
    return [-1, -1];
  }

  return [left, right];
}

// æ‰¾ç¬¬ä¸€ä¸ª >= target çš„ä½ç½®
function findLeft(nums: number[], target: number): number {
  let left = 0;
  let right = nums.length;

  while (left < right) {
    const mid = left + ((right - left) >> 1);
    if (nums[mid] >= target) {
      right = mid;
    } else {
      left = mid + 1;
    }
  }

  return left;
}

// æ‰¾æœ€åä¸€ä¸ª <= target çš„ä½ç½®
function findRight(nums: number[], target: number): number {
  let left = 0;
  let right = nums.length;

  while (left < right) {
    const mid = left + ((right - left) >> 1);
    if (nums[mid] > target) {
      right = mid;
    } else {
      left = mid + 1;
    }
  }

  return left - 1;
}

// ============================================================
// è§£æ³•äºŒï¼šç»Ÿä¸€æ¨¡æ¿
// ============================================================
function searchRange_v2(nums: number[], target: number): number[] {
  // ç¬¬ä¸€ä¸ª >= target çš„ä½ç½®
  const leftBound = lowerBound(nums, target);

  // å¦‚æœä¸å­˜åœ¨ target
  if (leftBound === nums.length || nums[leftBound] !== target) {
    return [-1, -1];
  }

  // ç¬¬ä¸€ä¸ª > target çš„ä½ç½® - 1 = æœ€åä¸€ä¸ª == target çš„ä½ç½®
  const rightBound = lowerBound(nums, target + 1) - 1;

  return [leftBound, rightBound];
}

function lowerBound(nums: number[], target: number): number {
  let left = 0;
  let right = nums.length;

  while (left < right) {
    const mid = left + ((right - left) >> 1);
    if (nums[mid] >= target) {
      right = mid;
    } else {
      left = mid + 1;
    }
  }

  return left;
}

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. ä¸å­˜åœ¨çš„æƒ…å†µï¼š
 *    - left > right è¯´æ˜ target ä¸åœ¨æ•°ç»„ä¸­
 *    - æˆ–è€…æ‰¾åˆ°çš„ä½ç½®å€¼ä¸ç­‰äº target
 *
 * 2. å³è¾¹ç•Œçš„è®¡ç®—ï¼š
 *    - æ‰¾ç¬¬ä¸€ä¸ª > target çš„ä½ç½®ï¼Œç„¶å -1
 *    - æˆ–è€…ç”¨ lowerBound(target + 1) - 1
 *
 * 3. è¾¹ç•Œæƒ…å†µï¼š
 *    - ç©ºæ•°ç»„
 *    - target æ¯”æ‰€æœ‰å…ƒç´ éƒ½å°æˆ–éƒ½å¤§
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - ç»Ÿè®¡ç›®æ ‡å€¼å‡ºç°çš„æ¬¡æ•° â†’ right - left + 1
 * - æœç´¢æ’å…¥ä½ç½® â†’ åªéœ€è¦å·¦è¾¹ç•Œ
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. æ—¥æœŸèŒƒå›´æŸ¥è¯¢ï¼šåœ¨æœ‰åºæ—¥æœŸæ•°ç»„ä¸­æ‰¾æŸä¸ªæ—¥æœŸèŒƒå›´
 * 2. åˆ†é¡µæ•°æ®ï¼šæ‰¾æŸä¸ªåˆ†æ•°æ®µçš„èµ·æ­¢ç´¢å¼•
 * 3. æ—¥å¿—åˆ†æï¼šæ‰¾æŸä¸ªæ—¶é—´æ®µçš„æ—¥å¿—æ¡ç›®
 */

export { searchRange, searchRange_v2 };
export default searchRange;

