/**
 * ğŸ“ é¢˜ç›®ï¼šå¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/median-of-two-sorted-arrays/
 * ğŸ·ï¸ éš¾åº¦ï¼šHard
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ•°ç»„ã€äºŒåˆ†æŸ¥æ‰¾ã€åˆ†æ²»
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™å®šä¸¤ä¸ªå¤§å°åˆ†åˆ«ä¸º m å’Œ n çš„æ­£åºï¼ˆä»å°åˆ°å¤§ï¼‰æ•°ç»„ nums1 å’Œ nums2ã€‚
 * è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›è¿™ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ ä¸­ä½æ•°ã€‚
 *
 * ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¸º O(log(m+n))ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šnums1 = [1,3], nums2 = [2]
 * è¾“å‡ºï¼š2.00000
 * è§£é‡Šï¼šåˆå¹¶æ•°ç»„ = [1,2,3]ï¼Œä¸­ä½æ•° 2
 *
 * è¾“å…¥ï¼šnums1 = [1,2], nums2 = [3,4]
 * è¾“å‡ºï¼š2.50000
 * è§£é‡Šï¼šåˆå¹¶æ•°ç»„ = [1,2,3,4]ï¼Œä¸­ä½æ•° (2 + 3) / 2 = 2.5
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// ä¸­ä½æ•°æŠŠæ•°ç»„åˆ†æˆä¸¤åŠï¼šå·¦åŠè¾¹ <= å³åŠè¾¹
//
// å…³é”®æ´å¯Ÿï¼š
// - ä¸éœ€è¦çœŸçš„åˆå¹¶æ•°ç»„
// - åªéœ€è¦æ‰¾åˆ°æ­£ç¡®çš„"åˆ†å‰²ä½ç½®"
// - ä½¿å¾—å·¦åŠè¾¹çš„æ‰€æœ‰å…ƒç´  <= å³åŠè¾¹çš„æ‰€æœ‰å…ƒç´ 
//
// å¦‚æœæˆ‘ä»¬åœ¨ nums1 ä¸­é€‰æ‹©äº† i ä¸ªå…ƒç´ æ”¾å…¥å·¦åŠè¾¹ï¼Œ
// é‚£ä¹ˆéœ€è¦ä» nums2 ä¸­é€‰æ‹© (m+n+1)/2 - i ä¸ªå…ƒç´ æ”¾å…¥å·¦åŠè¾¹
//
// ç„¶åéªŒè¯è¿™ä¸ªåˆ†å‰²æ˜¯å¦æ­£ç¡®ï¼š
// - nums1[i-1] <= nums2[j]
// - nums2[j-1] <= nums1[i]

// ============================================================
// è§£æ³•ï¼šäºŒåˆ†æŸ¥æ‰¾åˆ†å‰²ä½ç½®
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(log(min(m,n))) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * nums1 = [1, 3, 8, 9, 15]
 * nums2 = [7, 11, 18, 19, 21, 25]
 *
 * æ€»å…± 11 ä¸ªå…ƒç´ ï¼Œå·¦åŠè¾¹éœ€è¦ 6 ä¸ª
 *
 * åœ¨ nums1 ä¸­äºŒåˆ†æ‰¾åˆ†å‰²ä½ç½® iï¼š
 *
 *       nums1: [ 1  3  8 | 9  15 ]
 *                   i=3
 *       nums2: [ 7  11  18 | 19  21  25 ]
 *                    j=3
 *
 *       å·¦åŠè¾¹: [1, 3, 8, 7, 11, 18]
 *       å³åŠè¾¹: [9, 15, 19, 21, 25]
 *
 *       éªŒè¯: nums1[2]=8 <= nums2[3]=19 âœ“
 *             nums2[2]=18 > nums1[3]=9 âœ—
 *
 * ç»§ç»­äºŒåˆ†... æœ€ç»ˆæ‰¾åˆ°æ­£ç¡®åˆ†å‰²
 *
 * ```mermaid
 * flowchart TD
 *     A[ç¡®ä¿ nums1 è¾ƒçŸ­] --> B[äºŒåˆ†æŸ¥æ‰¾ i]
 *     B --> C[è®¡ç®— j = half - i]
 *     C --> D{åˆ†å‰²æ­£ç¡®?}
 *     D -->|å·¦è¾¹å¤ªå¤§| E[i å¾€å·¦ç§»]
 *     D -->|å·¦è¾¹å¤ªå°| F[i å¾€å³ç§»]
 *     D -->|æ­£ç¡®| G[è®¡ç®—ä¸­ä½æ•°]
 *     E --> B
 *     F --> B
 * ```
 */
function findMedianSortedArrays(nums1: number[], nums2: number[]): number {
  // ç¡®ä¿ nums1 æ˜¯è¾ƒçŸ­çš„æ•°ç»„
  if (nums1.length > nums2.length) {
    return findMedianSortedArrays(nums2, nums1);
  }

  const m = nums1.length;
  const n = nums2.length;
  const halfLen = Math.floor((m + n + 1) / 2);

  let left = 0;
  let right = m;

  while (left <= right) {
    // i: nums1 ä¸­å·¦åŠè¾¹çš„å…ƒç´ ä¸ªæ•°
    const i = Math.floor((left + right) / 2);
    // j: nums2 ä¸­å·¦åŠè¾¹çš„å…ƒç´ ä¸ªæ•°
    const j = halfLen - i;

    // nums1 å·¦åŠè¾¹æœ€å¤§å€¼
    const nums1LeftMax = i === 0 ? -Infinity : nums1[i - 1];
    // nums1 å³åŠè¾¹æœ€å°å€¼
    const nums1RightMin = i === m ? Infinity : nums1[i];
    // nums2 å·¦åŠè¾¹æœ€å¤§å€¼
    const nums2LeftMax = j === 0 ? -Infinity : nums2[j - 1];
    // nums2 å³åŠè¾¹æœ€å°å€¼
    const nums2RightMin = j === n ? Infinity : nums2[j];

    if (nums1LeftMax <= nums2RightMin && nums2LeftMax <= nums1RightMin) {
      // æ‰¾åˆ°æ­£ç¡®çš„åˆ†å‰²
      if ((m + n) % 2 === 1) {
        // å¥‡æ•°ä¸ªå…ƒç´ ï¼Œä¸­ä½æ•°æ˜¯å·¦åŠè¾¹æœ€å¤§å€¼
        return Math.max(nums1LeftMax, nums2LeftMax);
      } else {
        // å¶æ•°ä¸ªå…ƒç´ ï¼Œä¸­ä½æ•°æ˜¯å·¦å³ä¸¤è¾¹ç•Œçš„å¹³å‡
        return (
          (Math.max(nums1LeftMax, nums2LeftMax) +
            Math.min(nums1RightMin, nums2RightMin)) /
          2
        );
      }
    } else if (nums1LeftMax > nums2RightMin) {
      // nums1 å·¦è¾¹å¤ªå¤§ï¼Œéœ€è¦å¾€å·¦ç§»
      right = i - 1;
    } else {
      // nums1 å·¦è¾¹å¤ªå°ï¼Œéœ€è¦å¾€å³ç§»
      left = i + 1;
    }
  }

  return 0; // ä¸ä¼šåˆ°è¾¾è¿™é‡Œ
}

// ============================================================
// è§£æ³•äºŒï¼šæ‰¾ç¬¬ K å°ï¼ˆé€’å½’ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(log(m+n)) | ç©ºé—´å¤æ‚åº¦ï¼šO(log(m+n))

function findMedianSortedArrays_v2(nums1: number[], nums2: number[]): number {
  const total = nums1.length + nums2.length;
  if (total % 2 === 1) {
    return findKth(nums1, 0, nums2, 0, Math.floor(total / 2) + 1);
  } else {
    const left = findKth(nums1, 0, nums2, 0, Math.floor(total / 2));
    const right = findKth(nums1, 0, nums2, 0, Math.floor(total / 2) + 1);
    return (left + right) / 2;
  }
}

// æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„ä¸­ç¬¬ k å°çš„å…ƒç´ 
function findKth(
  nums1: number[],
  start1: number,
  nums2: number[],
  start2: number,
  k: number
): number {
  // å¦‚æœ nums1 å·²ç»éå†å®Œï¼Œè¿”å› nums2 ä¸­ç¬¬ k ä¸ª
  if (start1 >= nums1.length) {
    return nums2[start2 + k - 1];
  }
  // å¦‚æœ nums2 å·²ç»éå†å®Œï¼Œè¿”å› nums1 ä¸­ç¬¬ k ä¸ª
  if (start2 >= nums2.length) {
    return nums1[start1 + k - 1];
  }
  // k=1 æ—¶è¿”å›ä¸¤ä¸ªæ•°ç»„å½“å‰ä½ç½®çš„è¾ƒå°å€¼
  if (k === 1) {
    return Math.min(nums1[start1], nums2[start2]);
  }

  // æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„ç¬¬ k/2 ä½ç½®çš„å…ƒç´ 
  const half = Math.floor(k / 2);
  const index1 = Math.min(start1 + half - 1, nums1.length - 1);
  const index2 = Math.min(start2 + half - 1, nums2.length - 1);

  if (nums1[index1] <= nums2[index2]) {
    // æ’é™¤ nums1 çš„å‰ half ä¸ªå…ƒç´ 
    const count = index1 - start1 + 1;
    return findKth(nums1, index1 + 1, nums2, start2, k - count);
  } else {
    // æ’é™¤ nums2 çš„å‰ half ä¸ªå…ƒç´ 
    const count = index2 - start2 + 1;
    return findKth(nums1, start1, nums2, index2 + 1, k - count);
  }
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•        | æ—¶é—´            | ç©ºé—´          | ç‰¹ç‚¹            |
 * |------------|-----------------|---------------|-----------------|
 * | åˆ†å‰²ä½ç½®äºŒåˆ† | O(log(min(m,n)))| O(1)          | æ¨èï¼Œç©ºé—´æœ€ä¼˜   |
 * | æ‰¾ç¬¬Kå°    | O(log(m+n))     | O(log(m+n))   | æ€è·¯æ¸…æ™°        |
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. ç¡®ä¿åœ¨è¾ƒçŸ­æ•°ç»„ä¸ŠäºŒåˆ†ï¼š
 *    - å‡å°‘æ—¶é—´å¤æ‚åº¦
 *    - é¿å… j è¶Šç•Œ
 *
 * 2. è¾¹ç•Œå¤„ç†ï¼š
 *    - i=0 æ—¶ï¼Œnums1 å·¦è¾¹ä¸ºç©ºï¼Œç”¨ -Infinity
 *    - i=m æ—¶ï¼Œnums1 å³è¾¹ä¸ºç©ºï¼Œç”¨ Infinity
 *
 * 3. å¥‡å¶åŒºåˆ†ï¼š
 *    - å¥‡æ•°ï¼šä¸­ä½æ•°æ˜¯å·¦åŠè¾¹æœ€å¤§å€¼
 *    - å¶æ•°ï¼šä¸­ä½æ•°æ˜¯å·¦å³è¾¹ç•Œçš„å¹³å‡
 *
 * 4. halfLen çš„è®¡ç®—ï¼š
 *    - (m + n + 1) / 2ï¼ŒåŠ  1 æ˜¯ä¸ºäº†å¥‡æ•°æ—¶å·¦è¾¹å¤šä¸€ä¸ª
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - æœ‰åºçŸ©é˜µä¸­ç¬¬ K å°çš„å…ƒç´  â†’ ç±»ä¼¼æ€è·¯
 * - åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ â†’ æ›´ç®€å•çš„ç‰ˆæœ¬
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. æ•°æ®ç»Ÿè®¡ï¼šè®¡ç®—å¤šä¸ªæ•°æ®æºçš„ä¸­ä½æ•°
 * 2. è´Ÿè½½å‡è¡¡ï¼šæ‰¾åˆ°å“åº”æ—¶é—´çš„ä¸­ä½æ•°
 * 3. A/B æµ‹è¯•ï¼šæ¯”è¾ƒä¸¤ç»„æ•°æ®çš„ä¸­ä½æ•°
 */

export { findMedianSortedArrays, findMedianSortedArrays_v2 };
export default findMedianSortedArrays;

