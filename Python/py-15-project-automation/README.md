# P15: æ—¥å¿—åˆ†æä¸æ¸…ç†å·¥å…·

> ç»¼åˆé¡¹ç›® 2 - è¿ç”¨æ•°æ®å¤„ç†å’Œè‡ªåŠ¨åŒ–çŸ¥è¯†æ„å»ºå®ç”¨å·¥å…·

## ğŸ¯ é¡¹ç›®ç›®æ ‡

å¼€å‘ä¸€ä¸ªã€Œæ—¥å¿—åˆ†æä¸æ¸…ç†å·¥å…·ã€ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š

- ğŸ“„ è§£æå¤šç§æ ¼å¼çš„æ—¥å¿—æ–‡ä»¶ï¼ˆNginxã€Appã€JSONï¼‰
- ğŸ“Š æå–å…³é”®ä¿¡æ¯ï¼ˆé”™è¯¯ã€è­¦å‘Šã€æ—¶é—´åˆ†å¸ƒï¼‰
- ğŸ“‹ ç”Ÿæˆåˆ†ææŠ¥å‘Šï¼ˆç»ˆç«¯ã€JSONã€Markdownï¼‰
- ğŸ§¹ æ‰¹é‡æ¸…ç†/å½’æ¡£æ—§æ—¥å¿—
- âš™ï¸ æ”¯æŒé…ç½®å’Œ dry-run æ¨¡å¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd py-15-project-automation

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -e ".[dev]"

# æŸ¥çœ‹å¸®åŠ©
log-analyzer --help

# åˆ†ææ—¥å¿—
log-analyzer analyze sample_logs/ --format nginx

# ç”ŸæˆæŠ¥å‘Š
log-analyzer report sample_logs/ --output report.md

# æ¸…ç†æ—§æ—¥å¿—ï¼ˆé¢„è§ˆï¼‰
log-analyzer clean sample_logs/ --older-than 30 --dry-run

# å®é™…æ¸…ç†
log-analyzer clean sample_logs/ --older-than 30 --execute
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
py-15-project-automation/
â”œâ”€â”€ README.md                    # æœ¬æ–‡ä»¶
â”œâ”€â”€ pyproject.toml              # é¡¹ç›®é…ç½®
â”œâ”€â”€ src/
â”‚   â””â”€â”€ log_analyzer/           # ä¸»åŒ…
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ __main__.py         # python -m å…¥å£
â”‚       â”œâ”€â”€ cli.py              # CLI å‘½ä»¤
â”‚       â”œâ”€â”€ config.py           # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ models.py           # æ•°æ®æ¨¡å‹
â”‚       â”œâ”€â”€ parsers/            # æ—¥å¿—è§£æå™¨
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ base.py         # è§£æå™¨åŸºç±»
â”‚       â”‚   â”œâ”€â”€ nginx.py        # Nginx æ—¥å¿—
â”‚       â”‚   â”œâ”€â”€ app.py          # åº”ç”¨æ—¥å¿—
â”‚       â”‚   â””â”€â”€ json_log.py     # JSON æ—¥å¿—
â”‚       â”œâ”€â”€ analyzers/          # åˆ†æå™¨
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ errors.py       # é”™è¯¯åˆ†æ
â”‚       â”‚   â”œâ”€â”€ requests.py     # è¯·æ±‚åˆ†æ
â”‚       â”‚   â””â”€â”€ timeline.py     # æ—¶é—´åˆ†å¸ƒ
â”‚       â”œâ”€â”€ cleaners/           # æ¸…ç†å™¨
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ archiver.py     # å½’æ¡£
â”‚       â”‚   â””â”€â”€ compressor.py   # å‹ç¼©
â”‚       â””â”€â”€ reporters/          # æŠ¥å‘Šç”Ÿæˆ
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ terminal.py     # ç»ˆç«¯è¾“å‡º
â”‚           â”œâ”€â”€ json_report.py  # JSON æŠ¥å‘Š
â”‚           â””â”€â”€ markdown.py     # Markdown æŠ¥å‘Š
â”œâ”€â”€ tests/                      # æµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_parsers.py
â”‚   â”œâ”€â”€ test_analyzers.py
â”‚   â”œâ”€â”€ test_cleaners.py
â”‚   â””â”€â”€ test_reporters.py
â”œâ”€â”€ sample_logs/                # ç¤ºä¾‹æ—¥å¿—
â”‚   â”œâ”€â”€ nginx.log
â”‚   â”œâ”€â”€ app.log
â”‚   â””â”€â”€ json.log
â””â”€â”€ scripts/
    â”œâ”€â”€ run_demo.sh             # æ¼”ç¤ºè„šæœ¬
    â””â”€â”€ test.sh                 # æµ‹è¯•è„šæœ¬
```

## ğŸ”§ åŠŸèƒ½è¯¦è§£

### 1. æ—¥å¿—è§£æ

æ”¯æŒä¸‰ç§æ—¥å¿—æ ¼å¼ï¼š

```bash
# Nginx è®¿é—®æ—¥å¿—
log-analyzer analyze logs/ --format nginx

# åº”ç”¨æ—¥å¿—ï¼ˆtimestamp level messageï¼‰
log-analyzer analyze logs/ --format app

# JSON æ—¥å¿—
log-analyzer analyze logs/ --format json

# è‡ªåŠ¨æ£€æµ‹æ ¼å¼
log-analyzer analyze logs/ --format auto
```

### 2. åˆ†æåŠŸèƒ½

```bash
# é”™è¯¯ç»Ÿè®¡
log-analyzer analyze logs/ --type errors

# è¯·æ±‚ç»Ÿè®¡ï¼ˆä»… Nginxï¼‰
log-analyzer analyze logs/ --type requests

# æ—¶é—´åˆ†å¸ƒ
log-analyzer analyze logs/ --type timeline

# å…¨éƒ¨åˆ†æ
log-analyzer analyze logs/ --type all
```

### 3. æŠ¥å‘Šç”Ÿæˆ

```bash
# ç»ˆç«¯å½©è‰²è¾“å‡ºï¼ˆé»˜è®¤ï¼‰
log-analyzer report logs/

# JSON æŠ¥å‘Š
log-analyzer report logs/ --format json --output report.json

# Markdown æŠ¥å‘Š
log-analyzer report logs/ --format markdown --output report.md
```

### 4. æ—¥å¿—æ¸…ç†

```bash
# é¢„è§ˆæ¸…ç†ï¼ˆdry-runï¼‰
log-analyzer clean logs/ --older-than 30 --dry-run

# å½’æ¡£æ—§æ—¥å¿—
log-analyzer clean logs/ --older-than 30 --archive --execute

# å‹ç¼©å½’æ¡£
log-analyzer clean logs/ --older-than 30 --compress --execute

# æŸ¥çœ‹æ¸…ç†çŠ¶æ€
log-analyzer clean --status

# æ¢å¤ä¸­æ–­çš„æ¸…ç†
log-analyzer clean --resume
```

## ğŸ“Š æŠ¥å‘Šç¤ºä¾‹

### ç»ˆç«¯è¾“å‡º

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     æ—¥å¿—åˆ†ææŠ¥å‘Š                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ åˆ†ææ—¶é—´: 2024-01-15 10:30:00                                â•‘
â•‘ æ—¥å¿—æ–‡ä»¶: 5 ä¸ª                                                â•‘
â•‘ æ€»è®°å½•æ•°: 15,234                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š é”™è¯¯ç»Ÿè®¡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ERROR   : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  234 (45%)
  WARNING : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  156 (30%)
  CRITICAL: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  130 (25%)

ğŸ“ˆ è¯·æ±‚ç»Ÿè®¡ (Top 5 URLs)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  /api/users      : 3,456 requests (avg: 45ms)
  /api/products   : 2,891 requests (avg: 120ms)
  /api/orders     : 1,234 requests (avg: 89ms)
```

## âš¡ æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” |
|------|------|
| **pydantic** | æ—¥å¿—æ¨¡å‹å®šä¹‰å’ŒéªŒè¯ |
| **argparse** | CLI å‘½ä»¤è¡Œæ¥å£ |
| **pathlib** | æ–‡ä»¶è·¯å¾„å¤„ç† |
| **gzip/tarfile** | æ—¥å¿—å‹ç¼©å½’æ¡£ |
| **re** | æ—¥å¿—æ­£åˆ™è§£æ |
| **collections** | ç»Ÿè®¡è®¡æ•° |

## ğŸ“ çŸ¥è¯†è¿ç”¨

æœ¬é¡¹ç›®ç»¼åˆè¿ç”¨äº† P12-P14 çš„çŸ¥è¯†ï¼š

- **P12 æ•°æ®å¤„ç†**ï¼špydantic æ¨¡å‹ã€æ•°æ®è§£æã€æ¸…æ´—
- **P13 æ–‡ä»¶è‡ªåŠ¨åŒ–**ï¼šæ‰¹é‡å¤„ç†ã€dry-runã€æ–­ç‚¹ç»­è·‘
- **P14 å·¥ç¨‹åŒ–è„šæ‰‹æ¶**ï¼šé¡¹ç›®ç»“æ„ã€é…ç½®ç®¡ç†ã€CLI

## âœ… åŠŸèƒ½æ¸…å•

- [x] å¤šæ ¼å¼æ—¥å¿—è§£æï¼ˆNginxã€Appã€JSONï¼‰
- [x] pydantic æ—¥å¿—æ¨¡å‹
- [x] å¼‚å¸¸/æŸåæ—¥å¿—å¤„ç†
- [x] é”™è¯¯ç»Ÿè®¡ï¼ˆæŒ‰ç±»å‹ã€æ—¶é—´ï¼‰
- [x] è¯·æ±‚ç»Ÿè®¡ï¼ˆURLã€çŠ¶æ€ç ã€å“åº”æ—¶é—´ï¼‰
- [x] æ—¶é—´åˆ†å¸ƒå›¾è¡¨
- [x] æŒ‰æ—¶é—´å½’æ¡£
- [x] å‹ç¼©æ—§æ—¥å¿—
- [x] dry-run é¢„è§ˆ
- [x] æ–­ç‚¹ç»­è·‘
- [x] ç»ˆç«¯å½©è‰²è¾“å‡º
- [x] JSON æŠ¥å‘Š
- [x] Markdown æŠ¥å‘Š

