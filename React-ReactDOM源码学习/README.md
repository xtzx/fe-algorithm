# React 18 æºç å­¦ä¹ æŒ‡å—

> é¢å‘é¢è¯• + å®é™…å¼€å‘çš„ React æºç å­¦ä¹ è·¯å¾„

## ğŸ“š å­¦ä¹ ç›®æ ‡

å­¦å®Œæœ¬æŒ‡å—ï¼Œä½ å°†èƒ½å¤Ÿï¼š

1. **é¢è¯•åº”å¯¹**ï¼šå›ç­” 95%+ çš„ React åŸç†é¢è¯•é¢˜
2. **æ·±å…¥ç†è§£**ï¼šçœŸæ­£ç†è§£ React çš„è®¾è®¡æ€æƒ³å’Œå®ç°åŸç†
3. **å®é™…å¼€å‘**ï¼šå†™å‡ºæ›´é«˜è´¨é‡çš„ React ä»£ç ï¼Œå¿«é€Ÿå®šä½é—®é¢˜
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šåŸºäºåŸç†è¿›è¡Œæœ‰é’ˆå¯¹æ€§çš„æ€§èƒ½ä¼˜åŒ–
5. **æ¶æ„èƒ½åŠ›**ï¼šå­¦ä¹ é¡¶çº§å¼€æºé¡¹ç›®çš„å·¥ç¨‹åŒ–å®è·µ

---

## ğŸ“– å­¦ä¹ è·¯å¾„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React æºç å­¦ä¹ è·¯å¾„                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Phase 0: æ¶æ„è®¾è®¡ï¼ˆå·¥ç¨‹åŒ–è§†è§’ï¼‰                         â”‚   â”‚
â”‚  â”‚  Monorepo â”‚ æ„å»ºç³»ç»Ÿ â”‚ åŒ…è®¾è®¡ â”‚ æµ‹è¯•ä½“ç³»               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Phase 1-8: æ ¸å¿ƒåŸç†ï¼ˆæºç è§†è§’ï¼‰                         â”‚   â”‚
â”‚  â”‚  JSX â”‚ Fiber â”‚ Render â”‚ Hooks â”‚ Diff â”‚ Scheduler        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ æºç ç›®å½•ç»“æ„

```
packages/
â”œâ”€â”€ react/                  # â­ React æ ¸å¿ƒ APIï¼ˆcreateElementã€Hooksï¼‰
â”œâ”€â”€ react-dom/              # â­ DOM æ¸²æŸ“å™¨
â”œâ”€â”€ react-reconciler/       # â­â­â­ åè°ƒå™¨ï¼ˆFiber æ ¸å¿ƒï¼Œæœ€é‡è¦ï¼ï¼‰
â”œâ”€â”€ scheduler/              # â­â­ è°ƒåº¦å™¨ï¼ˆæ—¶é—´åˆ‡ç‰‡ã€ä¼˜å…ˆçº§ï¼‰
â”œâ”€â”€ shared/                 # å…±äº«å·¥å…·å‡½æ•°
â”œâ”€â”€ react-is/               # ç±»å‹åˆ¤æ–­å·¥å…·
â””â”€â”€ use-sync-external-store/ # å¤–éƒ¨çŠ¶æ€åŒæ­¥
```

### æ ¸å¿ƒåŒ…è¯´æ˜

| åŒ…å | é‡è¦ç¨‹åº¦ | è¯´æ˜ |
|------|---------|------|
| `react-reconciler` | â­â­â­â­â­ | Fiber æ¶æ„æ ¸å¿ƒï¼Œå¿…è¯» |
| `react` | â­â­â­â­ | React API å…¥å£ï¼ŒHooks å®šä¹‰ |
| `react-dom` | â­â­â­â­ | DOM æ“ä½œï¼Œäº‹ä»¶ç³»ç»Ÿ |
| `scheduler` | â­â­â­ | è°ƒåº¦ç®—æ³•ï¼Œä¼˜å…ˆçº§ |
| `shared` | â­â­ | å·¥å…·å‡½æ•°ï¼Œè¾…åŠ©ç†è§£ |

---

## ğŸ“– å­¦ä¹ è·¯å¾„ï¼ˆ8 ä¸ªé˜¶æ®µï¼‰

### é˜¶æ®µæ¦‚è§ˆ

```
Phase 1: åŸºç¡€æ¦‚å¿µ     â†’ ç†è§£ React è®¾è®¡ç†å¿µ
Phase 2: JSX ä¸å…ƒç´     â†’ createElement å’Œ ReactElement
Phase 3: Fiber æ¶æ„    â†’ æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ˆé¢è¯•é‡ç‚¹ï¼‰
Phase 4: æ¸²æŸ“æµç¨‹     â†’ render/commit ä¸¤é˜¶æ®µ
Phase 5: Hooks åŸç†   â†’ useState/useEffect å®ç°ï¼ˆé¢è¯•é‡ç‚¹ï¼‰
Phase 6: Diff ç®—æ³•    â†’ åè°ƒè¿‡ç¨‹ï¼ˆé¢è¯•é‡ç‚¹ï¼‰
Phase 7: è°ƒåº¦æœºåˆ¶     â†’ æ—¶é—´åˆ‡ç‰‡ã€ä¼˜å…ˆçº§
Phase 8: å¹¶å‘ç‰¹æ€§     â†’ Concurrent Modeï¼ˆ18 æ–°ç‰¹æ€§ï¼‰
```

---

## ğŸ“ å­¦ä¹ æ–‡ä»¶å¤¹

è¯·æŒ‰é¡ºåºå­¦ä¹ ä»¥ä¸‹æ¨¡å—ï¼š

```
00-architecture-design/  # ğŸ†• æ¶æ„è®¾è®¡ï¼ˆMonorepo/æ„å»º/åŒ…è®¾è®¡ï¼‰
01-jsx-element/          # JSX ä¸ React å…ƒç´ 
02-fiber-architecture/   # Fiber æ¶æ„æ·±å…¥
03-render-process/       # æ¸²æŸ“æµç¨‹
04-hooks-principle/      # Hooks åŸç†
05-diff-algorithm/       # Diff ç®—æ³•
06-scheduler/            # è°ƒåº¦æœºåˆ¶
07-concurrent-mode/      # å¹¶å‘ç‰¹æ€§
08-event-system/         # äº‹ä»¶ç³»ç»Ÿ
```

---

## ğŸ—ï¸ Phase 0: æ¶æ„è®¾è®¡ï¼ˆæ¨èå…ˆå­¦ï¼‰

### å­¦ä¹ å†…å®¹

| æ¨¡å— | å†…å®¹ | å­¦ä¹ ä»·å€¼ |
|------|------|---------|
| **Monorepo æ¶æ„** | ä¸ºä»€ä¹ˆé€‰æ‹© Monorepoï¼Ÿå¦‚ä½•ç»„ç»‡ 40+ ä¸ªåŒ…ï¼Ÿ | å­¦ä¹ å¤§å‹é¡¹ç›®ç»„ç»‡ |
| **æ„å»ºç³»ç»Ÿ** | Rollup + Babel + Closure Compiler | å­¦ä¹ åº“çš„æ„å»ºä¼˜åŒ– |
| **åŒ…è®¾è®¡** | æ ¸å¿ƒåŒ…ã€æ¸²æŸ“å™¨åŒ…ã€å·¥å…·åŒ…çš„èŒè´£åˆ’åˆ† | å­¦ä¹ æ¨¡å—åŒ–è®¾è®¡ |
| **æµ‹è¯•ä½“ç³»** | Jest + fixtures + æ€§èƒ½æµ‹è¯• | å­¦ä¹ æµ‹è¯•ç­–ç•¥ |
| **CI/CD** | è‡ªåŠ¨åŒ–æµæ°´çº¿è®¾è®¡ | å­¦ä¹ æŒç»­é›†æˆ |

### æ ¸å¿ƒæ–‡ä»¶

```
react-18.2.0/
â”œâ”€â”€ package.json         # æ ¹é…ç½®
â”œâ”€â”€ babel.config.js      # Babel é…ç½®
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ rollup/          # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ jest/            # æµ‹è¯•é…ç½®
â”‚   â””â”€â”€ release/         # å‘å¸ƒè„šæœ¬
â”œâ”€â”€ packages/            # 40+ ä¸ªåŒ…
â””â”€â”€ fixtures/            # æµ‹è¯•ç¤ºä¾‹
```

### åŒ…åˆ†ç±»é€ŸæŸ¥

| åˆ†ç±» | åŒ…å | è¯´æ˜ |
|------|------|------|
| **æ ¸å¿ƒ** | react | React APIï¼ˆHooksã€JSXï¼‰ |
| **æ ¸å¿ƒ** | react-reconciler | åè°ƒå™¨ï¼ˆFiber æ ¸å¿ƒï¼‰ |
| **æ ¸å¿ƒ** | scheduler | è°ƒåº¦å™¨ï¼ˆç‹¬ç«‹å¯ç”¨ï¼‰ |
| **æ¸²æŸ“å™¨** | react-dom | Web æ¸²æŸ“ |
| **æ¸²æŸ“å™¨** | react-native-renderer | Native æ¸²æŸ“ |
| **å·¥å…·** | shared | å…±äº«ä»£ç  |
| **å·¥å…·** | react-is | ç±»å‹åˆ¤æ–­ |
| **å¼€å‘** | react-devtools | è°ƒè¯•å·¥å…· |

---

## â±ï¸ é¢„è®¡å­¦ä¹ æ—¶é—´

| é˜¶æ®µ | å†…å®¹ | æ—¶é—´ | é¢è¯•æƒé‡ |
|------|------|------|---------|
| Phase 1 | åŸºç¡€æ¦‚å¿µ | 2h | â­â­ |
| Phase 2 | JSX ä¸å…ƒç´  | 3h | â­â­â­ |
| Phase 3 | Fiber æ¶æ„ | 8h | â­â­â­â­â­ |
| Phase 4 | æ¸²æŸ“æµç¨‹ | 6h | â­â­â­â­ |
| Phase 5 | Hooks åŸç† | 8h | â­â­â­â­â­ |
| Phase 6 | Diff ç®—æ³• | 6h | â­â­â­â­â­ |
| Phase 7 | è°ƒåº¦æœºåˆ¶ | 4h | â­â­â­ |
| Phase 8 | å¹¶å‘ç‰¹æ€§ | 4h | â­â­â­â­ |

**æ€»è®¡çº¦ 40 å°æ—¶**ï¼ˆå»ºè®® 2-4 å‘¨å®Œæˆï¼‰

---

## ğŸ”¥ é¢è¯•é«˜é¢‘è€ƒç‚¹é€ŸæŸ¥

### å¿…è€ƒé¢˜ï¼ˆå‡ºç°ç‡ 80%+ï¼‰

1. **Fiber æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ Fiberï¼Ÿ**
2. **Hooks çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ**
3. **React çš„ Diff ç®—æ³•æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ**
4. **setState æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ**
5. **useEffect å’Œ useLayoutEffect çš„åŒºåˆ«ï¼Ÿ**

### é«˜é¢‘é¢˜ï¼ˆå‡ºç°ç‡ 50%+ï¼‰

6. **React çš„æ¸²æŸ“æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ**
7. **ä»€ä¹ˆæ˜¯æ—¶é—´åˆ‡ç‰‡ï¼Ÿ**
8. **React 18 çš„å¹¶å‘æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ**
9. **key çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ**
10. **ä¸ºä»€ä¹ˆ Hooks ä¸èƒ½æ”¾åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Ÿ**

---

## ğŸ¯ å­¦ä¹ å»ºè®®

### 1. é˜…è¯»é¡ºåº

```
æ¨èé¡ºåºï¼ˆç”±æµ…å…¥æ·±ï¼‰ï¼š

1. shared/ReactTypes.js        # ç±»å‹å®šä¹‰
2. react/src/ReactElement.js   # å…ƒç´ åˆ›å»º
3. react/src/ReactHooks.js     # Hooks API
4. react-reconciler/src/ReactFiber.js  # Fiber èŠ‚ç‚¹
5. react-reconciler/src/ReactFiberWorkLoop.js  # å·¥ä½œå¾ªç¯
6. react-reconciler/src/ReactFiberHooks.js     # Hooks å®ç°
7. react-reconciler/src/ReactFiberReconciler.js # åè°ƒå™¨
8. scheduler/src/forks/Scheduler.js  # è°ƒåº¦å™¨
```

### 2. è°ƒè¯•æŠ€å·§

```bash
# 1. åœ¨æºç ä¸­æ·»åŠ  console.log
# 2. ä½¿ç”¨ React DevTools çš„ Profiler
# 3. æ–­ç‚¹è°ƒè¯•å…³é”®å‡½æ•°
```

### 3. ç¬”è®°æ–¹æ³•

- ç”»æµç¨‹å›¾ï¼ˆæ¨è Mermaidï¼‰
- å†™ä»£ç æ³¨é‡Š
- è¾“å‡ºå­¦ä¹ æ–‡ç« 

---

## ğŸ“‹ å­¦ä¹ è¿›åº¦

- [ ] Phase 1: åŸºç¡€æ¦‚å¿µ
- [ ] Phase 2: JSX ä¸å…ƒç´ 
- [ ] Phase 3: Fiber æ¶æ„
- [ ] Phase 4: æ¸²æŸ“æµç¨‹
- [ ] Phase 5: Hooks åŸç†
- [ ] Phase 6: Diff ç®—æ³•
- [ ] Phase 7: è°ƒåº¦æœºåˆ¶
- [ ] Phase 8: å¹¶å‘ç‰¹æ€§

---

## ğŸ”— å‚è€ƒèµ„æº

- [React æŠ€æœ¯æ­ç§˜](https://react.iamkasong.com/)ï¼ˆå¡é¢‚ï¼‰
- [React å®˜æ–¹åšå®¢](https://react.dev/blog)
- [React æºç ä¸­çš„æ³¨é‡Š]ï¼ˆæºç æœ¬èº«æ³¨é‡Šå¾ˆè¯¦ç»†ï¼‰

