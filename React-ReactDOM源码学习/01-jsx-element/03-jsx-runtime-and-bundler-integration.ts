/**
 * ============================================================
 * ğŸ“š Phase 1: JSX ä¸ React å…ƒç´  - Part 3: JSX Runtime ä¸ç¼–è¯‘é›†æˆ
 * ============================================================
 *
 * ğŸ“ æ ¸å¿ƒæºç ä½ç½®:
 * - packages/react/src/jsx/ReactJSX.js
 * - packages/react/src/jsx/ReactJSXElement.js
 * - packages/react/npm/jsx-runtime.js
 *
 * â±ï¸ é¢„è®¡æ—¶é—´ï¼š2-3 å°æ—¶
 * ğŸ¯ é¢è¯•æƒé‡ï¼šâ­â­â­â­
 */

// ============================================================
// Part 1: ä¼ ç»Ÿ JSX è½¬æ¢ï¼ˆClassic Runtimeï¼‰
// ============================================================

/**
 * ğŸ“Š Classic Runtime è¯¦è§£
 */

const classicRuntime = `
ğŸ“Š ä¼ ç»Ÿ JSX è½¬æ¢ï¼ˆClassic Runtimeï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Classic Runtime æ¦‚è¿°                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  æ—¶é—´: React æœ€åˆç‰ˆæœ¬ ~ React 16                                            â”‚
â”‚  ç¼–è¯‘ç›®æ ‡: React.createElement(...)                                         â”‚
â”‚  è¦æ±‚: å¿…é¡»åœ¨æ¯ä¸ªä½¿ç”¨ JSX çš„æ–‡ä»¶ä¸­ import React                             â”‚
â”‚                                                                             â”‚
â”‚  Babel é…ç½®:                                                                â”‚
â”‚  {                                                                          â”‚
â”‚    "presets": [                                                             â”‚
â”‚      ["@babel/preset-react", { "runtime": "classic" }]                      â”‚
â”‚    ]                                                                        â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¼–è¯‘è½¬æ¢ç¤ºä¾‹:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æºç :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import React from 'react';  // âš ï¸ å¿…é¡»å¼•å…¥

function App() {
  return (
    <div className="app">
      <Header title="Hello" />
      <main>
        {items.map(item => (
          <Item key={item.id} {...item} />
        ))}
      </main>
    </div>
  );
}


ç¼–è¯‘å:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import React from 'react';

function App() {
  return React.createElement(
    'div',
    { className: 'app' },
    React.createElement(Header, { title: 'Hello' }),
    React.createElement(
      'main',
      null,
      items.map(item =>
        React.createElement(Item, Object.assign({ key: item.id }, item))
      )
    )
  );
}


ä¸ºä»€ä¹ˆå¿…é¡» import Reactï¼Ÿ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ç¼–è¯‘åçš„ä»£ç ä½¿ç”¨äº† React.createElement
å¦‚æœæ²¡æœ‰ import Reactï¼Œè¿è¡Œæ—¶ä¼šæŠ¥é”™ï¼š
"React is not defined"

// å³ä½¿ä½ çš„ä»£ç çœ‹èµ·æ¥æ²¡æœ‰ç›´æ¥ä½¿ç”¨ Reactï¼š
function Hello() {
  return <div>Hi</div>;  // ç¼–è¯‘åä¼šä½¿ç”¨ React.createElement
}

// æ‰€ä»¥ä½ å¿…é¡»ï¼š
import React from 'react';  // å¦åˆ™è¿è¡Œæ—¶æŠ¥é”™
`;

// ============================================================
// Part 2: æ–° JSX è½¬æ¢ï¼ˆAutomatic Runtimeï¼‰
// ============================================================

/**
 * ğŸ“Š Automatic Runtime è¯¦è§£
 */

const automaticRuntime = `
ğŸ“Š æ–° JSX è½¬æ¢ï¼ˆAutomatic Runtimeï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Automatic Runtime æ¦‚è¿°                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  æ—¶é—´: React 17+ (2020å¹´)                                                   â”‚
â”‚  ç¼–è¯‘ç›®æ ‡: jsx() / jsxs() / jsxDEV() from 'react/jsx-runtime'               â”‚
â”‚  è¦æ±‚: ä¸éœ€è¦æ‰‹åŠ¨ import Reactï¼ˆç¼–è¯‘å™¨è‡ªåŠ¨å¼•å…¥ï¼‰                            â”‚
â”‚                                                                             â”‚
â”‚  Babel é…ç½®:                                                                â”‚
â”‚  {                                                                          â”‚
â”‚    "presets": [                                                             â”‚
â”‚      ["@babel/preset-react", { "runtime": "automatic" }]  // é»˜è®¤å€¼        â”‚
â”‚    ]                                                                        â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â”‚  ä¼˜åŠ¿:                                                                      â”‚
â”‚  1. ä¸éœ€è¦æ‰‹åŠ¨ import React                                                 â”‚
â”‚  2. æ›´å°çš„æ‰“åŒ…ä½“ç§¯ï¼ˆä¸éœ€è¦å®Œæ•´çš„ React å¯¹è±¡ï¼‰                               â”‚
â”‚  3. æœªæ¥ä¼˜åŒ–ç©ºé—´ï¼ˆjsx/jsxs å¯ä»¥é’ˆå¯¹æ€§ä¼˜åŒ–ï¼‰                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¼–è¯‘è½¬æ¢ç¤ºä¾‹:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æºç ï¼ˆä¸éœ€è¦ import Reactï¼ï¼‰:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function App() {
  return (
    <div className="app">
      <Header title="Hello" />
      <main>
        {items.map(item => (
          <Item key={item.id} {...item} />
        ))}
      </main>
    </div>
  );
}


ç¼–è¯‘å:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { jsx as _jsx, jsxs as _jsxs } from 'react/jsx-runtime';
// â­ ç¼–è¯‘å™¨è‡ªåŠ¨å¼•å…¥ï¼

function App() {
  return _jsxs('div', {
    className: 'app',
    children: [                           // â­ children åœ¨ props é‡Œ
      _jsx(Header, { title: 'Hello' }),
      _jsx('main', {
        children: items.map(item =>
          _jsx(Item, { ...item }, item.id)  // â­ key ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°
        )
      })
    ]
  });
}


jsx vs jsxs çš„åŒºåˆ«:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// ç¼–è¯‘å™¨æ ¹æ®å­å…ƒç´ æ˜¯å¦"é™æ€"æ¥é€‰æ‹©ï¼š

// ä½¿ç”¨ jsxï¼šåŠ¨æ€å­å…ƒç´ ï¼ˆè¿è¡Œæ—¶æ‰çŸ¥é“ï¼‰
<div>{dynamicContent}</div>
â†’ _jsx('div', { children: dynamicContent })

// ä½¿ç”¨ jsxsï¼šé™æ€å­å…ƒç´ ï¼ˆç¼–è¯‘æ—¶å°±ç¡®å®šï¼‰
<div><span>A</span><span>B</span></div>
â†’ _jsxs('div', { children: [_jsx('span', ...), _jsx('span', ...)] })

// â­ ä½†åœ¨ React 18 ç”Ÿäº§ç¯å¢ƒï¼Œjsx å’Œ jsxs æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼
// åŒºåˆ«ä¸»è¦åœ¨å¼€å‘ç¯å¢ƒçš„ key æ£€æŸ¥ç­‰éªŒè¯é€»è¾‘
`;

// ============================================================
// Part 3: jsx-runtime æºç åˆ†æ
// ============================================================

/**
 * ğŸ“Š jsx-runtime å…¥å£å’Œå®ç°
 */

const jsxRuntimeAnalysis = `
ğŸ“Š jsx-runtime æºç åˆ†æ

å…¥å£æ–‡ä»¶é“¾è·¯:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   import { jsx } from 'react/jsx-runtime'                                   â”‚
â”‚                        â”‚                                                    â”‚
â”‚                        â–¼                                                    â”‚
â”‚   ğŸ“ packages/react/npm/jsx-runtime.js                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚  if (process.env.NODE_ENV === 'production') {               â”‚          â”‚
â”‚   â”‚    module.exports = require('./cjs/react-jsx-runtime.production.min.js');â”‚
â”‚   â”‚  } else {                                                   â”‚          â”‚
â”‚   â”‚    module.exports = require('./cjs/react-jsx-runtime.development.js'); â”‚ â”‚
â”‚   â”‚  }                                                          â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                        â”‚                                                    â”‚
â”‚                        â–¼                                                    â”‚
â”‚   ğŸ“ packages/react/src/jsx/ReactJSX.js (æ„å»ºå‰æºç )                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚  import {jsx as jsxProd} from './ReactJSXElement';          â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚  const jsx = __DEV__ ? jsxWithValidationDynamic : jsxProd;  â”‚          â”‚
â”‚   â”‚  const jsxs = __DEV__ ? jsxWithValidationStatic : jsxProd;  â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚  export {Fragment, jsx, jsxs, jsxDEV};                      â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                        â”‚                                                    â”‚
â”‚                        â–¼                                                    â”‚
â”‚   ğŸ“ packages/react/src/jsx/ReactJSXElement.js                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚  export function jsx(type, config, maybeKey) {              â”‚          â”‚
â”‚   â”‚    // ... å®é™…å®ç°                                          â”‚          â”‚
â”‚   â”‚    return ReactElement(type, key, ref, ...);                â”‚          â”‚
â”‚   â”‚  }                                                          â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


jsx() å‡½æ•°å®ç°ï¼ˆç®€åŒ–ï¼‰:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“ packages/react/src/jsx/ReactJSXElement.js

export function jsx(type, config, maybeKey) {
  // åˆå§‹åŒ–
  const props = {};
  let key = null;
  let ref = null;

  // ========== å¤„ç† key ==========
  // key å¯èƒ½é€šè¿‡ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ï¼ˆç¼–è¯‘å™¨ä¼šè¿™æ ·åšï¼‰
  if (maybeKey !== undefined) {
    key = '' + maybeKey;
  }
  // key ä¹Ÿå¯èƒ½åœ¨ config ä¸­ï¼ˆå±•å¼€è¿ç®—ç¬¦åœºæ™¯ï¼‰
  if (hasValidKey(config)) {
    key = '' + config.key;
  }

  // ========== å¤„ç† ref ==========
  if (hasValidRef(config)) {
    ref = config.ref;
  }

  // ========== å¤åˆ¶å±æ€§åˆ° props ==========
  for (propName in config) {
    if (
      hasOwnProperty.call(config, propName) &&
      !RESERVED_PROPS.hasOwnProperty(propName)
    ) {
      props[propName] = config[propName];
    }
  }

  // ========== å¤„ç† defaultProps ==========
  if (type && type.defaultProps) {
    const defaultProps = type.defaultProps;
    for (propName in defaultProps) {
      if (props[propName] === undefined) {
        props[propName] = defaultProps[propName];
      }
    }
  }

  // ========== åˆ›å»º ReactElement ==========
  return ReactElement(
    type,
    key,
    ref,
    undefined,  // selfï¼ˆç”Ÿäº§ç¯å¢ƒä¸éœ€è¦ï¼‰
    undefined,  // sourceï¼ˆç”Ÿäº§ç¯å¢ƒä¸éœ€è¦ï¼‰
    ReactCurrentOwner.current,
    props,
  );
}
`;

// ============================================================
// Part 4: createElement vs jsx å¯¹æ¯”
// ============================================================

/**
 * ğŸ“Š ä¸¤ä¸ªå‡½æ•°çš„è¯¦ç»†å¯¹æ¯”
 */

const createElementVsJsx = `
ğŸ“Š createElement vs jsx è¯¦ç»†å¯¹æ¯”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰¹æ€§                  â”‚ createElement           â”‚ jsx / jsxs               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‡½æ•°ç­¾å              â”‚ (type, config, ...children) â”‚ (type, config, maybeKey)  â”‚
â”‚ children ä½ç½®         â”‚ ç¬¬3ä¸ªåŠåç»­å‚æ•°         â”‚ config.children          â”‚
â”‚ key ä½ç½®              â”‚ config.key              â”‚ ç¬¬3ä¸ªå‚æ•° æˆ– config.key  â”‚
â”‚ æºç æ–‡ä»¶              â”‚ ReactElement.js         â”‚ jsx/ReactJSXElement.js   â”‚
â”‚ å¼€å‘éªŒè¯              â”‚ å†…ç½®                    â”‚ jsxDEV / Validator å•ç‹¬  â”‚
â”‚ ä½¿ç”¨åœºæ™¯              â”‚ æ‰‹å†™ / æ—§é¡¹ç›®           â”‚ ç¼–è¯‘å™¨ç”Ÿæˆ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¸å¿ƒå·®å¼‚ï¼šchildren å¤„ç†
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

createElement:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// æºç 
function createElement(type, config, children) {
  // children ä» arguments[2] å¼€å§‹
  const childrenLength = arguments.length - 2;
  
  if (childrenLength === 1) {
    props.children = children;
  } else if (childrenLength > 1) {
    const childArray = Array(childrenLength);
    for (let i = 0; i < childrenLength; i++) {
      childArray[i] = arguments[i + 2];
    }
    props.children = childArray;
  }
}

// è°ƒç”¨æ–¹å¼
React.createElement('div', null, child1, child2, child3);
// â†’ props.children = [child1, child2, child3]


jsx:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// æºç 
function jsx(type, config, maybeKey) {
  // children ç›´æ¥ä» config ä¸­è·å–
  for (propName in config) {
    // config.children ä¼šè¢«å¤åˆ¶åˆ° props.children
    props[propName] = config[propName];
  }
}

// è°ƒç”¨æ–¹å¼
jsx('div', { children: [child1, child2, child3] });
// â†’ props.children = [child1, child2, child3]


æ ¸å¿ƒå·®å¼‚ï¼škey å¤„ç†
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

createElement:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// key åªèƒ½ä» config è·å–
if (hasValidKey(config)) {
  key = '' + config.key;
}

// è°ƒç”¨æ–¹å¼
React.createElement(Item, { key: 'abc', data: item });


jsx:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// key å¯ä»¥ä»ç¬¬ä¸‰ä¸ªå‚æ•°è·å–ï¼ˆç¼–è¯‘å™¨ä¼˜åŒ–ï¼‰
if (maybeKey !== undefined) {
  key = '' + maybeKey;
}
// ä¹Ÿå¯ä»¥ä» config è·å–ï¼ˆå±•å¼€è¿ç®—ç¬¦åœºæ™¯ï¼‰
if (hasValidKey(config)) {
  key = '' + config.key;
}

// è°ƒç”¨æ–¹å¼ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆï¼‰
jsx(Item, { data: item }, 'abc');  // key ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°


ä¸ºä»€ä¹ˆ jsx è¦æŠŠ key ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ï¼Ÿ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…åœ¨ config å¯¹è±¡ä¸­æŸ¥æ‰¾ key
æ›´æ¸…æ™°çš„è°ƒç”¨çº¦å®šï¼škey æ˜¯ç‰¹æ®Šçš„ï¼Œå•ç‹¬ä¼ é€’æ›´æ˜ç¡®

// ç¼–è¯‘å™¨å¯ä»¥ç›´æ¥ç”Ÿæˆï¼š
_jsx(Component, props, key)

// è€Œä¸æ˜¯ï¼š
_jsx(Component, { ...props, key: key })
`;

// ============================================================
// Part 5: å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ
// ============================================================

/**
 * ğŸ“Š å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚
 */

const devVsProd = `
ğŸ“Š å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç¯å¢ƒå·®å¼‚å¯¹æ¯”                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“ packages/react/src/jsx/ReactJSX.js                                     â”‚
â”‚                                                                             â”‚
â”‚  // å¼€å‘ç¯å¢ƒä½¿ç”¨å¸¦éªŒè¯çš„ç‰ˆæœ¬                                                â”‚
â”‚  const jsx = __DEV__ ? jsxWithValidationDynamic : jsxProd;                  â”‚
â”‚  const jsxs = __DEV__ ? jsxWithValidationStatic : jsxProd;                  â”‚
â”‚  const jsxDEV = __DEV__ ? jsxWithValidation : undefined;                    â”‚
â”‚                                                                             â”‚
â”‚  // ç”Ÿäº§ç¯å¢ƒï¼šjsx å’Œ jsxs æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼                                    â”‚
â”‚  // å¼€å‘ç¯å¢ƒï¼šä¸åŒå‡½æ•°ï¼Œä¸åŒçš„éªŒè¯é€»è¾‘                                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¼€å‘ç¯å¢ƒçš„é¢å¤–åŠŸèƒ½:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Key æ£€æŸ¥
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   // æ£€æŸ¥åˆ—è¡¨ä¸­çš„ key
   jsxWithValidationStatic â†’ æ£€æŸ¥é™æ€å­å…ƒç´ çš„ key
   jsxWithValidationDynamic â†’ æ£€æŸ¥åŠ¨æ€å­å…ƒç´ çš„ key
   
   // è­¦å‘Šç¤ºä¾‹ï¼š
   "Warning: Each child in a list should have a unique 'key' prop."

2. Props éªŒè¯
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   // æ£€æŸ¥ props.key çš„è®¿é—®
   if (key) {
     defineKeyPropWarningGetter(props, displayName);
   }
   // è­¦å‘Šç¤ºä¾‹ï¼š
   "Warning: Component: 'key' is not a prop..."

3. æºç ä½ç½®è¿½è¸ª
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   // jsxDEV æ¥æ”¶ source å’Œ self å‚æ•°
   jsxDEV(type, config, maybeKey, source, self)
   
   // source åŒ…å«ï¼š
   { fileName: 'App.js', lineNumber: 10, columnNumber: 5 }
   
   // é”™è¯¯ä¿¡æ¯å¯ä»¥æŒ‡å‘å…·ä½“ä½ç½®

4. String Ref è­¦å‘Š
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   // æ£€æŸ¥åºŸå¼ƒçš„ string ref ä½¿ç”¨
   warnIfStringRefCannotBeAutoConverted(config, self);


ç”Ÿäº§ç¯å¢ƒçš„ä¼˜åŒ–:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ç§»é™¤æ‰€æœ‰ __DEV__ ä»£ç å—
2. jsx å’Œ jsxs ä½¿ç”¨åŒä¸€ä¸ªå‡½æ•°
3. ä¸ä¼ é€’ source å’Œ self å‚æ•°
4. ä¸è¿›è¡Œä»»ä½•è¿è¡Œæ—¶éªŒè¯

// ç”Ÿäº§ç¯å¢ƒçš„ jsx éå¸¸ç²¾ç®€ï¼š
function jsx(type, config, maybeKey) {
  // ç›´æ¥å¤„ç†å‚æ•°ï¼Œåˆ›å»º ReactElement
  // æ²¡æœ‰ä»»ä½•éªŒè¯é€»è¾‘
}
`;

// ============================================================
// Part 6: é¢è¯•è¦ç‚¹
// ============================================================

const interviewPoints = `
ğŸ’¡ Part 3 é¢è¯•è¦ç‚¹

Q1: Classic Runtime å’Œ Automatic Runtime æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
A: - Classic: ä½¿ç”¨ React.createElementï¼Œå¿…é¡» import React
   - Automatic: ä½¿ç”¨ jsx/jsxsï¼Œç¼–è¯‘å™¨è‡ªåŠ¨å¼•å…¥ï¼Œä¸éœ€è¦æ‰‹åŠ¨ import
   - Automatic çš„ä¼˜åŠ¿ï¼šä»£ç æ›´ç®€æ´ã€æ‰“åŒ…æ›´å°ã€ä¾¿äºæœªæ¥ä¼˜åŒ–

Q2: jsx å’Œ jsxs æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
A: ç¼–è¯‘å™¨æ ¹æ®å­å…ƒç´ æ˜¯å¦é™æ€æ¥é€‰æ‹©ï¼š
   - jsx: åŠ¨æ€å­å…ƒç´ ï¼ˆè¿è¡Œæ—¶æ‰çŸ¥é“ï¼‰
   - jsxs: é™æ€å­å…ƒç´ ï¼ˆç¼–è¯‘æ—¶ç¡®å®šï¼‰
   ä½†åœ¨ React 18 ç”Ÿäº§ç¯å¢ƒï¼Œå®ƒä»¬æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼Œ
   åŒºåˆ«ä¸»è¦åœ¨å¼€å‘ç¯å¢ƒçš„éªŒè¯é€»è¾‘ã€‚

Q3: jsx() å’Œ createElement() çš„ä¸»è¦åŒºåˆ«ï¼Ÿ
A: - children ä½ç½®ï¼šcreateElement æ˜¯å¯å˜å‚æ•°ï¼Œjsx æ”¾åœ¨ config.children
   - key ä½ç½®ï¼šjsx æ”¯æŒç¬¬ä¸‰ä¸ªå‚æ•°ä¼  keyï¼ˆç¼–è¯‘å™¨ä¼˜åŒ–ï¼‰
   - ä½¿ç”¨åœºæ™¯ï¼šcreateElement å¯æ‰‹å†™ï¼Œjsx ä¸»è¦ç”±ç¼–è¯‘å™¨ç”Ÿæˆ

Q4: ä¸ºä»€ä¹ˆ React 17 è¦å¼•å…¥æ–°çš„ JSX è½¬æ¢ï¼Ÿ
A: 1. æ¶ˆé™¤"å¿…é¡» import React"çš„å›°æ‰°
   2. å‡å°‘æ‰“åŒ…ä½“ç§¯ï¼ˆä¸éœ€è¦å®Œæ•´ React å¯¹è±¡ï¼‰
   3. ä¸ºæœªæ¥ä¼˜åŒ–ç•™ä¸‹ç©ºé—´ï¼ˆå¦‚ jsx/jsxs é’ˆå¯¹æ€§ä¼˜åŒ–ï¼‰
   4. æ›´å¥½çš„å¼€å‘ä½“éªŒ

Q5: å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ jsx æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
A: å¼€å‘ç¯å¢ƒï¼š
   - ä½¿ç”¨ jsxWithValidation* å‡½æ•°
   - è¿›è¡Œ keyã€propsã€ç±»å‹ç­‰éªŒè¯
   - æ”¯æŒæºç ä½ç½®è¿½è¸ª
   ç”Ÿäº§ç¯å¢ƒï¼š
   - jsx å’Œ jsxs æ˜¯åŒä¸€ä¸ªç²¾ç®€å‡½æ•°
   - ç§»é™¤æ‰€æœ‰éªŒè¯é€»è¾‘
   - ä¸è¿½è¸ªæºç ä½ç½®
`;

export {
  classicRuntime,
  automaticRuntime,
  jsxRuntimeAnalysis,
  createElementVsJsx,
  devVsProd,
  interviewPoints,
};

