/**
 * ============================================================
 * ğŸ“š Phase 11: SSR & Hydration - Part 2: æœåŠ¡ç«¯æ¸²æŸ“å†…éƒ¨åŸç†
 * ============================================================
 *
 * ğŸ“ æ ¸å¿ƒæºç ä½ç½®:
 * - packages/react-dom/src/server/ReactPartialRenderer.js (æ—§ç‰ˆ)
 * - packages/react-dom/src/server/ReactDOMFizzServerNode.js (æ–°ç‰ˆ Streaming)
 * - packages/react-server/src/ReactFizzServer.js (Fizz æ ¸å¿ƒ)
 *
 * â±ï¸ é¢„è®¡æ—¶é—´ï¼š2-3 å°æ—¶
 * ğŸ¯ é¢è¯•æƒé‡ï¼šâ­â­â­â­
 */

// ============================================================
// Part 1: æœåŠ¡ç«¯æ¸²æŸ“çš„æ•´ä½“æµç¨‹
// ============================================================

/**
 * ğŸ“Š SSR æ•´ä½“æµç¨‹
 */

const ssrOverallFlow = `
ğŸ“Š æœåŠ¡ç«¯æ¸²æŸ“çš„æ•´ä½“æµç¨‹

ä»ç»„ä»¶åˆ° HTML çš„æ—…ç¨‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Step 1: å…¥å£è°ƒç”¨                                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚                                                                             â”‚
â”‚   // æ—§ç‰ˆ                                                                   â”‚
â”‚   const html = renderToString(<App />);                                     â”‚
â”‚                                                                             â”‚
â”‚   // æ–°ç‰ˆ (React 18)                                                        â”‚
â”‚   const { pipe } = renderToPipeableStream(<App />, options);                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Step 2: åˆ›å»ºæ¸²æŸ“å™¨å®ä¾‹                                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚                                                                             â”‚
â”‚   æœåŠ¡ç«¯æ¸²æŸ“å™¨çš„æ ¸å¿ƒèŒè´£ï¼š                                                  â”‚
â”‚   â€¢ éå† React ç»„ä»¶æ ‘                                                       â”‚
â”‚   â€¢ æ‰§è¡Œå‡½æ•°ç»„ä»¶/ç±»ç»„ä»¶                                                     â”‚
â”‚   â€¢ å¤„ç† Contextã€Hooks                                                     â”‚
â”‚   â€¢ ç”Ÿæˆ HTML æ ‡ç­¾å’Œå±æ€§                                                    â”‚
â”‚                                                                             â”‚
â”‚   æ—§ç‰ˆ: ReactPartialRenderer                                                â”‚
â”‚   æ–°ç‰ˆ: Fizz (React Fizz Server)                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Step 3: é€’å½’éå†ç»„ä»¶æ ‘                                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚                                                                             â”‚
â”‚   <App>                                                                     â”‚
â”‚     <Header />                                                              â”‚
â”‚     <Main>                                                                  â”‚
â”‚       <Article />                                                           â”‚
â”‚     </Main>                                                                 â”‚
â”‚   </App>                                                                    â”‚
â”‚                                                                             â”‚
â”‚   å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼š                                                            â”‚
â”‚   â€¢ å‡½æ•°ç»„ä»¶ â†’ è°ƒç”¨å‡½æ•°è·å– children                                        â”‚
â”‚   â€¢ ç±»ç»„ä»¶ â†’ å®ä¾‹åŒ–ï¼Œè°ƒç”¨ render()                                          â”‚
â”‚   â€¢ Host ç»„ä»¶ (div/span) â†’ ç”Ÿæˆ HTML æ ‡ç­¾                                   â”‚
â”‚   â€¢ æ–‡æœ¬èŠ‚ç‚¹ â†’ è½¬ä¹‰å¹¶è¾“å‡º                                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Step 4: ç”Ÿæˆ HTML è¾“å‡º                                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚                                                                             â”‚
â”‚   è¾“å‡ºç¤ºä¾‹:                                                                 â”‚
â”‚   <div id="root">                                                           â”‚
â”‚     <header>                                                                â”‚
â”‚       <h1>My App</h1>                                                       â”‚
â”‚     </header>                                                               â”‚
â”‚     <main>                                                                  â”‚
â”‚       <article>                                                             â”‚
â”‚         <p>Content here...</p>                                              â”‚
â”‚       </article>                                                            â”‚
â”‚     </main>                                                                 â”‚
â”‚   </div>                                                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 2: æ—§ç‰ˆå®ç° - ReactPartialRenderer
// ============================================================

/**
 * ğŸ“Š ReactPartialRendererï¼ˆæ—§ç‰ˆï¼‰
 */

const partialRenderer = `
ğŸ“Š ReactPartialRenderer - æ—§ç‰ˆæœåŠ¡ç«¯æ¸²æŸ“å™¨

æºç ä½ç½®: packages/react-dom/src/server/ReactPartialRenderer.js
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ReactPartialRenderer æ˜¯ renderToString / renderToNodeStream çš„æ ¸å¿ƒå®ç°ã€‚


æ ¸å¿ƒæ•°æ®ç»“æ„ï¼šFrameï¼ˆå¸§ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type Frame = {
  type: mixed,                    // ç»„ä»¶ç±»å‹
  domNamespace: string,           // DOM å‘½åç©ºé—´ï¼ˆå¦‚ SVGï¼‰
  children: FlatReactChildren,    // å­å…ƒç´ æ•°ç»„
  childIndex: number,             // å½“å‰å¤„ç†åˆ°ç¬¬å‡ ä¸ªå­å…ƒç´ 
  context: Object,                // Context å€¼
  footer: string,                 // ç»“æŸæ ‡ç­¾ï¼ˆå¦‚ </div>ï¼‰
};

class ReactDOMServerRenderer {
  // æ ˆï¼Œæ¨¡æ‹Ÿé€’å½’éå†
  stack: Array<Frame>;

  // Hooks ç›¸å…³
  currentSelectValue: any;

  // è¾“å‡ºç´¯ç§¯
  previousWasTextNode: boolean;

  // ...
}


æ¸²æŸ“é€»è¾‘ï¼ˆç®€åŒ–ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

read(bytes: number): string | null {
  // ä¸»å¾ªç¯ï¼šå¤„ç†æ ˆä¸­çš„å¸§
  while (this.stack.length) {
    const frame = this.stack[this.stack.length - 1];

    if (frame.childIndex >= frame.children.length) {
      // å½“å‰å¸§çš„å­å…ƒç´ éƒ½å¤„ç†å®Œäº†
      const out = frame.footer;
      this.stack.pop();
      // ... è¾“å‡ºç»“æŸæ ‡ç­¾
    } else {
      // å¤„ç†ä¸‹ä¸€ä¸ªå­å…ƒç´ 
      const child = frame.children[frame.childIndex++];
      const outChild = this.render(child, frame.context, frame.domNamespace);
      // ...
    }
  }
}

render(child: ReactNode, context: Object, namespace: string): string {
  if (typeof child === 'string' || typeof child === 'number') {
    // æ–‡æœ¬èŠ‚ç‚¹
    return escapeTextForBrowser('' + child);
  }

  // ReactElement
  const type = child.type;

  if (typeof type === 'function') {
    // å‡½æ•°ç»„ä»¶æˆ–ç±»ç»„ä»¶
    return this.renderComponent(child, context, namespace);
  }

  if (typeof type === 'string') {
    // Host ç»„ä»¶ï¼ˆdiv, span ç­‰ï¼‰
    return this.renderHostElement(child, context, namespace);
  }

  // ... å…¶ä»–ç±»å‹ï¼ˆFragment, Context, Suspense ç­‰ï¼‰
}


å¤„ç† Host å…ƒç´ 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

renderHostElement(element, context, namespace) {
  const type = element.type;
  const props = element.props;

  let out = '<' + type;

  // å¤„ç†å±æ€§
  for (const propKey in props) {
    const propValue = props[propKey];

    if (propKey === 'children') continue;
    if (propKey === 'dangerouslySetInnerHTML') continue;
    // ... å…¶ä»–ç‰¹æ®Šå±æ€§

    // ç”Ÿæˆå±æ€§å­—ç¬¦ä¸²
    out += ' ' + propKey + '="' + escapeTextForBrowser(propValue) + '"';
  }

  out += '>';

  // å¤„ç† children
  const children = props.children;
  if (children != null) {
    // å°† children å‹å…¥æ ˆ
    this.stack.push({
      type: type,
      children: toArray(children),
      childIndex: 0,
      footer: '</' + type + '>',
      // ...
    });
  }

  return out;
}
`;

// ============================================================
// Part 3: æ–°ç‰ˆå®ç° - Fizz
// ============================================================

/**
 * ğŸ“Š React Fizz - æ–°ç‰ˆæµå¼æ¸²æŸ“å™¨
 */

const fizzRenderer = `
ğŸ“Š React Fizz - React 18 çš„æµå¼æœåŠ¡ç«¯æ¸²æŸ“å™¨

æºç ä½ç½®:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â€¢ packages/react-server/src/ReactFizzServer.js (æ ¸å¿ƒé€»è¾‘)
â€¢ packages/react-dom/src/server/ReactDOMFizzServerNode.js (Node.js ç»‘å®š)
â€¢ packages/react-dom/src/server/ReactDOMServerFormatConfig.js (HTML æ ¼å¼åŒ–)


Fizz çš„æ ¸å¿ƒç‰¹æ€§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. æµå¼è¾“å‡º (Streaming)
   â€¢ è¾¹æ¸²æŸ“è¾¹å‘é€ï¼Œä¸éœ€è¦ç­‰å¾…æ•´æ£µæ ‘å®Œæˆ
   â€¢ ç”¨æˆ·æ›´å¿«çœ‹åˆ°é¦–å±å†…å®¹

2. Suspense æ”¯æŒ
   â€¢ æ•°æ®æœªå°±ç»ªæ—¶å…ˆè¾“å‡º fallback
   â€¢ æ•°æ®å°±ç»ªå"æ³¨å…¥"çœŸå®å†…å®¹

3. ä¼˜å…ˆçº§æ¸²æŸ“
   â€¢ å¯ä»¥ä¼˜å…ˆæ¸²æŸ“é‡è¦å†…å®¹
   â€¢ ä¸é‡è¦çš„å†…å®¹ç¨åå¤„ç†


Fizz çš„æ ¸å¿ƒæ¦‚å¿µ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Request (è¯·æ±‚)                                                            â”‚
â”‚   â€¢ ä»£è¡¨ä¸€æ¬¡æ¸²æŸ“ä»»åŠ¡                                                        â”‚
â”‚   â€¢ åŒ…å«å¾…å¤„ç†çš„ä»»åŠ¡é˜Ÿåˆ—                                                    â”‚
â”‚   â€¢ ç®¡ç† Suspense è¾¹ç•Œ                                                      â”‚
â”‚                                                                             â”‚
â”‚   Task (ä»»åŠ¡)                                                               â”‚
â”‚   â€¢ æ¸²æŸ“ä¸€ä¸ªç»„ä»¶å­æ ‘çš„å·¥ä½œå•å…ƒ                                              â”‚
â”‚   â€¢ ç±»ä¼¼å®¢æˆ·ç«¯ Fiber çš„"å·¥ä½œå•å…ƒ"æ¦‚å¿µ                                      â”‚
â”‚   â€¢ å¯ä»¥è¢«æŒ‚èµ·ï¼ˆSuspenseï¼‰                                                  â”‚
â”‚                                                                             â”‚
â”‚   Segment (ç‰‡æ®µ)                                                            â”‚
â”‚   â€¢ HTML è¾“å‡ºçš„ä¸€ä¸ªç‰‡æ®µ                                                     â”‚
â”‚   â€¢ å¯ä»¥æ˜¯å®Œæ•´çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¾…å¡«å……çš„å ä½ç¬¦                                    â”‚
â”‚                                                                             â”‚
â”‚   Boundary (è¾¹ç•Œ)                                                           â”‚
â”‚   â€¢ Suspense è¾¹ç•Œ                                                           â”‚
â”‚   â€¢ ç®¡ç†æŒ‚èµ·çŠ¶æ€å’Œ fallback                                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Fizz æ¸²æŸ“æµç¨‹ï¼ˆç®€åŒ–ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ReactFizzServer.js

function performWork(request: Request): void {
  const pingedTasks = request.pingedTasks;

  // å¤„ç†æ‰€æœ‰å¾…æ‰§è¡Œçš„ä»»åŠ¡
  for (let i = 0; i < pingedTasks.length; i++) {
    const task = pingedTasks[i];
    retryTask(request, task);
  }

  pingedTasks.length = 0;

  // æ£€æŸ¥æ˜¯å¦å¯ä»¥ flushï¼ˆè¾“å‡ºï¼‰ä¸€äº›å†…å®¹
  if (request.destination !== null) {
    flushCompletedQueues(request, request.destination);
  }
}

function retryTask(request: Request, task: Task): void {
  // æ¸²æŸ“ä»»åŠ¡å¯¹åº”çš„ç»„ä»¶
  const segment = task.blockedSegment;

  try {
    // æ‰§è¡Œæ¸²æŸ“
    renderNode(request, task, task.node);

    // æ¸²æŸ“æˆåŠŸï¼Œæ ‡è®°å®Œæˆ
    segment.status = COMPLETED;
  } catch (x) {
    if (typeof x === 'object' && x !== null && typeof x.then === 'function') {
      // â­ throw Promise â†’ Suspense æŒ‚èµ·
      const wakeable = x;
      wakeable.then(
        () => pingTask(request, task),  // resolve åé‡è¯•
        () => pingTask(request, task),
      );
    } else {
      // é”™è¯¯
      throw x;
    }
  }
}

function renderNode(request: Request, task: Task, node: ReactNode): void {
  // ç±»ä¼¼å®¢æˆ·ç«¯ï¼Œæ ¹æ®èŠ‚ç‚¹ç±»å‹åˆ†å‘
  if (typeof node === 'string' || typeof node === 'number') {
    // æ–‡æœ¬
    pushTextInstance(request, task, node);
    return;
  }

  if (typeof node === 'object' && node !== null) {
    const type = node.type;

    if (typeof type === 'function') {
      // ç»„ä»¶
      renderFunctionComponent(request, task, node);
    } else if (typeof type === 'string') {
      // Host å…ƒç´ 
      renderHostElement(request, task, node);
    }
    // ... å…¶ä»–ç±»å‹
  }
}
`;

// ============================================================
// Part 4: HTML ç”Ÿæˆç»†èŠ‚
// ============================================================

/**
 * ğŸ“Š HTML ç”Ÿæˆç»†èŠ‚
 */

const htmlGeneration = `
ğŸ“Š HTML ç”Ÿæˆç»†èŠ‚

å±æ€§å¤„ç†
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æºç ä½ç½®: packages/react-dom/src/server/DOMMarkupOperations.js

React å±æ€§åˆ° HTML å±æ€§çš„è½¬æ¢ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React å±æ€§         â”‚ HTML è¾“å‡º                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ className          â”‚ class="..."                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ htmlFor            â”‚ for="..."                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ style={{ ... }}   â”‚ style="..."ï¼ˆå¯¹è±¡è½¬å­—ç¬¦ä¸²ï¼‰                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ onClick / onXxx    â”‚ ä¸è¾“å‡ºï¼ˆäº‹ä»¶åœ¨å®¢æˆ·ç«¯ç»‘å®šï¼‰                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dangerouslySetInnerHTML â”‚ ç›´æ¥æ’å…¥ __html å†…å®¹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ref                â”‚ ä¸è¾“å‡ºï¼ˆä»…å®¢æˆ·ç«¯ä½¿ç”¨ï¼‰                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


æ–‡æœ¬è½¬ä¹‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æºç ä½ç½®: packages/react-dom/src/server/escapeTextForBrowser.js

function escapeTextForBrowser(text: string): string {
  // è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œé˜²æ­¢ XSS
  // & â†’ &amp;
  // < â†’ &lt;
  // > â†’ &gt;
  // " â†’ &quot;
  // ' â†’ &#x27;
  // ...
}


è‡ªé—­åˆæ ‡ç­¾å¤„ç†
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æºç ä½ç½®: packages/react-dom/src/shared/omittedCloseTags.js

const omittedCloseTags = {
  area: true,
  base: true,
  br: true,
  col: true,
  embed: true,
  hr: true,
  img: true,
  input: true,
  link: true,
  meta: true,
  source: true,
  track: true,
  wbr: true,
};

// <img src="..." /> ä¸éœ€è¦ </img>


å‘½åç©ºé—´å¤„ç†ï¼ˆSVGã€MathMLï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æºç ä½ç½®: packages/react-dom/src/shared/DOMNamespaces.js

â€¢ HTML_NAMESPACE: 'http://www.w3.org/1999/xhtml'
â€¢ SVG_NAMESPACE: 'http://www.w3.org/2000/svg'
â€¢ MATH_NAMESPACE: 'http://www.w3.org/1998/Math/MathML'

SVG å’Œ MathML æ ‡ç­¾ä¼šå¸¦æœ‰æ­£ç¡®çš„ namespace å±æ€§ã€‚
`;

// ============================================================
// Part 5: æ¡ˆä¾‹ - ç®€å• SSR æµç¨‹
// ============================================================

/**
 * ğŸ“Š æ¡ˆä¾‹ A: ç®€å• SSR æµç¨‹
 */

const simpleSSRCase = `
ğŸ“Š æ¡ˆä¾‹ A: ç®€å• SSR æµç¨‹

ç¤ºä¾‹ç»„ä»¶
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Header() {
  return <header><h1>My App</h1></header>;
}

function Main() {
  return (
    <main>
      <p>Welcome!</p>
    </main>
  );
}

function App() {
  return (
    <div id="root">
      <Header />
      <Main />
    </div>
  );
}


æœåŠ¡ç«¯æ¸²æŸ“è¿‡ç¨‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   1. renderToString(<App />) è°ƒç”¨                                           â”‚
â”‚      â€¢ åˆ›å»º ReactDOMServerRenderer å®ä¾‹                                     â”‚
â”‚      â€¢ åˆå§‹åŒ–æ ˆ                                                             â”‚
â”‚                                                                             â”‚
â”‚   2. render(App element)                                                    â”‚
â”‚      â€¢ App æ˜¯å‡½æ•°ç»„ä»¶                                                       â”‚
â”‚      â€¢ è°ƒç”¨ App() â†’ è¿”å› div å…ƒç´                                            â”‚
â”‚                                                                             â”‚
â”‚   3. å¤„ç† <div id="root">                                                   â”‚
â”‚      â€¢ è¾“å‡º: '<div id="root">'                                              â”‚
â”‚      â€¢ å°† children å‹å…¥æ ˆ                                                   â”‚
â”‚                                                                             â”‚
â”‚   4. å¤„ç† <Header />                                                        â”‚
â”‚      â€¢ è°ƒç”¨ Header() â†’ è¿”å› header å…ƒç´                                      â”‚
â”‚      â€¢ è¾“å‡º: '<header>'                                                     â”‚
â”‚      â€¢ å°† h1 å‹å…¥æ ˆ                                                         â”‚
â”‚                                                                             â”‚
â”‚   5. å¤„ç† <h1>                                                              â”‚
â”‚      â€¢ è¾“å‡º: '<h1>My App</h1>'                                              â”‚
â”‚      â€¢ è¾“å‡º: '</header>'                                                    â”‚
â”‚                                                                             â”‚
â”‚   6. å¤„ç† <Main />                                                          â”‚
â”‚      â€¢ è°ƒç”¨ Main() â†’ è¿”å› main å…ƒç´                                          â”‚
â”‚      â€¢ è¾“å‡º: '<main>'                                                       â”‚
â”‚      â€¢ å°† p å‹å…¥æ ˆ                                                          â”‚
â”‚                                                                             â”‚
â”‚   7. å¤„ç† <p>                                                               â”‚
â”‚      â€¢ è¾“å‡º: '<p>Welcome!</p>'                                              â”‚
â”‚      â€¢ è¾“å‡º: '</main>'                                                      â”‚
â”‚      â€¢ è¾“å‡º: '</div>'                                                       â”‚
â”‚                                                                             â”‚
â”‚   8. æœ€ç»ˆè¾“å‡º:                                                              â”‚
â”‚      '<div id="root">                                                       â”‚
â”‚        <header><h1>My App</h1></header>                                     â”‚
â”‚        <main><p>Welcome!</p></main>                                         â”‚
â”‚      </div>'                                                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 6: é¢è¯•è¦ç‚¹
// ============================================================

const interviewPoints = `
ğŸ’¡ Part 2 é¢è¯•è¦ç‚¹

Q1: æœåŠ¡ç«¯æ¸²æŸ“å’Œå®¢æˆ·ç«¯æ¸²æŸ“åœ¨æµç¨‹ä¸Šæœ‰ä»€ä¹ˆç›¸ä¼¼å’Œä¸åŒï¼Ÿ
A: ç›¸ä¼¼ï¼šéƒ½éœ€è¦éå†ç»„ä»¶æ ‘ã€æ‰§è¡Œç»„ä»¶å‡½æ•°ã€å¤„ç† props/state
   ä¸åŒï¼š
   - æœåŠ¡ç«¯ï¼šç”Ÿæˆ HTML å­—ç¬¦ä¸²ï¼Œä¸åˆ›å»º DOMï¼Œä¸ç»‘å®šäº‹ä»¶
   - å®¢æˆ·ç«¯ï¼šåˆ›å»º Fiber æ ‘ï¼Œåˆ›å»º/æ“ä½œ DOMï¼Œç»‘å®šäº‹ä»¶
   - æœåŠ¡ç«¯æ²¡æœ‰ commit é˜¶æ®µ

Q2: ReactPartialRenderer å’Œ Fizz æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
A: - ReactPartialRenderer: æ—§ç‰ˆï¼ŒåŒæ­¥æ¸²æŸ“ï¼Œä¸æ”¯æŒ Suspense
   - Fizz: React 18 æ–°ç‰ˆï¼Œæµå¼æ¸²æŸ“ï¼Œæ”¯æŒ Suspense

   Fizz å¯ä»¥è¾¹æ¸²æŸ“è¾¹è¾“å‡ºï¼Œä¸éœ€è¦ç­‰å¾…æ•´æ£µæ ‘å®Œæˆã€‚

Q3: SSR æ—¶å¦‚ä½•å¤„ç†äº‹ä»¶å±æ€§ï¼ˆå¦‚ onClickï¼‰ï¼Ÿ
A: ä¸è¾“å‡ºåˆ° HTMLã€‚äº‹ä»¶ç›‘å¬åœ¨å®¢æˆ·ç«¯ hydrate æ—¶ç»‘å®šã€‚
   è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ SSR çš„ HTML æ˜¯"æ­»"çš„ï¼Œéœ€è¦ hydrate æ¥"æ¿€æ´»"ã€‚

Q4: SSR æ—¶å¦‚ä½•å¤„ç† className å’Œ styleï¼Ÿ
A: - className â†’ class="..."ï¼ˆReact å±æ€§åè½¬ HTML å±æ€§åï¼‰
   - style={{ color: 'red' }} â†’ style="color:red"ï¼ˆå¯¹è±¡è½¬å­—ç¬¦ä¸²ï¼‰

Q5: Fizz æ˜¯å¦‚ä½•æ”¯æŒ Suspense çš„ï¼Ÿ
A: - æ¸²æŸ“è¿‡ç¨‹ä¸­å¦‚æœé‡åˆ° throw Promiseï¼Œä»»åŠ¡è¢«æŒ‚èµ·
   - å…ˆè¾“å‡º fallback çš„ HTML
   - Promise resolve åï¼Œä»»åŠ¡è¢«"ping"ï¼Œé‡æ–°æ‰§è¡Œ
   - çœŸå®å†…å®¹ä½œä¸º"å¢é‡"å‘é€ç»™å®¢æˆ·ç«¯

Q6: ä¸ºä»€ä¹ˆæœåŠ¡ç«¯æ¸²æŸ“ä¸åˆ›å»º Fiber æ ‘ï¼Ÿ
A: æœåŠ¡ç«¯æ¸²æŸ“çš„ç›®æ ‡æ˜¯ç”Ÿæˆ HTML å­—ç¬¦ä¸²ï¼Œä¸éœ€è¦åç»­çš„ diff å’Œ DOM æ“ä½œã€‚
   ä½¿ç”¨æ›´è½»é‡çš„éå†æ–¹å¼ï¼ˆæ ˆ/ä»»åŠ¡é˜Ÿåˆ—ï¼‰å³å¯ã€‚
   å®¢æˆ·ç«¯ hydrate æ—¶æ‰ä¼šåˆ›å»º Fiber æ ‘ã€‚
`;

export {
  ssrOverallFlow,
  partialRenderer,
  fizzRenderer,
  htmlGeneration,
  simpleSSRCase,
  interviewPoints,
};

