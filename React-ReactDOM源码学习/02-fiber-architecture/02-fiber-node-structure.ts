/**
 * ============================================================
 * ğŸ“š Phase 2: Fiber æ¶æ„ - Part 2: FiberNode ç»“æ„è¯¦è§£
 * ============================================================
 *
 * ğŸ“ æ ¸å¿ƒæºç ä½ç½®:
 * - packages/react-reconciler/src/ReactFiber.new.js (Line 118-195)
 * - packages/react-reconciler/src/ReactInternalTypes.js (Line 67-180)
 * - packages/react-reconciler/src/ReactWorkTags.js
 * - packages/react-reconciler/src/ReactFiberFlags.js
 *
 * â±ï¸ é¢„è®¡æ—¶é—´ï¼š4-5 å°æ—¶
 * ğŸ¯ é¢è¯•æƒé‡ï¼šâ­â­â­â­â­
 */

// ============================================================
// Part 1: FiberNode æ„é€ å‡½æ•°
// ============================================================

/**
 * ğŸ“Š FiberNode çš„åˆ›å»º
 */

const fiberNodeConstructor = `
ğŸ“Š FiberNode æ„é€ å‡½æ•°

ğŸ“ æºç ä½ç½®: packages/react-reconciler/src/ReactFiber.new.js (Line 118-195)

function FiberNode(
  tag: WorkTag,
  pendingProps: mixed,
  key: null | string,
  mode: TypeOfMode,
) {
  // ============ Instance ç›¸å…³ ============
  this.tag = tag;                    // ç»„ä»¶ç±»å‹æ ‡è¯†
  this.key = key;                    // åˆ—è¡¨ä¸­çš„å”¯ä¸€æ ‡è¯†
  this.elementType = null;           // ReactElement.typeï¼ˆåŸå§‹ç±»å‹ï¼‰
  this.type = null;                  // è§£æåçš„ç±»å‹
  this.stateNode = null;             // å¯¹åº”çš„çœŸå®èŠ‚ç‚¹

  // ============ Fiber æ ‘å…³ç³» ============
  this.return = null;                // çˆ¶ Fiber
  this.child = null;                 // ç¬¬ä¸€ä¸ªå­ Fiber
  this.sibling = null;               // ä¸‹ä¸€ä¸ªå…„å¼Ÿ Fiber
  this.index = 0;                    // åœ¨å…„å¼Ÿä¸­çš„ç´¢å¼•

  this.ref = null;                   // ref å¼•ç”¨

  // ============ çŠ¶æ€ç›¸å…³ ============
  this.pendingProps = pendingProps;  // æ–°çš„ propsï¼ˆå¾…å¤„ç†ï¼‰
  this.memoizedProps = null;         // ä¸Šæ¬¡æ¸²æŸ“ä½¿ç”¨çš„ props
  this.updateQueue = null;           // æ›´æ–°é˜Ÿåˆ—
  this.memoizedState = null;         // ä¸Šæ¬¡æ¸²æŸ“çš„ state
  this.dependencies = null;          // Context ä¾èµ–

  this.mode = mode;                  // æ¸²æŸ“æ¨¡å¼

  // ============ å‰¯ä½œç”¨ç›¸å…³ ============
  this.flags = NoFlags;              // å‰¯ä½œç”¨æ ‡è®°
  this.subtreeFlags = NoFlags;       // å­æ ‘çš„å‰¯ä½œç”¨æ ‡è®°
  this.deletions = null;             // è¦åˆ é™¤çš„å­ Fiber

  // ============ ä¼˜å…ˆçº§ç›¸å…³ ============
  this.lanes = NoLanes;              // æœ¬ Fiber çš„ä¼˜å…ˆçº§
  this.childLanes = NoLanes;         // å­æ ‘çš„ä¼˜å…ˆçº§

  // ============ åŒç¼“å­˜ç›¸å…³ ============
  this.alternate = null;             // æŒ‡å‘å¦ä¸€æ£µæ ‘ä¸Šå¯¹åº”çš„ Fiber

  // ============ DEV ä¸“ç”¨å­—æ®µ ============
  if (__DEV__) {
    this._debugSource = null;        // æºç ä½ç½®
    this._debugOwner = null;         // åˆ›å»ºè€…
    this._debugNeedsRemount = false; // çƒ­æ›´æ–°æ ‡è®°
    this._debugHookTypes = null;     // Hooks ç±»å‹
  }
}
`;

// ============================================================
// Part 2: æ ¸å¿ƒå­—æ®µè¯¦è§£
// ============================================================

/**
 * ğŸ“Š Instance ç›¸å…³å­—æ®µ
 */

const instanceFields = `
ğŸ“Š Instance ç›¸å…³å­—æ®µ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­—æ®µ          â”‚ ç±»å‹          â”‚ å«ä¹‰                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ tag           â”‚ WorkTag       â”‚ Fiber çš„ç±»å‹æ ‡è¯†ï¼ˆæ•°å­—æšä¸¾ï¼‰                â”‚
â”‚ key           â”‚ string | null â”‚ åˆ—è¡¨ Diff çš„å”¯ä¸€æ ‡è¯†ï¼Œæ¥è‡ª ReactElement.key â”‚
â”‚ elementType   â”‚ any           â”‚ åŸå§‹çš„ element.typeï¼ˆçƒ­æ›´æ–°æ—¶å¯èƒ½æ”¹å˜ï¼‰     â”‚
â”‚ type          â”‚ any           â”‚ è§£æåçš„ç±»å‹ï¼ˆå‡½æ•°ã€ç±»ã€å­—ç¬¦ä¸²ç­‰ï¼‰          â”‚
â”‚ stateNode     â”‚ any           â”‚ å¯¹åº”çš„å®é™…èŠ‚ç‚¹ï¼ˆDOMèŠ‚ç‚¹ã€ç±»å®ä¾‹ç­‰ï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

tagï¼ˆWorkTagï¼‰è¯¦è§£:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ packages/react-reconciler/src/ReactWorkTags.js

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¸¸é‡å                    â”‚ å€¼     â”‚ è¯´æ˜                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FunctionComponent         â”‚ 0      â”‚ å‡½æ•°ç»„ä»¶                               â”‚
â”‚ ClassComponent            â”‚ 1      â”‚ ç±»ç»„ä»¶                                 â”‚
â”‚ IndeterminateComponent    â”‚ 2      â”‚ è¿˜ä¸çŸ¥é“æ˜¯å‡½æ•°è¿˜æ˜¯ç±»ï¼ˆé¦–æ¬¡æ¸²æŸ“å‰ï¼‰     â”‚
â”‚ HostRoot                  â”‚ 3      â”‚ æ ¹èŠ‚ç‚¹ï¼ˆFiberRoot å¯¹åº”çš„ Fiberï¼‰       â”‚
â”‚ HostPortal                â”‚ 4      â”‚ Portal                                 â”‚
â”‚ HostComponent             â”‚ 5      â”‚ åŸç”Ÿ DOM å…ƒç´ ï¼ˆdivã€span ç­‰ï¼‰          â”‚
â”‚ HostText                  â”‚ 6      â”‚ æ–‡æœ¬èŠ‚ç‚¹                               â”‚
â”‚ Fragment                  â”‚ 7      â”‚ Fragment                               â”‚
â”‚ Mode                      â”‚ 8      â”‚ StrictModeã€ConcurrentMode ç­‰          â”‚
â”‚ ContextConsumer           â”‚ 9      â”‚ Context.Consumer                       â”‚
â”‚ ContextProvider           â”‚ 10     â”‚ Context.Provider                       â”‚
â”‚ ForwardRef                â”‚ 11     â”‚ forwardRef åŒ…è£…çš„ç»„ä»¶                  â”‚
â”‚ Profiler                  â”‚ 12     â”‚ Profiler                               â”‚
â”‚ SuspenseComponent         â”‚ 13     â”‚ Suspense                               â”‚
â”‚ MemoComponent             â”‚ 14     â”‚ memo åŒ…è£…çš„ç»„ä»¶                        â”‚
â”‚ SimpleMemoComponent       â”‚ 15     â”‚ ç®€å• memoï¼ˆæ—  compare å‡½æ•°ï¼‰           â”‚
â”‚ LazyComponent             â”‚ 16     â”‚ lazy åŒ…è£…çš„ç»„ä»¶                        â”‚
â”‚ OffscreenComponent        â”‚ 22     â”‚ Offscreenï¼ˆå¹¶å‘ç‰¹æ€§ï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


stateNode åœ¨ä¸åŒç±»å‹ Fiber ä¸Šçš„å€¼:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fiber.tag            â”‚ Fiber.stateNode çš„å€¼                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HostRoot            â”‚ FiberRootNodeï¼ˆæ ¹èŠ‚ç‚¹å®¹å™¨ï¼‰                          â”‚
â”‚ HostComponent       â”‚ DOM å…ƒç´ ï¼ˆdivã€span ç­‰ï¼‰                             â”‚
â”‚ HostText            â”‚ Text èŠ‚ç‚¹ï¼ˆdocument.createTextNodeï¼‰                â”‚
â”‚ ClassComponent      â”‚ ç±»ç»„ä»¶å®ä¾‹ï¼ˆnew Component()ï¼‰                        â”‚
â”‚ FunctionComponent   â”‚ nullï¼ˆå‡½æ•°ç»„ä»¶æ²¡æœ‰å®ä¾‹ï¼‰                             â”‚
â”‚ SuspenseComponent   â”‚ null æˆ– SuspenseState å¯¹è±¡                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

/**
 * ğŸ“Š æ ‘å…³ç³»å­—æ®µ
 */

const treeRelationFields = `
ğŸ“Š æ ‘å…³ç³»å­—æ®µï¼ˆreturn / child / siblingï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­—æ®µ     â”‚ ç±»å‹           â”‚ å«ä¹‰                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ return   â”‚ Fiber | null   â”‚ çˆ¶ Fiberï¼ˆå¤„ç†å®Œå½“å‰èŠ‚ç‚¹åè¿”å›çš„ç›®æ ‡ï¼‰          â”‚
â”‚ child    â”‚ Fiber | null   â”‚ ç¬¬ä¸€ä¸ªå­ Fiber                                  â”‚
â”‚ sibling  â”‚ Fiber | null   â”‚ ä¸‹ä¸€ä¸ªå…„å¼Ÿ Fiber                                â”‚
â”‚ index    â”‚ number         â”‚ åœ¨å…„å¼ŸèŠ‚ç‚¹ä¸­çš„ä½ç½®ç´¢å¼•                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸ºä»€ä¹ˆå« return è€Œä¸æ˜¯ parentï¼Ÿ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æºç æ³¨é‡Šè§£é‡Šï¼š
"It is conceptually the same as the return address of a stack frame."

return è¡¨ç¤º"å¤„ç†å®Œå½“å‰ Fiber åï¼Œåº”è¯¥è¿”å›åˆ°å“ªé‡Œç»§ç»­"
è¿™ä¸å‡½æ•°è°ƒç”¨æ ˆçš„"è¿”å›åœ°å€"æ¦‚å¿µä¸€è‡´


çœŸå®æ¡ˆä¾‹ï¼šFiber æ ‘ç»“æ„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç»„ä»¶ä»£ç :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function Child() { return <span>child</span>; }
function App() {
  return (
    <div>
      <h1>title</h1>
      <Child />
    </div>
  );
}

ReactDOM.createRoot(root).render(<App />);


å¯¹åº”çš„ Fiber æ ‘:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    FiberRoot    â”‚  (stateNode = #root DOM)
                    â”‚    tag: 3       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ child
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   App Fiber     â”‚
                    â”‚   tag: 0        â”‚  FunctionComponent
                    â”‚   type: App     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ child
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   div Fiber     â”‚
                    â”‚   tag: 5        â”‚  HostComponent
                    â”‚   type: 'div'   â”‚
                    â”‚   stateNode: divâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ child
                             â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   h1 Fiber      â”‚â”€â”€siblingâ”€â–¶â”‚  Child Fiber    â”‚
     â”‚   tag: 5        â”‚           â”‚   tag: 0        â”‚
     â”‚   type: 'h1'    â”‚           â”‚   type: Child   â”‚
     â”‚   stateNode: h1 â”‚           â”‚                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ child                        â”‚ child
              â–¼                              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Text Fiber     â”‚           â”‚  span Fiber     â”‚
     â”‚  tag: 6         â”‚           â”‚   tag: 5        â”‚
     â”‚  "title"        â”‚           â”‚   type: 'span'  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚ child
                                            â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚  Text Fiber     â”‚
                                   â”‚  tag: 6         â”‚
                                   â”‚  "child"        â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³ç³»æŒ‡é’ˆç¤ºæ„ï¼ˆä»¥ div Fiber ä¸ºä¾‹ï¼‰:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

div Fiber:
  - return â†’ App Fiberï¼ˆçˆ¶èŠ‚ç‚¹ï¼‰
  - child â†’ h1 Fiberï¼ˆç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ï¼‰
  - sibling â†’ nullï¼ˆæ²¡æœ‰å…„å¼Ÿï¼‰

h1 Fiber:
  - return â†’ div Fiber
  - child â†’ Text Fiber ("title")
  - sibling â†’ Child Fiberï¼ˆä¸‹ä¸€ä¸ªå…„å¼Ÿï¼‰

Child Fiber:
  - return â†’ div Fiber
  - child â†’ span Fiber
  - sibling â†’ nullï¼ˆæœ€åä¸€ä¸ªå…„å¼Ÿï¼‰
`;

/**
 * ğŸ“Š çŠ¶æ€ç›¸å…³å­—æ®µ
 */

const stateFields = `
ğŸ“Š çŠ¶æ€ç›¸å…³å­—æ®µ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­—æ®µ            â”‚ ç±»å‹    â”‚ å«ä¹‰                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ pendingProps    â”‚ any     â”‚ æ–°çš„ propsï¼Œç­‰å¾…è¢«å¤„ç†                          â”‚
â”‚ memoizedProps   â”‚ any     â”‚ ä¸Šæ¬¡æ¸²æŸ“ä½¿ç”¨çš„ propsï¼ˆå·²ç”Ÿæ•ˆï¼‰                  â”‚
â”‚ memoizedState   â”‚ any     â”‚ ä¸Šæ¬¡æ¸²æŸ“çš„ state                                â”‚
â”‚ updateQueue     â”‚ any     â”‚ æ›´æ–°é˜Ÿåˆ—ï¼ˆå­˜æ”¾ setState äº§ç”Ÿçš„ updateï¼‰         â”‚
â”‚ dependencies    â”‚ object  â”‚ Context ä¾èµ–åˆ—è¡¨                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

pendingProps vs memoizedProps:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   æ¸²æŸ“å¼€å§‹æ—¶:                                                               â”‚
â”‚   pendingProps = æ–°çš„ propsï¼ˆæ¥è‡ªçˆ¶ç»„ä»¶ / ReactElementï¼‰                    â”‚
â”‚   memoizedProps = ä¸Šæ¬¡æ¸²æŸ“çš„ props                                          â”‚
â”‚                                                                             â”‚
â”‚   æ¸²æŸ“å®Œæˆå:                                                               â”‚
â”‚   memoizedProps = pendingPropsï¼ˆæ›´æ–°ä¸ºæ–°å€¼ï¼‰                                â”‚
â”‚                                                                             â”‚
â”‚   ç”¨é€”:                                                                     â”‚
â”‚   - æ¯”è¾ƒ pendingProps å’Œ memoizedProps åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°                     â”‚
â”‚   - bailout ä¼˜åŒ–ï¼šå¦‚æœç›¸ç­‰ï¼Œè·³è¿‡è¿™ä¸ªç»„ä»¶çš„æ¸²æŸ“                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


memoizedState åœ¨ä¸åŒç±»å‹ Fiber ä¸Šçš„å€¼:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fiber.tag           â”‚ memoizedState çš„å€¼                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FunctionComponent   â”‚ Hooks é“¾è¡¨çš„å¤´èŠ‚ç‚¹                                    â”‚
â”‚                     â”‚ { memoizedState, queue, next } â†’ { ... } â†’ ...        â”‚
â”‚                     â”‚                                                       â”‚
â”‚ ClassComponent      â”‚ this.state çš„å€¼                                       â”‚
â”‚                     â”‚ { count: 0, name: 'React' }                           â”‚
â”‚                     â”‚                                                       â”‚
â”‚ HostRoot            â”‚ { element: ReactElement, ... }                        â”‚
â”‚                     â”‚                                                       â”‚
â”‚ HostComponent       â”‚ nullï¼ˆDOM å…ƒç´ æ²¡æœ‰ stateï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


updateQueue ç¤ºä¾‹ï¼ˆç±»ç»„ä»¶ï¼‰:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

this.setState({ count: 1 });
this.setState({ count: 2 });
this.setState(prev => ({ count: prev.count + 1 }));

// updateQueue ç»“æ„:
{
  shared: {
    pending: Update3 â†’ Update2 â†’ Update1 â†’ Update3 (ç¯å½¢é“¾è¡¨)
  },
  // ...
}
`;

/**
 * ğŸ“Š å‰¯ä½œç”¨ç›¸å…³å­—æ®µ
 */

const effectFields = `
ğŸ“Š å‰¯ä½œç”¨ç›¸å…³å­—æ®µï¼ˆflags / subtreeFlagsï¼‰

ğŸ“ æºç ä½ç½®: packages/react-reconciler/src/ReactFiberFlags.js

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­—æ®µ          â”‚ ç±»å‹    â”‚ å«ä¹‰                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ flags         â”‚ Flags   â”‚ æœ¬ Fiber éœ€è¦æ‰§è¡Œçš„å‰¯ä½œç”¨                         â”‚
â”‚ subtreeFlags  â”‚ Flags   â”‚ å­æ ‘ä¸­æ˜¯å¦æœ‰å‰¯ä½œç”¨ï¼ˆä¼˜åŒ–éå†ç”¨ï¼‰                  â”‚
â”‚ deletions     â”‚ Array   â”‚ éœ€è¦åˆ é™¤çš„å­ Fiber æ•°ç»„                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¸¸è§çš„ flags å€¼:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flag åç§°            â”‚ äºŒè¿›åˆ¶å€¼                 â”‚ å«ä¹‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NoFlags              â”‚ 0b000000000000000000000000 â”‚ æ²¡æœ‰å‰¯ä½œç”¨                â”‚
â”‚ Placement            â”‚ 0b000000000000000000000010 â”‚ éœ€è¦æ’å…¥ DOM              â”‚
â”‚ Update               â”‚ 0b000000000000000000000100 â”‚ éœ€è¦æ›´æ–°å±æ€§/è°ƒç”¨ç”Ÿå‘½å‘¨æœŸ â”‚
â”‚ ChildDeletion        â”‚ 0b000000000000000000010000 â”‚ æœ‰å­èŠ‚ç‚¹éœ€è¦åˆ é™¤          â”‚
â”‚ Ref                  â”‚ 0b000000000000001000000000 â”‚ éœ€è¦å¤„ç† ref              â”‚
â”‚ Passive              â”‚ 0b000000000000100000000000 â”‚ æœ‰ useEffect              â”‚
â”‚ Snapshot             â”‚ 0b000000000000010000000000 â”‚ éœ€è¦è°ƒç”¨ getSnapshotBeforeUpdate â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

subtreeFlags çš„ä½œç”¨:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   React 18 çš„ä¼˜åŒ–ï¼šä¸å†æ”¶é›†"effect é“¾è¡¨"                                    â”‚
â”‚                                                                             â”‚
â”‚   æ—§æ–¹å¼ï¼ˆReact 17 ä¹‹å‰ï¼‰:                                                  â”‚
â”‚   - éå†æ•´æ£µæ ‘ï¼ŒæŠŠæœ‰å‰¯ä½œç”¨çš„ Fiber ä¸²æˆé“¾è¡¨                                 â”‚
â”‚   - Commit é˜¶æ®µéå†é“¾è¡¨æ‰§è¡Œå‰¯ä½œç”¨                                           â”‚
â”‚                                                                             â”‚
â”‚   æ–°æ–¹å¼ï¼ˆReact 18ï¼‰:                                                       â”‚
â”‚   - æ¯ä¸ª Fiber æœ‰ subtreeFlagsï¼Œè¡¨ç¤º"å­æ ‘æ˜¯å¦æœ‰å‰¯ä½œç”¨"                      â”‚
â”‚   - å¦‚æœ subtreeFlags === NoFlagsï¼Œè·³è¿‡æ•´ä¸ªå­æ ‘                             â”‚
â”‚   - å¤§å¹…å‡å°‘ Commit é˜¶æ®µçš„éå†èŒƒå›´                                          â”‚
â”‚                                                                             â”‚
â”‚   ç¤ºä¾‹:                                                                     â”‚
â”‚              App (subtreeFlags: Passive)                                    â”‚
â”‚               â”‚                                                             â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚   Header              Main (subtreeFlags: Passive)                          â”‚
â”‚  (flags: 0)             â”‚                                                   â”‚
â”‚  (subtreeFlags: 0)      â”‚                                                   â”‚
â”‚      â†‘                  â”‚                                                   â”‚
â”‚   è·³è¿‡ï¼          â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                             â”‚
â”‚                Content      Footer                                          â”‚
â”‚              (flags: Passive) (flags: 0)                                    â”‚
â”‚                  â†‘            (subtreeFlags: 0)                             â”‚
â”‚              æœ‰ useEffect        â†‘                                          â”‚
â”‚                               è·³è¿‡ï¼                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

/**
 * ğŸ“Š ä¼˜å…ˆçº§ç›¸å…³å­—æ®µ
 */

const laneFields = `
ğŸ“Š ä¼˜å…ˆçº§ç›¸å…³å­—æ®µï¼ˆlanes / childLanesï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­—æ®µ        â”‚ ç±»å‹    â”‚ å«ä¹‰                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ lanes       â”‚ Lanes   â”‚ æœ¬ Fiber ä¸Šæœªå¤„ç†çš„æ›´æ–°å¯¹åº”çš„ä¼˜å…ˆçº§                 â”‚
â”‚ childLanes  â”‚ Lanes   â”‚ å­æ ‘ä¸­æœªå¤„ç†çš„æ›´æ–°ä¼˜å…ˆçº§                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Lane æ¨¡å‹ç®€ä»‹:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Lane æ˜¯ React 18 çš„ä¼˜å…ˆçº§æ¨¡å‹ï¼Œç”¨ 31 ä½äºŒè¿›åˆ¶è¡¨ç¤º                         â”‚
â”‚   æ¯ä¸€ä½ä»£è¡¨ä¸€ä¸ª"è½¦é“"ï¼Œä¸åŒä¼˜å…ˆçº§çš„æ›´æ–°åœ¨ä¸åŒè½¦é“                          â”‚
â”‚                                                                             â”‚
â”‚   å¸¸è§ Lane:                                                                â”‚
â”‚   - SyncLane: åŒæ­¥ä¼˜å…ˆçº§ï¼ˆæœ€é«˜ï¼‰                                            â”‚
â”‚   - InputContinuousLane: è¿ç»­è¾“å…¥ï¼ˆå¦‚æ‹–æ‹½ï¼‰                                 â”‚
â”‚   - DefaultLane: é»˜è®¤ä¼˜å…ˆçº§                                                 â”‚
â”‚   - TransitionLane: Transition ä¼˜å…ˆçº§                                       â”‚
â”‚   - IdleLane: ç©ºé—²ä¼˜å…ˆçº§ï¼ˆæœ€ä½ï¼‰                                            â”‚
â”‚                                                                             â”‚
â”‚   lanes å’Œ childLanes çš„ä½œç”¨:                                               â”‚
â”‚   - å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå­æ ‘æ˜¯å¦æœ‰å¾…å¤„ç†çš„æ›´æ–°                                      â”‚
â”‚   - å¦‚æœ childLanes === NoLanesï¼Œè·³è¿‡å­æ ‘                                   â”‚
â”‚   - è¿™æ˜¯ bailout ä¼˜åŒ–çš„åŸºç¡€                                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 3: å®Œæ•´å­—æ®µè¡¨
// ============================================================

/**
 * ğŸ“Š FiberNode å®Œæ•´å­—æ®µè¡¨
 */

const completeFieldTable = `
ğŸ“Š FiberNode å®Œæ•´å­—æ®µé€ŸæŸ¥è¡¨

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ†ç±»        â”‚ å­—æ®µ            â”‚ ç±»å‹           â”‚ ç®€è¦è¯´æ˜                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Instance    â”‚ tag             â”‚ WorkTag        â”‚ Fiber ç±»å‹ï¼ˆ0-25ï¼‰          â”‚
â”‚             â”‚ key             â”‚ string | null  â”‚ Diff ç”¨çš„å”¯ä¸€æ ‡è¯†           â”‚
â”‚             â”‚ elementType     â”‚ any            â”‚ åŸå§‹ element.type           â”‚
â”‚             â”‚ type            â”‚ any            â”‚ è§£æåçš„ç±»å‹                â”‚
â”‚             â”‚ stateNode       â”‚ any            â”‚ å¯¹åº”å®é™…èŠ‚ç‚¹                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Fiber Tree  â”‚ return          â”‚ Fiber | null   â”‚ çˆ¶ Fiber                    â”‚
â”‚             â”‚ child           â”‚ Fiber | null   â”‚ ç¬¬ä¸€ä¸ªå­ Fiber              â”‚
â”‚             â”‚ sibling         â”‚ Fiber | null   â”‚ ä¸‹ä¸€ä¸ªå…„å¼Ÿ Fiber            â”‚
â”‚             â”‚ index           â”‚ number         â”‚ åœ¨å…„å¼Ÿä¸­çš„ç´¢å¼•              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ State       â”‚ ref             â”‚ Ref | null     â”‚ ref å¼•ç”¨                    â”‚
â”‚             â”‚ pendingProps    â”‚ any            â”‚ æ–° props                    â”‚
â”‚             â”‚ memoizedProps   â”‚ any            â”‚ æ—§ props                    â”‚
â”‚             â”‚ memoizedState   â”‚ any            â”‚ æ—§ state / Hooks é“¾è¡¨       â”‚
â”‚             â”‚ updateQueue     â”‚ any            â”‚ æ›´æ–°é˜Ÿåˆ—                    â”‚
â”‚             â”‚ dependencies    â”‚ Dependencies   â”‚ Context ä¾èµ–                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Mode        â”‚ mode            â”‚ TypeOfMode     â”‚ æ¸²æŸ“æ¨¡å¼ï¼ˆConcurrentç­‰ï¼‰    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Effects     â”‚ flags           â”‚ Flags          â”‚ æœ¬èŠ‚ç‚¹å‰¯ä½œç”¨                â”‚
â”‚             â”‚ subtreeFlags    â”‚ Flags          â”‚ å­æ ‘å‰¯ä½œç”¨                  â”‚
â”‚             â”‚ deletions       â”‚ Array | null   â”‚ å¾…åˆ é™¤çš„å­èŠ‚ç‚¹              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Lanes       â”‚ lanes           â”‚ Lanes          â”‚ æœ¬èŠ‚ç‚¹ä¼˜å…ˆçº§                â”‚
â”‚             â”‚ childLanes      â”‚ Lanes          â”‚ å­æ ‘ä¼˜å…ˆçº§                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Alternate   â”‚ alternate       â”‚ Fiber | null   â”‚ åŒç¼“å­˜æ ‘çš„å¯¹åº”èŠ‚ç‚¹          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 4: é¢è¯•è¦ç‚¹
// ============================================================

const interviewPoints = `
ğŸ’¡ Part 2 é¢è¯•è¦ç‚¹

Q1: FiberNode æœ‰å“ªäº›æ ¸å¿ƒå­—æ®µï¼Ÿ
A: åˆ†ä¸ºå‡ ç±»ï¼š
   - Instance: tagã€keyã€typeã€stateNode
   - æ ‘å…³ç³»: returnã€childã€siblingã€index
   - çŠ¶æ€: pendingPropsã€memoizedPropsã€memoizedStateã€updateQueue
   - å‰¯ä½œç”¨: flagsã€subtreeFlagsã€deletions
   - ä¼˜å…ˆçº§: lanesã€childLanes
   - åŒç¼“å­˜: alternate

Q2: tag å­—æ®µæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿå¸¸è§çš„å€¼æœ‰å“ªäº›ï¼Ÿ
A: tag æ ‡è¯† Fiber çš„ç±»å‹ï¼Œå†³å®š React å¦‚ä½•å¤„ç†è¿™ä¸ªèŠ‚ç‚¹ã€‚
   å¸¸è§å€¼ï¼š
   - FunctionComponent(0): å‡½æ•°ç»„ä»¶
   - ClassComponent(1): ç±»ç»„ä»¶
   - HostRoot(3): æ ¹èŠ‚ç‚¹
   - HostComponent(5): åŸç”Ÿ DOM å…ƒç´ 
   - HostText(6): æ–‡æœ¬èŠ‚ç‚¹
   - SuspenseComponent(13): Suspense

Q3: returnã€childã€sibling åˆ†åˆ«æŒ‡å‘ä»€ä¹ˆï¼Ÿ
A: è¿™ä¸‰ä¸ªæŒ‡é’ˆå½¢æˆäº† Fiber æ ‘çš„é“¾è¡¨ç»“æ„ï¼š
   - return: æŒ‡å‘çˆ¶ Fiber
   - child: æŒ‡å‘ç¬¬ä¸€ä¸ªå­ Fiber
   - sibling: æŒ‡å‘ä¸‹ä¸€ä¸ªå…„å¼Ÿ Fiber
   é€šè¿‡è¿™ä¸‰ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥ç”¨å¾ªç¯éå†æ•´æ£µæ ‘ã€‚

Q4: stateNode åœ¨ä¸åŒç±»å‹çš„ Fiber ä¸Šå­˜ä»€ä¹ˆï¼Ÿ
A: - HostRoot: FiberRootNode
   - HostComponent: DOM å…ƒç´ 
   - HostText: Text èŠ‚ç‚¹
   - ClassComponent: ç±»ç»„ä»¶å®ä¾‹
   - FunctionComponent: null

Q5: flags å’Œ subtreeFlags æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
A: - flags: æœ¬ Fiber èŠ‚ç‚¹éœ€è¦æ‰§è¡Œçš„å‰¯ä½œç”¨
   - subtreeFlags: å­æ ‘æ˜¯å¦æœ‰å‰¯ä½œç”¨ï¼ˆä¼˜åŒ–ç”¨ï¼‰
   React 18 ç”¨ subtreeFlags ä¼˜åŒ– Commit é˜¶æ®µï¼š
   å¦‚æœ subtreeFlags === NoFlagsï¼Œè·³è¿‡æ•´ä¸ªå­æ ‘çš„éå†

Q6: memoizedState å¯¹äºå‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
A: - å‡½æ•°ç»„ä»¶: å­˜å‚¨ Hooks é“¾è¡¨çš„å¤´èŠ‚ç‚¹
   - ç±»ç»„ä»¶: å­˜å‚¨ this.state çš„å€¼
   - HostComponent: null
`;

export {
  fiberNodeConstructor,
  instanceFields,
  treeRelationFields,
  stateFields,
  effectFields,
  laneFields,
  completeFieldTable,
  interviewPoints,
};

