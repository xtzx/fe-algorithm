/**
 * ============================================================
 * ğŸ“š Phase 11: SSR & Hydration - Part 4: Streaming SSR ä¸ Suspense
 * ============================================================
 *
 * ğŸ“ æ ¸å¿ƒæºç ä½ç½®:
 * - packages/react-server/src/ReactFizzServer.js (Fizz æ ¸å¿ƒ)
 * - packages/react-dom/src/server/ReactDOMFizzServerNode.js
 * - packages/react-reconciler/src/ReactFiberHydrationContext.new.js
 *
 * â±ï¸ é¢„è®¡æ—¶é—´ï¼š2-3 å°æ—¶
 * ğŸ¯ é¢è¯•æƒé‡ï¼šâ­â­â­â­â­
 */

// ============================================================
// Part 1: Streaming SSR æ¦‚å¿µ
// ============================================================

/**
 * ğŸ“Š ä»€ä¹ˆæ˜¯ Streaming SSR
 */

const streamingSSRConcept = `
ğŸ“Š ä»€ä¹ˆæ˜¯ Streaming SSRï¼ˆæµå¼æœåŠ¡ç«¯æ¸²æŸ“ï¼‰

ä¼ ç»Ÿ SSR vs Streaming SSR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   ä¼ ç»Ÿ SSR (renderToString):                                                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚                                                                             â”‚
â”‚   æœåŠ¡å™¨:                                                                   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ¸²æŸ“æ•´æ£µæ ‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                 â”‚
â”‚                                          â†“                                  â”‚
â”‚                                      å‘é€å®Œæ•´ HTML                           â”‚
â”‚                                                                             â”‚
â”‚   å®¢æˆ·ç«¯:                                                                   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç­‰å¾… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ æ”¶åˆ°  â”œâ”€â”€â”€ æ˜¾ç¤º â”€â”€â”€â”¤                    â”‚
â”‚                                   â†‘                                         â”‚
â”‚                            é¦–å­—èŠ‚åˆ°è¾¾ (TTFB)                                â”‚
â”‚                                                                             â”‚
â”‚   é—®é¢˜ï¼š                                                                    â”‚
â”‚   â€¢ TTFB é•¿ï¼ˆè¦ç­‰æ•´æ£µæ ‘æ¸²æŸ“å®Œï¼‰                                             â”‚
â”‚   â€¢ æ— æ³•åˆ©ç”¨ç½‘ç»œå¸¦å®½ï¼ˆè¦ä¹ˆæ²¡æ•°æ®ï¼Œè¦ä¹ˆå…¨éƒ¨æ•°æ®ï¼‰                            â”‚
â”‚   â€¢ å¦‚æœæœ‰æ…¢æ•°æ®ï¼Œæ•´ä½“è¢«é˜»å¡                                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Streaming SSR (renderToPipeableStream):                                   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚                                                                             â”‚
â”‚   æœåŠ¡å™¨:                                                                   â”‚
â”‚   â”œâ”€ æ¸²æŸ“ â”€â”¤â”€ å‘é€ â”€â”¤â”€ æ¸²æŸ“ â”€â”¤â”€ å‘é€ â”€â”¤â”€ æ¸²æŸ“ â”€â”¤â”€ å‘é€ â”€â”¤                  â”‚
â”‚      chunk1  chunk1   chunk2  chunk2   chunk3  chunk3                       â”‚
â”‚                                                                             â”‚
â”‚   å®¢æˆ·ç«¯:                                                                   â”‚
â”‚   â”œâ”€â”¤ æ”¶åˆ°  â”œâ”€ æ˜¾ç¤º â”€â”¤ æ”¶åˆ°  â”œâ”€ æ˜¾ç¤º â”€â”¤ æ”¶åˆ°  â”œâ”€ æ˜¾ç¤º â”€â”¤                    â”‚
â”‚     â†‘                                                                       â”‚
â”‚   TTFB (æ›´å¿«ï¼)                                                             â”‚
â”‚                                                                             â”‚
â”‚   ä¼˜åŠ¿ï¼š                                                                    â”‚
â”‚   â€¢ TTFB æ›´å¿«ï¼ˆä¸éœ€è¦ç­‰å¾…æ•´æ£µæ ‘ï¼‰                                           â”‚
â”‚   â€¢ è¾¹æ¸²æŸ“è¾¹å‘é€ï¼Œå……åˆ†åˆ©ç”¨ç½‘ç»œ                                              â”‚
â”‚   â€¢ æ…¢æ•°æ®ä¸ä¼šé˜»å¡å¿«æ•°æ®                                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


React 18 çš„ Streaming API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import { renderToPipeableStream } from 'react-dom/server';

const { pipe, abort } = renderToPipeableStream(<App />, {
  bootstrapScripts: ['/main.js'],

  onShellReady() {
    // "Shell" å°±ç»ª - é Suspense éƒ¨åˆ†å·²æ¸²æŸ“å®Œæˆ
    // å¯ä»¥å¼€å§‹æµå¼è¾“å‡º
    res.statusCode = 200;
    res.setHeader('Content-Type', 'text/html');
    pipe(res);
  },

  onAllReady() {
    // æ‰€æœ‰å†…å®¹ï¼ˆåŒ…æ‹¬ Suspenseï¼‰éƒ½å·²å°±ç»ª
    // é€‚åˆçˆ¬è™«/é™æ€ç”Ÿæˆåœºæ™¯
  },

  onShellError(error) {
    // Shell æ¸²æŸ“å‡ºé”™
    res.statusCode = 500;
    res.send('<h1>Error</h1>');
  },

  onError(error) {
    console.error(error);
  },
});
`;

// ============================================================
// Part 2: Suspense ä¸ SSR çš„åä½œ
// ============================================================

/**
 * ğŸ“Š Suspense åœ¨ SSR ä¸­çš„è¡Œä¸º
 */

const suspenseInSSR = `
ğŸ“Š Suspense åœ¨ SSR ä¸­çš„è¡Œä¸º

æ ¸å¿ƒæ¦‚å¿µï¼šShell å’Œ Content
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   <App>                                                                     â”‚
â”‚     <Header />                    â† Shell éƒ¨åˆ†ï¼ˆç«‹å³æ¸²æŸ“ï¼‰                  â”‚
â”‚     <Suspense fallback={<Loading />}>                                       â”‚
â”‚       <AsyncContent />            â† Content éƒ¨åˆ†ï¼ˆå¯èƒ½å»¶è¿Ÿï¼‰                â”‚
â”‚     </Suspense>                                                             â”‚
â”‚     <Footer />                    â† Shell éƒ¨åˆ†ï¼ˆç«‹å³æ¸²æŸ“ï¼‰                  â”‚
â”‚   </App>                                                                    â”‚
â”‚                                                                             â”‚
â”‚   Shell: ä¸è¢« Suspense åŒ…è£¹çš„éƒ¨åˆ†ï¼Œä¼šç«‹å³æ¸²æŸ“å¹¶å‘é€                          â”‚
â”‚   Content: Suspense å†…çš„éƒ¨åˆ†ï¼Œæ•°æ®å°±ç»ªæ—¶æ‰æ¸²æŸ“                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


æœåŠ¡ç«¯ Suspense å¤„ç†æµç¨‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Step 1: å¼€å§‹æ¸²æŸ“ï¼Œé‡åˆ° Suspense                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚                                                                             â”‚
â”‚   <App>                                                                     â”‚
â”‚     <Header /> â† ç«‹å³æ¸²æŸ“: "<header>...</header>"                           â”‚
â”‚     <Suspense fallback={<Loading />}>                                       â”‚
â”‚       <AsyncContent />                                                      â”‚
â”‚     </Suspense>                                                             â”‚
â”‚     <Footer /> â† ç«‹å³æ¸²æŸ“: "<footer>...</footer>"                           â”‚
â”‚   </App>                                                                    â”‚
â”‚                                                                             â”‚
â”‚   Step 2: AsyncContent éœ€è¦æ•°æ®ï¼Œthrow Promise                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚                                                                             â”‚
â”‚   Fizz æ£€æµ‹åˆ° Promiseï¼Œä¸ä¼šé˜»å¡ï¼                                           â”‚
â”‚   â€¢ æ ‡è®°è¿™ä¸ª Suspense è¾¹ç•Œä¸º"pending"                                       â”‚
â”‚   â€¢ å…ˆè¾“å‡º fallback: "<div>Loading...</div>"                                â”‚
â”‚   â€¢ åœ¨ Promise ä¸Šæ³¨å†Œå›è°ƒ                                                   â”‚
â”‚                                                                             â”‚
â”‚   Step 3: Shell å°±ç»ªï¼Œå¼€å§‹æµå¼è¾“å‡º                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚                                                                             â”‚
â”‚   å‘é€åˆå§‹ HTML:                                                            â”‚
â”‚   <html>                                                                    â”‚
â”‚     <body>                                                                  â”‚
â”‚       <div id="root">                                                       â”‚
â”‚         <header>...</header>                                                â”‚
â”‚         <!--$?--><div>Loading...</div><!--/$-->                            â”‚
â”‚         <footer>...</footer>                                                â”‚
â”‚       </div>                                                                â”‚
â”‚       <script src="/main.js" async></script>                                â”‚
â”‚     </body>                                                                 â”‚
â”‚   </html>                                                                   â”‚
â”‚                                                                             â”‚
â”‚   â­ æ³¨æ„ <!--$?--> æ³¨é‡Šï¼Œè¿™æ˜¯ Suspense è¾¹ç•Œçš„æ ‡è®°                          â”‚
â”‚                                                                             â”‚
â”‚   Step 4: Promise resolveï¼Œæ•°æ®å°±ç»ª                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚                                                                             â”‚
â”‚   Fizz æ¸²æŸ“çœŸå®å†…å®¹ï¼Œä½œä¸º"è¡¥ä¸"å‘é€:                                        â”‚
â”‚   <script>                                                                  â”‚
â”‚     $RC = function(id, content) { /* æ›¿æ¢é€»è¾‘ */ };                         â”‚
â”‚     $RC("1", "<article>Real Content Here!</article>");                      â”‚
â”‚   </script>                                                                 â”‚
â”‚                                                                             â”‚
â”‚   è¿™ä¸ªè„šæœ¬ä¼šï¼š                                                              â”‚
â”‚   â€¢ æ‰¾åˆ° <!--$?--> æ ‡è®°çš„ä½ç½®                                               â”‚
â”‚   â€¢ ç”¨çœŸå®å†…å®¹æ›¿æ¢ fallback                                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 3: å®¢æˆ·ç«¯ Hydration ä¸ Suspense
// ============================================================

/**
 * ğŸ“Š Selective Hydration
 */

const selectiveHydration = `
ğŸ“Š Selective Hydrationï¼ˆé€‰æ‹©æ€§æ³¨æ°´ï¼‰

ä»€ä¹ˆæ˜¯ Selective Hydrationï¼Ÿ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

React 18 æ”¯æŒæŒ‰éœ€ hydrate Suspense è¾¹ç•Œå†…çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ‰€æœ‰å†…å®¹å°±ç»ªã€‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   ä¼ ç»Ÿ Hydration:                                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
â”‚   â€¢ å¿…é¡»ç­‰å¾…æ‰€æœ‰ JS ä¸‹è½½å®Œæˆ                                                â”‚
â”‚   â€¢ å¿…é¡»ç­‰å¾…æ‰€æœ‰ HTML åˆ°è¾¾                                                  â”‚
â”‚   â€¢ ç„¶åä¸€æ¬¡æ€§ hydrate æ•´æ£µæ ‘                                               â”‚
â”‚   â€¢ åœ¨æ­¤ä¹‹å‰ï¼Œé¡µé¢ä¸å¯äº¤äº’                                                  â”‚
â”‚                                                                             â”‚
â”‚   Selective Hydration:                                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚   â€¢ å¯ä»¥å…ˆ hydrate å·²åˆ°è¾¾çš„éƒ¨åˆ†                                             â”‚
â”‚   â€¢ Suspense è¾¹ç•Œå†…å¯ä»¥ç‹¬ç«‹ hydrate                                         â”‚
â”‚   â€¢ ç”¨æˆ·äº¤äº’å¯ä»¥è§¦å‘ä¼˜å…ˆ hydrate                                            â”‚
â”‚   â€¢ æ¸è¿›å¼å˜å¾—å¯äº¤äº’                                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Selective Hydration æ—¶é—´çº¿
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

<App>
  <Header />                           â† ç«‹å³å¯äº¤äº’
  <Suspense fallback={<Loading />}>
    <Sidebar />                        â† æ•°æ®åˆ°è¾¾åå¯äº¤äº’
  </Suspense>
  <Suspense fallback={<Loading />}>
    <Content />                        â† ç”¨æˆ·ç‚¹å‡»åä¼˜å…ˆå¯äº¤äº’
  </Suspense>
</App>

æ—¶é—´ â†’
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

T1: HTML åˆ°è¾¾ï¼ˆåŒ…å« Header + ä¸¤ä¸ª Loadingï¼‰
    â€¢ Header å¯è§
    â€¢ ä¸¤ä¸ª Suspense æ˜¾ç¤º Loading

T2: JS ä¸‹è½½å®Œæˆï¼Œå¼€å§‹ Hydration
    â€¢ hydrate Header â†’ Header å¯äº¤äº’

T3: Sidebar æ•°æ®åˆ°è¾¾
    â€¢ æœåŠ¡å™¨å‘é€ Sidebar å†…å®¹
    â€¢ å®¢æˆ·ç«¯æ›¿æ¢ Loading
    â€¢ hydrate Sidebar â†’ Sidebar å¯äº¤äº’

T4: ç”¨æˆ·ç‚¹å‡» Content åŒºåŸŸï¼ˆContent è¿˜åœ¨ Loadingï¼‰
    â€¢ React è®°å½•è¿™ä¸ªäº¤äº’
    â€¢ ä¼˜å…ˆå¤„ç† Content çš„ hydration

T5: Content æ•°æ®åˆ°è¾¾
    â€¢ æ›¿æ¢ Loading
    â€¢ â­ ä¼˜å…ˆ hydrate Contentï¼ˆå› ä¸ºç”¨æˆ·åœ¨äº¤äº’ï¼‰
    â€¢ Content å¯äº¤äº’
    â€¢ é‡æ”¾ç”¨æˆ·çš„ç‚¹å‡»äº‹ä»¶


äº¤äº’ä¼˜å…ˆ Hydration çš„å®ç°
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æºç ä½ç½®: packages/react-dom/src/events/ReactDOMEventReplaying.js

// å½“ç”¨æˆ·åœ¨å°šæœª hydrate çš„åŒºåŸŸç‚¹å‡»æ—¶
function queueExplicitHydrationTarget(target: Node): void {
  // è®°å½•è¿™ä¸ª target éœ€è¦ä¼˜å…ˆ hydrate
  queuedExplicitHydrationTargets.push(target);

  // è§¦å‘ä¼˜å…ˆ hydration
  scheduleExplicitHydrationTarget(target);
}

// React ä¼šï¼š
// 1. æ‰¾åˆ°åŒ…å«è¿™ä¸ª target çš„ Suspense è¾¹ç•Œ
// 2. ä¼˜å…ˆ hydrate è¿™ä¸ªè¾¹ç•Œ
// 3. hydration å®Œæˆåé‡æ”¾äº‹ä»¶
`;

// ============================================================
// Part 4: æ¡ˆä¾‹ - SSR + Suspense æµç¨‹
// ============================================================

/**
 * ğŸ“Š æ¡ˆä¾‹ B: SSR + Suspense æµç¨‹
 */

const ssrSuspenseCase = `
ğŸ“Š æ¡ˆä¾‹ B: SSR + Suspense ç®€åŒ–ç‰ˆæµç¨‹

ç¤ºä¾‹ä»£ç 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®è·å–
let data = null;
const fetchData = () => {
  if (data) return data;
  throw new Promise(resolve => {
    setTimeout(() => {
      data = { title: 'Loaded!' };
      resolve(data);
    }, 1000);
  });
};

function AsyncContent() {
  const result = fetchData();  // å¯èƒ½ throw Promise
  return <article>{result.title}</article>;
}

function App() {
  return (
    <div>
      <header><h1>My App</h1></header>
      <Suspense fallback={<p>Loading...</p>}>
        <AsyncContent />
      </Suspense>
      <footer>Footer</footer>
    </div>
  );
}


æœåŠ¡ç«¯æµç¨‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   T0: è¯·æ±‚åˆ°è¾¾ï¼Œå¼€å§‹æ¸²æŸ“                                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚                                                                             â”‚
â”‚   renderToPipeableStream(<App />, {                                         â”‚
â”‚     onShellReady() { pipe(res); }                                           â”‚
â”‚   });                                                                       â”‚
â”‚                                                                             â”‚
â”‚   T1: æ¸²æŸ“ Header å’Œ Footerï¼ˆ~0msï¼‰                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚                                                                             â”‚
â”‚   â€¢ <header> æ¸²æŸ“å®Œæˆ                                                       â”‚
â”‚   â€¢ é‡åˆ° Suspense                                                           â”‚
â”‚   â€¢ AsyncContent throw Promise                                              â”‚
â”‚   â€¢ è¾“å‡º fallback: <p>Loading...</p>                                        â”‚
â”‚   â€¢ <footer> æ¸²æŸ“å®Œæˆ                                                       â”‚
â”‚                                                                             â”‚
â”‚   T2: onShellReady è§¦å‘ï¼Œå¼€å§‹æµå¼è¾“å‡ºï¼ˆ~10msï¼‰                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚
â”‚                                                                             â”‚
â”‚   å‘é€åˆå§‹ HTML:                                                            â”‚
â”‚   <div>                                                                     â”‚
â”‚     <header><h1>My App</h1></header>                                        â”‚
â”‚     <!--$?--><p>Loading...</p><!--/$-->                                    â”‚
â”‚     <footer>Footer</footer>                                                 â”‚
â”‚   </div>                                                                    â”‚
â”‚                                                                             â”‚
â”‚   T3: Promise resolveï¼Œæ•°æ®å°±ç»ªï¼ˆ~1000msï¼‰                                  â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚                                                                             â”‚
â”‚   â€¢ Fizz è¢«"ping"ï¼Œé‡æ–°æ¸²æŸ“ Suspense å†…å®¹                                   â”‚
â”‚   â€¢ AsyncContent ä¸å† throwï¼Œæ­£å¸¸è¿”å›                                       â”‚
â”‚   â€¢ æ¸²æŸ“: <article>Loaded!</article>                                        â”‚
â”‚                                                                             â”‚
â”‚   å‘é€å¢é‡å†…å®¹:                                                             â”‚
â”‚   <script>                                                                  â”‚
â”‚     $RC("suspense-1", "<article>Loaded!</article>");                        â”‚
â”‚   </script>                                                                 â”‚
â”‚                                                                             â”‚
â”‚   T4: æµç»“æŸ                                                                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


å®¢æˆ·ç«¯æµç¨‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   T0: æ”¶åˆ°åˆå§‹ HTML                                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚                                                                             â”‚
â”‚   â€¢ æµè§ˆå™¨æ¸²æŸ“ Header + "Loading..." + Footer                               â”‚
â”‚   â€¢ ç”¨æˆ·ç«‹å³çœ‹åˆ°é¡µé¢æ¡†æ¶                                                    â”‚
â”‚                                                                             â”‚
â”‚   T1: JS åŠ è½½å®Œæˆï¼Œå¼€å§‹ Hydration                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚                                                                             â”‚
â”‚   hydrateRoot(container, <App />);                                          â”‚
â”‚   â€¢ Header hydrate å®Œæˆ â†’ å¯äº¤äº’                                            â”‚
â”‚   â€¢ Footer hydrate å®Œæˆ â†’ å¯äº¤äº’                                            â”‚
â”‚   â€¢ Suspense è¾¹ç•Œæ ‡è®°ä¸º dehydrated                                          â”‚
â”‚                                                                             â”‚
â”‚   T2: æ”¶åˆ°å¢é‡å†…å®¹                                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚                                                                             â”‚
â”‚   â€¢ $RC è„šæœ¬æ‰§è¡Œ                                                            â”‚
â”‚   â€¢ "Loading..." è¢«æ›¿æ¢ä¸º "<article>Loaded!</article>"                      â”‚
â”‚                                                                             â”‚
â”‚   T3: Suspense è¾¹ç•Œ Hydration                                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚                                                                             â”‚
â”‚   â€¢ React æ£€æµ‹åˆ° Suspense è¾¹ç•Œå†…å®¹æ›´æ–°                                      â”‚
â”‚   â€¢ hydrate AsyncContent â†’ å¯äº¤äº’                                           â”‚
â”‚                                                                             â”‚
â”‚   æœ€ç»ˆï¼šæ•´ä¸ªé¡µé¢å®Œå…¨å¯äº¤äº’                                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 5: é¢è¯•è¦ç‚¹
// ============================================================

const interviewPoints = `
ğŸ’¡ Part 4 é¢è¯•è¦ç‚¹

Q1: ä»€ä¹ˆæ˜¯ Streaming SSRï¼Ÿæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ
A: Streaming SSR æ˜¯è¾¹æ¸²æŸ“è¾¹å‘é€ HTML çš„æŠ€æœ¯ã€‚
   ä¼˜åŠ¿ï¼š
   - TTFB æ›´å¿«ï¼ˆä¸éœ€è¦ç­‰æ•´æ£µæ ‘æ¸²æŸ“å®Œï¼‰
   - è¾¹æ¸²æŸ“è¾¹å‘é€ï¼Œå……åˆ†åˆ©ç”¨ç½‘ç»œ
   - æ…¢æ•°æ®ä¸ä¼šé˜»å¡å¿«æ•°æ®

Q2: Suspense åœ¨ SSR ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
A: 1. é‡åˆ° Suspenseï¼Œå¦‚æœå†…å®¹ throw Promiseï¼Œå…ˆè¾“å‡º fallback
   2. Shellï¼ˆé Suspense éƒ¨åˆ†ï¼‰æ¸²æŸ“å®Œæˆåå¼€å§‹æµå¼è¾“å‡º
   3. Promise resolve åï¼ŒçœŸå®å†…å®¹ä½œä¸º"è¡¥ä¸"å‘é€
   4. å®¢æˆ·ç«¯ç”¨è„šæœ¬æ›¿æ¢ fallback

Q3: ä»€ä¹ˆæ˜¯ Shell å’Œ Contentï¼Ÿ
A: - Shell: ä¸è¢« Suspense åŒ…è£¹çš„éƒ¨åˆ†ï¼Œç«‹å³æ¸²æŸ“å¹¶å‘é€
   - Content: Suspense å†…çš„éƒ¨åˆ†ï¼Œæ•°æ®å°±ç»ªæ—¶æ‰æ¸²æŸ“

   onShellReady åœ¨ Shell å®Œæˆæ—¶è§¦å‘ã€‚

Q4: ä»€ä¹ˆæ˜¯ Selective Hydrationï¼Ÿ
A: React 18 çš„ç‰¹æ€§ï¼Œå¯ä»¥æŒ‰éœ€ hydrate Suspense è¾¹ç•Œï¼š
   - ä¸éœ€è¦ç­‰æ‰€æœ‰å†…å®¹åˆ°è¾¾
   - Suspense è¾¹ç•Œå¯ç‹¬ç«‹ hydrate
   - ç”¨æˆ·äº¤äº’å¯è§¦å‘ä¼˜å…ˆ hydrate
   - æ¸è¿›å¼å˜å¾—å¯äº¤äº’

Q5: ç”¨æˆ·ç‚¹å‡»å°šæœª hydrate çš„åŒºåŸŸä¼šæ€æ ·ï¼Ÿ
A: React ä¼šï¼š
   1. è®°å½•è¿™ä¸ªäº¤äº’
   2. ä¼˜å…ˆ hydrate è¿™ä¸ªåŒºåŸŸ
   3. hydration å®Œæˆåé‡æ”¾äº‹ä»¶

   è¿™å°±æ˜¯"äº¤äº’ä¼˜å…ˆ Hydration"ã€‚

Q6: <!--$?--> æ³¨é‡Šæ˜¯ä»€ä¹ˆï¼Ÿ
A: Suspense è¾¹ç•Œçš„æ ‡è®°ã€‚æœåŠ¡å™¨è¾“å‡ºæ—¶ï¼š
   <!--$?-->fallback<!--/$-->

   åç»­å¢é‡å†…å®¹ä¼šé€šè¿‡è„šæœ¬æ›¿æ¢è¿™ä¸ªæ ‡è®°å†…çš„å†…å®¹ã€‚
`;

export {
  streamingSSRConcept,
  suspenseInSSR,
  selectiveHydration,
  ssrSuspenseCase,
  interviewPoints,
};

