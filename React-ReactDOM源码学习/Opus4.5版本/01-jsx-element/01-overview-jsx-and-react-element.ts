/**
 * ============================================================
 * 📚 Phase 1: JSX 与 React 元素 - Part 1: 概览
 * ============================================================
 *
 * 📁 核心源码位置:
 * - packages/react/src/ReactElement.js
 * - packages/react/src/jsx/ReactJSXElement.js
 * - packages/shared/ReactSymbols.js
 *
 * ⏱️ 预计时间：2-3 小时
 * 🎯 面试权重：⭐⭐⭐⭐⭐
 */

// ============================================================
// Part 1: 什么是 JSX？
// ============================================================

/**
 * 📊 JSX 的本质
 */

const whatIsJSX = `
📊 什么是 JSX？

┌─────────────────────────────────────────────────────────────────────────────┐
│                              JSX 的定义                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  JSX 是 JavaScript 的语法扩展，允许你在 JS 中编写类似 HTML 的代码。         │
│                                                                             │
│  ⭐ 核心观点：JSX 只是语法糖！                                              │
│                                                                             │
│  浏览器不认识 JSX，它必须被编译工具（Babel/SWC/TypeScript）转换成           │
│  普通的 JavaScript 函数调用。                                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

JSX 写法 vs 编译后的 JS:
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│  JSX 写法（你写的代码）                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  const element = <div className="container">Hello, React!</div>;            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                          Babel/编译器 转换
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  传统方式（React 17 之前，classic runtime）                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  const element = React.createElement(                                       │
│    'div',                          // type: 元素类型                        │
│    { className: 'container' },     // config: 属性对象                      │
│    'Hello, React!'                 // children: 子元素                      │
│  );                                                                         │
│                                                                             │
│  ⚠️ 必须在文件顶部 import React from 'react'                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    或
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  新方式（React 17+，automatic runtime）                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  import { jsx as _jsx } from 'react/jsx-runtime';                           │
│                                                                             │
│  const element = _jsx('div', {                                              │
│    className: 'container',                                                  │
│    children: 'Hello, React!'       // children 放在 props 里               │
│  });                                                                        │
│                                                                             │
│  ✅ 不需要手动 import React                                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
`;

// ============================================================
// Part 2: ReactElement 的概念
// ============================================================

/**
 * 📊 ReactElement 是什么？
 */

const whatIsReactElement = `
📊 ReactElement 是什么？

┌─────────────────────────────────────────────────────────────────────────────┐
│                         ReactElement 的角色                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ReactElement 是一个普通的 JavaScript 对象，                                │
│  它描述了你想在屏幕上看到什么。                                             │
│                                                                             │
│  ⭐ 核心观点：ReactElement 是 UI 的"描述"，不是真正的 DOM！                 │
│                                                                             │
│  它是：                                                                     │
│  • JSX 编译后产生的对象                                                     │
│  • React 渲染流程的输入                                                     │
│  • 组件树的节点表示                                                         │
│                                                                             │
│  它不是：                                                                   │
│  • 真正的 DOM 元素                                                          │
│  • Fiber 节点（那是下一阶段的概念）                                         │
│  • 组件实例                                                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

"UI = f(state)" 在源码层面的体现：
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   State / Props                                                             │
│        │                                                                    │
│        │  组件函数执行                                                      │
│        ▼                                                                    │
│   ┌─────────────────┐                                                       │
│   │  function App() │  ← 这就是 "f"（函数）                                 │
│   │  {              │                                                       │
│   │    return (     │                                                       │
│   │      <div>      │  ← JSX 语法糖                                         │
│   │        {count}  │                                                       │
│   │      </div>     │                                                       │
│   │    );           │                                                       │
│   │  }              │                                                       │
│   └─────────────────┘                                                       │
│        │                                                                    │
│        │  JSX 编译 + 组件执行                                               │
│        ▼                                                                    │
│   ┌─────────────────┐                                                       │
│   │  ReactElement   │  ← 这就是 "UI"（描述对象）                            │
│   │  {              │                                                       │
│   │    $$typeof,    │                                                       │
│   │    type: 'div', │                                                       │
│   │    props: {...} │                                                       │
│   │  }              │                                                       │
│   └─────────────────┘                                                       │
│        │                                                                    │
│        │  React 内部处理                                                    │
│        ▼                                                                    │
│   ┌─────────────────┐                                                       │
│   │  Fiber Tree     │  → Phase 2 会讲                                       │
│   └─────────────────┘                                                       │
│        │                                                                    │
│        │  Commit 阶段                                                       │
│        ▼                                                                    │
│   ┌─────────────────┐                                                       │
│   │  Real DOM       │  ← 最终渲染到屏幕                                     │
│   └─────────────────┘                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

关键理解：
─────────────────────────

1. 每次组件重新渲染，都会创建新的 ReactElement 对象
2. ReactElement 是不可变的（immutable）
3. React 通过比较新旧 ReactElement 来决定如何更新 DOM（Diff）
`;

// ============================================================
// Part 3: createElement vs jsx/jsxs 对比
// ============================================================

/**
 * 📊 两种运行时的对比
 */

const runtimeComparison = `
📊 createElement vs jsx/jsxs 对比

┌─────────────────────────────────────────────────────────────────────────────┐
│                    两种 JSX 转换方式对比                                     │
├─────────────────────┬───────────────────────────────────────────────────────┤
│ 特性                │ Classic Runtime           │ Automatic Runtime         │
├─────────────────────┼───────────────────────────┼───────────────────────────┤
│ 引入时间            │ React 最初版本            │ React 17+                 │
│ 入口函数            │ React.createElement       │ jsx / jsxs / jsxDEV       │
│ 是否需要 import     │ ✅ 必须 import React      │ ❌ 编译器自动引入         │
│ children 位置       │ 作为第3+个参数            │ 放在 props.children 里    │
│ 静态子元素优化      │ ❌ 无                     │ ✅ jsxs 处理静态子元素    │
│ 源码位置            │ ReactElement.js           │ jsx/ReactJSXElement.js    │
└─────────────────────┴───────────────────────────┴───────────────────────────┘

具体示例：
═══════════════════════════════════════════════════════════════════════════════

JSX 代码：
─────────────────────────

function Greeting({ name }) {
  return (
    <div className="greeting">
      <h1>Hello, {name}!</h1>
      <p>Welcome to React.</p>
    </div>
  );
}


Classic Runtime 编译结果：
─────────────────────────

import React from 'react';  // ⚠️ 必须引入

function Greeting({ name }) {
  return React.createElement(
    'div',
    { className: 'greeting' },
    React.createElement('h1', null, 'Hello, ', name, '!'),
    React.createElement('p', null, 'Welcome to React.')
  );
}


Automatic Runtime 编译结果：
─────────────────────────

import { jsx as _jsx, jsxs as _jsxs } from 'react/jsx-runtime';

function Greeting({ name }) {
  return _jsxs('div', {       // ⭐ jsxs: 有多个静态子元素
    className: 'greeting',
    children: [
      _jsxs('h1', {           // ⭐ jsxs: 有多个子元素
        children: ['Hello, ', name, '!']
      }),
      _jsx('p', {             // ⭐ jsx: 单个子元素
        children: 'Welcome to React.'
      })
    ]
  });
}


jsx vs jsxs 的区别：
─────────────────────────

📁 packages/react/src/jsx/ReactJSX.js

const jsx = __DEV__ ? jsxWithValidationDynamic : jsxProd;
const jsxs = __DEV__ ? jsxWithValidationStatic : jsxProd;

// 区别：
// - jsx: 用于动态子元素（可能在运行时变化）
// - jsxs: 用于静态子元素（编译时就确定的）

// 例如：
// <div>{items.map(...)}</div>  → 使用 jsx（动态）
// <div><span>A</span><span>B</span></div>  → 使用 jsxs（静态）

// ⭐ 但实际上 jsx 和 jsxs 在生产环境是同一个函数！
// 区别主要在开发环境的警告和验证
`;

// ============================================================
// Part 4: 为什么需要 ReactElement？
// ============================================================

/**
 * 📊 ReactElement 的设计意义
 */

const whyReactElement = `
📊 为什么需要 ReactElement 这个中间表示？

┌─────────────────────────────────────────────────────────────────────────────┐
│                         设计原因                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. 声明式编程的基础                                                        │
│     ─────────────────                                                       │
│     • 开发者只描述"想要什么"，不需要描述"如何做"                            │
│     • ReactElement 就是这个"描述"                                           │
│                                                                             │
│  2. 跨平台能力                                                              │
│     ─────────────────                                                       │
│     • ReactElement 是抽象的，不依赖具体平台                                 │
│     • 同一份 ReactElement 可以渲染到：                                      │
│       - DOM（react-dom）                                                    │
│       - Native（react-native）                                              │
│       - Canvas、Terminal 等                                                 │
│                                                                             │
│  3. 高效的 Diff 算法基础                                                    │
│     ─────────────────                                                       │
│     • ReactElement 是轻量的 JS 对象                                         │
│     • 创建和比较的成本很低                                                  │
│     • 为后续的 Fiber 架构提供输入                                           │
│                                                                             │
│  4. 安全性                                                                  │
│     ─────────────────                                                       │
│     • $$typeof 字段防止 XSS 攻击                                            │
│     • 只有合法的 ReactElement 才能被渲染                                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

ReactElement 在整个渲染链路中的位置：
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   [Phase 1]              [Phase 2]           [Phase 3]          [Phase 3]   │
│                                                                             │
│   JSX 语法糖              Fiber 架构          Render 阶段        Commit 阶段│
│       │                       │                   │                   │     │
│       ▼                       ▼                   ▼                   ▼     │
│  ┌─────────┐           ┌─────────────┐     ┌───────────┐      ┌─────────┐  │
│  │  JSX    │  编译     │ ReactElement│ 转换│ FiberNode │ 处理 │ Real    │  │
│  │ 语法糖  │ ───────▶  │ 描述对象    │───▶ │ 工作单元  │ ───▶ │  DOM    │  │
│  └─────────┘           └─────────────┘     └───────────┘      └─────────┘  │
│                                                                             │
│  你写的代码              你现在学习的         下一阶段学          最终渲染  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
`;

// ============================================================
// Part 5: 面试要点
// ============================================================

const interviewPoints = `
💡 Part 1 面试要点

Q1: JSX 是什么？
A: JSX 是 JavaScript 的语法扩展，允许在 JS 中编写类似 HTML 的代码。
   它只是语法糖，会被编译器转换为 React.createElement 或 jsx() 调用。
   最终产生 ReactElement 对象。

Q2: ReactElement 和 DOM 元素有什么区别？
A: ReactElement 是普通的 JS 对象，描述了 UI 应该是什么样子。
   DOM 元素是浏览器中的真实节点。
   ReactElement 是轻量的，创建成本低；DOM 操作是昂贵的。
   React 通过比较 ReactElement 来最小化 DOM 操作。

Q3: React 17 的新 JSX 转换有什么优势？
A: 1. 不需要手动 import React
   2. 编译器自动引入需要的函数
   3. 减少了打包体积
   4. jsx/jsxs 可以针对静态/动态子元素做优化

Q4: "UI = f(state)" 是什么意思？
A: UI 是状态的函数。
   在 React 中，组件（f）接收 state/props 作为输入，
   返回 ReactElement（UI 描述）作为输出。
   每次 state 变化，函数重新执行，产生新的 UI 描述，
   React 负责将描述同步到真实 DOM。

Q5: 为什么 ReactElement 要设计成不可变的？
A: 1. 便于比较：不可变对象可以通过引用比较快速判断是否相同
   2. 可预测性：同样的输入总是产生同样的输出
   3. 并发安全：在并发模式下不会有数据竞争问题
   4. 简化逻辑：不需要追踪对象的变化历史
`;

export {
  whatIsJSX,
  whatIsReactElement,
  runtimeComparison,
  whyReactElement,
  interviewPoints,
};

