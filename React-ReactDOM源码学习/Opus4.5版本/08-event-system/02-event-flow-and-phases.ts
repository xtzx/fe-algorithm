/**
 * ============================================================
 * ğŸ“š Phase 8: äº‹ä»¶ç³»ç»Ÿ - Part 2: äº‹ä»¶æµä¸æ‰§è¡Œé˜¶æ®µ
 * ============================================================
 *
 * ğŸ“ æ ¸å¿ƒæºç ä½ç½®:
 * - packages/react-dom/src/events/ReactDOMEventListener.js
 * - packages/react-dom/src/events/DOMPluginEventSystem.js
 * - packages/react-dom/src/events/getListener.js
 *
 * â±ï¸ é¢„è®¡æ—¶é—´ï¼š4-5 å°æ—¶
 * ğŸ¯ é¢è¯•æƒé‡ï¼šâ­â­â­â­â­
 */

// ============================================================
// Part 1: äº‹ä»¶å®Œæ•´æµç¨‹ - ä»ç”¨æˆ·ç‚¹å‡»åˆ°å›è°ƒæ‰§è¡Œ
// ============================================================

/**
 * ğŸ“Š ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶çš„å®Œæ•´æµç¨‹
 */

const completeEventFlow = `
ğŸ“Š ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶çš„å®Œæ•´æµç¨‹

å‡è®¾ç»„ä»¶ç»“æ„:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function App() {
  return (
    <div onClickCapture={() => console.log('div capture')}
         onClick={() => console.log('div bubble')}>
      <button onClick={() => console.log('button click')}>
        Click Me
      </button>
    </div>
  );
}

å¯¹åº”çš„ Fiber æ ‘:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    FiberRoot
        â”‚
        â–¼
    HostRoot
        â”‚
        â–¼
    App (FunctionComponent)
        â”‚
        â–¼
    div (HostComponent)  â† æœ‰ onClick å’Œ onClickCapture
        â”‚
        â–¼
    button (HostComponent)  â† æœ‰ onClickï¼Œè¿™æ˜¯ç‚¹å‡»ç›®æ ‡
        â”‚
        â–¼
    "Click Me" (Text)


ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åçš„å®Œæ•´æµç¨‹:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: åŸç”Ÿäº‹ä»¶äº§ç”Ÿ                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ç”¨æˆ·ç‚¹å‡» <button> â†’ æµè§ˆå™¨äº§ç”ŸåŸç”Ÿ click äº‹ä»¶                             â”‚
â”‚                                                                             â”‚
â”‚   åŸç”Ÿäº‹ä»¶æµ:                                                               â”‚
â”‚   1. æ•è·é˜¶æ®µ: window â†’ document â†’ html â†’ body â†’ #root â†’ div â†’ button      â”‚
â”‚   2. ç›®æ ‡é˜¶æ®µ: button                                                       â”‚
â”‚   3. å†’æ³¡é˜¶æ®µ: button â†’ div â†’ #root â†’ body â†’ html â†’ document â†’ window      â”‚
â”‚                                                                             â”‚
â”‚   â­ React åœ¨ #root (root container) ä¸Šç›‘å¬äº‹ä»¶                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: React äº‹ä»¶ç›‘å¬å™¨è¢«è§¦å‘                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ ReactDOMEventListener.js                                              â”‚
â”‚                                                                             â”‚
â”‚   å½“äº‹ä»¶å†’æ³¡åˆ° #root æ—¶ï¼ŒReact çš„ç›‘å¬å™¨è¢«è°ƒç”¨:                              â”‚
â”‚                                                                             â”‚
â”‚   // åœ¨ #root ä¸Šæ³¨å†Œçš„ç›‘å¬å™¨ï¼ˆæ•è·é˜¶æ®µï¼‰                                    â”‚
â”‚   root.addEventListener('click', listener, true);                           â”‚
â”‚                                                                             â”‚
â”‚   // åœ¨ #root ä¸Šæ³¨å†Œçš„ç›‘å¬å™¨ï¼ˆå†’æ³¡é˜¶æ®µï¼‰                                    â”‚
â”‚   root.addEventListener('click', listener, false);                          â”‚
â”‚                                                                             â”‚
â”‚   listener æ˜¯ dispatchDiscreteEvent / dispatchContinuousEvent / dispatchEvent â”‚
â”‚   æ ¹æ®äº‹ä»¶ç±»å‹çš„ä¼˜å…ˆçº§ä¸åŒ                                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: è®¾ç½®äº‹ä»¶ä¼˜å…ˆçº§                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ ReactDOMEventListener.js: dispatchDiscreteEvent                       â”‚
â”‚                                                                             â”‚
â”‚   function dispatchDiscreteEvent(domEventName, eventSystemFlags,            â”‚
â”‚                                  container, nativeEvent) {                  â”‚
â”‚     const previousPriority = getCurrentUpdatePriority();                    â”‚
â”‚     const prevTransition = ReactCurrentBatchConfig.transition;              â”‚
â”‚     ReactCurrentBatchConfig.transition = null;                              â”‚
â”‚     try {                                                                   â”‚
â”‚       // â­ è®¾ç½®ä¸ºç¦»æ•£äº‹ä»¶ä¼˜å…ˆçº§ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰                              â”‚
â”‚       setCurrentUpdatePriority(DiscreteEventPriority);                      â”‚
â”‚       dispatchEvent(domEventName, eventSystemFlags, container, nativeEvent);â”‚
â”‚     } finally {                                                             â”‚
â”‚       setCurrentUpdatePriority(previousPriority);                           â”‚
â”‚       ReactCurrentBatchConfig.transition = prevTransition;                  â”‚
â”‚     }                                                                       â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â”‚   click æ˜¯ç¦»æ•£äº‹ä»¶ â†’ DiscreteEventPriority                                  â”‚
â”‚   è¿™æ„å‘³ç€äº‹ä»¶è§¦å‘çš„æ›´æ–°ä¼šæœ‰æœ€é«˜ä¼˜å…ˆçº§                                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: è°ƒç”¨ dispatchEvent                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ ReactDOMEventListener.js: dispatchEvent                               â”‚
â”‚                                                                             â”‚
â”‚   function dispatchEvent(domEventName, eventSystemFlags,                    â”‚
â”‚                          targetContainer, nativeEvent) {                    â”‚
â”‚     // ... æ£€æŸ¥æ˜¯å¦å¯ç”¨ç­‰                                                   â”‚
â”‚     dispatchEventForPluginEventSystem(...);                                 â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: æŸ¥æ‰¾ç›®æ ‡ Fiber                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ DOMPluginEventSystem.js: dispatchEventForPluginEventSystem            â”‚
â”‚                                                                             â”‚
â”‚   1. ä» nativeEvent.target (åŸç”Ÿ DOM èŠ‚ç‚¹) è·å–å¯¹åº”çš„ Fiber                 â”‚
â”‚      getClosestInstanceFromNode(nativeEvent.target)                         â”‚
â”‚                                                                             â”‚
â”‚      â­ DOM èŠ‚ç‚¹ä¸Šæœ‰ __reactFiber$ å±æ€§æŒ‡å‘å¯¹åº”çš„ Fiber                     â”‚
â”‚      è¿™æ˜¯åœ¨ React æ¸²æŸ“æ—¶è®¾ç½®çš„                                              â”‚
â”‚                                                                             â”‚
â”‚   2. æ‰¾åˆ°çš„ Fiber: button ç»„ä»¶å¯¹åº”çš„ Fiber                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: è°ƒç”¨äº‹ä»¶æ’ä»¶å¤„ç†                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ DOMPluginEventSystem.js: dispatchEventsForPlugins                     â”‚
â”‚                                                                             â”‚
â”‚   function dispatchEventsForPlugins(domEventName, eventSystemFlags,         â”‚
â”‚                                     nativeEvent, targetInst, targetContainer) â”‚
â”‚   {                                                                         â”‚
â”‚     const nativeEventTarget = getEventTarget(nativeEvent);                  â”‚
â”‚     const dispatchQueue = [];                                               â”‚
â”‚                                                                             â”‚
â”‚     // â­ è°ƒç”¨å„ä¸ªæ’ä»¶æå–äº‹ä»¶                                              â”‚
â”‚     extractEvents(                                                          â”‚
â”‚       dispatchQueue,                                                        â”‚
â”‚       domEventName,      // 'click'                                         â”‚
â”‚       targetInst,        // button Fiber                                    â”‚
â”‚       nativeEvent,       // åŸç”Ÿäº‹ä»¶å¯¹è±¡                                    â”‚
â”‚       nativeEventTarget, // <button> DOM èŠ‚ç‚¹                               â”‚
â”‚       eventSystemFlags,  // æ ‡å¿—ä½                                          â”‚
â”‚       targetContainer,   // #root                                           â”‚
â”‚     );                                                                      â”‚
â”‚                                                                             â”‚
â”‚     // â­ å¤„ç†æ´¾å‘é˜Ÿåˆ—                                                      â”‚
â”‚     processDispatchQueue(dispatchQueue, eventSystemFlags);                  â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: extractEvents - æå–äº‹ä»¶å’Œæ”¶é›†ç›‘å¬å™¨                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ DOMPluginEventSystem.js: extractEvents                                â”‚
â”‚                                                                             â”‚
â”‚   function extractEvents(dispatchQueue, domEventName, ...) {                â”‚
â”‚     // 1. SimpleEventPlugin å¤„ç†åŸºæœ¬äº‹ä»¶ï¼ˆclick ç”±å®ƒå¤„ç†ï¼‰                  â”‚
â”‚     SimpleEventPlugin.extractEvents(dispatchQueue, ...);                    â”‚
â”‚                                                                             â”‚
â”‚     // 2. å…¶ä»–æ’ä»¶å¤„ç†ç‰¹æ®Šäº‹ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼‰                                  â”‚
â”‚     EnterLeaveEventPlugin.extractEvents(dispatchQueue, ...);                â”‚
â”‚     ChangeEventPlugin.extractEvents(dispatchQueue, ...);                    â”‚
â”‚     SelectEventPlugin.extractEvents(dispatchQueue, ...);                    â”‚
â”‚     BeforeInputEventPlugin.extractEvents(dispatchQueue, ...);               â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â”‚   å¯¹äº click äº‹ä»¶ï¼ŒSimpleEventPlugin ä¼šï¼š                                   â”‚
â”‚   1. åˆ›å»º SyntheticMouseEvent                                               â”‚
â”‚   2. æ”¶é›†æ‰€æœ‰ç›¸å…³çš„ listeners                                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: æ”¶é›† listenersï¼ˆä» target å‘ä¸Šéå†ï¼‰                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ DOMPluginEventSystem.js: accumulateSinglePhaseListeners               â”‚
â”‚                                                                             â”‚
â”‚   ä» button Fiber å‘ä¸Šéå†åˆ° rootï¼Œæ”¶é›†æ‰€æœ‰ç›‘å¬å™¨:                          â”‚
â”‚                                                                             â”‚
â”‚   å¯¹äºå†’æ³¡é˜¶æ®µï¼ˆinCapturePhase = falseï¼‰:                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚  Fiber             â”‚  æ£€æŸ¥å±æ€§        â”‚  ç»“æœ              â”‚             â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚   â”‚  button            â”‚  onClick         â”‚  âœ“ æ‰¾åˆ°ç›‘å¬å™¨      â”‚             â”‚
â”‚   â”‚  div               â”‚  onClick         â”‚  âœ“ æ‰¾åˆ°ç›‘å¬å™¨      â”‚             â”‚
â”‚   â”‚  App               â”‚  (å‡½æ•°ç»„ä»¶)      â”‚  è·³è¿‡              â”‚             â”‚
â”‚   â”‚  HostRoot          â”‚  (æ ¹èŠ‚ç‚¹)        â”‚  åœæ­¢              â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                             â”‚
â”‚   æ”¶é›†ç»“æœ (dispatchListeners):                                             â”‚
â”‚   [                                                                         â”‚
â”‚     { instance: buttonFiber, listener: buttonOnClick, currentTarget: button },â”‚
â”‚     { instance: divFiber, listener: divOnClick, currentTarget: div },       â”‚
â”‚   ]                                                                         â”‚
â”‚                                                                             â”‚
â”‚   å¯¹äºæ•è·é˜¶æ®µï¼ˆinCapturePhase = trueï¼‰:                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚  Fiber             â”‚  æ£€æŸ¥å±æ€§           â”‚  ç»“æœ           â”‚             â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚   â”‚  button            â”‚  onClickCapture     â”‚  âœ— æ—            â”‚             â”‚
â”‚   â”‚  div               â”‚  onClickCapture     â”‚  âœ“ æ‰¾åˆ°ç›‘å¬å™¨   â”‚             â”‚
â”‚   â”‚  App               â”‚  (å‡½æ•°ç»„ä»¶)         â”‚  è·³è¿‡           â”‚             â”‚
â”‚   â”‚  HostRoot          â”‚  (æ ¹èŠ‚ç‚¹)           â”‚  åœæ­¢           â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                             â”‚
â”‚   æ”¶é›†ç»“æœ:                                                                 â”‚
â”‚   [                                                                         â”‚
â”‚     { instance: divFiber, listener: divOnClickCapture, currentTarget: div },â”‚
â”‚   ]                                                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 9: åˆ›å»º SyntheticEvent                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ SyntheticEvent.js: SyntheticMouseEvent                                â”‚
â”‚                                                                             â”‚
â”‚   const syntheticEvent = new SyntheticMouseEvent(                           â”‚
â”‚     'onClick',          // React äº‹ä»¶å                                     â”‚
â”‚     'click',            // åŸç”Ÿäº‹ä»¶ç±»å‹                                     â”‚
â”‚     buttonFiber,        // target Fiber                                     â”‚
â”‚     nativeEvent,        // åŸç”Ÿäº‹ä»¶å¯¹è±¡                                     â”‚
â”‚     nativeEventTarget,  // <button> DOM èŠ‚ç‚¹                                â”‚
â”‚   );                                                                        â”‚
â”‚                                                                             â”‚
â”‚   SyntheticEvent åŒ…å«:                                                      â”‚
â”‚   - _reactName: 'onClick'                                                   â”‚
â”‚   - _targetInst: buttonFiber                                                â”‚
â”‚   - type: 'click'                                                           â”‚
â”‚   - nativeEvent: åŸç”Ÿ MouseEvent                                            â”‚
â”‚   - target: <button> DOM                                                    â”‚
â”‚   - currentTarget: null (ä¼šåœ¨è°ƒç”¨æ—¶è®¾ç½®)                                    â”‚
â”‚   - ... (å…¶ä»– MouseEvent å±æ€§: clientX, clientY ç­‰)                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 10: processDispatchQueue - æ‰§è¡Œç›‘å¬å™¨                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ DOMPluginEventSystem.js: processDispatchQueue                         â”‚
â”‚                                                                             â”‚
â”‚   dispatchQueue åŒ…å«:                                                       â”‚
â”‚   [                                                                         â”‚
â”‚     {                                                                       â”‚
â”‚       event: syntheticEvent (SyntheticMouseEvent),                          â”‚
â”‚       listeners: [buttonListener, divListener]  // å†’æ³¡                     â”‚
â”‚     },                                                                      â”‚
â”‚     {                                                                       â”‚
â”‚       event: syntheticEvent (SyntheticMouseEvent),                          â”‚
â”‚       listeners: [divCaptureListener]  // æ•è·                              â”‚
â”‚     },                                                                      â”‚
â”‚   ]                                                                         â”‚
â”‚                                                                             â”‚
â”‚   æ‰§è¡Œé¡ºåº:                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚  â­ æ•è·é˜¶æ®µå…ˆæ‰§è¡Œï¼ˆåŸç”Ÿäº‹ä»¶åœ¨æ•è·é˜¶æ®µè§¦å‘æ—¶ï¼‰                         â”‚â”‚
â”‚   â”‚                                                                       â”‚â”‚
â”‚   â”‚  1. div çš„ onClickCapture â†’ console.log('div capture')                â”‚â”‚
â”‚   â”‚                                                                       â”‚â”‚
â”‚   â”‚  â­ ç„¶åæ˜¯å†’æ³¡é˜¶æ®µ                                                    â”‚â”‚
â”‚   â”‚                                                                       â”‚â”‚
â”‚   â”‚  2. button çš„ onClick â†’ console.log('button click')                   â”‚â”‚
â”‚   â”‚  3. div çš„ onClick â†’ console.log('div bubble')                        â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â”‚   è¾“å‡ºé¡ºåº:                                                                 â”‚
â”‚   'div capture'                                                             â”‚
â”‚   'button click'                                                            â”‚
â”‚   'div bubble'                                                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 2: æ•è·ä¸å†’æ³¡é˜¶æ®µçš„å®ç°
// ============================================================

/**
 * ğŸ“Š React ä¸­æ•è·ä¸å†’æ³¡çš„æ¨¡æ‹Ÿ
 */

const captureAndBubblePhases = `
ğŸ“Š React ä¸­æ•è·ä¸å†’æ³¡é˜¶æ®µçš„å®ç°

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åŸç”Ÿäº‹ä»¶æµ vs React äº‹ä»¶æµ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   åŸç”Ÿäº‹ä»¶æµ:                                                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚   æ•è·: window â†’ document â†’ html â†’ body â†’ #root â†’ div â†’ button             â”‚
â”‚   å†’æ³¡: button â†’ div â†’ #root â†’ body â†’ html â†’ document â†’ window             â”‚
â”‚                                                                             â”‚
â”‚   React äº‹ä»¶å¤„ç†:                                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚   React åœ¨ #root ä¸Šæ³¨å†Œäº†ä¸¤ä¸ªç›‘å¬å™¨:                                        â”‚
â”‚   - æ•è·é˜¶æ®µç›‘å¬å™¨ (addEventListener(..., true))                            â”‚
â”‚   - å†’æ³¡é˜¶æ®µç›‘å¬å™¨ (addEventListener(..., false))                           â”‚
â”‚                                                                             â”‚
â”‚   å½“åŸç”Ÿäº‹ä»¶çš„æ•è·é˜¶æ®µåˆ°è¾¾ #root æ—¶:                                        â”‚
â”‚   â†’ React æ•è·ç›‘å¬å™¨è§¦å‘                                                    â”‚
â”‚   â†’ React å†…éƒ¨æ¨¡æ‹Ÿä»å¤–åˆ°å†…çš„æ•è·é¡ºåºè°ƒç”¨ onXxxCapture                       â”‚
â”‚                                                                             â”‚
â”‚   å½“åŸç”Ÿäº‹ä»¶çš„å†’æ³¡é˜¶æ®µåˆ°è¾¾ #root æ—¶:                                        â”‚
â”‚   â†’ React å†’æ³¡ç›‘å¬å™¨è§¦å‘                                                    â”‚
â”‚   â†’ React å†…éƒ¨æ¨¡æ‹Ÿä»å†…åˆ°å¤–çš„å†’æ³¡é¡ºåºè°ƒç”¨ onXxx                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       äº‹ä»¶ç›‘å¬å™¨æ³¨å†Œ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ DOMPluginEventSystem.js: listenToAllSupportedEvents                   â”‚
â”‚                                                                             â”‚
â”‚   function listenToAllSupportedEvents(rootContainerElement) {               â”‚
â”‚     if (!rootContainerElement[listeningMarker]) {                           â”‚
â”‚       rootContainerElement[listeningMarker] = true;                         â”‚
â”‚                                                                             â”‚
â”‚       allNativeEvents.forEach(domEventName => {                             â”‚
â”‚         if (domEventName !== 'selectionchange') {                           â”‚
â”‚           if (!nonDelegatedEvents.has(domEventName)) {                      â”‚
â”‚             // â­ æ³¨å†Œå†’æ³¡é˜¶æ®µç›‘å¬å™¨                                        â”‚
â”‚             listenToNativeEvent(domEventName, false, rootContainerElement); â”‚
â”‚           }                                                                 â”‚
â”‚           // â­ æ³¨å†Œæ•è·é˜¶æ®µç›‘å¬å™¨                                          â”‚
â”‚           listenToNativeEvent(domEventName, true, rootContainerElement);    â”‚
â”‚         }                                                                   â”‚
â”‚       });                                                                   â”‚
â”‚     }                                                                       â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â”‚   ğŸ“ DOMPluginEventSystem.js: addTrappedEventListener                      â”‚
â”‚                                                                             â”‚
â”‚   function addTrappedEventListener(targetContainer, domEventName,           â”‚
â”‚                                    eventSystemFlags, isCapturePhaseListener) â”‚
â”‚   {                                                                         â”‚
â”‚     let listener = createEventListenerWrapperWithPriority(                  â”‚
â”‚       targetContainer, domEventName, eventSystemFlags                       â”‚
â”‚     );                                                                      â”‚
â”‚                                                                             â”‚
â”‚     if (isCapturePhaseListener) {                                           â”‚
â”‚       // æ•è·é˜¶æ®µ                                                           â”‚
â”‚       targetContainer.addEventListener(domEventName, listener, true);       â”‚
â”‚     } else {                                                                â”‚
â”‚       // å†’æ³¡é˜¶æ®µ                                                           â”‚
â”‚       targetContainer.addEventListener(domEventName, listener, false);      â”‚
â”‚     }                                                                       â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ‰§è¡Œé¡ºåºæ§åˆ¶                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ DOMPluginEventSystem.js: processDispatchQueueItemsInOrder             â”‚
â”‚                                                                             â”‚
â”‚   function processDispatchQueueItemsInOrder(event, dispatchListeners,       â”‚
â”‚                                             inCapturePhase) {               â”‚
â”‚     let previousInstance;                                                   â”‚
â”‚                                                                             â”‚
â”‚     if (inCapturePhase) {                                                   â”‚
â”‚       // â­ æ•è·é˜¶æ®µ: ä»åå‘å‰éå†ï¼ˆä»å¤–åˆ°å†…ï¼‰                              â”‚
â”‚       for (let i = dispatchListeners.length - 1; i >= 0; i--) {             â”‚
â”‚         const {instance, currentTarget, listener} = dispatchListeners[i];   â”‚
â”‚         if (instance !== previousInstance && event.isPropagationStopped()) {â”‚
â”‚           return;                                                           â”‚
â”‚         }                                                                   â”‚
â”‚         executeDispatch(event, listener, currentTarget);                    â”‚
â”‚         previousInstance = instance;                                        â”‚
â”‚       }                                                                     â”‚
â”‚     } else {                                                                â”‚
â”‚       // â­ å†’æ³¡é˜¶æ®µ: ä»å‰å‘åéå†ï¼ˆä»å†…åˆ°å¤–ï¼‰                              â”‚
â”‚       for (let i = 0; i < dispatchListeners.length; i++) {                  â”‚
â”‚         const {instance, currentTarget, listener} = dispatchListeners[i];   â”‚
â”‚         if (instance !== previousInstance && event.isPropagationStopped()) {â”‚
â”‚           return;                                                           â”‚
â”‚         }                                                                   â”‚
â”‚         executeDispatch(event, listener, currentTarget);                    â”‚
â”‚         previousInstance = instance;                                        â”‚
â”‚       }                                                                     â”‚
â”‚     }                                                                       â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â”‚   dispatchListeners æ”¶é›†æ—¶æ˜¯ä» target å‘ä¸Šéå†çš„:                           â”‚
â”‚   [button, div, App, HostRoot]                                              â”‚
â”‚                                                                             â”‚
â”‚   æ‰€ä»¥:                                                                     â”‚
â”‚   - å†’æ³¡: æ­£åºéå† button â†’ div (ä»å†…åˆ°å¤–)                                  â”‚
â”‚   - æ•è·: å€’åºéå† div â†’ button (ä»å¤–åˆ°å†…)                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 3: ä» DOM èŠ‚ç‚¹æŸ¥æ‰¾ Fiber
// ============================================================

/**
 * ğŸ“Š DOM èŠ‚ç‚¹ä¸ Fiber çš„å…³è”
 */

const domToFiberMapping = `
ğŸ“Š DOM èŠ‚ç‚¹ä¸ Fiber çš„å…³è”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DOM èŠ‚ç‚¹ä¸Šçš„ç‰¹æ®Šå±æ€§                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   React åœ¨æ¸²æŸ“æ—¶ä¼šåœ¨ DOM èŠ‚ç‚¹ä¸Šè®¾ç½®ç‰¹æ®Šå±æ€§:                                â”‚
â”‚                                                                             â”‚
â”‚   ğŸ“ ReactDOMComponentTree.js                                              â”‚
â”‚                                                                             â”‚
â”‚   const internalInstanceKey = '__reactFiber$' + randomKey;                  â”‚
â”‚   const internalPropsKey = '__reactProps$' + randomKey;                     â”‚
â”‚   const internalContainerInstanceKey = '__reactContainer$' + randomKey;     â”‚
â”‚                                                                             â”‚
â”‚   DOM èŠ‚ç‚¹ç»“æ„:                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚  <button>                                                             â”‚â”‚
â”‚   â”‚    __reactFiber$xxx:  Fiber å¯¹è±¡å¼•ç”¨                                  â”‚â”‚
â”‚   â”‚    __reactProps$xxx:  {onClick: fn, children: "Click Me"}            â”‚â”‚
â”‚   â”‚    __reactContainer$xxx: åªæœ‰ root container æœ‰                       â”‚â”‚
â”‚   â”‚                                                                       â”‚â”‚
â”‚   â”‚    innerHTML: "Click Me"                                              â”‚â”‚
â”‚   â”‚  </button>                                                            â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â”‚   è¿™äº›å±æ€§æ˜¯åœ¨ completeWork é˜¶æ®µè®¾ç½®çš„ï¼ˆåˆ›å»º DOM èŠ‚ç‚¹æ—¶ï¼‰                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æŸ¥æ‰¾ Fiber çš„è¿‡ç¨‹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ ReactDOMComponentTree.js: getClosestInstanceFromNode                  â”‚
â”‚                                                                             â”‚
â”‚   function getClosestInstanceFromNode(targetNode) {                         â”‚
â”‚     let targetInst = targetNode[internalInstanceKey];                       â”‚
â”‚     if (targetInst) {                                                       â”‚
â”‚       return targetInst;                                                    â”‚
â”‚     }                                                                       â”‚
â”‚                                                                             â”‚
â”‚     // å¦‚æœå½“å‰èŠ‚ç‚¹æ²¡æœ‰ Fiberï¼Œå‘ä¸ŠæŸ¥æ‰¾çˆ¶èŠ‚ç‚¹                               â”‚
â”‚     let parentNode = targetNode.parentNode;                                 â”‚
â”‚     while (parentNode) {                                                    â”‚
â”‚       targetInst = parentNode[internalContainerInstanceKey] ||              â”‚
â”‚                    parentNode[internalInstanceKey];                         â”‚
â”‚       if (targetInst) {                                                     â”‚
â”‚         // æ‰¾åˆ°æœ€è¿‘çš„ Fiber                                                 â”‚
â”‚         return targetInst;                                                  â”‚
â”‚       }                                                                     â”‚
â”‚       parentNode = parentNode.parentNode;                                   â”‚
â”‚     }                                                                       â”‚
â”‚     return null;                                                            â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â”‚   â­ ä¸ºä»€ä¹ˆæœ‰æ—¶å€™éœ€è¦å‘ä¸ŠæŸ¥æ‰¾ï¼Ÿ                                             â”‚
â”‚   å› ä¸ºçº¯æ–‡æœ¬èŠ‚ç‚¹ç­‰æ²¡æœ‰å¯¹åº”çš„ HostComponent Fiber                            â”‚
â”‚   éœ€è¦æ‰¾åˆ°æœ€è¿‘çš„æœ‰ Fiber çš„ç¥–å…ˆèŠ‚ç‚¹                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 4: äº‹ä»¶ä¼˜å…ˆçº§ä¸è°ƒåº¦
// ============================================================

/**
 * ğŸ“Š äº‹ä»¶ä¼˜å…ˆçº§ç¡®å®š
 */

const eventPriorityDetermination = `
ğŸ“Š äº‹ä»¶ä¼˜å…ˆçº§çš„ç¡®å®š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       getEventPriority                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ ReactDOMEventListener.js: getEventPriority                            â”‚
â”‚                                                                             â”‚
â”‚   function getEventPriority(domEventName) {                                 â”‚
â”‚     switch (domEventName) {                                                 â”‚
â”‚       // â­ ç¦»æ•£äº‹ä»¶ - DiscreteEventPriority (æœ€é«˜)                         â”‚
â”‚       case 'click':                                                         â”‚
â”‚       case 'keydown':                                                       â”‚
â”‚       case 'keyup':                                                         â”‚
â”‚       case 'mousedown':                                                     â”‚
â”‚       case 'mouseup':                                                       â”‚
â”‚       case 'input':                                                         â”‚
â”‚       case 'change':                                                        â”‚
â”‚       case 'submit':                                                        â”‚
â”‚       case 'focus':                                                         â”‚
â”‚       case 'blur':                                                          â”‚
â”‚         return DiscreteEventPriority;                                       â”‚
â”‚                                                                             â”‚
â”‚       // â­ è¿ç»­äº‹ä»¶ - ContinuousEventPriority                              â”‚
â”‚       case 'mousemove':                                                     â”‚
â”‚       case 'mouseenter':                                                    â”‚
â”‚       case 'mouseleave':                                                    â”‚
â”‚       case 'scroll':                                                        â”‚
â”‚       case 'wheel':                                                         â”‚
â”‚       case 'pointermove':                                                   â”‚
â”‚       case 'drag':                                                          â”‚
â”‚       case 'dragenter':                                                     â”‚
â”‚       case 'dragleave':                                                     â”‚
â”‚         return ContinuousEventPriority;                                     â”‚
â”‚                                                                             â”‚
â”‚       // â­ é»˜è®¤ä¼˜å…ˆçº§ - DefaultEventPriority                               â”‚
â”‚       default:                                                              â”‚
â”‚         return DefaultEventPriority;                                        â”‚
â”‚     }                                                                       â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ä¼˜å…ˆçº§å¦‚ä½•å½±å“æ›´æ–°                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ ReactDOMEventListener.js: dispatchDiscreteEvent                       â”‚
â”‚                                                                             â”‚
â”‚   function dispatchDiscreteEvent(...) {                                     â”‚
â”‚     setCurrentUpdatePriority(DiscreteEventPriority);  // â­ è®¾ç½®æ›´æ–°ä¼˜å…ˆçº§  â”‚
â”‚     // ... è§¦å‘äº‹ä»¶å¤„ç†                                                     â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â”‚   å½“äº‹ä»¶å¤„ç†å‡½æ•°è°ƒç”¨ setState æ—¶:                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚                                                                       â”‚â”‚
â”‚   â”‚   onClick = () => {                                                   â”‚â”‚
â”‚   â”‚     setState(newValue);  // è¿™ä¸ªæ›´æ–°ä¼šè¯»å–å½“å‰ä¼˜å…ˆçº§                   â”‚â”‚
â”‚   â”‚   }                                                                   â”‚â”‚
â”‚   â”‚                                                                       â”‚â”‚
â”‚   â”‚   requestUpdateLane ä¼šæ ¹æ® currentUpdatePriority è¿”å›å¯¹åº”çš„ Lane:     â”‚â”‚
â”‚   â”‚   - DiscreteEventPriority â†’ SyncLane (åŒæ­¥æ›´æ–°ï¼Œç«‹å³æ‰§è¡Œ)             â”‚â”‚
â”‚   â”‚   - ContinuousEventPriority â†’ InputContinuousLane                     â”‚â”‚
â”‚   â”‚   - DefaultEventPriority â†’ DefaultLane                                â”‚â”‚
â”‚   â”‚                                                                       â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â”‚   è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ click è§¦å‘çš„ setState ä¼šç«‹å³æ›´æ–°ï¼Œ                           â”‚
â”‚   è€Œ scroll è§¦å‘çš„æ›´æ–°å¯èƒ½ä¼šè¢«å»¶è¿Ÿã€‚                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 5: é¢è¯•è¦ç‚¹
// ============================================================

const interviewPoints = `
ğŸ’¡ Part 2 é¢è¯•è¦ç‚¹

Q1: æè¿°ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶ä»è§¦å‘åˆ°æ‰§è¡Œå›è°ƒçš„å®Œæ•´è¿‡ç¨‹
A: 10 ä¸ªæ­¥éª¤ï¼š
   1. ç”¨æˆ·ç‚¹å‡» â†’ æµè§ˆå™¨äº§ç”ŸåŸç”Ÿ click äº‹ä»¶
   2. äº‹ä»¶å†’æ³¡/æ•è·åˆ° root containerï¼ˆ#rootï¼‰
   3. React çš„ç›‘å¬å™¨è¢«è§¦å‘ï¼ˆdispatchDiscreteEventï¼‰
   4. è®¾ç½®äº‹ä»¶ä¼˜å…ˆçº§ï¼ˆDiscreteEventPriorityï¼‰
   5. è°ƒç”¨ dispatchEvent
   6. é€šè¿‡ event.target æ‰¾åˆ°å¯¹åº”çš„ Fiber
   7. è°ƒç”¨äº‹ä»¶æ’ä»¶ï¼ˆSimpleEventPluginï¼‰æå–äº‹ä»¶
   8. ä» target Fiber å‘ä¸Šéå†æ”¶é›†æ‰€æœ‰ç›‘å¬å™¨
   9. åˆ›å»º SyntheticEvent
   10. æŒ‰æ•è·/å†’æ³¡é¡ºåºæ‰§è¡Œç›‘å¬å™¨

Q2: React å¦‚ä½•æ¨¡æ‹Ÿæ•è·å’Œå†’æ³¡ï¼Ÿ
A: React åœ¨ root ä¸Šæ³¨å†Œäº†æ•è·å’Œå†’æ³¡ä¸¤ä¸ªç›‘å¬å™¨ã€‚
   æ”¶é›† listeners æ—¶æ˜¯ä» target å‘ä¸Šéå†çš„ï¼ˆç”Ÿæˆ [target, parent1, parent2, ...]ï¼‰
   - å†’æ³¡ï¼šæ­£åºéå†æ•°ç»„ï¼ˆä»å†…åˆ°å¤–ï¼‰
   - æ•è·ï¼šå€’åºéå†æ•°ç»„ï¼ˆä»å¤–åˆ°å†…ï¼‰

Q3: React å¦‚ä½•ä» DOM èŠ‚ç‚¹æ‰¾åˆ°å¯¹åº”çš„ Fiberï¼Ÿ
A: React åœ¨æ¸²æŸ“æ—¶ä¼šåœ¨ DOM èŠ‚ç‚¹ä¸Šè®¾ç½® __reactFiber$xxx å±æ€§ï¼ŒæŒ‡å‘å¯¹åº”çš„ Fiberã€‚
   äº‹ä»¶è§¦å‘æ—¶é€šè¿‡ event.target[internalInstanceKey] è·å– Fiberã€‚
   å¦‚æœå½“å‰èŠ‚ç‚¹æ²¡æœ‰ Fiberï¼Œä¼šå‘ä¸ŠæŸ¥æ‰¾çˆ¶èŠ‚ç‚¹ã€‚

Q4: äº‹ä»¶ä¼˜å…ˆçº§å¦‚ä½•å½±å“çŠ¶æ€æ›´æ–°ï¼Ÿ
A: React æ ¹æ®äº‹ä»¶ç±»å‹ç¡®å®šä¼˜å…ˆçº§ï¼ˆclick â†’ Discreteï¼Œscroll â†’ Continuousï¼‰
   äº‹ä»¶å¤„ç†å‰ä¼šè®¾ç½® currentUpdatePriorityã€‚
   å½“ setState è¢«è°ƒç”¨æ—¶ï¼Œæ ¹æ®è¿™ä¸ªä¼˜å…ˆçº§ç¡®å®šæ›´æ–°çš„ Laneã€‚
   Discrete äº‹ä»¶ â†’ SyncLane â†’ åŒæ­¥æ›´æ–°
   Continuous äº‹ä»¶ â†’ InputContinuousLane â†’ å¯èƒ½è¢«å»¶è¿Ÿ

Q5: stopPropagation åœ¨ React ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
A: SyntheticEvent.stopPropagation() ä¼šï¼š
   1. è°ƒç”¨åŸç”Ÿäº‹ä»¶çš„ stopPropagation()
   2. è®¾ç½® isPropagationStopped = true
   åœ¨ processDispatchQueueItemsInOrder ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨å‰éƒ½ä¼šæ£€æŸ¥è¿™ä¸ªæ ‡å¿—
   å¦‚æœä¸º trueï¼Œåç»­çš„ç›‘å¬å™¨å°±ä¸ä¼šè¢«è°ƒç”¨
`;

export {
  completeEventFlow,
  captureAndBubblePhases,
  domToFiberMapping,
  eventPriorityDetermination,
  interviewPoints,
};

