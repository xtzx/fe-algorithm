/**
 * ============================================================
 * ğŸ“š Phase 4: Hooks åŸç† - Part 5: æºç å¯¼èˆªä¸é˜…è¯»æŒ‡å—
 * ============================================================
 *
 * ğŸ“ æ ¸å¿ƒæºç ç›®å½•:
 * - packages/react/src/
 * - packages/react-reconciler/src/
 *
 * â±ï¸ é¢„è®¡æ—¶é—´ï¼š1-2 å°æ—¶
 * ğŸ¯ é¢è¯•æƒé‡ï¼šâ­â­â­â­
 */

// ============================================================
// Part 1: æ ¸å¿ƒæ–‡ä»¶æ¦‚è§ˆ
// ============================================================

/**
 * ğŸ“Š Hooks ç›¸å…³çš„æ ¸å¿ƒæ–‡ä»¶
 */

const coreFiles = `
ğŸ“Š Hooks ç›¸å…³çš„æ ¸å¿ƒæ–‡ä»¶

packages/react/src/
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡ä»¶                          â”‚ èŒè´£                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ReactCurrentDispatcher.js     â”‚ â­ å½“å‰ Dispatcher æŒ‡é’ˆ                     â”‚
â”‚                               â”‚ â€¢ current å±æ€§æŒ‡å‘å½“å‰ä½¿ç”¨çš„ hooks å®ç°     â”‚
â”‚                               â”‚ â€¢ æ˜¯ React åŒ…ä¸ Reconciler çš„æ¡¥æ¢           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ReactHooks.js                 â”‚ React åŒ…å¯¼å‡ºçš„ Hook å‡½æ•°                    â”‚
â”‚                               â”‚ â€¢ useState, useEffect ç­‰çš„å…¥å£              â”‚
â”‚                               â”‚ â€¢ å§”æ‰˜ç»™ ReactCurrentDispatcher.current     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ React.js                      â”‚ React åŒ…çš„å…¥å£                              â”‚
â”‚                               â”‚ â€¢ å¯¼å‡º useState, useEffect ç­‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


packages/react-reconciler/src/
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡ä»¶                              â”‚ èŒè´£                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ReactFiberHooks.new.js            â”‚ â­â­â­ Hooks çš„æ ¸å¿ƒå®ç°ï¼ˆæœ€é‡è¦ï¼‰        â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â”‚ æ•°æ®ç»“æ„å®šä¹‰:                           â”‚
â”‚                                   â”‚ â€¢ Hook ç±»å‹ (Line 148)                  â”‚
â”‚                                   â”‚ â€¢ Effect ç±»å‹ (Line 156)                â”‚
â”‚                                   â”‚ â€¢ UpdateQueue ç±»å‹ (Line 134)           â”‚
â”‚                                   â”‚ â€¢ Update ç±»å‹ (Line 126)                â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â”‚ æ ¸å¿ƒå‡½æ•°:                               â”‚
â”‚                                   â”‚ â€¢ renderWithHooks (Line 374)            â”‚
â”‚                                   â”‚ â€¢ mountWorkInProgressHook (Line 636)    â”‚
â”‚                                   â”‚ â€¢ updateWorkInProgressHook (Line 657)   â”‚
â”‚                                   â”‚ â€¢ mountState (Line 1505)                â”‚
â”‚                                   â”‚ â€¢ updateState (Line 1532)               â”‚
â”‚                                   â”‚ â€¢ mountEffect (Line 1702)               â”‚
â”‚                                   â”‚ â€¢ updateEffect (Line 1727)              â”‚
â”‚                                   â”‚ â€¢ dispatchSetState (Line 2228)          â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â”‚ Dispatcher å®šä¹‰:                        â”‚
â”‚                                   â”‚ â€¢ HooksDispatcherOnMount (Line 2427)    â”‚
â”‚                                   â”‚ â€¢ HooksDispatcherOnUpdate (Line 2454)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ReactFiberCommitWork.new.js       â”‚ â­â­ Effect çš„æ‰§è¡Œ                       â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â”‚ â€¢ commitHookEffectListMount (Line 562)  â”‚
â”‚                                   â”‚ â€¢ commitHookEffectListUnmount (Line 512)â”‚
â”‚                                   â”‚ â€¢ commitPassiveMountEffects             â”‚
â”‚                                   â”‚ â€¢ commitPassiveUnmountEffects           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ReactFiberBeginWork.new.js        â”‚ ç»„ä»¶æ¸²æŸ“å…¥å£                            â”‚
â”‚                                   â”‚ â€¢ updateFunctionComponent               â”‚
â”‚                                   â”‚   â””â”€â–¶ è°ƒç”¨ renderWithHooks              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ReactFiberWorkLoop.new.js         â”‚ æ¸²æŸ“è°ƒåº¦                                â”‚
â”‚                                   â”‚ â€¢ flushPassiveEffects                   â”‚
â”‚                                   â”‚ â€¢ è°ƒåº¦ useEffect çš„æ‰§è¡Œ                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ReactHookEffectTags.js            â”‚ Effect çš„æ ‡è®°å¸¸é‡                       â”‚
â”‚                                   â”‚ â€¢ HookHasEffect, HookLayout, HookPassiveâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 2: æ¨èé˜…è¯»é¡ºåº
// ============================================================

/**
 * ğŸ“Š æ¨èé˜…è¯»é¡ºåº
 */

const readingOrder = `
ğŸ“Š æ¨èé˜…è¯»é¡ºåº

Phase 4 æºç é˜…è¯»è·¯å¾„:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   ç¬¬ä¸€é˜¶æ®µï¼šç†è§£ Dispatcher æœºåˆ¶                                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚                                                                             â”‚
â”‚   1. ReactCurrentDispatcher.js                                              â”‚
â”‚      â€¢ å¾ˆç®€å•ï¼Œå°±ä¸€ä¸ª current å±æ€§                                          â”‚
â”‚      â€¢ ç†è§£è¿™æ˜¯ React ä¸ Reconciler é€šä¿¡çš„æ¡¥æ¢                              â”‚
â”‚                                                                             â”‚
â”‚   2. ReactHooks.js                                                          â”‚
â”‚      â€¢ çœ‹ useState, useEffect çš„å®šä¹‰                                        â”‚
â”‚      â€¢ ç†è§£å®ƒä»¬å¦‚ä½•å§”æ‰˜ç»™ dispatcher                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   ç¬¬äºŒé˜¶æ®µï¼šç†è§£æ•°æ®ç»“æ„                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚                                                                             â”‚
â”‚   3. ReactFiberHooks.new.js (Line 126-177)                                  â”‚
â”‚      â€¢ Hook ç±»å‹å®šä¹‰                                                        â”‚
â”‚      â€¢ UpdateQueue ç±»å‹å®šä¹‰                                                 â”‚
â”‚      â€¢ Update ç±»å‹å®šä¹‰                                                      â”‚
â”‚      â€¢ Effect ç±»å‹å®šä¹‰                                                      â”‚
â”‚                                                                             â”‚
â”‚   é‡ç‚¹ç†è§£ï¼š                                                                â”‚
â”‚   â€¢ memoizedState åœ¨ä¸åŒ Hook ä¸­çš„å«ä¹‰                                      â”‚
â”‚   â€¢ queue.pending çš„ç¯å½¢é“¾è¡¨ç»“æ„                                            â”‚
â”‚   â€¢ Effect é“¾è¡¨çš„ç»“æ„                                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   ç¬¬ä¸‰é˜¶æ®µï¼šç†è§£ Hook é“¾è¡¨çš„æ„å»º                                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚                                                                             â”‚
â”‚   4. ReactFiberHooks.new.js - renderWithHooks (Line 374)                    â”‚
â”‚      â€¢ å¦‚ä½•è®¾ç½® Dispatcher                                                  â”‚
â”‚      â€¢ å¦‚ä½•æ‰§è¡Œç»„ä»¶å‡½æ•°                                                     â”‚
â”‚      â€¢ å¦‚ä½•é‡ç½®çŠ¶æ€                                                         â”‚
â”‚                                                                             â”‚
â”‚   5. ReactFiberHooks.new.js - mountWorkInProgressHook (Line 636)            â”‚
â”‚      â€¢ é¦–æ¬¡æ¸²æŸ“å¦‚ä½•åˆ›å»º Hook                                                â”‚
â”‚      â€¢ å¦‚ä½•æ„å»ºé“¾è¡¨                                                         â”‚
â”‚                                                                             â”‚
â”‚   6. ReactFiberHooks.new.js - updateWorkInProgressHook (Line 657)           â”‚
â”‚      â€¢ æ›´æ–°æ¸²æŸ“å¦‚ä½•å¤ç”¨ Hook                                                â”‚
â”‚      â€¢ currentHook å’Œ workInProgressHook çš„ç§»åŠ¨                             â”‚
â”‚      â€¢ ä¸ºä»€ä¹ˆé¡ºåºå¿…é¡»ä¸€è‡´                                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   ç¬¬å››é˜¶æ®µï¼šç†è§£ useState å®ç°                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚                                                                             â”‚
â”‚   7. ReactFiberHooks.new.js - mountState (Line 1505)                        â”‚
â”‚      â€¢ å¦‚ä½•åˆå§‹åŒ– state                                                     â”‚
â”‚      â€¢ å¦‚ä½•åˆ›å»º UpdateQueue                                                 â”‚
â”‚      â€¢ å¦‚ä½•ç»‘å®š dispatch                                                    â”‚
â”‚                                                                             â”‚
â”‚   8. ReactFiberHooks.new.js - dispatchSetState (Line 2228)                  â”‚
â”‚      â€¢ setState çš„å†…éƒ¨å®ç°                                                  â”‚
â”‚      â€¢ Eager State ä¼˜åŒ–                                                     â”‚
â”‚      â€¢ å¦‚ä½•è§¦å‘æ›´æ–°                                                         â”‚
â”‚                                                                             â”‚
â”‚   9. ReactFiberHooks.new.js - updateReducer (è¢« updateState è°ƒç”¨)           â”‚
â”‚      â€¢ å¦‚ä½•å¤„ç†æ›´æ–°é˜Ÿåˆ—                                                     â”‚
â”‚      â€¢ å¦‚ä½•è®¡ç®—æ–° state                                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   ç¬¬äº”é˜¶æ®µï¼šç†è§£ useEffect å®ç°                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚                                                                             â”‚
â”‚   10. ReactFiberHooks.new.js - mountEffect (Line 1702)                      â”‚
â”‚       â€¢ å¦‚ä½•åˆ›å»º Effect                                                     â”‚
â”‚       â€¢ å¦‚ä½•æ‰“ flags æ ‡è®°                                                   â”‚
â”‚                                                                             â”‚
â”‚   11. ReactFiberHooks.new.js - pushEffect (Line 1544)                       â”‚
â”‚       â€¢ Effect é“¾è¡¨çš„æ„å»º                                                   â”‚
â”‚       â€¢ ç¯å½¢é“¾è¡¨çš„å®ç°                                                      â”‚
â”‚                                                                             â”‚
â”‚   12. ReactFiberHooks.new.js - updateEffect (Line 1727)                     â”‚
â”‚       â€¢ å¦‚ä½•æ¯”è¾ƒä¾èµ–                                                        â”‚
â”‚       â€¢ HookHasEffect æ ‡è®°çš„ä½œç”¨                                            â”‚
â”‚                                                                             â”‚
â”‚   13. ReactFiberCommitWork.new.js - commitHookEffectListMount/Unmount       â”‚
â”‚       â€¢ Effect å¦‚ä½•åœ¨ commit é˜¶æ®µæ‰§è¡Œ                                       â”‚
â”‚       â€¢ destroy å’Œ create çš„æ‰§è¡Œé¡ºåº                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 3: å…³é”®å‡½æ•°é€ŸæŸ¥è¡¨
// ============================================================

/**
 * ğŸ“Š å…³é”®å‡½æ•°é€ŸæŸ¥è¡¨
 */

const functionQuickRef = `
ğŸ“Š å…³é”®å‡½æ•°é€ŸæŸ¥è¡¨

Dispatcher ç›¸å…³
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‡½æ•°/å˜é‡                  â”‚ èŒè´£                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ReactCurrentDispatcher     â”‚ å½“å‰ Dispatcher æŒ‡é’ˆå¯¹è±¡                       â”‚
â”‚ HooksDispatcherOnMount     â”‚ é¦–æ¬¡æ¸²æŸ“ä½¿ç”¨çš„ Dispatcher                      â”‚
â”‚ HooksDispatcherOnUpdate    â”‚ æ›´æ–°æ¸²æŸ“ä½¿ç”¨çš„ Dispatcher                      â”‚
â”‚ renderWithHooks            â”‚ æ‰§è¡Œå‡½æ•°ç»„ä»¶ï¼Œè®¾ç½®/æ¢å¤ Dispatcher             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Hook é“¾è¡¨æ“ä½œ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‡½æ•°                       â”‚ èŒè´£                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ mountWorkInProgressHook    â”‚ é¦–æ¬¡æ¸²æŸ“æ—¶åˆ›å»º Hook èŠ‚ç‚¹å¹¶åŠ å…¥é“¾è¡¨             â”‚
â”‚ updateWorkInProgressHook   â”‚ æ›´æ–°æ¸²æŸ“æ—¶å¤ç”¨/å…‹éš† Hook èŠ‚ç‚¹                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


useState/useReducer ç›¸å…³
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‡½æ•°                       â”‚ èŒè´£                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ mountState                 â”‚ é¦–æ¬¡æ¸²æŸ“çš„ useState å®ç°                       â”‚
â”‚ updateState                â”‚ æ›´æ–°æ¸²æŸ“çš„ useState å®ç°ï¼ˆè°ƒç”¨ updateReducerï¼‰ â”‚
â”‚ mountReducer               â”‚ é¦–æ¬¡æ¸²æŸ“çš„ useReducer å®ç°                     â”‚
â”‚ updateReducer              â”‚ æ›´æ–°æ¸²æŸ“çš„ useReducer å®ç°ï¼Œå¤„ç†æ›´æ–°é˜Ÿåˆ—       â”‚
â”‚ dispatchSetState           â”‚ setState çš„å†…éƒ¨å®ç°                            â”‚
â”‚ dispatchReducerAction      â”‚ dispatch çš„å†…éƒ¨å®ç°                            â”‚
â”‚ basicStateReducer          â”‚ useState å†…éƒ¨ä½¿ç”¨çš„ reducer                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


useEffect/useLayoutEffect ç›¸å…³
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‡½æ•°                       â”‚ èŒè´£                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ mountEffect                â”‚ é¦–æ¬¡æ¸²æŸ“çš„ useEffect å®ç°                      â”‚
â”‚ updateEffect               â”‚ æ›´æ–°æ¸²æŸ“çš„ useEffect å®ç°                      â”‚
â”‚ mountLayoutEffect          â”‚ é¦–æ¬¡æ¸²æŸ“çš„ useLayoutEffect å®ç°                â”‚
â”‚ updateLayoutEffect         â”‚ æ›´æ–°æ¸²æŸ“çš„ useLayoutEffect å®ç°                â”‚
â”‚ mountEffectImpl            â”‚ effect æŒ‚è½½çš„å®é™…å®ç°                          â”‚
â”‚ updateEffectImpl           â”‚ effect æ›´æ–°çš„å®é™…å®ç°                          â”‚
â”‚ pushEffect                 â”‚ åˆ›å»º Effect å¯¹è±¡å¹¶åŠ å…¥é“¾è¡¨                     â”‚
â”‚ areHookInputsEqual         â”‚ æ¯”è¾ƒä¾èµ–æ•°ç»„æ˜¯å¦ç›¸ç­‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ commitHookEffectListMount  â”‚ æ‰§è¡Œ effect çš„ create å‡½æ•°                     â”‚
â”‚ commitHookEffectListUnmountâ”‚ æ‰§è¡Œ effect çš„ destroy å‡½æ•°                    â”‚
â”‚ commitPassiveMountEffects  â”‚ æ‰§è¡Œ useEffect çš„ createï¼ˆå¼‚æ­¥ï¼‰               â”‚
â”‚ commitPassiveUnmountEffectsâ”‚ æ‰§è¡Œ useEffect çš„ destroyï¼ˆå¼‚æ­¥ï¼‰              â”‚
â”‚ flushPassiveEffects        â”‚ è§¦å‘ Passive Effects çš„æ‰§è¡Œ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


å…¶ä»– Hooks
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‡½æ•°                       â”‚ èŒè´£                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ mountRef / updateRef       â”‚ useRef å®ç°                                    â”‚
â”‚ mountMemo / updateMemo     â”‚ useMemo å®ç°                                   â”‚
â”‚ mountCallback / updateCallback â”‚ useCallback å®ç°                           â”‚
â”‚ mountContext               â”‚ useContext å®ç°ï¼ˆè¯»å– Contextï¼‰                â”‚
â”‚ mountTransition            â”‚ useTransition å®ç°                             â”‚
â”‚ mountDeferredValue         â”‚ useDeferredValue å®ç°                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 4: ä¸å…¶ä»– Phase çš„å…³è”
// ============================================================

/**
 * ğŸ“Š ä¸å…¶ä»– Phase çš„å…³è”
 */

const phaseConnections = `
ğŸ“Š ä¸å…¶ä»– Phase çš„å…³è”

Phase 2: Fiber æ¶æ„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Hook é“¾è¡¨æŒ‚åœ¨ Fiber ä¸Š:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   FiberNode (å‡½æ•°ç»„ä»¶)                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚ memoizedState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  â”‚
â”‚   â”‚                 Hook é“¾è¡¨ï¼ˆuseState, useMemo, useEffect...ï¼‰        â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚ updateQueue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  â”‚
â”‚   â”‚                 Effect é“¾è¡¨ï¼ˆuseEffect, useLayoutEffectï¼‰          â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   æ³¨æ„ï¼šå‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶çš„ memoizedState / updateQueue å«ä¹‰ä¸åŒï¼           â”‚
â”‚   â€¢ å‡½æ•°ç»„ä»¶ memoizedState â†’ Hook é“¾è¡¨å¤´                                   â”‚
â”‚   â€¢ ç±»ç»„ä»¶ memoizedState â†’ state å¯¹è±¡                                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Phase 3: æ¸²æŸ“æµç¨‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Hooks åœ¨æ¸²æŸ“æµç¨‹ä¸­çš„ä½ç½®:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   beginWork                                                                 â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”‚ å‡½æ•°ç»„ä»¶                                                             â”‚
â”‚      â–¼                                                                      â”‚
â”‚   updateFunctionComponent                                                   â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚  renderWithHooks(current, workInProgress, Component, props, ...)    â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚  1. è®¾ç½® currentlyRenderingFiber = workInProgress                   â”‚  â”‚
â”‚   â”‚  2. é‡ç½® workInProgress.memoizedState = null                        â”‚  â”‚
â”‚   â”‚  3. é€‰æ‹© Dispatcherï¼ˆMount / Updateï¼‰                               â”‚  â”‚
â”‚   â”‚  4. â­ Component(props)  â† æ‰§è¡Œç»„ä»¶ï¼ŒHooks åœ¨è¿™é‡Œè°ƒç”¨               â”‚  â”‚
â”‚   â”‚  5. æ¢å¤ Dispatcher                                                 â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚   reconcileChildren (Diff ç®—æ³•)                                             â”‚
â”‚                                                                             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚   commitRoot                                                                â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”œâ”€â”€ commitMutationEffects                                              â”‚
â”‚      â”‚      â””â”€â”€ useLayoutEffect destroy                                     â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”œâ”€â”€ commitLayoutEffects                                                â”‚
â”‚      â”‚      â””â”€â”€ useLayoutEffect create                                      â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â””â”€â”€ flushPassiveEffects (å¼‚æ­¥)                                         â”‚
â”‚             â””â”€â”€ useEffect destroy / create                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Phase 5: Diff ç®—æ³•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Hooks æœ¬èº«ä¸å½±å“ Diffï¼Œä½† Hooks äº§ç”Ÿçš„æ›´æ–°ä¼šè§¦å‘ Diff:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   useState äº§ç”Ÿæ›´æ–°:                                                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚                                                                             â”‚
â”‚   setCount(1)                                                               â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â””â”€â–¶ dispatchSetState                                                   â”‚
â”‚             â”‚                                                               â”‚
â”‚             â””â”€â–¶ scheduleUpdateOnFiber                                       â”‚
â”‚                    â”‚                                                        â”‚
â”‚                    â””â”€â–¶ è¿›å…¥ Render é˜¶æ®µ                                     â”‚
â”‚                           â”‚                                                 â”‚
â”‚                           â””â”€â–¶ beginWork â†’ reconcileChildren (Diff)         â”‚
â”‚                                                                             â”‚
â”‚   Hooks å†³å®šç»„ä»¶è¿”å›ä»€ä¹ˆ JSXï¼ŒDiff æ¯”è¾ƒæ–°æ—§ JSXã€‚                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Phase 6: è°ƒåº¦æœºåˆ¶
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

setState å¦‚ä½•è§¦å‘è°ƒåº¦:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   dispatchSetState                                                          â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”‚ åˆ›å»º Updateï¼ŒåŠ å…¥é˜Ÿåˆ—                                                â”‚
â”‚      â–¼                                                                      â”‚
â”‚   enqueueConcurrentHookUpdate                                               â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”‚ è¿”å› FiberRoot                                                       â”‚
â”‚      â–¼                                                                      â”‚
â”‚   scheduleUpdateOnFiber(root, fiber, lane, eventTime)                       â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â”‚ è¿›å…¥è°ƒåº¦æµç¨‹                                                         â”‚
â”‚      â–¼                                                                      â”‚
â”‚   ensureRootIsScheduled                                                     â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â””â”€â–¶ Scheduler è°ƒåº¦æ¸²æŸ“ä»»åŠ¡                                             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 5: çœŸå®æ¡ˆä¾‹åˆ†æ
// ============================================================

/**
 * ğŸ“Š çœŸå®æ¡ˆä¾‹åˆ†æ
 */

const realCases = `
ğŸ“Š çœŸå®æ¡ˆä¾‹åˆ†æ

ç¤ºä¾‹ Aï¼šè®¡æ•°å™¨ç»„ä»¶
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log('count changed:', count);
    return () => console.log('cleanup:', count);
  }, [count]);

  return (
    <button onClick={() => setCount(count + 1)}>
      {count}
    </button>
  );
}


é¦–æ¬¡æ¸²æŸ“æ—¶ Hook é“¾è¡¨:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   Fiber.memoizedState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                                                           â”‚â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚   â”‚ Hook 1 (useState)                   â”‚â”€â”€â”€â–¶â”‚ Hook 2 (useEffect)     â”‚  â”‚â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”‚
â”‚   â”‚ memoizedState: 0                    â”‚    â”‚ memoizedState: Effect  â”‚  â”‚â”‚
â”‚   â”‚ queue: {                            â”‚    â”‚ next: null             â”‚  â”‚â”‚
â”‚   â”‚   pending: null,                    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚   â”‚   dispatch: setCount,               â”‚                                â”‚â”‚
â”‚   â”‚ }                                   â”‚                                â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚â”‚
â”‚                                                                           â”‚â”‚
â”‚   Fiber.updateQueue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚                                                                        â”‚ â”‚â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”˜â”‚
â”‚   â”‚                                                                    â”‚  â”‚
â”‚   â”‚  lastEffect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  â”‚
â”‚   â”‚                                                                    â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚  â”‚
â”‚   â”‚  â”‚ Effect                             â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                              â”‚
â”‚   â”‚  â”‚ tag: Passive | HookHasEffect       â”‚                              â”‚
â”‚   â”‚  â”‚ create: () => { log; return cleanup; }â”‚                           â”‚
â”‚   â”‚  â”‚ destroy: undefined                 â”‚                              â”‚
â”‚   â”‚  â”‚ deps: [0]                          â”‚                              â”‚
â”‚   â”‚  â”‚ next: self (ç¯å½¢)                  â”‚                              â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚   â”‚                                                                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ç¤ºä¾‹ Bï¼šå¤šä¸ª Hook ç»„åˆï¼ˆé”™è¯¯æ¨¡å¼åˆ†æï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ é”™è¯¯ä»£ç 
function BadComponent({ showCount }) {
  if (showCount) {
    const [count, setCount] = useState(0);  // æ¡ä»¶ä¸­è°ƒç”¨ï¼
  }
  const [name, setName] = useState('React');
  useMemo(() => name.length, [name]);

  return <div>{name}</div>;
}


ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼ˆshowCount = trueï¼‰:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Hook é“¾è¡¨:
  Hook1 (count)  â”€â”€â–¶  Hook2 (name)  â”€â”€â–¶  Hook3 (memo)
       â†‘                   â†‘                 â†‘
  ç¬¬ 1 æ¬¡è°ƒç”¨        ç¬¬ 2 æ¬¡è°ƒç”¨       ç¬¬ 3 æ¬¡è°ƒç”¨


ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼ˆshowCount = falseï¼‰:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   current Fiber çš„ Hook é“¾è¡¨:                                               â”‚
â”‚   Hook1 (count)  â”€â”€â–¶  Hook2 (name)  â”€â”€â–¶  Hook3 (memo)                      â”‚
â”‚                                                                             â”‚
â”‚   æ›´æ–°æ¸²æŸ“æ—¶:                                                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚                                                                             â”‚
â”‚   ç¬¬ 1 æ¬¡è°ƒç”¨ useState('React'):                                            â”‚
â”‚   currentHook ç§»åŠ¨åˆ° Hook1 (count)                                         â”‚
â”‚                                                                             â”‚
â”‚   âš ï¸ é—®é¢˜ï¼šname çš„ useState è¯»å–åˆ°äº† count çš„ Hookï¼                       â”‚
â”‚   name ä¼šå˜æˆ 0ï¼ˆcount çš„å€¼ï¼‰                                               â”‚
â”‚                                                                             â”‚
â”‚   ç¬¬ 2 æ¬¡è°ƒç”¨ useMemo:                                                      â”‚
â”‚   currentHook ç§»åŠ¨åˆ° Hook2 (name)                                          â”‚
â”‚                                                                             â”‚
â”‚   âš ï¸ useMemo è¯»å–åˆ°äº† name çš„ Hookï¼Œç»“æ„ä¸åŒ¹é…ï¼                           â”‚
â”‚                                                                             â”‚
â”‚   å¦‚æœè¿˜æœ‰æ›´å¤š Hook è°ƒç”¨:                                                   â”‚
â”‚   currentHook.next === null                                                â”‚
â”‚   â†’ throw Error('Rendered more hooks than during the previous render.')    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`;

// ============================================================
// Part 6: é¢è¯•é«˜é¢‘é—®é¢˜
// ============================================================

/**
 * ğŸ“Š é¢è¯•é«˜é¢‘é—®é¢˜
 */

const interviewQuestions = `
ğŸ’¡ Phase 4 é¢è¯•é«˜é¢‘é—®é¢˜

åŸºç¡€æ¦‚å¿µ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Q1: Hooks çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ

Q2: ä»€ä¹ˆæ˜¯ Dispatcherï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ä¸åŒçš„ Dispatcherï¼Ÿ

Q3: ä¸ºä»€ä¹ˆ Hook å¿…é¡»åœ¨å‡½æ•°ç»„ä»¶é¡¶å±‚è°ƒç”¨ï¼Ÿ

Q4: Hook å¯¹è±¡çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼ŸmemoizedState åœ¨ä¸åŒ Hook ä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ


useState ç›¸å…³
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Q5: useState å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸmountState å’Œ updateState æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

Q6: ä»€ä¹ˆæ˜¯ Eager State ä¼˜åŒ–ï¼Ÿå®ƒè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

Q7: è¿ç»­è°ƒç”¨å¤šæ¬¡ setState ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæ‰¹é‡æ›´æ–°æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ

Q8: ä¸ºä»€ä¹ˆ useState æ˜¯åŸºäº useReducer å®ç°çš„ï¼Ÿ


useEffect ç›¸å…³
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Q9: useEffect çš„ create å’Œ destroy åˆ†åˆ«åœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿ

Q10: useEffect å’Œ useLayoutEffect æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

Q11: ä¾èµ–æ•°ç»„æ˜¯å¦‚ä½•æ¯”è¾ƒçš„ï¼Ÿä¼ ç©ºæ•°ç»„å’Œä¸ä¼ æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

Q12: ä¸ºä»€ä¹ˆæ¸…ç†å‡½æ•°æ‹¿åˆ°çš„æ˜¯æ—§å€¼ï¼Ÿ


åŸç†æ·±å…¥
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Q13: Effect é“¾è¡¨å’Œ Hook é“¾è¡¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

Q14: HookHasEffect æ ‡è®°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

Q15: renderWithHooks åšäº†ä»€ä¹ˆï¼Ÿ


å‚è€ƒç­”æ¡ˆè¦ç‚¹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

A1: Hooks æœ¬è´¨æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œå­˜å‚¨åœ¨ Fiber.memoizedState ä¸Šã€‚
    æ¯ä¸ª Hook æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« memoizedStateã€queueã€next ç­‰å­—æ®µã€‚

A3: React é€šè¿‡ä½ç½®ï¼ˆè°ƒç”¨é¡ºåºï¼‰æ¥è¯†åˆ«æ¯ä¸ª Hookã€‚
    æ›´æ–°æ—¶æŒ‰é¡ºåºéå†é“¾è¡¨ï¼Œå¦‚æœé¡ºåºæ”¹å˜ä¼šå¯¼è‡´çŠ¶æ€é”™ä¹±ã€‚

A6: è°ƒç”¨ setState æ—¶ï¼Œå¦‚æœå½“å‰æ²¡æœ‰å¾…å¤„ç†çš„æ›´æ–°ï¼ŒReact ä¼šæå‰è®¡ç®—æ–°çŠ¶æ€ã€‚
    å¦‚æœæ–°æ—§çŠ¶æ€ç›¸åŒï¼ˆObject.isï¼‰ï¼Œç›´æ¥è·³è¿‡æ›´æ–°è°ƒåº¦ã€‚

A9: éƒ½åœ¨ commit åçš„ Passive Effects é˜¶æ®µå¼‚æ­¥æ‰§è¡Œï¼š
    å…ˆæ‰§è¡Œæ‰€æœ‰ destroyï¼ˆæ¸…ç†ä¸Šæ¬¡çš„ï¼‰ï¼Œå†æ‰§è¡Œæ‰€æœ‰ createï¼ˆæœ¬æ¬¡çš„ï¼‰ã€‚

A10: æ‰§è¡Œæ—¶æœºä¸åŒï¼š
     - useLayoutEffectï¼šLayout é˜¶æ®µåŒæ­¥æ‰§è¡Œï¼Œé˜»å¡ç»˜åˆ¶
     - useEffectï¼šPassive é˜¶æ®µå¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ç»˜åˆ¶
`;

// ============================================================
// Part 7: å­¦ä¹ æ£€æŸ¥æ¸…å•
// ============================================================

const learningChecklist = `
ğŸ“‹ Phase 4 å­¦ä¹ æ£€æŸ¥æ¸…å•

Dispatcher æœºåˆ¶
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ ç†è§£ ReactCurrentDispatcher çš„ä½œç”¨
â–¡ çŸ¥é“ HooksDispatcherOnMount å’Œ HooksDispatcherOnUpdate çš„åŒºåˆ«
â–¡ ç†è§£ renderWithHooks å¦‚ä½•åˆ‡æ¢ Dispatcher


æ•°æ®ç»“æ„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ æŒæ¡ Hook å¯¹è±¡çš„ç»“æ„ï¼ˆmemoizedState, queue, nextï¼‰
â–¡ çŸ¥é“ä¸åŒ Hook çš„ memoizedState å­˜å‚¨ä»€ä¹ˆ
â–¡ ç†è§£ UpdateQueue çš„ç¯å½¢é“¾è¡¨ç»“æ„
â–¡ ç†è§£ Effect é“¾è¡¨çš„ç»“æ„


useState å®ç°
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ ç†è§£ mountState å’Œ updateState çš„åŒºåˆ«
â–¡ æŒæ¡ dispatchSetState çš„å®ç°
â–¡ ç†è§£ Eager State ä¼˜åŒ–
â–¡ çŸ¥é“æ›´æ–°é˜Ÿåˆ—å¦‚ä½•å¤„ç†


useEffect å®ç°
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ ç†è§£ mountEffect å’Œ updateEffect çš„åŒºåˆ«
â–¡ æŒæ¡ Effect åœ¨ commit é˜¶æ®µçš„æ‰§è¡Œæµç¨‹
â–¡ ç†è§£ useLayoutEffect å’Œ useEffect çš„åŒºåˆ«
â–¡ çŸ¥é“ä¾èµ–æ¯”è¾ƒçš„æœºåˆ¶


ç»¼åˆç†è§£
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ èƒ½è§£é‡Šä¸ºä»€ä¹ˆ Hook å¿…é¡»æŒ‰é¡ºåºè°ƒç”¨
â–¡ èƒ½ç”»å‡º Hook é“¾è¡¨çš„ç»“æ„
â–¡ ç†è§£ Hooks ä¸æ¸²æŸ“æµç¨‹çš„å…³ç³»
â–¡ èƒ½å›ç­”ç›¸å…³é¢è¯•é—®é¢˜
`;

export {
  coreFiles,
  readingOrder,
  functionQuickRef,
  phaseConnections,
  realCases,
  interviewQuestions,
  learningChecklist,
};

