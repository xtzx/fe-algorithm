/**
 * ğŸ“ é¢˜ç›®ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/regular-expression-matching/
 * ğŸ·ï¸ éš¾åº¦ï¼šHard
 * ğŸ·ï¸ æ ‡ç­¾ï¼šé€’å½’ã€å­—ç¬¦ä¸²ã€åŠ¨æ€è§„åˆ’
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªå­—ç¬¦è§„å¾‹ pï¼Œè¯·ä½ æ¥å®ç°ä¸€ä¸ªæ”¯æŒ '.' å’Œ '*' çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚
 *
 * '.' åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦
 * '*' åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ 
 *
 * æ‰€è°“åŒ¹é…ï¼Œæ˜¯è¦æ¶µç›– æ•´ä¸ª å­—ç¬¦ä¸² s çš„ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šs = "aa", p = "a"
 * è¾“å‡ºï¼šfalse
 *
 * è¾“å…¥ï¼šs = "aa", p = "a*"
 * è¾“å‡ºï¼štrue
 *
 * è¾“å…¥ï¼šs = "ab", p = ".*"
 * è¾“å‡ºï¼štrue
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// dp[i][j] = s[0..i-1] æ˜¯å¦åŒ¹é… p[0..j-1]
//
// çŠ¶æ€è½¬ç§»ï¼š
// 1. p[j-1] æ˜¯æ™®é€šå­—ç¬¦æˆ– '.'ï¼š
//    dp[i][j] = dp[i-1][j-1] && (s[i-1] === p[j-1] || p[j-1] === '.')
//
// 2. p[j-1] æ˜¯ '*'ï¼š
//    - '*' åŒ¹é… 0 æ¬¡ï¼šdp[i][j] = dp[i][j-2]
//    - '*' åŒ¹é… 1+ æ¬¡ï¼šdp[i][j] = dp[i-1][j] && (s[i-1] === p[j-2] || p[j-2] === '.')

// ============================================================
// è§£æ³•ï¼šåŠ¨æ€è§„åˆ’
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(mÃ—n) | ç©ºé—´å¤æ‚åº¦ï¼šO(mÃ—n)

/**
 * ğŸ“Š æ‰§è¡Œè¿‡ç¨‹å›¾è§£ï¼š
 *
 * s = "aab", p = "c*a*b"
 *
 * â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”
 * â”‚   â”‚ "" â”‚ c â”‚ c* â”‚ a â”‚ a* â”‚ b â”‚
 * â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¤
 * â”‚"" â”‚ T  â”‚ F â”‚ T  â”‚ F â”‚ T  â”‚ F â”‚
 * â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¤
 * â”‚ a â”‚ F  â”‚ F â”‚ F  â”‚ T â”‚ T  â”‚ F â”‚
 * â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¤
 * â”‚ a â”‚ F  â”‚ F â”‚ F  â”‚ F â”‚ T  â”‚ F â”‚
 * â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”¤
 * â”‚ b â”‚ F  â”‚ F â”‚ F  â”‚ F â”‚ F  â”‚ T â”‚
 * â””â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”˜
 *
 * ç­”æ¡ˆï¼šdp[3][5] = true
 */
function isMatch(s: string, p: string): boolean {
  const m = s.length;
  const n = p.length;

  // dp[i][j] = s[0..i-1] æ˜¯å¦åŒ¹é… p[0..j-1]
  const dp: boolean[][] = Array.from({ length: m + 1 }, () =>
    Array(n + 1).fill(false)
  );

  // ç©ºå­—ç¬¦ä¸²åŒ¹é…ç©ºæ¨¡å¼
  dp[0][0] = true;

  // åˆå§‹åŒ–ç¬¬ä¸€è¡Œï¼šç©ºå­—ç¬¦ä¸² vs æ¨¡å¼
  // åªæœ‰ a*b*c* è¿™æ ·çš„æ¨¡å¼æ‰èƒ½åŒ¹é…ç©ºå­—ç¬¦ä¸²
  for (let j = 2; j <= n; j++) {
    if (p[j - 1] === '*') {
      dp[0][j] = dp[0][j - 2]; // '*' åŒ¹é… 0 æ¬¡
    }
  }

  // å¡«è¡¨
  for (let i = 1; i <= m; i++) {
    for (let j = 1; j <= n; j++) {
      if (p[j - 1] === '*') {
        // '*' åŒ¹é… 0 æ¬¡
        dp[i][j] = dp[i][j - 2];

        // '*' åŒ¹é… 1+ æ¬¡
        if (matches(s, p, i, j - 1)) {
          dp[i][j] = dp[i][j] || dp[i - 1][j];
        }
      } else {
        // æ™®é€šå­—ç¬¦æˆ– '.'
        if (matches(s, p, i, j)) {
          dp[i][j] = dp[i - 1][j - 1];
        }
      }
    }
  }

  return dp[m][n];
}

// åˆ¤æ–­ s[i-1] æ˜¯å¦åŒ¹é… p[j-1]
function matches(s: string, p: string, i: number, j: number): boolean {
  return p[j - 1] === '.' || s[i - 1] === p[j - 1];
}

// ============================================================
// è§£æ³•äºŒï¼šè®°å¿†åŒ–é€’å½’
// ============================================================
function isMatch_memo(s: string, p: string): boolean {
  const m = s.length;
  const n = p.length;
  const memo: Map<string, boolean> = new Map();

  function dp(i: number, j: number): boolean {
    // æ¨¡å¼ç”¨å®Œäº†
    if (j === n) return i === m;

    const key = `${i},${j}`;
    if (memo.has(key)) return memo.get(key)!;

    // å½“å‰å­—ç¬¦æ˜¯å¦åŒ¹é…
    const firstMatch = i < m && (s[i] === p[j] || p[j] === '.');

    let result: boolean;
    if (j + 1 < n && p[j + 1] === '*') {
      // æœ‰ '*'ï¼šåŒ¹é… 0 æ¬¡ æˆ– åŒ¹é… 1+ æ¬¡
      result = dp(i, j + 2) || (firstMatch && dp(i + 1, j));
    } else {
      // æ™®é€šå­—ç¬¦æˆ– '.'
      result = firstMatch && dp(i + 1, j + 1);
    }

    memo.set(key, result);
    return result;
  }

  return dp(0, 0);
}

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. '*' çš„å«ä¹‰ï¼š
 *    - åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ª å‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ 
 *    - æ‰€ä»¥ '*' ä¸èƒ½å•ç‹¬å‡ºç°ï¼Œè¦å’Œå‰ä¸€ä¸ªå­—ç¬¦ä¸€èµ·è€ƒè™‘
 *
 * 2. '*' çš„ä¸¤ç§æƒ…å†µï¼š
 *    - åŒ¹é… 0 æ¬¡ï¼šdp[i][j] = dp[i][j-2]ï¼ˆè·³è¿‡ x*ï¼‰
 *    - åŒ¹é… 1+ æ¬¡ï¼šdp[i][j] = dp[i-1][j]ï¼ˆs æ¶ˆè€—ä¸€ä¸ªå­—ç¬¦ï¼‰
 *
 * 3. åˆå§‹åŒ–ï¼š
 *    - dp[0][0] = true
 *    - dp[0][j] åªæœ‰ a*b*c* å½¢å¼æ‰ä¸º true
 *
 * 4. '.' åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œä¸æ˜¯ä»»æ„å¤šä¸ªå­—ç¬¦
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - é€šé…ç¬¦åŒ¹é… â†’ '*' åŒ¹é…ä»»æ„å­—ç¬¦åºåˆ—ï¼Œ'?' åŒ¹é…å•ä¸ªå­—ç¬¦
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. è¡¨å•éªŒè¯ï¼šè¾“å…¥æ ¼å¼æ ¡éªŒ
 * 2. è·¯ç”±åŒ¹é…ï¼šURL æ¨¡å¼åŒ¹é…
 * 3. æœç´¢åŠŸèƒ½ï¼šæ”¯æŒé€šé…ç¬¦çš„æœç´¢
 */

export { isMatch, isMatch_memo };
export default isMatch;

