/**
 * ğŸ“ é¢˜ç›®ï¼šå’Œä¸º K çš„å­æ•°ç»„
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/subarray-sum-equals-k/
 * ğŸ·ï¸ éš¾åº¦ï¼šMedium
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ•°ç»„ã€å“ˆå¸Œè¡¨ã€å‰ç¼€å’Œ
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° kï¼Œ
 * è¯·ä½ ç»Ÿè®¡å¹¶è¿”å›è¯¥æ•°ç»„ä¸­å’Œä¸º k çš„è¿ç»­å­æ•°ç»„çš„ä¸ªæ•°ã€‚
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šnums = [1,1,1], k = 2
 * è¾“å‡ºï¼š2
 * è§£é‡Šï¼š[1,1] å‡ºç°äº† 2 æ¬¡ï¼ˆä¸‹æ ‡ 0-1 å’Œ 1-2ï¼‰
 *
 * è¾“å…¥ï¼šnums = [1,2,3], k = 3
 * è¾“å‡ºï¼š2
 * è§£é‡Šï¼š[1,2] å’Œ [3]
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// âš ï¸ æ³¨æ„ï¼šè¿™é“é¢˜ä¸èƒ½ç”¨æ»‘åŠ¨çª—å£ï¼å› ä¸ºå…ƒç´ å¯èƒ½æœ‰è´Ÿæ•°ï¼
//
// 1. æš´åŠ›æ€è·¯ï¼šæšä¸¾æ‰€æœ‰å­æ•°ç»„ï¼Œè®¡ç®—å’Œ â†’ O(nÂ²) æˆ– O(nÂ³)
//
// 2. å‰ç¼€å’Œæ€è·¯ï¼š
//    - sum[i,j] = prefix[j+1] - prefix[i]
//    - éœ€è¦æ‰¾ prefix[j+1] - prefix[i] = k
//    - å³ prefix[i] = prefix[j+1] - k
//
// 3. å‰ç¼€å’Œ + å“ˆå¸Œè¡¨ï¼ˆå…³é”®ä¼˜åŒ–ï¼‰ï¼š
//    - éå†æ—¶ï¼Œç»´æŠ¤å‰ç¼€å’Œ
//    - ç”¨å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªå‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°
//    - å¯¹äºå½“å‰å‰ç¼€å’Œ prefixSumï¼ŒæŸ¥æ‰¾ prefixSum - k å‡ºç°äº†å‡ æ¬¡
//
// ğŸ“Š å‰ç¼€å’Œ + å“ˆå¸Œè¡¨å›¾è§£ï¼š
//
//    nums = [1, 2, 3], k = 3
//
//    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
//    â”‚  ä¸‹æ ‡      0    1    2                                 â”‚
//    â”‚  nums     [1]  [2]  [3]                                â”‚
//    â”‚  prefix    0    1    3    6                            â”‚
//    â”‚                                                        â”‚
//    â”‚  éå†è¿‡ç¨‹ï¼š                                             â”‚
//    â”‚  i=0: prefix=1, æ‰¾ 1-3=-2, æ²¡æœ‰, map={0:1, 1:1}        â”‚
//    â”‚  i=1: prefix=3, æ‰¾ 3-3=0, æœ‰1æ¬¡! count=1, mapåŠ {3:1}   â”‚
//    â”‚  i=2: prefix=6, æ‰¾ 6-3=3, æœ‰1æ¬¡! count=2, mapåŠ {6:1}   â”‚
//    â”‚                                                        â”‚
//    â”‚  ç»“æœï¼šcount = 2                                        â”‚
//    â”‚  å¯¹åº”å­æ•°ç»„ï¼š[1,2] (prefix[2]-prefix[0]=3-0=3)          â”‚
//    â”‚             [3] (prefix[3]-prefix[2]=6-3=3)            â”‚
//    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// ============================================================
// è§£æ³•ä¸€ï¼šå‰ç¼€å’Œ + å“ˆå¸Œè¡¨ï¼ˆæ¨èï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)

/**
 * ğŸ”„ æµç¨‹å›¾ (Mermaid):
 * ```mermaid
 * flowchart TD
 *     A[prefixSum=0, count=0, map={0:1}] --> B[éå† nums]
 *     B --> C[prefixSum += nums[i]]
 *     C --> D{map æœ‰ prefixSum-k?}
 *     D -->|Yes| E[count += map[prefixSum-k]]
 *     D -->|No| F[ç»§ç»­]
 *     E --> G[map[prefixSum]++]
 *     F --> G
 *     G --> B
 *     B -->|éå†ç»“æŸ| H[è¿”å› count]
 * ```
 */
function subarraySum_v1(nums: number[], k: number): number {
  // map è®°å½•å‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°
  // åˆå§‹åŒ– {0: 1}ï¼šå‰ç¼€å’Œä¸º 0 å‡ºç° 1 æ¬¡ï¼ˆç©ºå‰ç¼€ï¼‰
  const map = new Map<number, number>([[0, 1]]);
  let prefixSum = 0;
  let count = 0;

  for (const num of nums) {
    // æ›´æ–°å‰ç¼€å’Œ
    prefixSum += num;

    // æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ prefixSum - k
    // å¦‚æœå­˜åœ¨ï¼Œè¯´æ˜å­˜åœ¨å­æ•°ç»„å’Œä¸º k
    if (map.has(prefixSum - k)) {
      count += map.get(prefixSum - k)!;
    }

    // è®°å½•å½“å‰å‰ç¼€å’Œ
    map.set(prefixSum, (map.get(prefixSum) || 0) + 1);
  }

  return count;
}

// ============================================================
// è§£æ³•äºŒï¼šå‰ç¼€å’Œ + æš´åŠ›æŸ¥æ‰¾
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)
// ğŸ“ ç†è§£å‰ç¼€å’ŒåŸç†ï¼Œä½†æ²¡æœ‰ç”¨å“ˆå¸Œè¡¨ä¼˜åŒ–
function subarraySum_v2(nums: number[], k: number): number {
  const n = nums.length;

  // æ„å»ºå‰ç¼€å’Œæ•°ç»„
  const prefix: number[] = new Array(n + 1).fill(0);
  for (let i = 0; i < n; i++) {
    prefix[i + 1] = prefix[i] + nums[i];
  }

  let count = 0;

  // æšä¸¾æ‰€æœ‰åŒºé—´ [i, j]
  for (let i = 0; i < n; i++) {
    for (let j = i; j < n; j++) {
      // åŒºé—´ [i, j] çš„å’Œ
      if (prefix[j + 1] - prefix[i] === k) {
        count++;
      }
    }
  }

  return count;
}

// ============================================================
// è§£æ³•ä¸‰ï¼šæš´åŠ›æšä¸¾ï¼ˆæœ€ç›´æ¥ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)
function subarraySum_v3(nums: number[], k: number): number {
  let count = 0;
  const n = nums.length;

  for (let i = 0; i < n; i++) {
    let sum = 0;
    for (let j = i; j < n; j++) {
      sum += nums[j];
      if (sum === k) {
        count++;
      }
    }
  }

  return count;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•             | æ—¶é—´   | ç©ºé—´  | ç‰¹ç‚¹                    |
 * |-----------------|--------|-------|------------------------|
 * | å‰ç¼€å’Œ+å“ˆå¸Œè¡¨    | O(n)   | O(n)  | æœ€ä¼˜è§£                  |
 * | å‰ç¼€å’Œ+æš´åŠ›      | O(nÂ²)  | O(n)  | ç†è§£å‰ç¼€å’ŒåŸç†          |
 * | æš´åŠ›            | O(nÂ²)  | O(1)  | ç®€å•ç›´æ¥                |
 *
 * âš ï¸ ä¸ºä»€ä¹ˆä¸èƒ½ç”¨æ»‘åŠ¨çª—å£ï¼Ÿ
 * - æ»‘åŠ¨çª—å£è¦æ±‚ï¼šæ‰©å¼ çª—å£æ—¶ç»“æœå˜å¤§ï¼Œæ”¶ç¼©çª—å£æ—¶ç»“æœå˜å°
 * - æœ¬é¢˜å…ƒç´ å¯èƒ½æœ‰è´Ÿæ•°ï¼Œä¸æ»¡è¶³å•è°ƒæ€§
 * - ä¾‹å¦‚ [-1, 1, 0]ï¼Œk=0ï¼Œæ»‘åŠ¨çª—å£æ— æ³•å¤„ç†
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. åˆå§‹åŒ– map = {0: 1}
 *    - ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå‰ç¼€å’Œæœ¬èº«ç­‰äº k æ—¶ï¼Œéœ€è¦æ‰¾åˆ°è¿™ä¸ªç©ºå‰ç¼€
 *    - ä¾‹å¦‚ nums=[3], k=3ï¼Œprefix=3ï¼Œæ‰¾ 3-3=0ï¼Œéœ€è¦ map æœ‰ 0
 *
 * 2. å…ˆæŸ¥è¯¢ï¼Œåè®°å½•
 *    - å¿…é¡»å…ˆ count += map.get(prefixSum - k)
 *    - å† map.set(prefixSum, ...)
 *    - é¡ºåºä¸èƒ½åï¼å¦åˆ™å¯èƒ½æŠŠè‡ªå·±ç®—è¿›å»
 *
 * 3. è¿™é“é¢˜æ˜¯æ±‚ã€Œä¸ªæ•°ã€ï¼Œä¸æ˜¯æ±‚ã€Œå­æ•°ç»„æœ¬èº«ã€
 *    - æ‰€ä»¥ç”¨å“ˆå¸Œè¡¨è®°å½•æ¬¡æ•°ï¼Œä¸éœ€è¦è®°å½•ä½ç½®
 *
 * 4. ä¸èƒ½ç”¨æ»‘åŠ¨çª—å£ï¼ˆæœ‰è´Ÿæ•°ï¼‰
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - ä¸¤æ•°ä¹‹å’Œ â†’ å“ˆå¸Œè¡¨ï¼ˆæ‰¾ target - numï¼‰
 * - è¿ç»­çš„å­æ•°ç»„å’Œ â†’ å‰ç¼€å’Œ + å“ˆå¸Œè¡¨ï¼ˆåˆ¤æ–­æ˜¯å¦èƒ½è¢« k æ•´é™¤ï¼‰
 * - è·¯å¾„æ€»å’Œ III â†’ æ ‘ä¸Šå‰ç¼€å’Œ + å“ˆå¸Œè¡¨
 * - ç»Ÿè®¡ã€Œä¼˜ç¾å­æ•°ç»„ã€â†’ å‰ç¼€å’Œå˜å½¢
 *
 * å…±åŒæ¨¡å¼ï¼šã€Œä¸¤æ•°ä¹‹å·®ä¸ºå®šå€¼ã€â†’ å“ˆå¸Œè¡¨ä¼˜åŒ–
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. è´¦å•ç»Ÿè®¡ï¼šç»Ÿè®¡æŸæ®µæ—¶é—´å†…æ”¶æ”¯åˆšå¥½æŠµæ¶ˆï¼ˆå’Œä¸º0ï¼‰çš„å­åŒºé—´æ•°
 * 2. æ•°æ®åˆ†æï¼šç»Ÿè®¡æŒ‡æ ‡ç´¯è®¡å€¼ç­‰äºæŸä¸ªç›®æ ‡çš„æ—¶é—´æ®µæ•°
 * 3. æ¸¸æˆè®¡åˆ†ï¼šç»Ÿè®¡åˆ†æ•°å˜åŒ–åˆšå¥½ç­‰äºæŸå€¼çš„å›åˆæ•°
 * 4. åº“å­˜ç®¡ç†ï¼šç»Ÿè®¡è¿›å‡ºåº“æ•°é‡åˆšå¥½å¹³è¡¡çš„æ—¶é—´æ®µæ•°
 */

// å¯¼å‡ºä¸»è§£æ³•
export { subarraySum_v1, subarraySum_v2, subarraySum_v3 };
export default subarraySum_v1;

