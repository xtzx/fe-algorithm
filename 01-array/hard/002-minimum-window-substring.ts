/**
 * ğŸ“ é¢˜ç›®ï¼šæœ€å°è¦†ç›–å­ä¸²
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/minimum-window-substring/
 * ğŸ·ï¸ éš¾åº¦ï¼šHard
 * ğŸ·ï¸ æ ‡ç­¾ï¼šå“ˆå¸Œè¡¨ã€å­—ç¬¦ä¸²ã€æ»‘åŠ¨çª—å£
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªå­—ç¬¦ä¸² tï¼Œè¿”å› s ä¸­æ¶µç›– t æ‰€æœ‰å­—ç¬¦çš„æœ€å°å­ä¸²ã€‚
 * å¦‚æœ s ä¸­ä¸å­˜åœ¨æ¶µç›– t æ‰€æœ‰å­—ç¬¦çš„å­ä¸²ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸² ""ã€‚
 *
 * æ³¨æ„ï¼š
 * - t ä¸­å¯èƒ½æœ‰é‡å¤å­—ç¬¦ï¼Œç»“æœå­ä¸²ä¸­è¯¥å­—ç¬¦æ•°é‡å¿…é¡»ä¸å°‘äº t ä¸­çš„æ•°é‡
 * - å¦‚æœå­˜åœ¨è¿™æ ·çš„å­ä¸²ï¼Œä¿è¯å®ƒæ˜¯å”¯ä¸€çš„ç­”æ¡ˆ
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šs = "ADOBECODEBANC", t = "ABC"
 * è¾“å‡ºï¼š"BANC"
 *
 * è¾“å…¥ï¼šs = "a", t = "a"
 * è¾“å‡ºï¼š"a"
 *
 * è¾“å…¥ï¼šs = "a", t = "aa"
 * è¾“å‡ºï¼š""
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// å…³é”®è¯ï¼šã€Œæœ€å°å­ä¸²ã€ã€ŒåŒ…å«æ‰€æœ‰å­—ç¬¦ã€â†’ æ»‘åŠ¨çª—å£ï¼
//
// 1. æš´åŠ›æ€è·¯ï¼šæšä¸¾æ‰€æœ‰å­ä¸²ï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å« t â†’ O(nÂ²) æˆ–æ›´æ…¢
//
// 2. æ»‘åŠ¨çª—å£æ€è·¯ï¼š
//    - æ‰©å¼ ï¼šä¸æ–­åŠ å…¥å­—ç¬¦ï¼Œç›´åˆ°çª—å£åŒ…å« t çš„æ‰€æœ‰å­—ç¬¦
//    - æ”¶ç¼©ï¼šå°è¯•ç¼©å°çª—å£ï¼Œæ‰¾åˆ°æœ€å°çš„æ»¡è¶³æ¡ä»¶çš„å­ä¸²
//    - å…³é”®ï¼šå¦‚ä½•é«˜æ•ˆåˆ¤æ–­ã€Œçª—å£åŒ…å« t çš„æ‰€æœ‰å­—ç¬¦ã€ï¼Ÿ
//
// 3. ä¼˜åŒ–åˆ¤æ–­ï¼š
//    - need: t ä¸­æ¯ä¸ªå­—ç¬¦éœ€è¦çš„æ•°é‡
//    - window: çª—å£ä¸­æ¯ä¸ªå­—ç¬¦çš„æ•°é‡
//    - valid: å·²ç»æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ç§ç±»æ•°
//    - å½“ valid == need.size æ—¶ï¼Œçª—å£æ»¡è¶³æ¡ä»¶
//
// ğŸ“Š æ»‘åŠ¨çª—å£è¿‡ç¨‹å›¾è§£ï¼š
//
//    s = "ADOBECODEBANC", t = "ABC"
//    need = {A:1, B:1, C:1}, need.size = 3
//
//    [A] D O B E C O D E B A N C     valid=1 (Aæ»¡è¶³)
//     â†‘
//
//    [A D O B] E C O D E B A N C     valid=2 (A,Bæ»¡è¶³)
//     â†‘     â†‘
//
//    [A D O B E C] O D E B A N C     valid=3 âœ“ æ»¡è¶³! è®°å½•, æ”¶ç¼©
//     â†‘         â†‘
//     len=6
//
//     A [D O B E C] O D E B A N C    valid=2 (Aä¸å¤Ÿ), ç»§ç»­æ‰©å¼ 
//       â†‘       â†‘
//
//    ... ç»§ç»­ ...
//
//    æœ€ç»ˆæ‰¾åˆ° "BANC" æ˜¯æœ€å°çš„

// ============================================================
// è§£æ³•ï¼šæ»‘åŠ¨çª—å£ + å“ˆå¸Œè¡¨
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n + m) | ç©ºé—´å¤æ‚åº¦ï¼šO(m)ï¼Œm æ˜¯å­—ç¬¦é›†å¤§å°

/**
 * ğŸ”„ æµç¨‹å›¾ (Mermaid):
 * ```mermaid
 * flowchart TD
 *     A[åˆå§‹åŒ– need, window, valid] --> B[æ‰©å¼ : right++]
 *     B --> C[æ›´æ–° window å’Œ valid]
 *     C --> D{valid == need.size?}
 *     D -->|Yes| E[è®°å½•å½“å‰çª—å£]
 *     E --> F[æ”¶ç¼©: left++]
 *     F --> G[æ›´æ–° window å’Œ valid]
 *     G --> D
 *     D -->|No| H{right < s.length?}
 *     H -->|Yes| B
 *     H -->|No| I[è¿”å›ç»“æœ]
 * ```
 */
function minWindow(s: string, t: string): string {
  // ç»Ÿè®¡ t ä¸­æ¯ä¸ªå­—ç¬¦éœ€è¦çš„æ•°é‡
  const need = new Map<string, number>();
  for (const c of t) {
    need.set(c, (need.get(c) || 0) + 1);
  }

  // çª—å£ä¸­æ¯ä¸ªå­—ç¬¦çš„æ•°é‡
  const window = new Map<string, number>();

  let left = 0;
  let right = 0;
  let valid = 0; // å·²æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ç§ç±»æ•°

  // è®°å½•æœ€å°è¦†ç›–å­ä¸²çš„èµ·å§‹ä½ç½®å’Œé•¿åº¦
  let start = 0;
  let minLen = Infinity;

  while (right < s.length) {
    // 1. æ‰©å¼ çª—å£
    const c = s[right];
    right++;

    // æ›´æ–°çª—å£æ•°æ®
    if (need.has(c)) {
      window.set(c, (window.get(c) || 0) + 1);
      // å½“è¯¥å­—ç¬¦çš„æ•°é‡æ»¡è¶³éœ€æ±‚æ—¶ï¼Œvalid++
      if (window.get(c) === need.get(c)) {
        valid++;
      }
    }

    // 2. æ”¶ç¼©çª—å£ï¼šå½“çª—å£åŒ…å« t çš„æ‰€æœ‰å­—ç¬¦æ—¶
    while (valid === need.size) {
      // æ›´æ–°æœ€å°è¦†ç›–å­ä¸²
      if (right - left < minLen) {
        start = left;
        minLen = right - left;
      }

      // æ”¶ç¼©çª—å£
      const d = s[left];
      left++;

      // æ›´æ–°çª—å£æ•°æ®
      if (need.has(d)) {
        // å½“è¯¥å­—ç¬¦çš„æ•°é‡ä¸å†æ»¡è¶³éœ€æ±‚æ—¶ï¼Œvalid--
        if (window.get(d) === need.get(d)) {
          valid--;
        }
        window.set(d, window.get(d)! - 1);
      }
    }
  }

  return minLen === Infinity ? '' : s.substring(start, start + minLen);
}

// ============================================================
// è¯¦ç»†ç‰ˆæœ¬ï¼ˆå¸¦æ³¨é‡Šï¼Œä¾¿äºç†è§£ï¼‰
// ============================================================
function minWindowDetailed(s: string, t: string): string {
  /**
   * ğŸ“Š å˜é‡è¯´æ˜ï¼š
   *
   * need: t ä¸­æ¯ä¸ªå­—ç¬¦éœ€è¦çš„æ•°é‡
   *       ä¾‹å¦‚ t="ABC", need={A:1, B:1, C:1}
   *
   * window: å½“å‰çª—å£ä¸­æ¯ä¸ªå­—ç¬¦çš„æ•°é‡
   *
   * valid: å·²ç»æ»¡è¶³éœ€æ±‚çš„å­—ç¬¦ç§ç±»æ•°
   *        å½“ window[c] >= need[c] æ—¶ï¼Œc è¿™ä¸ªå­—ç¬¦æ»¡è¶³
   *        å½“ valid == need.size æ—¶ï¼Œæ‰€æœ‰å­—ç¬¦éƒ½æ»¡è¶³
   */

  // Step 1: ç»Ÿè®¡ t ä¸­æ¯ä¸ªå­—ç¬¦çš„éœ€æ±‚
  const need = new Map<string, number>();
  for (const c of t) {
    need.set(c, (need.get(c) || 0) + 1);
  }

  const window = new Map<string, number>();
  let left = 0;
  let right = 0;
  let valid = 0;

  let start = 0;
  let minLen = Infinity;

  // Step 2: æ»‘åŠ¨çª—å£
  while (right < s.length) {
    // ===== æ‰©å¼ çª—å£ =====
    const c = s[right];
    right++;

    // å¦‚æœæ˜¯ t ä¸­çš„å­—ç¬¦ï¼Œæ›´æ–°çª—å£
    if (need.has(c)) {
      window.set(c, (window.get(c) || 0) + 1);
      // æ³¨æ„ï¼šåªæœ‰å½“æ•°é‡åˆšå¥½ç›¸ç­‰æ—¶æ‰ valid++
      // å¦‚æœ window[c] > need[c]ï¼Œä¸åº”è¯¥é‡å¤è®¡æ•°
      if (window.get(c) === need.get(c)) {
        valid++;
      }
    }

    // ===== æ”¶ç¼©çª—å£ =====
    // å½“æ‰€æœ‰å­—ç¬¦çš„éœ€æ±‚éƒ½æ»¡è¶³æ—¶ï¼Œå°è¯•æ”¶ç¼©
    while (valid === need.size) {
      // æ›´æ–°ç»“æœ
      if (right - left < minLen) {
        start = left;
        minLen = right - left;
      }

      // ç§»å‡ºå·¦è¾¹ç•Œçš„å­—ç¬¦
      const d = s[left];
      left++;

      if (need.has(d)) {
        // æ³¨æ„ï¼šåªæœ‰å½“æ•°é‡åˆšå¥½ç›¸ç­‰æ—¶æ‰ valid--
        if (window.get(d) === need.get(d)) {
          valid--;
        }
        window.set(d, window.get(d)! - 1);
      }
    }
  }

  return minLen === Infinity ? '' : s.substring(start, start + minLen);
}

// ============================================================
// ğŸ”„ æ»‘åŠ¨çª—å£æ¨¡æ¿æ€»ç»“
// ============================================================
/**
 * ğŸ“ æ»‘åŠ¨çª—å£é€šç”¨æ¨¡æ¿ï¼š
 *
 * function slidingWindow(s: string) {
 *   const window = new Map();
 *   let left = 0, right = 0;
 *
 *   while (right < s.length) {
 *     // 1. æ‰©å¼ çª—å£
 *     const c = s[right];
 *     right++;
 *     // æ›´æ–°çª—å£å†…æ•°æ® ...
 *
 *     // 2. åˆ¤æ–­æ˜¯å¦éœ€è¦æ”¶ç¼©
 *     while (éœ€è¦æ”¶ç¼©) {
 *       // å¦‚æœæ±‚æœ€å°ï¼Œåœ¨è¿™é‡Œæ›´æ–°ç»“æœ
 *
 *       const d = s[left];
 *       left++;
 *       // æ›´æ–°çª—å£å†…æ•°æ® ...
 *     }
 *
 *     // å¦‚æœæ±‚æœ€å¤§ï¼Œåœ¨è¿™é‡Œæ›´æ–°ç»“æœ
 *   }
 * }
 *
 * ä»€ä¹ˆæ—¶å€™ç”¨æ»‘åŠ¨çª—å£ï¼Ÿ
 * - è¿ç»­å­æ•°ç»„/å­ä¸²é—®é¢˜
 * - éœ€è¦æ»¡è¶³æŸç§æ¡ä»¶çš„æœ€é•¿/æœ€çŸ­
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. valid çš„æ›´æ–°æ—¶æœºï¼š
 *    - åªæœ‰å½“ window[c] == need[c] æ—¶æ‰ valid++
 *    - åªæœ‰å½“ window[c] == need[c] æ—¶æ‰ valid--
 *    - ä¸æ˜¯ >= æˆ– <= çš„å…³ç³»ï¼
 *
 * 2. æ”¶ç¼©çª—å£æ—¶ï¼Œå…ˆæ›´æ–°ç»“æœï¼Œå†ç§»åŠ¨ left
 *    - å› ä¸º [left, right) æ˜¯å½“å‰æœ‰æ•ˆçª—å£
 *
 * 3. ç©ºå­—ç¬¦ä¸²å¤„ç†ï¼š
 *    - å¦‚æœæ²¡æ‰¾åˆ°ï¼Œè¿”å› ""
 *
 * 4. t ä¸­å¯èƒ½æœ‰é‡å¤å­—ç¬¦ï¼š
 *    - ä¾‹å¦‚ t="AA"ï¼Œéœ€è¦çª—å£ä¸­è‡³å°‘æœ‰ 2 ä¸ª A
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸² â†’ æ»‘åŠ¨çª—å£ï¼ˆæ±‚æœ€é•¿ï¼Œæ‰©å¼ æ—¶æ›´æ–°ï¼‰
 * - æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯ â†’ æ»‘åŠ¨çª—å£ + å›ºå®šçª—å£å¤§å°
 * - å­—ç¬¦ä¸²çš„æ’åˆ— â†’ æ»‘åŠ¨çª—å£ + å›ºå®šçª—å£å¤§å°
 * - é•¿åº¦æœ€å°çš„å­æ•°ç»„ â†’ æ»‘åŠ¨çª—å£ï¼ˆæ±‚æœ€çŸ­ï¼Œæ”¶ç¼©æ—¶æ›´æ–°ï¼‰
 *
 * å…±åŒæ¨¡å¼ï¼šæ»‘åŠ¨çª—å£ + å“ˆå¸Œè¡¨è®¡æ•°
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. æœç´¢åŒ¹é…ï¼šåœ¨é•¿æ–‡æœ¬ä¸­æ‰¾åŒ…å«æ‰€æœ‰å…³é”®è¯çš„æœ€çŸ­ç‰‡æ®µ
 * 2. æƒé™æ£€æŸ¥ï¼šæ‰¾åŒ…å«æ‰€æœ‰å¿…éœ€æƒé™çš„æœ€å°æƒé™é›†
 * 3. æ—¥å¿—åˆ†æï¼šæ‰¾åŒ…å«æ‰€æœ‰é”™è¯¯ç±»å‹çš„æœ€çŸ­æ—¶é—´æ®µ
 * 4. å†…å®¹æ‘˜è¦ï¼šä»æ–‡ç« ä¸­æå–åŒ…å«å…³é”®ä¿¡æ¯çš„æœ€çŸ­æ®µè½
 */

// å¯¼å‡ºä¸»è§£æ³•
export { minWindow, minWindowDetailed };
export default minWindow;

