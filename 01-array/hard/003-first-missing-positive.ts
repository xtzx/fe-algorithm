/**
 * ğŸ“ é¢˜ç›®ï¼šç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°
 * ğŸ”— é“¾æ¥ï¼šhttps://leetcode.cn/problems/first-missing-positive/
 * ğŸ·ï¸ éš¾åº¦ï¼šHard
 * ğŸ·ï¸ æ ‡ç­¾ï¼šæ•°ç»„ã€å“ˆå¸Œè¡¨
 *
 * ğŸ“‹ é¢˜ç›®æè¿°ï¼š
 * ç»™ä½ ä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ numsï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­æ²¡æœ‰å‡ºç°çš„æœ€å°çš„æ­£æ•´æ•°ã€‚
 *
 * è¦æ±‚ï¼šæ—¶é—´å¤æ‚åº¦ O(n)ï¼Œç©ºé—´å¤æ‚åº¦ O(1)
 *
 * ç¤ºä¾‹ï¼š
 * è¾“å…¥ï¼šnums = [1,2,0]
 * è¾“å‡ºï¼š3
 *
 * è¾“å…¥ï¼šnums = [3,4,-1,1]
 * è¾“å‡ºï¼š2
 *
 * è¾“å…¥ï¼šnums = [7,8,9,11,12]
 * è¾“å‡ºï¼š1
 */

// ============================================================
// ğŸ’¡ æ€è·¯åˆ†æï¼šè¿™é“é¢˜çš„è§£æ³•æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ï¼Ÿ
// ============================================================
//
// å…³é”®çº¦æŸï¼šã€ŒO(n) æ—¶é—´ã€ã€ŒO(1) ç©ºé—´ã€
//
// 1. å¦‚æœæ²¡æœ‰ç©ºé—´é™åˆ¶ï¼š
//    - ç”¨ HashSet è®°å½•æ‰€æœ‰æ­£æ•´æ•°
//    - ä» 1 å¼€å§‹æ£€æŸ¥ï¼Œç¬¬ä¸€ä¸ªä¸åœ¨é›†åˆä¸­çš„å°±æ˜¯ç­”æ¡ˆ
//    - æ—¶é—´ O(n)ï¼Œç©ºé—´ O(n)
//
// 2. O(1) ç©ºé—´çš„æ€è€ƒï¼š
//    - ç­”æ¡ˆä¸€å®šåœ¨ [1, n+1] èŒƒå›´å†…ï¼ˆn æ˜¯æ•°ç»„é•¿åº¦ï¼‰
//    - ä¸ºä»€ä¹ˆï¼Ÿæœ€å¤šæœ‰ n ä¸ªæ­£æ•´æ•°ï¼Œå¦‚æœ 1~n éƒ½åœ¨ï¼Œç­”æ¡ˆæ˜¯ n+1
//    - å¯ä»¥ç”¨æ•°ç»„æœ¬èº«ä½œä¸ºå“ˆå¸Œè¡¨ï¼
//
// 3. åŸåœ°å“ˆå¸Œï¼š
//    - æŠŠæ•°å­— x æ”¾åˆ°ä¸‹æ ‡ x-1 çš„ä½ç½®
//    - å³ nums[i] = i + 1
//    - ç„¶åä»å¤´éå†ï¼Œç¬¬ä¸€ä¸ªä¸æ»¡è¶³ nums[i] = i + 1 çš„ä½ç½®å°±æ˜¯ç­”æ¡ˆ
//
// ğŸ“Š åŸåœ°å“ˆå¸Œå›¾è§£ï¼š
//
//    nums = [3, 4, -1, 1]
//
//    ç›®æ ‡ï¼šæŠŠæ•°å­—æ”¾åˆ°æ­£ç¡®ä½ç½®
//    - 1 åº”è¯¥åœ¨ index 0
//    - 2 åº”è¯¥åœ¨ index 1
//    - 3 åº”è¯¥åœ¨ index 2
//    - 4 åº”è¯¥åœ¨ index 3
//
//    åˆå§‹: [3, 4, -1, 1]
//
//    i=0: nums[0]=3, åº”è¯¥æ”¾åˆ° index 2
//         äº¤æ¢: [-1, 4, 3, 1]
//         nums[0]=-1 æ˜¯è´Ÿæ•°, è·³è¿‡
//
//    i=1: nums[1]=4, åº”è¯¥æ”¾åˆ° index 3
//         äº¤æ¢: [-1, 1, 3, 4]
//         nums[1]=1, åº”è¯¥æ”¾åˆ° index 0
//         äº¤æ¢: [1, -1, 3, 4]
//         nums[1]=-1 æ˜¯è´Ÿæ•°, è·³è¿‡
//
//    i=2: nums[2]=3, åœ¨æ­£ç¡®ä½ç½®, è·³è¿‡
//
//    i=3: nums[3]=4, åœ¨æ­£ç¡®ä½ç½®, è·³è¿‡
//
//    ç»“æœ: [1, -1, 3, 4]
//           â†‘   â†‘   â†‘   â†‘
//           1   ?   3   4
//               â†‘
//           index 1 åº”è¯¥æ˜¯ 2ï¼Œä½†ä¸æ˜¯
//           ç­”æ¡ˆæ˜¯ 2

// ============================================================
// è§£æ³•ä¸€ï¼šåŸåœ°å“ˆå¸Œï¼ˆæ¨èï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)

/**
 * ğŸ”„ æµç¨‹å›¾ (Mermaid):
 * ```mermaid
 * flowchart TD
 *     A[éå†æ•°ç»„] --> B{nums[i] åœ¨ [1,n] èŒƒå›´?}
 *     B -->|Yes| C{nums[i] åœ¨æ­£ç¡®ä½ç½®?}
 *     C -->|No| D[äº¤æ¢åˆ°æ­£ç¡®ä½ç½®]
 *     D --> B
 *     C -->|Yes| E[i++]
 *     B -->|No| E
 *     E --> F{i < n?}
 *     F -->|Yes| A
 *     F -->|No| G[å†æ¬¡éå†æ‰¾ç­”æ¡ˆ]
 * ```
 */
function firstMissingPositive_v1(nums: number[]): number {
  const n = nums.length;

  // Step 1: åŸåœ°å“ˆå¸Œï¼ŒæŠŠæ•°å­—æ”¾åˆ°æ­£ç¡®ä½ç½®
  for (let i = 0; i < n; i++) {
    // å½“ nums[i] åœ¨ [1, n] èŒƒå›´å†…ï¼Œä¸”ä¸åœ¨æ­£ç¡®ä½ç½®æ—¶ï¼Œäº¤æ¢
    while (
      nums[i] >= 1 &&
      nums[i] <= n &&
      nums[nums[i] - 1] !== nums[i] // ç›®æ ‡ä½ç½®çš„å€¼ä¸ç­‰äºå½“å‰å€¼ï¼ˆé¿å…æ­»å¾ªç¯ï¼‰
    ) {
      // äº¤æ¢ nums[i] å’Œ nums[nums[i] - 1]
      const targetIndex = nums[i] - 1;
      [nums[i], nums[targetIndex]] = [nums[targetIndex], nums[i]];
    }
  }

  // Step 2: æ‰¾ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ nums[i] = i + 1 çš„ä½ç½®
  for (let i = 0; i < n; i++) {
    if (nums[i] !== i + 1) {
      return i + 1;
    }
  }

  // å¦‚æœ 1~n éƒ½åœ¨ï¼Œç­”æ¡ˆæ˜¯ n+1
  return n + 1;
}

// ============================================================
// è§£æ³•äºŒï¼šæ ‡è®°æ³•ï¼ˆå¦ä¸€ç§ O(1) ç©ºé—´æ€è·¯ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(1)
// ğŸ“ æ€è·¯ï¼šç”¨æ­£è´Ÿå·æ ‡è®°æŸä¸ªæ•°æ˜¯å¦å‡ºç°

/**
 * ğŸ“Š æ ‡è®°æ³•å›¾è§£ï¼š
 *
 * nums = [3, 4, -1, 1]
 *
 * Step 1: æŠŠæ‰€æœ‰éæ­£æ•°æ”¹æˆ n+1ï¼ˆå› ä¸ºç­”æ¡ˆåœ¨ [1, n+1]ï¼‰
 *         [3, 4, 5, 1]
 *
 * Step 2: éå†æ•°ç»„ï¼Œå¦‚æœ |nums[i]| åœ¨ [1, n]ï¼ŒæŠŠå¯¹åº”ä½ç½®æ”¹æˆè´Ÿæ•°
 *         nums[0]=3, æŠŠ index 2 æ”¹æˆè´Ÿæ•°: [3, 4, -5, 1]
 *         nums[1]=4, æŠŠ index 3 æ”¹æˆè´Ÿæ•°: [3, 4, -5, -1]
 *         nums[2]=-5, |âˆ’5|=5 > n, è·³è¿‡
 *         nums[3]=-1, |âˆ’1|=1, æŠŠ index 0 æ”¹æˆè´Ÿæ•°: [-3, 4, -5, -1]
 *
 * Step 3: æ‰¾ç¬¬ä¸€ä¸ªæ­£æ•°çš„ä½ç½®
 *         [-3, 4, -5, -1]
 *              â†‘
 *         index 1 æ˜¯æ­£æ•°ï¼Œç­”æ¡ˆæ˜¯ 2
 */
function firstMissingPositive_v2(nums: number[]): number {
  const n = nums.length;

  // Step 1: æŠŠæ‰€æœ‰éæ­£æ•°æ”¹æˆ n+1
  for (let i = 0; i < n; i++) {
    if (nums[i] <= 0) {
      nums[i] = n + 1;
    }
  }

  // Step 2: ç”¨æ­£è´Ÿå·æ ‡è®°
  for (let i = 0; i < n; i++) {
    const num = Math.abs(nums[i]);
    if (num <= n) {
      // æŠŠ index = num-1 çš„ä½ç½®æ”¹æˆè´Ÿæ•°ï¼ˆå¦‚æœè¿˜æ˜¯æ­£æ•°ï¼‰
      if (nums[num - 1] > 0) {
        nums[num - 1] = -nums[num - 1];
      }
    }
  }

  // Step 3: æ‰¾ç¬¬ä¸€ä¸ªæ­£æ•°çš„ä½ç½®
  for (let i = 0; i < n; i++) {
    if (nums[i] > 0) {
      return i + 1;
    }
  }

  return n + 1;
}

// ============================================================
// è§£æ³•ä¸‰ï¼šHashSetï¼ˆå¦‚æœç©ºé—´å¯ä»¥ O(n)ï¼‰
// ============================================================
// â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) | ç©ºé—´å¤æ‚åº¦ï¼šO(n)
// ğŸ“ æœ€ç›´è§‚ï¼Œä½†ä¸æ»¡è¶³ O(1) ç©ºé—´è¦æ±‚
function firstMissingPositive_v3(nums: number[]): number {
  const set = new Set(nums);

  let result = 1;
  while (set.has(result)) {
    result++;
  }

  return result;
}

// ============================================================
// ğŸ”„ è§£æ³•å¯¹æ¯”
// ============================================================
/**
 * | è§£æ³•       | æ—¶é—´  | ç©ºé—´  | ç‰¹ç‚¹                        |
 * |-----------|-------|-------|----------------------------|
 * | åŸåœ°å“ˆå¸Œ   | O(n)  | O(1)  | æŠŠæ•°æ”¾åˆ°æ­£ç¡®ä½ç½®             |
 * | æ ‡è®°æ³•     | O(n)  | O(1)  | ç”¨æ­£è´Ÿå·æ ‡è®°                 |
 * | HashSet   | O(n)  | O(n)  | æœ€ç›´è§‚ï¼Œä¸æ»¡è¶³ç©ºé—´è¦æ±‚        |
 *
 * ä¸ºä»€ä¹ˆåŸåœ°å“ˆå¸Œæ˜¯ O(n)ï¼Ÿ
 * - è™½ç„¶æœ‰ while å¾ªç¯ï¼Œä½†æ¯ä¸ªæ•°æœ€å¤šè¢«äº¤æ¢ä¸€æ¬¡åˆ°æ­£ç¡®ä½ç½®
 * - æ€»äº¤æ¢æ¬¡æ•° <= n
 */

// ============================================================
// âš ï¸ æ˜“é”™ç‚¹
// ============================================================
/**
 * 1. while å¾ªç¯æ¡ä»¶ï¼š
 *    - nums[i] >= 1 && nums[i] <= nï¼šåªå¤„ç† [1, n] èŒƒå›´å†…çš„æ•°
 *    - nums[nums[i] - 1] !== nums[i]ï¼šç›®æ ‡ä½ç½®å·²ç»æ˜¯æ­£ç¡®çš„å€¼å°±è·³è¿‡
 *      ï¼ˆé¿å…æ­»å¾ªç¯ï¼Œä¾‹å¦‚ [1, 1] ä¼šæ— é™äº¤æ¢ï¼‰
 *
 * 2. äº¤æ¢æ—¶çš„ç´¢å¼•ï¼š
 *    - targetIndex = nums[i] - 1ï¼ˆæ•°å­— x åº”è¯¥åœ¨ index x-1ï¼‰
 *
 * 3. ç­”æ¡ˆèŒƒå›´ï¼š
 *    - ç­”æ¡ˆä¸€å®šåœ¨ [1, n+1]
 *    - æœ€å¤š n ä¸ªæ­£æ•´æ•°ï¼Œå¦‚æœ 1~n éƒ½æœ‰ï¼Œç­”æ¡ˆæ˜¯ n+1
 *
 * 4. æ ‡è®°æ³•ä¸­ Math.abs çš„ä½¿ç”¨ï¼š
 *    - å› ä¸ºå·²ç»æ ‡è®°è¿‡çš„ä½ç½®æ˜¯è´Ÿæ•°
 *    - éœ€è¦å–ç»å¯¹å€¼æ‰èƒ½å¾—åˆ°åŸæ¥çš„æ•°
 */

// ============================================================
// ğŸ”— ä¸¾ä¸€åä¸‰ï¼šç›¸ä¼¼é¢˜ç›®
// ============================================================
/**
 * - æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­— â†’ åŸåœ°æ ‡è®°
 * - æ•°ç»„ä¸­é‡å¤çš„æ•°æ® â†’ åŸåœ°æ ‡è®°
 * - ä¸¢å¤±çš„æ•°å­— â†’ ä½è¿ç®— / æ•°å­¦
 *
 * å…±åŒæ¨¡å¼ï¼šã€ŒåŸåœ°å“ˆå¸Œã€ç”¨æ•°ç»„æœ¬èº«ä½œä¸ºå“ˆå¸Œè¡¨
 */

// ============================================================
// ğŸ¢ å‰ç«¯ä¸šåŠ¡åœºæ™¯
// ============================================================
/**
 * 1. ID ç”Ÿæˆï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨çš„ IDï¼ˆè‡ªå¢ ID ç³»ç»Ÿï¼‰
 * 2. èµ„æºåˆ†é…ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªæœªè¢«ä½¿ç”¨çš„èµ„æºç¼–å·
 * 3. ä»»åŠ¡ç¼–å·ï¼šåˆ†é…ç¬¬ä¸€ä¸ªæœªä½¿ç”¨çš„ä»»åŠ¡ç¼–å·
 * 4. æ–‡ä»¶å‘½åï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶ç¼–å·ï¼ˆfile1, file2, ...ï¼‰
 */

// å¯¼å‡ºä¸»è§£æ³•
export {
  firstMissingPositive_v1,
  firstMissingPositive_v2,
  firstMissingPositive_v3,
};
export default firstMissingPositive_v1;

